(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{1554:function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function EventSource(){this.listeners=new Map}return EventSource.prototype.on=function(e,t){var n=this.listeners.get(e);n||(n=[],this.listeners.set(e,n)),n.push(t)},EventSource.prototype.onAny=function(e){var t=this.anyListeners;t||(t=[],this.anyListeners=t),t.push(e)},EventSource.prototype.off=function(e,t){var n=this.listeners.get(e);if(n){var r=n.indexOf(t);r>=0&&n.splice(r,1)}},EventSource.prototype.offAny=function(e){var t=this.anyListeners;if(t){var n=t.indexOf(e);n>=0&&t.splice(n,1)}},EventSource.prototype.trigger=function(e,t){var n,r=this.listeners.get(e);if(r)for(var i=0,o=r;i<o.length;i++){(0,o[i])(t,e)}if(this.anyListeners)for(var a=0,s=this.anyListeners;a<s.length;a++){(0,s[a])(((n={})[e]=t,n),e)}},EventSource}();t.EventSource=n;var r=function(){function EventObserver(){this.unsubscribeByKey=new Map,this.onDispose=[]}return EventObserver.prototype.listen=function(e,t,n){e.on(t,n),this.onDispose.push((function(){return e.off(t,n)}))},EventObserver.prototype.listenAny=function(e,t){e.onAny(t),this.onDispose.push((function(){return e.offAny(t)}))},EventObserver.prototype.listenOnce=function(e,t,n){var r=!1,onceListener=function(i,o){r=!0,e.off(t,onceListener),n(i,o)};e.on(t,onceListener),this.onDispose.push((function(){r||e.off(t,onceListener)}))},EventObserver.prototype.stopListening=function(){for(var e=0,t=this.onDispose;e<t.length;e++){(0,t[e])()}this.onDispose.length=0,this.unsubscribeByKey.forEach((function(e){for(var t=0,n=e;t<n.length;t++){(0,n[t])()}})),this.unsubscribeByKey.clear()},EventObserver}();t.EventObserver=r},1560:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1554),o=function(){function BatchingScheduler(e){void 0===e&&(e=0),this.waitingTime=e,this.useAnimationFrame=0===e,this.runSynchronously=this.runSynchronously.bind(this)}return BatchingScheduler.prototype.schedule=function(){void 0===this.scheduled&&(this.useAnimationFrame?this.scheduled=requestAnimationFrame(this.runSynchronously):this.scheduled=setTimeout(this.runSynchronously,this.waitingTime))},BatchingScheduler.prototype.runSynchronously=function(){this.cancelScheduledTimeout()&&this.run()},BatchingScheduler.prototype.dispose=function(){this.cancelScheduledTimeout()},BatchingScheduler.prototype.cancelScheduledTimeout=function(){return void 0!==this.scheduled&&(this.useAnimationFrame?cancelAnimationFrame(this.scheduled):clearTimeout(this.scheduled),this.scheduled=void 0,!0)},BatchingScheduler}();t.BatchingScheduler=o;var a=function(e){function BufferingQueue(t,n){void 0===n&&(n=200);var r=e.call(this,n)||this;return r.onFetch=t,r.fetchingQueue=Object.create(null),r}return r.__extends(BufferingQueue,e),BufferingQueue.prototype.push=function(e){this.fetchingQueue[e]=!0,this.schedule()},BufferingQueue.prototype.clear=function(){this.fetchingQueue=Object.create(null)},BufferingQueue.prototype.run=function(){var e=this.fetchingQueue,t=this.onFetch;this.fetchingQueue=Object.create(null),t(Object.keys(e))},BufferingQueue}(o);t.BufferingQueue=a;var s=function(e){function Debouncer(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(Debouncer,e),Debouncer.prototype.call=function(e){this.callback=e,this.schedule()},Debouncer.prototype.run=function(){(0,this.callback)()},Debouncer}(o);t.Debouncer=s;var l=function(){function Cancellation(){this.source=new i.EventSource,this.aborted=!1,this.signal=new(function(){function class_1(e){this.parent=e}return Object.defineProperty(class_1.prototype,"aborted",{get:function(){return this.parent.aborted},enumerable:!0,configurable:!0}),class_1.prototype.addEventListener=function(e,t){"abort"===e&&(this.parent.source?this.parent.source.on("abort",t):t())},class_1.prototype.removeEventListener=function(e,t){"abort"===e&&this.parent.source&&this.parent.source.off("abort",t)},class_1}())(this)}return Cancellation.prototype.abort=function(){this.aborted||(this.aborted=!0,this.source.trigger("abort",void 0),this.source=void 0)},Cancellation.NEVER_SIGNAL={aborted:!1,addEventListener:function(){},removeEventListener:function(){}},Cancellation}();t.Cancellation=l,function(e){e.throwIfAborted=function throwIfAborted(e){if(e.aborted)throw new c},e.mapCancelledToNull=function mapCancelledToNull(e,t){return t.then((function(t){return e.aborted?null:t}),(function(t){return e.aborted?null:Promise.reject(t)}))}}(t.CancellationToken||(t.CancellationToken={}));var c=function(e){function CancelledError(t){void 0===t&&(t="Operation was cancelled");var n=e.call(this,t)||this;return n.name=CancelledError.name,Object.setPrototypeOf(n,CancelledError.prototype),n}return r.__extends(CancelledError,e),CancelledError}(Error);t.CancelledError=c,t.delay=function delay(e){return new Promise((function(t){return setTimeout((function(){return t()}),e)}))},t.animateInterval=function animateInterval(e,t,n){return new Promise((function(r){var i,o,animate=function(a){if(!n||!n.signal.aborted){var s=a-(o=o||a);s>e&&(s=e),t(s/e),s<e?i=requestAnimationFrame(animate):r()}};n.signal.addEventListener("abort",(function(){cancelAnimationFrame(i),r()})),i=requestAnimationFrame(animate)}))},t.easeInOutBezier=function easeInOutBezier(e){return e<0?0:e>1?1:e*e*(3-2*e)}},1573:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1580),o=n(1554),a=n(1574);!function(e){e.in="in",e.out="out"}(t.LinkDirection||(t.LinkDirection={}));var s=function(){function Element(e){this.source=new o.EventSource,this.events=this.source,this.links=[];var t=e.id,n=e.data,r=e.position,i=void 0===r?{x:0,y:0}:r,a=e.size,s=void 0===a?{width:0,height:0}:a,l=e.fixedSize,c=e.expanded,u=void 0!==c&&c,d=e.group,p=e.elementState,h=e.temporary,f=void 0!==h&&h;this.id=t,this._data=n,this._position=i,this._size=s,this._fixedSize=l,this._expanded=u,this._group=d,this._elementState=p,this._temporary=f}return Object.defineProperty(Element.prototype,"iri",{get:function(){return this._data.id},enumerable:!0,configurable:!0}),Object.defineProperty(Element.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Element.prototype.setData=function(e){var t=this._data;t!==e&&(this._data=e,this.source.trigger("changeData",{source:this,previous:t}),function updateLinksToReferByNewIri(e,t,n){if(t===n)return;for(var i=0,o=e.links;i<o.length;i++){var a=o[i],s=a.data;s.sourceId===t&&(s=r.__assign(r.__assign({},s),{sourceId:n})),s.targetId===t&&(s=r.__assign(r.__assign({},s),{targetId:n})),a.setData(s)}}(this,t.id,e.id))},Object.defineProperty(Element.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),Element.prototype.setPosition=function(e){var t=this._position;t.x===e.x&&t.y===e.y||(this._position=e,this.source.trigger("changePosition",{source:this,previous:t}))},Object.defineProperty(Element.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Element.prototype.setSize=function(e){var t=this._size;t.width===e.width&&t.height===e.height||(this._size=e,this.source.trigger("changeSize",{source:this,previous:t}))},Object.defineProperty(Element.prototype,"isFixedSize",{get:function(){return this._fixedSize},enumerable:!0,configurable:!0}),Element.prototype.setFixedSize=function(e){this._fixedSize!==e&&(this._fixedSize=e)},Object.defineProperty(Element.prototype,"isExpanded",{get:function(){return this._expanded},enumerable:!0,configurable:!0}),Element.prototype.setExpanded=function(e){var t=this._expanded;t!==e&&(this._expanded=e,this.source.trigger("changeExpanded",{source:this,previous:t}))},Object.defineProperty(Element.prototype,"group",{get:function(){return this._group},enumerable:!0,configurable:!0}),Element.prototype.setGroup=function(e){var t=this._group;t!==e&&(this._group=e,this.source.trigger("changeGroup",{source:this,previous:t}))},Object.defineProperty(Element.prototype,"elementState",{get:function(){return this._elementState},enumerable:!0,configurable:!0}),Element.prototype.setElementState=function(e){var t=this._elementState;t!==e&&(this._elementState=e,this.source.trigger("changeElementState",{source:this,previous:t}))},Object.defineProperty(Element.prototype,"temporary",{get:function(){return this._temporary},enumerable:!0,configurable:!0}),Element.prototype.focus=function(){this.source.trigger("requestedFocus",{source:this})},Element.prototype.requestGroupContent=function(){this.source.trigger("requestedGroupContent",{source:this})},Element.prototype.addToFilter=function(e,t){this.source.trigger("requestedAddToFilter",{source:this,linkType:e,direction:t})},Element.prototype.redraw=function(){this.source.trigger("requestedRedraw",{source:this})},Element}();t.Element=s;var l=function(){function FatClassModel(e){this.source=new o.EventSource,this.events=this.source;var t=e.id,n=e.label,r=void 0===n?[]:n,i=e.count;this.id=t,this._label=r,this._count=i}return Object.defineProperty(FatClassModel.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),FatClassModel.prototype.setLabel=function(e){var t=this._label;t!==e&&(this._label=e,this.source.trigger("changeLabel",{source:this,previous:t}))},Object.defineProperty(FatClassModel.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),FatClassModel.prototype.setCount=function(e){var t=this._count;t!==e&&(this._count=e,this.source.trigger("changeCount",{source:this,previous:t}))},FatClassModel}();t.FatClassModel=l;var c=function(){function RichProperty(e){this.source=new o.EventSource,this.events=this.source;var t=e.id,n=e.label,r=void 0===n?[]:n;this.id=t,this._label=r}return Object.defineProperty(RichProperty.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),RichProperty.prototype.setLabel=function(e){var t=this._label;t!==e&&(this._label=e,this.source.trigger("changeLabel",{source:this,previous:t}))},RichProperty}();t.RichProperty=c;var u=function(){function Link(e){this.source=new o.EventSource,this.events=this.source;var t=e.id,n=void 0===t?i.GenerateID.forLink():t,r=e.typeId,a=e.sourceId,s=e.targetId,l=e.data,c=e.vertices,u=void 0===c?[]:c,d=e.linkState;this.id=n,this._typeId=r,this._sourceId=a,this._targetId=s,this._data=l,this._vertices=u,this._linkState=d}return Object.defineProperty(Link.prototype,"typeId",{get:function(){return this._typeId},enumerable:!0,configurable:!0}),Object.defineProperty(Link.prototype,"sourceId",{get:function(){return this._sourceId},enumerable:!0,configurable:!0}),Object.defineProperty(Link.prototype,"targetId",{get:function(){return this._targetId},enumerable:!0,configurable:!0}),Object.defineProperty(Link.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Link.prototype.setData=function(e){var t=this._data;t!==e&&(this._data=e,this._typeId=e.linkTypeId,this.source.trigger("changeData",{source:this,previous:t}))},Object.defineProperty(Link.prototype,"labelBounds",{get:function(){return this._labelBounds},enumerable:!0,configurable:!0}),Link.prototype.setLabelBounds=function(e){var t=this._labelBounds;t!==e&&(this._labelBounds=e,this.source.trigger("changeLabelBounds",{source:this,previous:t}))},Object.defineProperty(Link.prototype,"layoutOnly",{get:function(){return this._layoutOnly},enumerable:!0,configurable:!0}),Link.prototype.setLayoutOnly=function(e){var t=this._layoutOnly;t!==e&&(this._layoutOnly=e,this.source.trigger("changeLayoutOnly",{source:this,previous:t}))},Object.defineProperty(Link.prototype,"vertices",{get:function(){return this._vertices},enumerable:!0,configurable:!0}),Link.prototype.setVertices=function(e){var t=this._vertices;a.isPolylineEqual(this._vertices,e)||(this._vertices=e,this.source.trigger("changeVertices",{source:this,previous:t}))},Object.defineProperty(Link.prototype,"linkState",{get:function(){return this._linkState},enumerable:!0,configurable:!0}),Link.prototype.setLinkState=function(e){var t=this._linkState;t!==e&&(this._linkState=e,this.source.trigger("changeLinkState",{source:this,previous:t}))},Link}();t.Link=u,t.linkMarkerKey=function linkMarkerKey(e,t){return"ontodia-"+(t?"mstart":"mend")+"-"+e};var d=function(){function FatLinkType(e){this.source=new o.EventSource,this.events=this.source,this._isNew=!1,this._visible=!0,this._showLabel=!0;var t=e.id,n=e.index,r=e.label,i=void 0===r?[]:r;this.id=t,this._index=n,this._label=i}return Object.defineProperty(FatLinkType.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),FatLinkType.prototype.setIndex=function(e){if("number"==typeof this._index)throw new Error("Cannot set index for link type more than once.");this._index=e},Object.defineProperty(FatLinkType.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),FatLinkType.prototype.setLabel=function(e){var t=this._label;t!==e&&(this._label=e,this.source.trigger("changeLabel",{source:this,previous:t}))},Object.defineProperty(FatLinkType.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0}),Object.defineProperty(FatLinkType.prototype,"showLabel",{get:function(){return this._showLabel},enumerable:!0,configurable:!0}),FatLinkType.prototype.setVisibility=function(e){if(!(this._visible===e.visible&&this._showLabel===e.showLabel)){var t=Boolean(e.preventLoading)||this._visible===e.visible;this._visible=e.visible,this._showLabel=e.showLabel,this.source.trigger("changeVisibility",{source:this,preventLoading:t})}},Object.defineProperty(FatLinkType.prototype,"isNew",{get:function(){return this._isNew},enumerable:!0,configurable:!0}),FatLinkType.prototype.setIsNew=function(e){var t=this._isNew;t!==e&&(this._isNew=e,this.source.trigger("changeIsNew",{source:this,previous:t}))},FatLinkType}();t.FatLinkType=d;var p=function(){function LinkVertex(e,t){this.link=e,this.vertexIndex=t}return LinkVertex.prototype.createAt=function(e){var t=r.__spreadArrays(this.link.vertices);t.splice(this.vertexIndex,0,e),this.link.setVertices(t)},LinkVertex.prototype.moveTo=function(e){var t=r.__spreadArrays(this.link.vertices);t.splice(this.vertexIndex,1,e),this.link.setVertices(t)},LinkVertex.prototype.remove=function(){var e=r.__spreadArrays(this.link.vertices);e.splice(this.vertexIndex,1)[0];this.link.setVertices(e)},LinkVertex}();t.LinkVertex=p},1574:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i,o=n(11);function boundsOf(e){var t=e.position,n=t.x,r=t.y,i=e.size;return{x:n,y:r,width:i.width,height:i.height}}function intersectRayFromRectangleCenter(e,t){var n=0===e.width||0===e.height||t.x>e.x&&t.x<e.x+e.width&&t.y>e.y&&t.y<e.y+e.height,i=e.width/2,o=e.height/2,a={x:e.x+i,y:e.y+o};if(n)return a;var s=r.normalize({x:t.x-a.x,y:t.y-a.y}),l={x:Math.abs(s.x),y:s.y};return r.cross2D({x:i,y:-o},l)>0&&r.cross2D({x:i,y:o},l)<0?{x:a.x+i*Math.sign(s.x),y:a.y+i*s.y/Math.abs(s.x)}:{x:a.x+o*s.x/Math.abs(s.y),y:a.y+o*Math.sign(s.y)}}!function(e){e.equals=function equals(e,t){return e.x===t.x&&e.y===t.y},e.length=function length(e){var t=e.x,n=e.y;return Math.sqrt(t*t+n*n)},e.normalize=function normalize(e){var t=e.x,n=e.y;if(0===t&&0===n)return{x:t,y:n};var r=1/Math.sqrt(t*t+n*n);return{x:t*r,y:n*r}},e.dot=function dot(e,t){var n=e.x,r=e.y;return n*t.x+r*t.y},e.cross2D=function cross2D(e,t){var n=e.x,r=e.y,i=t.x;return n*t.y-r*i}}(r=t.Vector||(t.Vector={})),function(e){e.center=function center(e){var t=e.x,n=e.y;return{x:t+e.width/2,y:n+e.height/2}}}(i=t.Rect||(t.Rect={})),t.boundsOf=boundsOf,t.isPolylineEqual=function isPolylineEqual(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++){var r=e[n],i=t[n];if(r.x!==i.x||r.y!==i.y)return!1}return!0},t.computePolyline=function computePolyline(e,t,n){var r=boundsOf(e),a=boundsOf(t),s=intersectRayFromRectangleCenter(r,n.length>0?n[0]:i.center(a)),l=intersectRayFromRectangleCenter(a,n.length>0?n[n.length-1]:i.center(r));return o.__spreadArrays([s],n,[l])},t.computePolylineLength=function computePolylineLength(e){var t;return e.reduce((function(e,n){var i=t?r.length({x:n.x-t.x,y:n.y-t.y}):0;return t=n,e+i}),0)},t.getPointAlongPolyline=function getPointAlongPolyline(e,t){if(0===e.length)throw new Error("Cannot compute a point for empty polyline");if(t<0)return e[0];for(var n=0,i=1;i<e.length;i++){var o=e[i-1],a=e[i],s={x:a.x-o.x,y:a.y-o.y},l=r.length(s),c=n+l;if(t<c){var u=(t-n)/l;return{x:o.x+u*s.x,y:o.y+u*s.y}}n=c}return e[e.length-1]},t.findNearestSegmentIndex=function findNearestSegmentIndex(e,t){for(var n=1/0,i=0,o=0;o<e.length-1;o++){var a=e[o],s=e[o+1],l={x:t.x-a.x,y:t.y-a.y},c={x:s.x-a.x,y:s.y-a.y},u=r.length(c),d=r.dot(l,c)/u;if(!(d<0||d>u)){var p=Math.abs(r.cross2D(l,c))/u;p<n&&(n=p,i=o)}}return i},t.findElementAtPoint=function findElementAtPoint(e,t){for(var n=e.length-1;n>=0;n--){var r=e[n],i=boundsOf(r),o=i.x,a=i.y,s=i.width,l=i.height;if(!r.temporary&&(t.x>=o&&t.x<=o+s&&t.y>=a&&t.y<=a+l))return r}},t.computeGrouping=function computeGrouping(e){for(var t=new Map,n=0,r=e;n<r.length;n++){var i=r[n],o=i.group;if("string"==typeof o){var a=t.get(o);a||(a=[],t.set(o,a)),a.push(i)}}return t}},1579:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11);n(1455),r.__exportStar(n(3153),t),r.__exportStar(n(2268),t),r.__exportStar(n(1607),t),r.__exportStar(n(3168),t),r.__exportStar(n(3169),t),r.__exportStar(n(3170),t);var i=n(1580);t.PLACEHOLDER_ELEMENT_TYPE=i.PLACEHOLDER_ELEMENT_TYPE,t.PLACEHOLDER_LINK_TYPE=i.PLACEHOLDER_LINK_TYPE,r.__exportStar(n(3171),t);var o=n(1966);t.RdfNode=o.RdfNode,t.RdfIri=o.RdfIri,t.RdfLiteral=o.RdfLiteral,t.Triple=o.Triple,r.__exportStar(n(3172),t),r.__exportStar(n(3265),t),r.__exportStar(n(3267),t),r.__exportStar(n(2317),t),r.__exportStar(n(2319),t),r.__exportStar(n(3276),t);var a=n(1580);t.DIAGRAM_CONTEXT_URL_V1=a.DIAGRAM_CONTEXT_URL_V1;var s=n(1655);t.RestoreGeometry=s.RestoreGeometry,t.setElementExpanded=s.setElementExpanded,t.setElementData=s.setElementData,t.setLinkData=s.setLinkData;var l=n(1573);t.Element=l.Element,t.ElementEvents=l.ElementEvents,t.ElementTemplateState=l.ElementTemplateState,t.Link=l.Link,t.LinkEvents=l.LinkEvents,t.LinkTemplateState=l.LinkTemplateState,t.LinkVertex=l.LinkVertex,t.Cell=l.Cell,t.LinkDirection=l.LinkDirection;var c=n(2270);t.EmbeddedLayer=c.EmbeddedLayer,r.__exportStar(n(1574),t),r.__exportStar(n(1693),t);var u=n(2326);t.DiagramModel=u.DiagramModel,t.DiagramModelEvents=u.DiagramModelEvents,r.__exportStar(n(1634),t);var d=n(1656);t.PointerEvent=d.PointerEvent,t.PointerUpEvent=d.PointerUpEvent,t.getContentFittingBox=d.getContentFittingBox,t.ViewportOptions=d.ViewportOptions,t.ScaleOptions=d.ScaleOptions,r.__exportStar(n(1984),t);var p=n(2276);t.AuthoredEntity=p.AuthoredEntity,t.AuthoredEntityProps=p.AuthoredEntityProps,t.AuthoredEntityContext=p.AuthoredEntityContext,r.__exportStar(n(1635),t);var h=n(2327);t.EditorOptions=h.EditorOptions,t.EditorEvents=h.EditorEvents,t.EditorController=h.EditorController,t.PropertyEditor=h.PropertyEditor,t.PropertyEditorOptions=h.PropertyEditorOptions;var f=n(2331);t.ValidationState=f.ValidationState,t.ElementValidation=f.ElementValidation,t.LinkValidation=f.LinkValidation;var m=n(1980);t.LayoutData=m.LayoutData,t.LayoutElement=m.LayoutElement,t.LayoutLink=m.LayoutLink,t.SerializedDiagram=m.SerializedDiagram,t.convertToSerializedDiagram=m.convertToSerializedDiagram,t.makeSerializedDiagram=m.makeSerializedDiagram,t.LinkTypeOptions=m.LinkTypeOptions,t.makeLayoutData=m.makeLayoutData;var g=n(1748);t.calculateLayout=g.calculateLayout,t.removeOverlaps=g.removeOverlaps,t.CalculatedLayout=g.CalculatedLayout,t.UnzippedCalculatedLayout=g.UnzippedCalculatedLayout,t.LayoutNode=g.LayoutNode,t.applyLayout=g.applyLayout,t.forceLayout=g.forceLayout;var v=n(1560);t.Cancellation=v.Cancellation,t.CancellationToken=v.CancellationToken,t.CancelledError=v.CancelledError,r.__exportStar(n(1554),t);var y=n(2328);t.PropertySuggestionParams=y.PropertySuggestionParams,t.PropertyScore=y.PropertyScore;var k=n(2332);t.DefaultToolbar=k.DefaultToolbar,t.ToolbarProps=k.ToolbarProps;var E=n(3292);t.Workspace=E.Workspace,t.WorkspaceProps=E.WorkspaceProps,t.WorkspaceState=E.WorkspaceState,t.WorkspaceLanguage=E.WorkspaceLanguage,t.renderTo=E.renderTo;var b=n(1657);t.WorkspaceEventHandler=b.WorkspaceEventHandler,t.WorkspaceEventKey=b.WorkspaceEventKey;var L=n(1985);t.DraggableHandle=L.DraggableHandle,r.__exportStar(n(2333),t);var S=n(3306);t.InternalApi=S},1580:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(1838);t.DIAGRAM_CONTEXT_URL_V1="https://ontodia.org/context/v1.json",t.PLACEHOLDER_ELEMENT_TYPE="http://ontodia.org/NewEntity",t.PLACEHOLDER_LINK_TYPE="http://ontodia.org/NewLink";!function(e){e.forElement=function forElement(){return"http://ontodia.org/data/e_"+r.generate128BitID()},e.forLink=function forLink(){return"http://ontodia.org/data/l_"+r.generate128BitID()}}(t.GenerateID||(t.GenerateID={})),function(e){e.PinnedProperties="ontodia:pinnedProperties",e.CustomLabel="ontodia:customLabel"}(t.TemplateProperties||(t.TemplateProperties={}))},1585:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=function(e){function Spinner(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(Spinner,e),Spinner.prototype.render=function(){var e=this.props,t=e.position,n=void 0===t?{x:0,y:0}:t,r=e.size,o=void 0===r?50:r,a=e.statusText,s=e.errorOccured,l="m3.47,-19.7 a20,20 0 1,1 -6.95,0 m0,0 l-6,5 m6,-5 l-8,-0"+(s?"M-8,-8L8,8M-8,8L8,-8":"");return i.createElement("g",{className:"ontodia-spinner","data-error":s,transform:"translate("+n.x+","+n.y+")"},i.createElement("g",{className:"ontodia-spinner__arrow"},i.createElement("path",{d:l,transform:"scale(0.02)scale("+o+")",fill:"none",stroke:s?"red":"black",strokeWidth:"3",strokeLinecap:"round"})),i.createElement("text",{style:{dominantBaseline:"middle"},x:o/2+5},a))},Spinner}(i.Component);t.Spinner=o;var a=function(e){function HtmlSpinner(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(HtmlSpinner,e),HtmlSpinner.prototype.render=function(){var e=this.props,t=e.width,n=e.height,r=Math.min(t,n);return i.createElement("svg",{width:t,height:n},i.createElement(o,{size:r,position:{x:t/2,y:n/2}}))},HtmlSpinner}(i.Component);t.HtmlSpinner=a},1607:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(1838);function isIriProperty(e){return e&&"uri"===e.type}function isLiteralProperty(e){return e&&"string"===e.type}function isArraysEqual(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function isLiteralsEqual(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++){var r=e[n],i=t[n];if(r.value!==i.value||r.language!==i.language)return!1}return!0}function isIriPropertiesEqual(e,t){if(!isIriProperty(e)||!isIriProperty(t))return!1;if(e.values.length!==t.values.length)return!1;for(var n=0;n<e.values.length;n++){var r=e.values[n],i=t.values[n];if(r.value!==i.value)return!1}return!0}function isLiteralPropertiesEqual(e,t){return!(!isLiteralProperty(e)||!isLiteralProperty(t))&&isLiteralsEqual(e.values,t.values)}t.isIriProperty=isIriProperty,t.isLiteralProperty=isLiteralProperty,t.sameLink=function sameLink(e,t){return e.linkTypeId===t.linkTypeId&&e.sourceId===t.sourceId&&e.targetId===t.targetId},t.hashLink=function hashLink(e){var t=e.linkTypeId,n=e.sourceId,i=e.targetId,o=r.hashFnv32a(t);return o=31*(o=31*o+r.hashFnv32a(n))+r.hashFnv32a(i)},t.sameElement=function sameElement(e,t){return e.id===t.id&&isArraysEqual(e.types,t.types)&&isLiteralsEqual(e.label.values,t.label.values)&&e.image===t.image&&function isPropertiesEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var n in e.properties)if(e.properties.hasOwnProperty(n)){var r=e[n],i=t[n];if(!i)return!1;if(!isIriPropertiesEqual(r,i)&&!isLiteralPropertiesEqual(r,i))return!1}return!0}(e.properties,t.properties)&&(!e.sources&&!t.sources||e.sources&&t.sources&&isArraysEqual(e.sources,t.sources))}},1623:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11);t.objectValues=function objectValues(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(e[n]);return t},t.isEmptyMap=function isEmptyMap(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},t.cloneMap=function cloneMap(e){var t=new Map;return e.forEach((function(e,n){return t.set(n,e)})),t},t.cloneSet=function cloneSet(e){var t=new Set;return e.forEach((function(e){return t.add(e)})),t},t.getOrCreateArrayInMap=function getOrCreateArrayInMap(e,t){var n=e.get(t);return n||(n=[],e.set(t,n)),n},t.getOrCreateSetInMap=function getOrCreateSetInMap(e,t){var n=e.get(t);return n||(n=new Set,e.set(t,n)),n};var i=function(){function OrderedMap(){this.mapping=new Map,this.ordered=[]}return OrderedMap.prototype.reorder=function(e){this.ordered.sort(e)},Object.defineProperty(OrderedMap.prototype,"items",{get:function(){return this.ordered},enumerable:!0,configurable:!0}),OrderedMap.prototype.get=function(e){return this.mapping.get(e)},OrderedMap.prototype.push=function(e,t){if(this.mapping.has(e)){var n=this.mapping.get(e);if(n===t)return;var r=this.ordered.indexOf(n);this.ordered.splice(r,1)}this.mapping.set(e,t),this.ordered.push(t)},OrderedMap.prototype.delete=function(e){if(this.mapping.has(e)){var t=this.mapping.get(e),n=this.ordered.indexOf(t);return this.ordered.splice(n,1),this.mapping.delete(e),t}},OrderedMap}();t.OrderedMap=i;var o=function(){function HashMap(e,t){this.hashCode=e,this.equals=t,this.map=new Map,this._size=0}return Object.defineProperty(HashMap.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),HashMap.prototype.has=function(e){var t=this,n=this.map.get(this.hashCode(e));return!!n&&Boolean(n.find((function(n){return t.equals(n.key,e)})))},HashMap.prototype.get=function(e){var t=this,n=this.map.get(this.hashCode(e));if(n){var r=n.find((function(n){return t.equals(n.key,e)}));return r?r.value:void 0}},HashMap.prototype.set=function(e,t){var n=this,r=this.hashCode(e),i=this.map.get(r);if(i){var o=i.findIndex((function(t){return n.equals(t.key,e)}));o>=0?i.splice(o,1):this._size++,i.push({key:e,value:t})}else i=[{key:e,value:t}],this.map.set(r,i),this._size++;return this},HashMap.prototype.delete=function(e){var t=this,n=this.map.get(this.hashCode(e));if(!n)return!1;var r=n.findIndex((function(n){return t.equals(n.key,e)}));return r>=0&&(n.splice(r,1),this._size--,!0)},HashMap.prototype.clear=function(){this.map.clear(),this._size=0},HashMap.prototype.forEach=function(e){var t=this;this.map.forEach((function(n){for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o.key,s=o.value;e(s,a,t)}}))},HashMap.prototype.clone=function(){var e=new HashMap(this.hashCode,this.equals);return e._size=this.size,this.map.forEach((function(t,n){return e.map.set(n,r.__spreadArrays(t))})),e},HashMap}();t.HashMap=o,function(e){e[e.ToStart=-1]="ToStart",e[e.ToEnd=1]="ToEnd"}(t.MoveDirection||(t.MoveDirection={})),t.makeMoveComparator=function makeMoveComparator(e,t,n){var r=new Map,i=n*e.length;e.forEach((function(e,t){r.set(e,t)}));for(var o=0,a=t;o<a.length;o++){var s=a[o];r.set(s,i+r.get(s))}return function(e,t){var n=r.get(e),i=r.get(t);return n>i?1:n<i?-1:0}}},1634:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(1591),o=n(16),a=n(3156),s=n(2273),l=n(2268),c=n(1965),u=n(1838),d=n(1554),p=n(1574),h=n(3166);!function(e){e.JumpToEntity="jumpToEntity",e.OpenEntityIri="openEntityIri",e.OpenOtherIri="openOtherIri"}(t.IriClickIntent||(t.IriClickIntent={})),function(e){e[e.Element=1]="Element",e[e.ElementSize=2]="ElementSize",e[e.PaperArea=3]="PaperArea",e[e.Link=4]="Link",e[e.Editor=5]="Editor",e[e.FirstToUpdate=1]="FirstToUpdate",e[e.LastToUpdate=5]="LastToUpdate"}(r=t.RenderingLayer||(t.RenderingLayer={})),function(e){e[e.Viewport=1]="Viewport",e[e.OverElements=2]="OverElements",e[e.OverLinks=3]="OverLinks"}(t.WidgetAttachment||(t.WidgetAttachment={}));var f=function(){function DiagramView(e,t){void 0===t&&(t={}),this.model=e,this.options=t,this.listener=new d.EventObserver,this.source=new d.EventSource,this.events=this.source,this.disposed=!1,this.colorSeed=195935983,this._language="en",this.linkTemplates=new Map,this.routings=new Map,this.resolveTypeStyle=t.typeStyleResolver||a.DefaultTypeStyleBundle,this.resolveLinkTemplate=t.linkTemplateResolver||s.DefaultLinkTemplateBundle,this.resolveElementTemplate=t.elementTemplateResolver||l.DefaultElementTemplateBundle,this.initRouting()}return DiagramView.prototype.initRouting=function(){var e=this;this.router=this.options.linkRouter||new h.DefaultLinkRouter,this.updateRoutings(),this.listener.listen(this.model.events,"changeCells",(function(){return e.updateRoutings()})),this.listener.listen(this.model.events,"linkEvent",(function(t){t.key;t.data.changeVertices&&e.updateRoutings()})),this.listener.listen(this.model.events,"elementEvent",(function(t){t.key;var n=t.data;(n.changePosition||n.changeSize)&&e.updateRoutings()}))},DiagramView.prototype.updateRoutings=function(){var e=this.routings,t=this.router.route(this.model);e.forEach((function(e,n){var r=t.get(n);r&&function sameRoutedLink(e,t){return e.linkId===t.linkId&&e.labelTextAnchor===t.labelTextAnchor&&p.isPolylineEqual(e.vertices,t.vertices)}(e,r)&&t.set(n,e)})),this.routings=t,this.source.trigger("updateRoutings",{source:this,previous:e})},DiagramView.prototype.getRoutings=function(){return this.routings},DiagramView.prototype.getRouting=function(e){return this.routings.get(e)},DiagramView.prototype.getLanguage=function(){return this._language},DiagramView.prototype.setLanguage=function(e){if(!e)throw new Error("Cannot set empty language.");var t=this._language;t!==e&&(this._language=e,this.source.trigger("changeLanguage",{source:this,previous:t}))},DiagramView.prototype.getLinkTemplates=function(){return this.linkTemplates},DiagramView.prototype.performSyncUpdate=function(){for(var e=r.FirstToUpdate;e<=r.LastToUpdate;e++)this.source.trigger("syncUpdate",{layer:e})},DiagramView.prototype.onIriClick=function(e,t,n,r){r.persist(),r.preventDefault();var i=this.options.onIriClick;i&&i({iri:e,element:t,clickIntent:n,originalEvent:r})},DiagramView.prototype.setPaperWidget=function(e){var t,n=e.key,r=e.widget,i=e.attachment,o=((t={})[n]=r?{element:r,attachment:i}:void 0,t);this.source.trigger("updateWidgets",{widgets:o})},DiagramView.prototype.setHandlerForNextDropOnPaper=function(e){this.dropOnPaperHandler=e},DiagramView.prototype._tryHandleDropOnPaper=function(e){var t=this.dropOnPaperHandler;return!!t&&(this.dropOnPaperHandler=void 0,t(e),!0)},DiagramView.prototype.selectLabel=function(e,t){var n=void 0===t?this.getLanguage():t,r=this.options.selectLabelLanguage;return(void 0===r?defaultSelectLabel:r)(e,n)},DiagramView.prototype.formatLabel=function(e,t,n){return function resolveLabel(e,t){if(e)return e.value;return u.getUriLocalName(t)||t}(this.selectLabel(e,n),t)},DiagramView.prototype.getElementTypeString=function(e){var t=this;return e.types.map((function(e){var n=t.model.createClass(e);return t.formatLabel(n.label,n.id)})).sort().join(", ")},DiagramView.prototype.getTypeStyle=function(e){e.sort();var t,n=this.resolveTypeStyle(e),r=n?n.icon:void 0;n&&n.color?t=i.hcl(n.color):t={h:function getHueFromClasses(e,t){for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];n=u.hashFnv32a(o,n)}return(void 0===n?0:n)/2147483647*360}(e,this.colorSeed),c:40,l:75};return{icon:r,color:t}},DiagramView.prototype.formatIri=function(e){return c.isEncodedBlank(e)?"(blank node)":"<"+e+">"},DiagramView.prototype.getElementTemplate=function(e){return this.resolveElementTemplate(e)||l.StandardTemplate},DiagramView.prototype.createLinkTemplate=function(e){var t=this.linkTemplates.get(e.id);if(t)return t;var n={},r=this.resolveLinkTemplate(e.id);return r&&(n=o.cloneDeep(r)),function fillLinkTemplateDefaults(e){o.defaultsDeep(e,{markerTarget:{d:"M0,0 L0,8 L9,4 z",width:9,height:8,fill:"black"}}),e.renderLink||(e.renderLink=function(){return{}})}(n),this.linkTemplates.set(e.id,n),this.source.trigger("changeLinkTemplates",{}),n},DiagramView.prototype.dispose=function(){this.disposed||(this.source.trigger("dispose",{}),this.listener.stopListening(),this.disposed=!0)},Object.defineProperty(DiagramView.prototype,"highlighter",{get:function(){return this._highlighter},enumerable:!0,configurable:!0}),DiagramView.prototype.setHighlighter=function(e){var t=this._highlighter;t!==e&&(this._highlighter=e,this.source.trigger("changeHighlight",{source:this,previous:t}))},DiagramView.prototype._setElementDecorator=function(e){this._elementDecorator=e},DiagramView.prototype._decorateElement=function(e){return this._elementDecorator(e)},DiagramView}();function defaultSelectLabel(e,t){if(0!==e.length){for(var n,r,i=0,o=e;i<o.length;i++){var a=o[i];if(a.language===t)return a;""===a.language?n=a:"en"===a.language&&(r=a)}return void 0!==n?n:void 0!==r?r:e[0]}}t.DiagramView=f},1635:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(11),o=n(1607),a=n(1623);function isLinkConnectedToElement(e,t){return e.sourceId===t||e.targetId===t}!function(e){e.ChangeElement="changeElement",e.ChangeLink="changeLink"}(r=t.AuthoringKind||(t.AuthoringKind={})),function(e){function clone(e){return{elements:a.cloneMap(e.elements),links:e.links.clone()}}function has(e,t){return t.type===r.ChangeElement?e.elements.get(t.after.id)===t:e.links.get(t.after)===t}function isNewElement(e,t){var n=e.elements.get(t);return n&&n.type===r.ChangeElement&&!n.before}function isDeletedElement(e,t){var n=e.elements.get(t);return n&&n.deleted}function isElementWithModifiedIri(e,t){var n=e.elements.get(t);return n&&n.type===r.ChangeElement&&n.before&&Boolean(n.newIri)}function isNewLink(e,t){var n=e.links.get(t);return n&&!n.before}function isDeletedLink(e,t){var n=e.links.get(t);return n&&n.deleted||isDeletedElement(e,t.sourceId)||isDeletedElement(e,t.targetId)}e.empty={elements:new Map,links:new a.HashMap(o.hashLink,o.sameLink)},e.isEmpty=function isEmpty(e){return 0===e.elements.size&&0===e.links.size},e.clone=clone,e.has=has,e.discard=function discard(e,t){if(!has(e,t))return e;var n=clone(e);return t.type===r.ChangeElement?(n.elements.delete(t.after.id),t.before||e.links.forEach((function(e){isLinkConnectedToElement(e.after,t.after.id)&&n.links.delete(e.after)}))):n.links.delete(t.after),n},e.addElement=function addElement(e,t){var n={type:r.ChangeElement,after:t,deleted:!1},i=clone(e);return i.elements.set(n.after.id,n),i},e.addLink=function addLink(e,t){var n={type:r.ChangeLink,after:t,deleted:!1},i=clone(e);return i.links.set(n.after,n),i},e.changeElement=function changeElement(e,t,n){var o=clone(e);o.elements.delete(t.id);var a=e.elements.get(t.id);if(a&&!a.before)o.elements.set(n.id,{type:r.ChangeElement,after:n,deleted:!1}),t.id!==n.id&&e.links.forEach((function(e){if(!e.before&&isLinkConnectedToElement(e.after,t.id)){var a=function updateLinkToReferByNewIri(e,t,n){return i.__assign(i.__assign({},e),{sourceId:e.sourceId===t?n:e.sourceId,targetId:e.targetId===t?n:e.targetId})}(e.after,t.id,n.id);o.links.delete(e.after),o.links.set(a,{type:r.ChangeLink,after:a,deleted:!1})}}));else{var s=n.id!==t.id,l=a?a.before:void 0;o.elements.set(t.id,{type:r.ChangeElement,before:l||t,after:s?i.__assign(i.__assign({},n),{id:t.id}):n,newIri:s?n.id:void 0,deleted:!1})}return o},e.changeLink=function changeLink(e,t,n){if(!o.sameLink(t,n))throw new Error("Cannot move link to another element or change its type");var i=clone(e),a=e.links.get(t);return i.links.set(t,{type:r.ChangeLink,before:a?a.before:void 0,after:n,deleted:!1}),i},e.deleteElement=function deleteElement(e,t){var n=clone(e);return n.elements.delete(t.id),e.links.forEach((function(e){isLinkConnectedToElement(e.after,t.id)&&n.links.delete(e.after)})),isNewElement(e,t.id)||n.elements.set(t.id,{type:r.ChangeElement,before:t,after:t,deleted:!0}),n},e.deleteLink=function deleteLink(e,t){var n=clone(e);return n.links.delete(t),isNewLink(e,t)||n.links.set(t,{type:r.ChangeLink,before:t,after:t,deleted:!0}),n},e.deleteNewLinksConnectedToElements=function deleteNewLinksConnectedToElements(e,t){var n=clone(e);return e.links.forEach((function(e){if(!e.before){var r=e.after;(t.has(r.sourceId)||t.has(r.targetId))&&n.links.delete(r)}})),n},e.isNewElement=isNewElement,e.isDeletedElement=isDeletedElement,e.isElementWithModifiedIri=isElementWithModifiedIri,e.isNewLink=isNewLink,e.isDeletedLink=isDeletedLink,e.isUncertainLink=function isUncertainLink(e,t){return!isDeletedLink(e,t)&&(isElementWithModifiedIri(e,t.sourceId)||isElementWithModifiedIri(e,t.targetId))}}(t.AuthoringState||(t.AuthoringState={})),function(e){e.empty={elements:new Map,links:new a.HashMap(o.hashLink,o.sameLink)},e.addElement=function addElement(e,t){var n=a.cloneMap(e.elements);return n.set(t.id,t),i.__assign(i.__assign({},e),{elements:n})},e.deleteElement=function deleteElement(e,t){var n=a.cloneMap(e.elements);return n.delete(t.id),i.__assign(i.__assign({},e),{elements:n})},e.addLink=function addLink(e,t){var n=e.links.clone();return n.set(t,t),i.__assign(i.__assign({},e),{links:n})},e.deleteLink=function deleteLink(e,t){var n=e.links.clone();return n.delete(t),i.__assign(i.__assign({},e),{links:n})}}(t.TemporaryState||(t.TemporaryState={})),t.isLinkConnectedToElement=isLinkConnectedToElement},1655:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1607),o=n(1574),a=n(1693),s=function(){function RestoreGeometry(e,t){this.elementState=e,this.linkState=t,this.title="Move elements and links"}return RestoreGeometry.capture=function(e){return RestoreGeometry.captureElementsAndLinks(e.elements,e.links)},RestoreGeometry.captureElementsAndLinks=function(e,t){return new RestoreGeometry(e.map((function(e){return{element:e,position:e.position}})),t.map((function(e){return{link:e,vertices:e.vertices}})))},RestoreGeometry.prototype.hasChanges=function(){return this.elementState.length>0||this.linkState.length>0},RestoreGeometry.prototype.filterOutUnchanged=function(){return new RestoreGeometry(this.elementState.filter((function(e){var t=e.element,n=e.position;return!o.Vector.equals(t.position,n)})),this.linkState.filter((function(e){var t=e.link,n=e.vertices;return!o.isPolylineEqual(t.vertices,n)})))},RestoreGeometry.prototype.invoke=function(){for(var e=RestoreGeometry.captureElementsAndLinks(this.elementState.map((function(e){return e.element})),this.linkState.map((function(e){return e.link}))),t=0,n=r.__spreadArrays(this.elementState).reverse();t<n.length;t++){var i=n[t],o=i.element,a=i.position;o.setPosition(a)}for(var s=0,l=this.linkState;s<l.length;s++){var c=l[s],u=c.link,d=c.vertices;u.setVertices(d)}return e},RestoreGeometry}();t.RestoreGeometry=s,t.restoreCapturedLinkGeometry=function restoreCapturedLinkGeometry(e){var t=e.vertices;return a.Command.create("Change link vertices",(function(){var n=restoreCapturedLinkGeometry(e);return e.setVertices(t),n}))},t.setElementExpanded=function setElementExpanded(e,t){var n=t?"Expand element":"Collapse element";return a.Command.create(n,(function(){return e.setExpanded(t),setElementExpanded(e,!t)}))},t.changeLinkTypeVisibility=function changeLinkTypeVisibility(e){var t=e.linkType,n=e.visible,r=e.showLabel,i=e.preventLoading;return a.Command.create("Change link type visibility",(function(){var e=t.visible,o=t.showLabel;return t.setVisibility({visible:n,showLabel:r,preventLoading:i}),changeLinkTypeVisibility({linkType:t,visible:e,showLabel:o,preventLoading:i})}))},t.setElementData=function setElementData(e,t,n){var r=e.elements.filter((function(e){return e.iri===t})),i=r.length>0?r[0].data:void 0;return a.Command.create("Set element data",(function(){for(var r=0,o=e.elements.filter((function(e){return e.iri===t}));r<o.length;r++){o[r].setData(n)}return setElementData(e,n.id,i)}))},t.setLinkData=function setLinkData(e,t,n){if(!i.sameLink(t,n))throw new Error("Cannot change typeId, sourceId or targetId when changing link data");return a.Command.create("Set link data",(function(){for(var r=0,o=e.links;r<o.length;r++){var a=o[r];i.sameLink(a.data,t)&&a.setData(n)}return setLinkData(e,n,t)}))}},1656:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1560),a=n(1554),s=n(1964),l=n(2275),c=n(1655),u=n(1573),d=n(1574),p=n(1634),h=n(1692);t.PaperAreaContextTypes={ontodiaPaperArea:s.PropTypes.anything};var f="ontodia-paper-area",m=function(e){function PaperArea(t,n){var i=e.call(this,t,n)||this;return i.listener=new a.EventObserver,i.source=new a.EventSource,i.events=i.source,i.widgets={},i.pageSize={x:1500,y:800},i.cssAnimations=0,i.delayedPaperAdjust=new o.Debouncer,i.onOuterMount=function(e){i.outer=e},i.onAreaMount=function(e){i.area=e},i.onWidgetsMouseDown=function(e){e.stopPropagation()},i.adjustPaper=function(e){var t=i.area,n=t.clientWidth,o=t.clientHeight,a=r.__assign(r.__assign({},i.computeAdjustedBox()),{paddingX:Math.ceil(n),paddingY:Math.ceil(o)}),s=i.state;a.paperWidth===s.paperWidth&&a.paperHeight===s.paperHeight&&a.originX===s.originX&&a.originY===s.originY&&a.paddingX===s.paddingX&&a.paddingY===s.paddingY?e&&e():(i.scrollBeforeUpdate={left:i.area.scrollLeft,top:i.area.scrollTop},i.setState(a,e))},i.onPaperPointerDown=function(e,t){if(!(i.movingState||e.target instanceof HTMLElement&&"ontodia-overlayed-element__resizable-handle"===e.target.className)){var n=c.RestoreGeometry.capture(i.props.view.model),r=i.props.view.model.history.startBatch(n.title);t&&0===e.button?t instanceof u.Element?(e.preventDefault(),i.startMoving(e,t),i.listenToPointerMove(e,t,r,n)):(e.preventDefault(),i.listenToPointerMove(e,t,r,n)):(e.preventDefault(),i.listenToPointerMove(e,void 0,r,n))}},i.onAreaPointerDown=function(e){e.target===i.area&&i.onPaperPointerDown(e,void 0)},i.onPointerMove=function(e){if(i.movingState&&!i.scrollBeforeUpdate){var t=i.movingState,n=t.origin,r=t.target,o=t.panning,a=e.pageX-n.pageX,s=e.pageY-n.pageY;if(Math.abs(a)>=1&&Math.abs(s)>=1&&(i.movingState.pointerMoved=!0),void 0===r)o&&(i.area.scrollLeft=i.panningScrollOrigin.scrollLeft-a,i.area.scrollTop=i.panningScrollOrigin.scrollTop-s),i.source.trigger("pointerMove",{source:i,sourceEvent:e,target:r,panning:o});else if(r instanceof u.Element){var l=i.pageToPaperCoords(e.pageX,e.pageY),c=l.x,d=l.y,p=i.movingElementOrigin,h=p.pointerX,f=p.pointerY,m=p.elementX,g=p.elementY;r.setPosition({x:m+c-h,y:g+d-f}),i.source.trigger("pointerMove",{source:i,sourceEvent:e,target:r,panning:o}),i.props.view.performSyncUpdate()}else if(r instanceof u.Link){var v=i.pageToPaperCoords(e.pageX,e.pageY),y=i.generateLinkVertex(r,v);y.createAt(v),i.movingState.target=y}else if(r instanceof u.LinkVertex){v=i.pageToPaperCoords(e.pageX,e.pageY);r.moveTo(v),i.source.trigger("pointerMove",{source:i,sourceEvent:e,target:r,panning:o}),i.props.view.performSyncUpdate()}}},i.stopListeningToPointerMove=function(e){var t=i.movingState;if(i.movingState=void 0,t&&(document.removeEventListener("mousemove",i.onPointerMove),document.removeEventListener("mouseup",i.stopListeningToPointerMove)),e&&t){var n=t.pointerMoved,r=t.target,o=t.batch,a=t.restoreGeometry;i.source.trigger("pointerUp",{source:i,sourceEvent:e,target:r,panning:t.panning,triggerAsClick:!n});var s=a.filterOutUnchanged();s.hasChanges()&&o.history.registerToUndo(s),o.store()}},i.onWheel=function(e){if(i.shouldStartZooming(e)){e.preventDefault();var t=Math.max(-1,Math.min(1,e.deltaY||e.deltaX)),n=i.pageToPaperCoords(e.pageX,e.pageY);i.zoomBy(.1*-t,{pivot:n})}},i.onDragOver=function(e){e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move";var t=clientCoordsFor(i.area,e);t.x,t.y;return!1},i.onDragDrop=function(e){if(i.props.onDragDrop){var t=clientCoordsFor(i.area,e),n=t.x,r=t.y,o=i.clientToPaperCoords(n,r);i.props.onDragDrop(e,o)}},i.onScroll=function(){i.source.trigger("scroll",{source:i})},i.applyViewportState=function(e){var t=e.scale.x,n=e.center;i.setState({scale:t},(function(){var e=i.state,r=e.originX,o=e.originY,a=e.paddingX,s=e.paddingY,l=(n.x+r)*t,c=(n.y+o)*t,u=i.area,d=u.clientWidth,p=u.clientHeight;i.area.scrollLeft=l-d/2+a,i.area.scrollTop=c-p/2+s,i.props.onZoom&&i.props.onZoom(t,t)}))},i.state={paperWidth:i.pageSize.x,paperHeight:i.pageSize.y,originX:0,originY:0,scale:1,paddingX:0,paddingY:0,renderedWidgets:[]},i}return r.__extends(PaperArea,e),Object.defineProperty(PaperArea.prototype,"zoomOptions",{get:function(){var e=this.props.zoomOptions||{},t=e.min,n=void 0===t?.2:t,r=e.max,i=void 0===r?2:r,o=e.step,a=void 0===o?.1:o,s=e.maxFit,l=void 0===s?1:s,c=e.fitPadding,u=void 0===c?20:c,d=e.requireCtrl;return{min:n,max:i,step:a,maxFit:l,fitPadding:u,requireCtrl:void 0===d||d}},enumerable:!0,configurable:!0}),PaperArea.prototype.getChildContext=function(){return{ontodiaPaperArea:{paperArea:this,view:this.props.view}}},PaperArea.prototype.render=function(){var e=this.props.view,t=this.state,n=t.paperWidth,r=t.paperHeight,o=t.originX,a=t.originY,s=t.scale,l=t.paddingX,c=t.paddingY,u=t.renderedWidgets,d={width:n,height:r,originX:o,originY:a,scale:s,paddingX:l,paddingY:c},m={paperArea:this,paperTransform:d},g=f+"__area";this.props.hideScrollBars&&(g+=" "+f+"--hide-scrollbars");var v=f;return this.isAnimatingGraph()&&(v+=" "+f+"--animated"),i.createElement("div",{className:v,ref:this.onOuterMount},i.createElement("div",{className:g,ref:this.onAreaMount,onMouseDown:this.onAreaPointerDown},i.createElement(h.Paper,{view:e,paperTransform:d,onPointerDown:this.onPaperPointerDown,linkLayerWidgets:i.createElement("div",{className:f+"__widgets",onMouseDown:this.onWidgetsMouseDown},u.filter((function(e){return e.attachment===p.WidgetAttachment.OverLinks})).map((function(e){return i.cloneElement(e.element,m)}))),elementLayerWidgets:i.createElement("div",{className:f+"__widgets",onMouseDown:this.onWidgetsMouseDown},u.filter((function(e){return e.attachment===p.WidgetAttachment.OverElements})).map((function(e){return i.cloneElement(e.element,m)})))})),u.filter((function(e){return e.attachment===p.WidgetAttachment.Viewport})).map((function(e){return i.cloneElement(e.element,m)})))},PaperArea.prototype.componentDidMount=function(){var e=this;this.adjustPaper((function(){return e.centerTo()}));var t=this.props.view,delayedAdjust=function(){return e.delayedPaperAdjust.call(e.adjustPaper)};this.listener.listen(t.model.events,"changeCells",delayedAdjust),this.listener.listen(t.model.events,"elementEvent",(function(e){var t=e.data;(t.changePosition||t.changeSize)&&delayedAdjust()})),this.listener.listen(t.model.events,"linkEvent",(function(e){e.data.changeVertices&&delayedAdjust()})),this.listener.listen(t.events,"syncUpdate",(function(t){t.layer===p.RenderingLayer.PaperArea&&e.delayedPaperAdjust.runSynchronously()})),this.listener.listen(t.events,"updateWidgets",(function(t){var n=t.widgets;e.updateWidgets(n)})),this.area.addEventListener("dragover",this.onDragOver),this.area.addEventListener("drop",this.onDragDrop),this.area.addEventListener("scroll",this.onScroll),this.area.addEventListener("wheel",this.onWheel,{passive:!1})},PaperArea.prototype.componentDidUpdate=function(e,t){if(this.scrollBeforeUpdate){var n=this.state,r=n.scale,i=n.originX,o=n.originY,a=n.paddingX,s=n.paddingY,l=(i-t.originX)*r+(a-t.paddingX),c=(o-t.originY)*r+(s-t.paddingY),u=this.scrollBeforeUpdate.left+l,d=this.scrollBeforeUpdate.top+c;this.area.scrollLeft=u,this.area.scrollTop=d,this.scrollBeforeUpdate=void 0}},PaperArea.prototype.componentWillUnmount=function(){this.stopListeningToPointerMove(),this.listener.stopListening(),this.area.removeEventListener("dragover",this.onDragOver),this.area.removeEventListener("drop",this.onDragDrop),this.area.removeEventListener("scroll",this.onScroll),this.area.removeEventListener("wheel",this.onWheel)},PaperArea.prototype.updateWidgets=function(e){var t=this;this.widgets=r.__assign(r.__assign({},this.widgets),e);var n=Object.keys(this.widgets).filter((function(e){return t.widgets[e]})).map((function(e){var n=t.widgets[e],o=i.cloneElement(n.element,{key:e});return r.__assign(r.__assign({},n),{element:o})}));this.setState({renderedWidgets:n})},PaperArea.prototype.pageToPaperCoords=function(e,t){var n=this.area.getBoundingClientRect(),r=n.left,i=n.top;return this.clientToPaperCoords(e-(r+window.pageXOffset),t-(i+window.pageYOffset))},PaperArea.prototype.clientToPaperCoords=function(e,t){var n=this.clientToScrollablePaneCoords(e,t),r=n.x,i=n.y;return this.scrollablePaneToPaperCoords(r,i)},PaperArea.prototype.clientToScrollablePaneCoords=function(e,t){var n=this.state,r=n.paddingX,i=n.paddingY;return{x:e+this.area.scrollLeft-r,y:t+this.area.scrollTop-i}},PaperArea.prototype.scrollablePaneToPaperCoords=function(e,t){var n=this.state,r=n.scale;n.paddingX,n.paddingY;return{x:e/r-n.originX,y:t/r-n.originY}},PaperArea.prototype.paperToScrollablePaneCoords=function(e,t){var n=this.state,r=n.scale;n.paddingX,n.paddingY;return{x:(e+n.originX)*r,y:(t+n.originY)*r}},PaperArea.prototype.getContentFittingBox=function(){var e=this.props.view.model;return getContentFittingBox(e.elements,e.links)},PaperArea.prototype.getPaperSize=function(){var e=this.state,t=e.paperWidth,n=e.paperHeight,r=e.scale;return{width:t/r,height:n/r}},PaperArea.prototype.getAreaMetrics=function(){var e=this.area;return{clientWidth:e.clientWidth,clientHeight:e.clientHeight,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight}},PaperArea.prototype.computeAdjustedBox=function(){var e=this.getContentFittingBox(),t=e.x,n=e.y,r=e.x+e.width,i=e.y+e.height,o=this.pageSize,a=o.x,s=o.y,l=Math.floor(t/a),c=Math.floor(n/s),u=Math.ceil(r/a),d=Math.ceil(i/s),p=-l*a,h=-c*s;return{paperWidth:Math.max(u-l,1)*a,paperHeight:Math.max(d-c,1)*s,originX:p,originY:h}},PaperArea.prototype.shouldStartZooming=function(e){return Boolean(e.ctrlKey)&&Boolean(this.zoomOptions.requireCtrl)||!this.zoomOptions.requireCtrl},PaperArea.prototype.shouldStartPanning=function(e){var t=e.ctrlKey||e.shiftKey||e.altKey;return 0===e.button&&!t},PaperArea.prototype.startMoving=function(e,t){var n=this.pageToPaperCoords(e.pageX,e.pageY),r=n.x,i=n.y,o=t.position,a=o.x,s=o.y;this.movingElementOrigin={pointerX:r,pointerY:i,elementX:a,elementY:s}},PaperArea.prototype.startPanning=function(e){var t=this.area,n=t.scrollLeft,r=t.scrollTop;this.panningScrollOrigin={scrollLeft:n,scrollTop:r},this.clearTextSelectionInArea()},PaperArea.prototype.clearTextSelectionInArea=function(){if(document.getSelection){var e=document.getSelection();e.removeAllRanges&&e.removeAllRanges()}},PaperArea.prototype.generateLinkVertex=function(e,t){var n=e.vertices,i=n?r.__spreadArrays(n):[],o=this.props.view.model,a=d.computePolyline(o.getElement(e.sourceId),o.getElement(e.targetId),i),s=d.findNearestSegmentIndex(a,t);return new u.LinkVertex(e,s)},PaperArea.prototype.listenToPointerMove=function(e,t,n,r){if(!this.movingState){var i=void 0===t&&this.shouldStartPanning(e);i&&this.startPanning(e);var o=e.pageX,a=e.pageY;this.movingState={origin:{pageX:o,pageY:a},target:t,panning:i,pointerMoved:!1,batch:n,restoreGeometry:r},document.addEventListener("mousemove",this.onPointerMove),document.addEventListener("mouseup",this.stopListeningToPointerMove),this.source.trigger("pointerDown",{source:this,sourceEvent:e,target:t,panning:i})}},PaperArea.prototype.centerTo=function(e,t){void 0===t&&(t={});var n=this.state,r=n.paperWidth,i=n.paperHeight,o={center:e||{x:r/2,y:i/2}};return this.setViewportState(o,t)},PaperArea.prototype.centerContent=function(e){void 0===e&&(e={});var t=this.getContentFittingBox();return this.centerTo({x:t.x+t.width/2,y:t.y+t.height/2},e)},PaperArea.prototype.getScale=function(){return this.state.scale},PaperArea.prototype.setScale=function(e,t){var n,r=e,i=this.zoomOptions,o=i.min,a=i.max;if(r=Math.max(r,o),r=Math.min(r,a),t&&t.pivot){var s=t.pivot,l=s.x,c=s.y,u=this.clientToPaperCoords(this.area.clientWidth/2,this.area.clientHeight/2),d=r/this.state.scale;n={center:{x:l-(l-u.x)/d,y:c-(c-u.y)/d},scale:{x:r,y:r}}}else n={scale:{x:r,y:r}};return this.setViewportState(n,t)},PaperArea.prototype.zoomBy=function(e,t){return this.setScale(this.getScale()+e,t)},PaperArea.prototype.zoomIn=function(e){return this.zoomBy(this.zoomOptions.step,e)},PaperArea.prototype.zoomOut=function(e){return this.zoomBy(-this.zoomOptions.step,e)},PaperArea.prototype.zoomToFit=function(e){if(void 0===e&&(e={}),!e.elements||0!==e.elements.size){if(0===this.props.view.model.elements.length)return this.centerTo();var t,n;if(e.elements){var r=[];e.elements.forEach((function(e){return r.push(e)})),n=r}else n=this.props.view.model.elements;return t=getContentFittingBox(n,[]),this.zoomToFitRect(t,e)}},PaperArea.prototype.zoomToFitRect=function(e,t){void 0===t&&(t={});var n=this.area,r=n.clientWidth,i=n.clientHeight;if(0!==e.width){var o=l.fitRectKeepingAspectRatio(e.width,e.height,r,i).width/e.width,a=this.zoomOptions,s=a.min,c=a.maxFit;o=Math.max(o,s),o=Math.min(o,c);var u={center:{x:e.x+e.width/2,y:e.y+e.height/2},scale:{x:o,y:o}};return this.setViewportState(u,t)}},PaperArea.prototype.makeToSVGOptions=function(){var e=this,t=this.area.querySelector(".ontodia-paper__canvas");if(!t)throw new Error("Cannot find SVG canvas to export");return{model:this.props.view.model,paper:t,contentBox:this.getContentFittingBox(),getOverlayedElement:function(t){return e.area.querySelector("[data-element-id='"+t+"']")},preserveDimensions:!0,elementsToRemoveSelector:".ontodia-link__vertex-tools"}},PaperArea.prototype.exportSVG=function(){return l.toSVG(this.makeToSVGOptions())},PaperArea.prototype.exportPNG=function(e){return l.toDataURL(r.__assign(r.__assign({},e),this.makeToSVGOptions()))},PaperArea.prototype.isAnimatingGraph=function(){return this.cssAnimations>0},PaperArea.prototype.animateGraph=function(e,t){var n=this;this.changeGraphAnimationCount(1),e();var r="number"==typeof t?t:500;return o.delay(r).then((function(){return n.onGraphAnimationEnd()}))},PaperArea.prototype.onGraphAnimationEnd=function(){this.changeGraphAnimationCount(-1)},PaperArea.prototype.changeGraphAnimationCount=function(e){var t=this.cssAnimations+e;if(!(t<0)){var n=this.isAnimatingGraph();this.cssAnimations=t,n!==this.isAnimatingGraph()&&(this.forceUpdate(),this.source.trigger("changeAnimatingGraph",{source:this,previous:n}))}},Object.defineProperty(PaperArea.prototype,"viewportState",{get:function(){var e=this.area,t=e.clientWidth,n=e.clientHeight,r=this.state,i=r.originX,o=r.originY,a=r.paddingX,s=r.paddingY,l=r.scale;return{center:{x:(this.area.scrollLeft+t/2-a)/l-i,y:(this.area.scrollTop+n/2-s)/l-o},scale:{x:l,y:l}}},enumerable:!0,configurable:!0}),PaperArea.prototype.setViewportState=function(e,t){var n=this;this.viewportAnimation&&this.viewportAnimation.cancellation.abort();var i=this.viewportState,a=r.__assign(r.__assign({},i),e);if(t&&(t.animate||t.duration>0)){var s={from:i,to:a,cancellation:new o.Cancellation},l="number"==typeof t.duration?t.duration:500,c=o.animateInterval(l,(function(e){var t=o.easeInOutBezier(e),r={center:{x:i.center.x+(a.center.x-i.center.x)*t,y:i.center.y+(a.center.y-i.center.y)*t},scale:{x:i.scale.x+(a.scale.x-i.scale.x)*t,y:i.scale.y+(a.scale.y-i.scale.y)*t}};n.applyViewportState(r)}),s.cancellation);return this.viewportAnimation=s,c.then((function(){n.viewportAnimation=void 0}))}return this.applyViewportState(a),Promise.resolve()},PaperArea.childContextTypes=t.PaperAreaContextTypes,PaperArea}(i.Component);function clientCoordsFor(e,t){var n=(t.target instanceof SVGElement&&null!==t.target.ownerSVGElement?t.target.ownerSVGElement:t.target).getBoundingClientRect(),r=e.getBoundingClientRect();return{x:t.offsetX+(n.left-r.left),y:t.offsetY+(n.top-r.top)}}function getContentFittingBox(e,t){for(var n=1/0,r=1/0,i=-1/0,o=-1/0,a=0,s=e;a<s.length;a++){var l=s[a],c=l.position,u=c.x,d=c.y,p=l.size;n=Math.min(n,u),r=Math.min(r,d),i=Math.max(i,u+p.width),o=Math.max(o,d+p.height)}for(var h=0,f=t;h<f.length;h++)for(var m=0,g=f[h].vertices||[];m<g.length;m++){var v=g[m];u=v.x,d=v.y;n=Math.min(n,u),r=Math.min(r,d),i=Math.max(i,u),o=Math.max(o,d)}return{x:Number.isFinite(n)?n:0,y:Number.isFinite(r)?r:0,width:Number.isFinite(n)&&Number.isFinite(i)?i-n:0,height:Number.isFinite(r)&&Number.isFinite(o)?o-r:0}}t.PaperArea=m,t.getContentFittingBox=getContentFittingBox},1657:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(1964);!function(e){e.searchUpdateCriteria="search:updateCriteria",e.searchQueryItem="search:queryItems",e.connectionsLoadLinks="connections:loadLinks",e.connectionsExpandLink="connections:expandLink",e.connectionsLoadElements="connections:loadElements",e.editorChangeSelection="editor:changeSelection",e.editorToggleDialog="editor:toggleDialog",e.editorAddElements="editor:addElements"}(t.WorkspaceEventKey||(t.WorkspaceEventKey={})),t.WorkspaceContextTypes={ontodiaWorkspace:r.PropTypes.anything}},1692:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1),a=n(1573),s=n(2271),l=n(2274),c=function(e){function Paper(){var t=null!==e&&e.apply(this,arguments)||this;return t.onMouseDown=function(e){var n=t.props,r=n.view,i=n.onPointerDown,o=e.target instanceof Element?findCell(e.target,e.currentTarget,r.model):void 0;i&&i(e,o)},t}return r.__extends(Paper,e),Paper.prototype.render=function(){var e=this.props,t=e.view,n=e.group,r=e.paperTransform,o=e.linkLayerWidgets,a=e.elementLayerWidgets,c=r.width,d=r.height,p=r.originX,h=r.originY,f=r.scale,m=r.paddingX,g=r.paddingY,v={width:c*f+m,height:d*f+g,marginLeft:m,marginTop:g,paddingRight:m,paddingBottom:g},y={position:"absolute",left:0,top:0,transform:"scale("+f+","+f+")translate("+p+"px,"+h+"px)"};return i.createElement("div",{className:"ontodia-paper",style:v,onMouseDown:this.onMouseDown},i.createElement(u,{className:"ontodia-paper__canvas",style:{overflow:"visible"},paperTransform:r},i.createElement(l.LinkMarkers,{view:t}),i.createElement(l.LinkLayer,{view:t,links:t.model.links,group:n})),o,i.createElement(s.ElementLayer,{view:t,group:n,style:y,scale:f}),a)},Paper}(o.Component);function findCell(e,t,n){for(var r,i=e;;){if(i instanceof Element){if(i.hasAttribute("data-element-id"))return n.getElement(i.getAttribute("data-element-id"));if(i.hasAttribute("data-link-id")){var o=n.getLinkById(i.getAttribute("data-link-id"));return"number"==typeof r?new a.LinkVertex(o,r):o}i.hasAttribute("data-vertex")&&(r=Number(i.getAttribute("data-vertex")))}if(!i||i===t)break;i=i.parentNode}}t.Paper=c;var u=function(e){function TransformedSvgCanvas(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(TransformedSvgCanvas,e),TransformedSvgCanvas.prototype.render=function(){var e=this.props,t=e.paperTransform,n=e.style,o=e.children,a=r.__rest(e,["paperTransform","style","children"]),s=t.width,l=t.height,c=t.originX,u=t.originY,d=t.scale,p=(t.paddingX,t.paddingY,s*d),h=l*d,f=TransformedSvgCanvas.SVG_STYLE;return n&&(f=r.__assign(r.__assign({},f),n)),i.createElement("svg",r.__assign({width:p,height:h,style:f},a),i.createElement("g",{transform:"scale("+d+","+d+")translate("+c+","+u+")"},o))},TransformedSvgCanvas.SVG_STYLE={position:"absolute",top:0,left:0},TransformedSvgCanvas}(o.Component);t.TransformedSvgCanvas=u,t.totalPaneSize=function totalPaneSize(e){return{x:e.width*e.scale+2*e.paddingX,y:e.height*e.scale+2*e.paddingY}},t.paneTopLeft=function paneTopLeft(e){return{x:-e.paddingX,y:-e.paddingY}},t.paneFromPaperCoords=function paneFromPaperCoords(e,t){return{x:(e.x+t.originX)*t.scale,y:(e.y+t.originY)*t.scale}},t.paperFromPaneCoords=function paperFromPaneCoords(e,t){return{x:e.x/t.scale-t.originX,y:e.y/t.scale-t.originY}}},1693:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(1554);!function(e){e.create=function create(e,t){return{title:e,invoke:t}},e.effect=function effect(e,t){var n={title:e,invoke:function(){return t(),r}},r={title:"Skipped effect: "+e,invoke:function(){return n}};return n}}(t.Command||(t.Command={}));var i=function(){function NonRememberingHistory(){this.source=new r.EventSource,this.events=this.source,this.undoStack=[],this.redoStack=[],this.storeBatch=function(){},this.discardBatch=function(){}}return NonRememberingHistory.prototype.reset=function(){this.source.trigger("historyChanged",{hasChanges:!1})},NonRememberingHistory.prototype.undo=function(){throw new Error("Undo is unsupported")},NonRememberingHistory.prototype.redo=function(){throw new Error("Redo is unsupported")},NonRememberingHistory.prototype.execute=function(e){e.invoke(),this.source.trigger("historyChanged",{hasChanges:!0})},NonRememberingHistory.prototype.registerToUndo=function(e){this.source.trigger("historyChanged",{hasChanges:!0})},NonRememberingHistory.prototype.startBatch=function(e){return{history:this,store:this.storeBatch,discard:this.discardBatch}},NonRememberingHistory}();t.NonRememberingHistory=i},1697:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(11),o=n(1);!function(e){e.none="none",e.loading="loading",e.error="error",e.completed="completed"}(r=t.ProgressState||(t.ProgressState={}));var a="ontodia-progress-bar",s=function(e){function ProgressBar(){return null!==e&&e.apply(this,arguments)||this}return i.__extends(ProgressBar,e),ProgressBar.prototype.render=function(){var e=this.props,t=e.state,n=e.percent,i=void 0===n?100:n,s=e.height,l=void 0===s?20:s,c=a+" "+a+"--"+t,u=t===r.loading||t===r.error;return o.createElement("div",{className:c,style:{height:u?l:0}},o.createElement("div",{className:a+"__bar",role:"progressbar",style:{width:i+"%"},"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":i}))},ProgressBar}(o.Component);t.ProgressBar=s},1698:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1591),a="ontodia-list-element-view",s=function(e){function ListElementView(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){var n=t.props,r=n.disabled,i=n.model,o=n.onClick;!r&&o&&(e.persist(),o(e,i))},t}return r.__extends(ListElementView,e),ListElementView.prototype.render=function(){var e=this.props,t=e.className,n=e.view,r=e.model,s=e.highlightText,l=e.disabled,c=e.selected,u=e.onDragStart,d=n.getTypeStyle(r.types).color,p=d.h,h=d.c,f=d.l,m=c&&!l?o.hcl(p,h,1.2*f):o.hcl("white"),g=""+a;g+=l?" "+a+"--disabled":"",g+=t?" "+t:"";var v=n.formatLabel(r.label.values,r.id),y=r.types.length>0?"\nClasses: "+n.getElementTypeString(r):"";return i.createElement("li",{className:g,draggable:!l&&Boolean(u),title:v+" "+n.formatIri(r.id)+y,style:{background:o.hcl(p,h,f).toString()},onClick:this.onClick,onDragStart:u},i.createElement("div",{className:a+"__label",style:{background:m.toString()}},highlightSubstring(v,s)))},ListElementView}(i.Component);t.ListElementView=s,t.startDragElements=function startDragElements(e,t){try{e.dataTransfer.setData("application/x-ontodia-elements",JSON.stringify(t))}catch(n){e.dataTransfer.setData("text",JSON.stringify(t))}return!1};var l={className:"ontodia-text-highlight"};function highlightSubstring(e,t,n){if(void 0===n&&(n=l),!t)return i.createElement("span",null,e);var o=e.toLowerCase().indexOf(t.toLowerCase());if(o<0)return i.createElement("span",null,e);var a=o+t.length,s=e.substring(0,o),c=e.substring(o,a),u=e.substring(a);return i.createElement("span",null,s,i.createElement("span",r.__assign({},n),c),u)}t.highlightSubstring=highlightSubstring},1748:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(3269),i=n(1574),o=n(1554),a=n(1656);function groupForceLayout(e){(new r.Layout).nodes(e.nodes).links(e.links).avoidOverlaps(e.avoidOvelaps).convergenceThreshold(1e-9).jaccardLinkLengths(e.preferredLinkLength).handleDisconnected(!0).start(30,0,10,void 0,!1)}function groupRemoveOverlaps(e){for(var t=[],n=0,i=e;n<i.length;n++){var o=i[n];t.push(new r.Rectangle(o.x,o.x+o.width,o.y,o.y+o.height))}r.removeOverlaps(t);for(var a=0;a<t.length;a++){o=e[a];var s=t[a];o.x=s.x,o.y=s.y}}function translateToPositiveQuadrant(e,t){var n=1/0,r=1/0;e.forEach((function(e){n=Math.min(n,e.x),r=Math.min(r,e.y)}));var i=t.x,o=t.y;e.forEach((function(t,a){e.set(a,{x:t.x-n+i,y:t.y-r+o})}))}function padded(e,t,n){if(t)for(var r=0,i=e;r<i.length;r++){(s=i[r]).x-=t.x,s.y-=t.y,s.width+=2*t.x,s.height+=2*t.y}if(n(),t)for(var o=0,a=e;o<a.length;o++){var s;(s=a[o]).x+=t.x,s.y+=t.y,s.width-=2*t.x,s.height-=2*t.y}}function biasFreePadded(e,t,n){for(var r=new Map,i={x:1/0,y:1/0},o=0,a=e;o<a.length;o++){var s=a[o];r.set(s.id,{width:s.width,height:s.height});var l=Math.max(s.width,s.height),c=s.width?l/s.width:1,u=s.height?l/s.height:1;i.x=Math.min(c-1+1,i.x),i.y=Math.min(u-1+1,i.y),s.height=l,s.width=l}padded(e,t,(function(){return n()}));for(var d=getContentFittingBoxForLayout(e),p=0,h=e;p<h.length;p++){s=h[p];var f=r.get(s.id);s.x=(s.x-d.x)/i.x+d.x,s.y=(s.y-d.y)/i.y+d.y,s.height=f.height,s.width=f.width}}function calculateLayout(e){var t=i.computeGrouping(e.model.elements),n=e.layoutFunction,r=e.model,o=e.fixedElements,a=e.selectedElements;return a&&a.size<=1?{positions:new Map,nestedLayouts:[],keepAveragePosition:!1}:function internalRecursion(e){for(var s=e?t.get(e):r.elements.filter((function(e){return void 0===e.group})),l=a?s.filter((function(e){return a.has(e)})):s,c=[],u=0,d=l;u<d.length;u++){var p=d[u];t.has(p.id)&&c.push(internalRecursion(p.id))}for(var h=[],f={},m=0,g=l;m<g.length;m++){p=g[m];var v=i.boundsOf(p),y=v.x,k=v.y,E=v.width,b=v.height,L={id:p.id,x:y,y:k,width:E,height:b,fixed:o&&o.has(p)?1:0};f[p.id]=L,h.push(L)}for(var S=[],w=0,_=r.links;w<_.length;w++){var T=_[w];if(r.isSourceAndTargetVisible(T)){var C=r.sourceOf(T),P=r.targetOf(T),x=f[C.id],I=f[P.id];x&&I&&S.push({source:x,target:I})}}n(h,S,e);for(var D=new Map,A=0,O=h;A<O.length;A++){L=O[A];D.set(L.id,{x:L.x,y:L.y})}return{positions:D,group:e,nestedLayouts:c,keepAveragePosition:Boolean(a)}}(e.group)}function calculateAveragePosition(e){for(var t=0,n=0,r=0,i=e;r<i.length;r++){var o=i[r];t+=o.position.x+o.size.width/2,n+=o.position.y+o.size.height/2}return{x:t/e.length,y:n/e.length}}function removeOverlaps(e){var t=e.padding;return calculateLayout({model:e.model,group:e.group,fixedElements:e.fixedElements,selectedElements:e.selectedElements,layoutFunction:function(e){padded(e,t,(function(){return groupRemoveOverlaps(e)}))}})}function getContentFittingBoxForLayout(e){for(var t=1/0,n=1/0,r=-1/0,i=-1/0,o=0,a=e;o<a.length;o++){var s=a[o],l=s.x,c=s.y,u=s.width,d=s.height;t=Math.min(t,l),n=Math.min(n,c),r=Math.max(r,l+u),i=Math.max(i,c+d)}return{x:Number.isFinite(t)?t:0,y:Number.isFinite(n)?n:0,width:Number.isFinite(t)&&Number.isFinite(r)?r-t:0,height:Number.isFinite(n)&&Number.isFinite(i)?i-n:0}}t.groupForceLayout=groupForceLayout,t.groupRemoveOverlaps=groupRemoveOverlaps,t.translateToPositiveQuadrant=translateToPositiveQuadrant,t.uniformGrid=function uniformGrid(e){return function(t){var n=Math.floor(t/e.rows);return{x:(t-n*e.rows)*e.cellSize.x,y:n*e.cellSize.y,width:e.cellSize.x,height:e.cellSize.y}}},t.padded=padded,t.biasFreePadded=biasFreePadded,t.calculateLayout=calculateLayout,t.applyLayout=function applyLayout(e,t){for(var n=t,r=n.positions,i=n.group,o=n.nestedLayouts,s=n.keepAveragePosition,l=e.elements.filter((function(e){var t=e.id;return r.has(t)})),c=0,u=o;c<u.length;c++){var d=u[c];applyLayout(e,d)}if(i){var p=a.getContentFittingBox(l,[]);translateToPositiveQuadrant(r,p)}for(var h=s?calculateAveragePosition(l):void 0,f=0,m=l;f<m.length;f++){var g=m[f];g.setPosition(r.get(g.id))}if(s){var v=calculateAveragePosition(l),y={x:h.x-v.x,y:h.y-v.y};r.forEach((function(t,n){e.getElement(n).setPosition({x:t.x+y.x,y:t.y+y.y})}))}},t.calculateAveragePosition=calculateAveragePosition,t.placeElementsAround=function placeElementsAround(e){var t=e.model,n=e.elements,r=e.targetElement,a=e.prefferedLinksLength,s=i.boundsOf(r),l=s.x+s.width/2,c=s.y+s.height/2,u=0;if(r.links.length>0){var d=calculateAveragePosition(r.links.map((function(e){var n=t.sourceOf(e);return n!==r?n:t.targetOf(e)}))),p={x:l-d.x,y:c-d.y};0===p.x&&0===p.y||(u=Math.atan2(p.y,p.x))}var h=Math.min(Math.PI/n.length,Math.PI/6),f=[].concat(n),placeElementFromSteck=function(e,t){if(t){var n=t.size;t.setPosition({x:l+a*Math.cos(e)-n.width/2,y:c+a*Math.sin(e)-n.height/2})}};if(f.length%2==0)for(var m=h/2;f.length>0;m+=h)placeElementFromSteck(u-m,f.pop()),placeElementFromSteck(u+m,f.pop());else{placeElementFromSteck(u,f.pop());for(m=h;f.length>0;m+=h)placeElementFromSteck(u-m,f.pop()),placeElementFromSteck(u+m,f.pop())}return new Promise((function(e){var n=new o.EventObserver;n.listen(t.events,"changeCells",(function(){n.stopListening(),removeOverlaps({model:t,padding:{x:15,y:15}}),e()}))}))},t.removeOverlaps=removeOverlaps,t.forceLayout=function forceLayout(e){var t=e.model,n=e.group,r=e.fixedElements,i=e.selectedElements;return calculateLayout({model:t,group:n,fixedElements:r,selectedElements:i,layoutFunction:function(e,t){r&&r.size>0?biasFreePadded(e,{x:50,y:50},(function(){return groupForceLayout({nodes:e,links:t,preferredLinkLength:200,avoidOvelaps:!0})})):(groupForceLayout({nodes:e,links:t,preferredLinkLength:200}),biasFreePadded(e,{x:50,y:50},(function(){return groupRemoveOverlaps(e)})))}})},t.getContentFittingBoxForLayout=getContentFittingBoxForLayout},1838:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.generate128BitID=function generate128BitID(){function random32BitDigits(){return Math.floor(4294967296*(1+Math.random())).toString(16).substring(1)}return random32BitDigits()+random32BitDigits()+random32BitDigits()+random32BitDigits()},t.hashFnv32a=function hashFnv32a(e,t){void 0===t&&(t=2166136261);var n,r,i=2147483647&t;for(n=0,r=e.length;n<r;n++)i^=e.charCodeAt(n),i+=(i<<1)+(i<<4)+(i<<7)+(i<<8)+(i<<24);return i>>>0},t.getUriLocalName=function getUriLocalName(e){var t=e.indexOf("#");if(t<0&&(t=e.lastIndexOf("/")),t<0&&(t=e.lastIndexOf(":")),!(t<0))return e.substring(t+1)}},1964:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.anything=function(){return null}}(t.PropTypes||(t.PropTypes={}))},1965:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1838),o=n(1966);function isEncodedBlank(e){return e.startsWith(t.ENCODED_PREFIX)}t.MAX_RECURSION_DEEP=3,t.ENCODED_PREFIX="sparql-blank:",t.BLANK_NODE_QUERY_PARAMETERS="?blankTrgProp ?blankTrg ?blankSrc ?blankSrcProp ?listHead",t.BLANK_NODE_QUERY='\n    OPTIONAL {\n        FILTER (ISBLANK(?inst)).\n        {\n            ?inst ?blankTrgProp ?blankTrg.\n            ?blankSrc ?blankSrcProp ?inst.\n            FILTER NOT EXISTS { ?inst rdf:first _:smth1 }.\n            BIND("blankNode" as ?blankType)\n        } UNION {\n            ?inst rdf:rest*/rdf:first ?blankTrg.\n            ?blankSrc ?blankSrcProp ?inst.\n            _:smth2 rdf:first ?blankTrg.\n            BIND(?blankSrcProp as ?blankTrgProp)\n            BIND("listHead" as ?blankType)\n            FILTER NOT EXISTS { _:smth3 rdf:rest ?inst }.\n        } UNION {\n            ?listHead rdf:rest* ?inst.\n            FILTER NOT EXISTS { _:smth4 rdf:rest ?listHead }.\n\n            ?listHead rdf:rest*/rdf:first ?blankTrg.\n            ?blankSrc ?blankSrcProp ?listHead.\n            _:smth5 rdf:first ?blankTrg.\n            BIND(?blankSrcProp as ?blankTrgProp)\n            BIND("listHead" as ?blankType)\n        }\n    }\n',t.isEncodedBlank=isEncodedBlank;var a=function(){function QueryExecutor(e){this.queryFunction=e,this.queryDictionary={}}return QueryExecutor.prototype.executeQuery=function(e){var t=this,n=this.queryDictionary[e];return n||(this.queryDictionary[e]=this.queryFunction(e).then((function(n){return delete t.queryDictionary[e],n})),this.queryDictionary[e])},QueryExecutor}();function processBlankBindings(e,n,r){for(var i={},s=0,l=e;s<l.length;s++){var c=l[s];c.newInst&&(c.inst=c.newInst),i[c.inst.value]||(i[c.inst.value]=[]),i[c.inst.value].push(c)}for(var u=[],d=0,p=e;d<p.length;d++){var h=p[d];o.isRdfBlank(h.blankTrg)&&u.push([h])}return function loadRelatedBlankNodes(e,n,r,i){if((i=i||1)>t.MAX_RECURSION_DEEP)return Promise.resolve({});var a=e.map((function(e){return{query:getQueryForChain(e,r),chain:e}})).map((function(e){return n.executeQuery(e.query).then((function(t){return{response:t,chain:e.chain}}))}));return Promise.all(a).then((function(e){for(var t=[],a={},_loop_1=function(e){var s=e.response.results.bindings;if(s.length>0){for(var l=[],c=0,u=s;c<u.length;c++){var d=u[c];o.isRdfBlank(d.blankTrg)&&l.push(e.chain.concat([d]))}t.push(loadRelatedBlankNodes(l,n,r,i+1).then((function(e){for(var t=getEncodedIdDictionary(e),n={},r=0,i=s;r<i.length;r++){var o=i[r];o.label=createLabelForBlankBinding(o);var l=t[o.blankTrg.value];l&&(o.blankTrg.value=l),n[o.inst.value]||(n[o.inst.value]=[]),n[o.inst.value].push(o)}return Object.keys(n).forEach((function(e){var t=n[e],r=t[0].inst.value;a[r]=t})),!0})))}},s=0,l=e;s<l.length;s++){_loop_1(l[s])}return Promise.all(t).then((function(){return a}))}))}(u,new a(n),r).then((function(t){for(var n=getEncodedIdDictionary(t),r=0,o=Object.keys(i).map((function(e){return i[e]}));r<o.length;r++){for(var a=o[r],s=0,l=a;s<l.length;s++){var c=l[s];c.label||(c.label=createLabelForBlankBinding(c));var u=n[c.blankTrg.value];u&&(c.blankTrg.value=u)}updateGroupIds(a,encodeId(a))}return e}))}function getEncodedIdDictionary(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];t[i]=encodeId(e[i]),updateGroupIds(e[i],t[i])}return t}function updateGroupIds(e,t){for(var n=0,r=e;n<r.length;n++){r[n].inst.value=t}}function encodeId(e){for(var n={},i=0,o=e;i<o.length;i++){var a=o[i],s=(a.inst,r.__rest(a,["inst"])),l=JSON.stringify(s);n[l]=s}var c=Object.keys(n).sort().map((function(e){return n[e]}));return t.ENCODED_PREFIX+encodeURI(JSON.stringify(c))}function decodeId(e){if(isEncodedBlank(e))try{var n=e.substring(t.ENCODED_PREFIX.length,e.length);return JSON.parse(decodeURI(n)).map((function(t){return t.inst={type:"uri",value:e},t}))}catch(e){return}}function createLabelForBlankBinding(e){return"listHead"===e.blankType.value?{type:"literal",value:"RDFList","xml:lang":""}:{type:"literal",value:e.class?i.getUriLocalName(e.class.value)||e.class.value:"anonymous","xml:lang":""}}function getQueryForChain(e,t){var n=e.map((function(t,n){return function getQueryBlock(e,t,n){var r=0===t||"listHead"!==e.blankType.value,i=t>0?"?inst"+(t-1):"<"+e.blankSrc.value+">",o=r?t>0?"?blankTrgProp"+(t-1):"<"+e.blankSrcProp.value+">":"?anyType"+t,a=t===n?"":t.toString(),s=r?"<"+e.blankTrgProp.value+">":"?anyType0"+t;return"\n            # ======================\n            "+i+" "+o+" ?blankSrc"+t+".\n            "+(0===t&&"listHead"===e.blankType.value?"\n            ?blankSrc"+t+" rdf:rest*/rdf:first ?inst"+a+".\n            ":"?blankSrc"+t+" "+s+" ?inst"+a+".")+"\n            BIND (<"+e.blankTrgProp.value+"> as ?blankSrcProp"+t+").\n            FILTER (ISBLANK(?inst"+a+")).\n            {\n                ?inst"+a+" ?blankTrgProp"+a+" ?blankTrg"+a+'.\n                BIND("blankNode" as ?blankType'+a+").\n                FILTER NOT EXISTS { ?inst"+a+" rdf:first _:smth1"+t+" }.\n            } UNION {\n                ?inst"+a+" rdf:rest*/rdf:first ?blankTrg"+a+".\n                ?blankSrc"+t+" ?blankSrcProp"+t+" ?inst"+a+".\n                _:smth2"+t+" rdf:first ?blankTrg"+a+".\n                BIND(?blankSrcProp"+t+" as ?blankTrgProp"+a+')\n                BIND("listHead" as ?blankType'+a+")\n                FILTER NOT EXISTS { _:smth3"+t+" rdf:rest ?inst"+a+" }.\n            }\n            OPTIONAL {\n                ?inst"+a+" rdf:type ?class"+a+".\n            }\n        "}(t,n,e.length-1)})).join("\n");return t.defaultPrefix+"\n    SELECT ?inst ?class ?label ?blankTrgProp ?blankTrg ?blankType\n        WHERE {\n           "+n+"\n        }\n    "}function getElementBindings(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];decodeId(i)&&(t=t.concat(decodeId(i)))}return t.filter((function(t){return-1!==e.indexOf(t.inst.value)}))}function getLinkBinding(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];decodeId(i)&&(t=t.concat(decodeId(i)))}for(var a=[],s=0,l=t;s<l.length;s++){var c=l[s];-1!==e.indexOf(c.inst.value)&&((o.isRdfIri(c.blankSrc)||o.isRdfBlank(c.blankSrc))&&o.isRdfIri(c.blankSrcProp)&&-1!==e.indexOf(c.blankSrc.value)&&a.push({source:c.blankSrc,type:c.blankSrcProp,target:c.inst}),(o.isRdfIri(c.blankTrg)||o.isRdfBlank(c.blankTrg))&&o.isRdfIri(c.blankTrgProp)&&-1!==e.indexOf(c.blankTrg.value)&&a.push({source:c.inst,type:c.blankTrgProp,target:c.blankTrg}))}return a}function getLinkCountBinding(e){for(var t=decodeId(e),n={},r=0,i=t;r<i.length;r++){var a=i[r];e===a.inst.value&&(o.isRdfIri(a.blankTrg)||o.isRdfBlank(a.blankTrg))&&o.isRdfIri(a.blankTrgProp)&&((o.isRdfIri(a.blankSrc)||o.isRdfBlank(a.blankSrc))&&o.isRdfIri(a.blankSrcProp)&&(n[a.blankSrcProp.value]||(n[a.blankSrcProp.value]={link:a.blankSrcProp,inCount:{type:"literal",value:"1","xml:lang":""},outCount:{type:"literal",value:"0","xml:lang":""}})),n[a.blankTrgProp.value]?n[a.blankTrgProp.value].outCount.value=(+n[a.blankTrgProp.value].outCount.value+1).toString():n[a.blankTrgProp.value]={link:a.blankTrgProp,inCount:{type:"literal",value:"0","xml:lang":""},outCount:{type:"literal",value:"1","xml:lang":""}})}return Object.keys(n).map((function(e){return n[e]}))}t.QueryExecutor=a,t.updateFilterResults=function updateFilterResults(e,t,n){for(var r=[],i=[],a=0,s=e.results.bindings;a<s.length;a++){var l=s[a];o.isBlankBinding(l)?i.push(l):r.push(l)}return processBlankBindings(i,(function(e){return t(e)}),n).then((function(t){return e.results.bindings=r.concat(t),e}))},t.processBlankBindings=processBlankBindings,t.encodeId=encodeId,t.decodeId=decodeId,t.createLabelForBlankBinding=createLabelForBlankBinding,t.elementInfo=function elementInfo(e){return{head:void 0,results:{bindings:getElementBindings(e.filter((function(e){return isEncodedBlank(e)})))}}},t.linksInfo=function linksInfo(e){return{head:void 0,results:{bindings:getLinkBinding(e)}}},t.linkTypesOf=function linkTypesOf(e){return{head:void 0,results:{bindings:getLinkCountBinding(e.elementId)}}},t.filter=function filter(e){var t={head:void 0,results:{bindings:[]}};return 0===e.limit&&(e.limit=100),e.elementTypeId?t.results.bindings=[]:e.refElementId&&e.refElementLinkId?t.results.bindings=function getAllRelatedByLinkTypeElements(e,t,n){var r=(decodeId(e)||[]).concat(decodeId(t)||[]),i=[];if(r.length>0)for(var a=0,s=r;a<s.length;a++){var l=s[a];"in"===n?l.inst.value===e&&(o.isRdfIri(l.blankSrc)||o.isRdfBlank(l.blankSrc))&&t===l.blankSrcProp.value?o.isRdfIri(l.blankSrc)?i.push({inst:l.blankSrc}):i=i.concat(decodeId(l.blankSrc.value)||[{inst:l.blankSrc}]):l.blankTrg.value===e&&t===l.blankTrgProp.value&&i.push(l):l.inst.value===e&&(o.isRdfIri(l.blankTrg)||o.isRdfBlank(l.blankTrg))&&t===l.blankTrgProp.value?o.isRdfIri(l.blankTrg)?i.push({inst:l.blankTrg}):i=i.concat(decodeId(l.blankTrg.value)||[{inst:l.blankTrg}]):l.blankSrc.value===e&&t===l.blankSrcProp.value&&i.push(l)}return i}(e.refElementId,e.refElementLinkId,e.linkDirection):e.refElementId&&(t.results.bindings=function getAllRelatedElements(e){var t=decodeId(e),n=[];if(t)for(var r=0,i=t;r<i.length;r++){var a=i[r];a.inst.value!==e&&e!==a.blankSrc.value&&e!==a.blankTrg.value||(n.push(a),o.isRdfIri(a.blankSrc)?n.push({inst:a.blankSrc}):o.isRdfBlank(a.blankSrc)&&(n=n.concat(decodeId(a.blankSrc.value)||[{inst:a.blankSrc}])),o.isRdfIri(a.blankTrg)?n.push({inst:a.blankTrg}):o.isRdfBlank(a.blankTrg)&&(n=n.concat(decodeId(a.blankTrg.value)||[{inst:a.blankTrg}])))}return n}(e.refElementId)),e.text&&0!==t.results.bindings.length&&(t.results.bindings=t.results.bindings.filter((function(t){return-1!==t.inst.value.toLowerCase().indexOf(e.text)}))),t},t.getElementTypes=function getElementTypes(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=decodeId(r[n]);if(i)for(var a=0,s=i;a<s.length;a++){var l=s[a];o.isRdfIri(l.inst)&&l.class&&t.push({inst:l.inst,class:l.class})}}return{head:void 0,results:{bindings:t}}}},1966:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isRdfBlank=function isRdfBlank(e){return e&&"bnode"===e.type},t.isRdfIri=function isRdfIri(e){return e&&"uri"===e.type},t.isRdfLiteral=function isRdfLiteral(e){return e&&"literal"===e.type},t.isBlankBinding=function isBlankBinding(e){var t=e;return void 0!==t.blankTrgProp||void 0!==t.blankTrg||void 0!==t.blankSrcProp||void 0!==t.blankSrc}},1980:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(16),o=n(1580),a=["id","type","size","fixedSize","angle","isExpanded","position","iri","group","typeId","source","target","vertices"];function emptyDiagram(){return{"@context":o.DIAGRAM_CONTEXT_URL_V1,"@type":"Diagram",layoutData:{"@type":"Layout",elements:[],links:[]},linkTypeOptions:[]}}function emptyLayoutData(){return{"@type":"Layout",elements:[],links:[]}}t.emptyDiagram=emptyDiagram,t.emptyLayoutData=emptyLayoutData,t.convertToSerializedDiagram=function convertToSerializedDiagram(e){for(var t=[],n=[],o=0,s=e.layoutData.cells;o<s.length;o++){var l=s[o],c=i.pick(l,a);switch("Ontodia.Element"!==c.type&&"element"!==c.type||(c.type="Element"),"link"===c.type&&(c.type="Link"),c.iri||(c.iri=c.id),c["@id"]=c.id,delete c.id,c["@type"]=c.type,delete c.type,c["@type"]){case"Element":t.push(c);break;case"Link":c.source["@id"]=c.source.id,delete c.source.id,c.target["@id"]=c.target.id,delete c.target.id,c.property=c.typeId,delete c.typeId,n.push(c)}}return r.__assign(r.__assign({},emptyDiagram()),{layoutData:{"@type":"Layout",elements:t,links:n},linkTypeOptions:e.linkTypeOptions})},t.makeSerializedDiagram=function makeSerializedDiagram(e){var t=r.__assign(r.__assign({},emptyDiagram()),{linkTypeOptions:e.linkTypeOptions});return e.layoutData&&(t.layoutData=e.layoutData),t},t.makeLayoutData=function makeLayoutData(e,t){return{"@type":"Layout",elements:e.map((function(e){return{"@type":"Element","@id":e.id,iri:e.iri,position:e.position,size:e.size,fixedSize:e.isFixedSize,isExpanded:e.isExpanded,group:e.group,elementState:e.elementState}})),links:t.map((function(e){return{"@type":"Link","@id":e.id,property:e.typeId,source:{"@id":e.sourceId},target:{"@id":e.targetId},vertices:r.__spreadArrays(e.vertices),linkState:e.linkState}}))}}},1984:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1580),o=n(1573),a=n(1693),s=n(2326),l=n(3278),c=n(1980),u=function(e){function AsyncModel(t,n){var r=e.call(this,t)||this;return r.groupByProperties=n,r.linkSettings={},r.onLinkTypeVisibilityChanged=function(e){if(e.source.visible)e.preventLoading||r.requestLinksOfType([e.source.id]);else for(var t=0,n=r.linksOfType(e.source.id);t<n.length;t++){var i=n[t];r.graph.removeLink(i.id)}},r}return r.__extends(AsyncModel,e),Object.defineProperty(AsyncModel.prototype,"asyncSource",{get:function(){return this.source},enumerable:!0,configurable:!0}),Object.defineProperty(AsyncModel.prototype,"dataProvider",{get:function(){return this._dataProvider},enumerable:!0,configurable:!0}),AsyncModel.prototype.subscribeGraph=function(){var t=this;e.prototype.subscribeGraph.call(this),this.graphListener.listen(this.graph.events,"linkTypeEvent",(function(e){"changeVisibility"===e.key&&t.onLinkTypeVisibilityChanged(e.data[e.key],e.key)}))},AsyncModel.prototype.setDataProvider=function(e){this._dataProvider=e,this.fetcher=new l.DataFetcher(this.graph,e)},AsyncModel.prototype.createNewDiagram=function(e){var t=this;return this.resetGraph(),this.setDataProvider(e),this.asyncSource.trigger("loadingStart",{source:this}),this.dataProvider.linkTypes().then((function(e){var n=t.initLinkTypes(e);return t.loadAndRenderLayout({allLinkTypes:n,markLinksAsLayoutOnly:!1})})).catch((function(e){return console.error(e),t.asyncSource.trigger("loadingError",{source:t,error:e}),Promise.reject(e)}))},AsyncModel.prototype.importLayout=function(e){var t=this;return this.resetGraph(),this.setDataProvider(e.dataProvider),this.asyncSource.trigger("loadingStart",{source:this}),this.dataProvider.linkTypes().then((function(n){var r=t.initLinkTypes(n),i=e.diagram?e.diagram:c.emptyDiagram();t.setLinkSettings(i.linkTypeOptions);var o=t.loadAndRenderLayout({layoutData:i.layoutData,preloadedElements:e.preloadedElements||{},markLinksAsLayoutOnly:e.validateLinks||!1,allLinkTypes:r,hideUnusedLinkTypes:e.hideUnusedLinkTypes}),a=e.validateLinks?t.requestLinksOfType():Promise.resolve();return Promise.all([o,a])})).then((function(){t.asyncSource.trigger("loadingSuccess",{source:t})})).catch((function(e){return console.error(e),t.asyncSource.trigger("loadingError",{source:t,error:e}),Promise.reject(e)}))},AsyncModel.prototype.exportLayout=function(){var e=c.makeLayoutData(this.graph.getElements(),this.graph.getLinks()),t=this.graph.getLinkTypes().filter((function(e){return!(e.visible&&e.showLabel||e.id===i.PLACEHOLDER_LINK_TYPE)})).map((function(e){return{"@type":"LinkTypeOptions",property:e.id,visible:e.visible,showLabel:e.showLabel}}));return c.makeSerializedDiagram({layoutData:e,linkTypeOptions:t})},AsyncModel.prototype.initLinkTypes=function(e){for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n],a=i.id,s=i.label,l=new o.FatLinkType({id:a,label:s.values});this.graph.addLinkType(l),t.push(l)}return t},AsyncModel.prototype.setLinkSettings=function(e){if(e)for(var t=0,n=e;t<n.length;t++){var r=n[t],i=r.visible,o=void 0===i||i,a=r.showLabel,s=void 0===a||a,l=r.property;this.linkSettings[l]={"@type":"LinkTypeOptions",property:l,visible:o,showLabel:s};var c=this.getLinkType(l);c&&c.setVisibility({visible:o,showLabel:s})}},AsyncModel.prototype.loadAndRenderLayout=function(e){for(var t=e.layoutData,n=void 0===t?c.emptyLayoutData():t,r=e.preloadedElements,i=void 0===r?{}:r,a=e.markLinksAsLayoutOnly,l=e.hideUnusedLinkTypes,u=[],d={},p=0,h=n.elements;p<h.length;p++){var f=h[p],m=f["@id"],g=f.iri,v=f.position,y=f.size,k=f.fixedSize,E=f.isExpanded,b=f.group,L=f.elementState,S=i[g],w=S||s.placeholderDataFromIri(g),_=new o.Element({id:m,data:w,position:v,size:y,fixedSize:k,expanded:E,group:b,elementState:L});this.graph.addElement(_),S||u.push(_.iri)}for(var T=0,C=n.links;T<C.length;T++){var P=C[T],x=(m=P["@id"],P.property),I=P.source,D=P.target,A=P.vertices,O=P.linkState,N=this.createLinkType(x);d[N.id]=N;var M=this.addLink(new o.Link({id:m,typeId:N.id,sourceId:I["@id"],targetId:D["@id"],vertices:A,linkState:O}));M&&M.setLayoutOnly(a)}this.subscribeGraph();var R=this.requestElementData(u);return l&&e.allLinkTypes&&this.hideUnusedLinkTypes(e.allLinkTypes,d),R},AsyncModel.prototype.hideUnusedLinkTypes=function(e,t){for(var n=0,r=e;n<r.length;n++){var i=r[n];t[i.id]||i.setVisibility({visible:!1,showLabel:i.showLabel})}},AsyncModel.prototype.requestElementData=function(e){return this.fetcher.fetchElementData(e)},AsyncModel.prototype.requestLinksOfType=function(e){var t=this,n=e||this.graph.getLinkTypes().filter((function(e){return e.visible})).map((function(e){return e.id}));return this.dataProvider.linksInfo({elementIds:this.graph.getElements().map((function(e){return e.iri})),linkTypeIds:n}).then((function(e){return t.onLinkInfoLoaded(e)}))},AsyncModel.prototype.createClass=function(t){if(this.graph.getClass(t))return e.prototype.getClass.call(this,t);var n=e.prototype.createClass.call(this,t);return this.fetcher.fetchClass(n),n},AsyncModel.prototype.createLinkType=function(t){if(this.graph.getLinkType(t))return e.prototype.createLinkType.call(this,t);var n=e.prototype.createLinkType.call(this,t),r=this.linkSettings[n.id];if(r){var i=r.visible,o=r.showLabel;n.setVisibility({visible:i,showLabel:o,preventLoading:!0})}return this.fetcher.fetchLinkType(n),n},AsyncModel.prototype.createProperty=function(t){if(this.graph.getProperty(t))return e.prototype.createProperty.call(this,t);var n=e.prototype.createProperty.call(this,t);return this.fetcher.fetchPropertyType(n),n},AsyncModel.prototype.onLinkInfoLoaded=function(e){for(var t,cancel=function(){t=!1},n=0,r=e;n<r.length;n++){var i=r[n];this.createLinkType(i.linkTypeId),t=!0,this.asyncSource.trigger("createLoadedLink",{source:this,model:i,cancel}),t&&this.createLinks(i)}},AsyncModel.prototype.createLinks=function(e){for(var t=this.graph.getElements().filter((function(t){return t.iri===e.sourceId})),n=this.graph.getElements().filter((function(t){return t.iri===e.targetId})),r=e.linkTypeId,i=0,a=t;i<a.length;i++)for(var s=a[i],l=0,c=n;l<c.length;l++){var u=c[l];this.addLink(new o.Link({typeId:r,sourceId:s.id,targetId:u.id,data:e}))}},AsyncModel.prototype.loadEmbeddedElements=function(e){var t=this,n=this.groupByProperties.map((function(n){return t.dataProvider.linkElements({elementId:e,linkId:n.linkType,offset:0,direction:n.linkDirection})}));return Promise.all(n).then((function(e){return e.reduce((function(e,t){return Object.assign(e,t)}),{})}))},AsyncModel}(s.DiagramModel);t.AsyncModel=u,t.requestElementData=function requestElementData(e,t){return a.Command.effect("Fetch element data",(function(){e.requestElementData(t)}))},t.restoreLinksBetweenElements=function restoreLinksBetweenElements(e){return a.Command.effect("Restore links between elements",(function(){e.requestLinksOfType()}))}},1985:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=function(e){function DraggableHandle(){var t=null!==e&&e.apply(this,arguments)||this;return t.isHoldingMouse=!1,t.onHandleMouseDown=function(e){if(e.target===e.currentTarget&&!t.isHoldingMouse){0===e.button&&(t.isHoldingMouse=!0,t.originPageX=e.pageX,t.originPageY=e.pageY,document.addEventListener("mousemove",t.onMouseMove),document.addEventListener("mouseup",t.onMouseUp),t.props.onBeginDragHandle(e))}},t.onMouseMove=function(e){t.isHoldingMouse&&(e.preventDefault(),t.props.onDragHandle(e,e.pageX-t.originPageX,e.pageY-t.originPageY))},t.onMouseUp=function(e){t.removeListeners(),t.props.onEndDragHandle&&t.props.onEndDragHandle(e)},t}return r.__extends(DraggableHandle,e),DraggableHandle.prototype.render=function(){var e=this.props,t=(e.onBeginDragHandle,e.onDragHandle,e.onEndDragHandle,r.__rest(e,["onBeginDragHandle","onDragHandle","onEndDragHandle"]));return i.createElement("div",r.__assign({},t,{onMouseDown:this.onHandleMouseDown}),this.props.children)},DraggableHandle.prototype.componentWillUnmount=function(){this.removeListeners()},DraggableHandle.prototype.removeListeners=function(){this.isHoldingMouse&&(this.isHoldingMouse=!1,document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp))},DraggableHandle}(i.Component);t.DraggableHandle=o},1986:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(11),o=n(1),a=n(1623),s=n(1560),l=n(1554),c=n(1698);!function(e){e[e.Up=0]="Up",e[e.Down=1]="Down"}(r||(r={}));var u=function(e){function SearchResults(t){var n=e.call(this,t)||this;return n.listener=new l.EventObserver,n.delayedChangeCells=new s.Debouncer,n.startSelection=0,n.endSelection=0,n.onRootMount=function(e){n.root=e},n.renderResultItem=function(e){var t=n.props.useDragAndDrop,r=n.canBeSelected(e);return o.createElement(c.ListElementView,{key:e.id,model:e,view:n.props.view,highlightText:n.props.highlightText,disabled:!r,selected:n.props.selection.has(e.id),onClick:r?n.onItemClick:void 0,onDragStart:t?function(t){var r=n.props.selection,i=[];return r.forEach((function(e){return i.push(e)})),r.has(e.id)||i.push(e.id),c.startDragElements(t,i)}:void 0})},n.onChangeCells=function(){var e=n.props,t=e.items,r=e.selection;if(0===r.size)t&&t.length>0&&n.forceUpdate();else{for(var i=a.cloneSet(r),o=0,s=n.props.view.model.elements;o<s.length;o++){var l=s[o];void 0===l.group&&r.has(l.iri)&&i.delete(l.iri)}n.updateSelection(i)}},n.addKeyListener=function(){document.addEventListener("keydown",n.onKeyUp)},n.removeKeyListener=function(){document.removeEventListener("keydown",n.onKeyUp)},n.onKeyUp=function(e){var t=n.props.items,i=38===e.keyCode||38===e.which,o=40===e.keyCode||40===e.which;if(i||o)if(e.shiftKey){i?n.endSelection=n.getNextIndex(n.endSelection,r.Up):o&&(n.endSelection=n.getNextIndex(n.endSelection,r.Down));var a=Math.min(n.startSelection,n.endSelection),s=Math.max(n.startSelection,n.endSelection),l=n.selectRange(a,s);n.updateSelection(l),n.focusOn(n.endSelection)}else{a=Math.min(n.startSelection,n.endSelection),s=Math.max(n.startSelection,n.endSelection);i?n.startSelection=n.getNextIndex(a,r.Up):o&&(n.startSelection=n.getNextIndex(s,r.Down)),n.endSelection=n.startSelection;var c=t[n.startSelection],u=new Set;u.add(c.id),n.updateSelection(u),n.focusOn(n.startSelection)}e.preventDefault()},n.onItemClick=function(e,t){e.preventDefault();var r,i=n.props,o=i.items,s=i.selection,l=i.onSelectionChanged,c=(s.has(t.id),o.indexOf(t));if(e.shiftKey&&-1!==n.startSelection){var u=Math.min(n.startSelection,c),d=Math.max(n.startSelection,c);r=n.selectRange(u,d)}else{n.endSelection=n.startSelection=c,e.ctrlKey||e.metaKey?(r=a.cloneSet(s),s.has(t.id)?r.delete(t.id):r.add(t.id)):(r=new Set).add(t.id)}l(r)},n.state={selection:t.selection||{}},n}return i.__extends(SearchResults,e),SearchResults.prototype.render=function(){var e=this.props.items||[];return o.createElement("ul",{className:"ontodia-search-results",ref:this.onRootMount,tabIndex:-1,onFocus:this.addKeyListener,onBlur:this.removeKeyListener},e.map(this.renderResultItem))},SearchResults.prototype.componentDidMount=function(){var e=this;this.listener.listen(this.props.view.model.events,"changeCells",(function(){e.delayedChangeCells.call(e.onChangeCells)}))},SearchResults.prototype.componentWillReceiveProps=function(e){this.setState({selection:e.selection||{}})},SearchResults.prototype.componentWillUnmount=function(){this.removeKeyListener(),this.listener.stopListening(),this.delayedChangeCells.dispose()},SearchResults.prototype.updateSelection=function(e){(0,this.props.onSelectionChanged)(e)},SearchResults.prototype.selectRange=function(e,t){for(var n=this.props.items,r=new Set,i=e;i<=t;i++){var o=n[i];this.canBeSelected(o)&&r.add(o.id)}return r},SearchResults.prototype.getNextIndex=function(e,t){var n=this.props.items;if(0===n.length)return e;for(var i=t===r.Up?-1:1,o=1;o<n.length;o++){var a=e+o*i;if(a<0&&(a+=n.length),a>=n.length&&(a-=n.length),this.canBeSelected(n[a]))return a}return e},SearchResults.prototype.canBeSelected=function(e){var t=this.props.view.model.elements.findIndex((function(t){return t.iri===e.id&&void 0===t.group}))>=0;return!this.props.useDragAndDrop||!t},SearchResults.prototype.focusOn=function(e){var t=this.root.parentElement,n=t.getBoundingClientRect(),r=this.root.children.item(e),i=r.getBoundingClientRect(),o=i.top-n.top,a=i.bottom-n.top;o<0?t.scrollTop+=o:a>n.height&&(t.scrollTop+=a-n.height),r.focus()},SearchResults.defaultProps={useDragAndDrop:!0},SearchResults}(o.Component);t.SearchResults=u},2268:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11);r.__exportStar(n(3154),t),r.__exportStar(n(3155),t),r.__exportStar(n(3167),t),t.DefaultElementTemplateBundle=function(e){}},2269:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(1607);function getPropertyValues(e){return r.isIriProperty(e)||r.isLiteralProperty(e)?e.values.map((function(e){return e.value})):[]}t.getProperty=function getProperty(e,t){return e&&e[t]?getPropertyValues(e[t]).join(", "):void 0},t.getPropertyValues=getPropertyValues},2270:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1692),a=n(1656),s=n(1573),l=n(2271),c=n(1554),u=n(1656),d=function(e){function EmbeddedLayer(t){var n=e.call(this,t)||this;return n.listener=new c.EventObserver,n.nestedElementListener=new c.EventObserver,n.layerOffsetLeft=0,n.layerOffsetTop=0,n.isApplyingParentMove=!1,n.isNestedElementMoving=!1,n.previousPositions=[],n.moveNestedElements=function(e,t){n.isApplyingParentMove=!0;try{for(var r=0,i=n.getNestedElements();r<i.length;r++){var o=i[r],a=o.position,s={x:a.x+e,y:a.y+t};o.setPosition(s)}}finally{n.isApplyingParentMove=!1,n.recomputeSelfBounds()}},n.recomputeSelfBounds=function(){if(!n.isApplyingParentMove){var e=n.context.ontodiaElement.element,t=n.getContentFittingBox(),r=t.x,i=t.y,o=t.width,a=t.height;if(n.isNestedElementMoving){var s={x:r-n.layerOffsetLeft,y:i-n.layerOffsetTop};e.setPosition(s)}n.setState({offsetX:r,offsetY:i,paperWidth:o,paperHeight:a},(function(){return e.redraw()}))}},n.onPaperPointerDown=function(e,t){0===e.button&&t&&t instanceof s.Element&&(e.preventDefault(),n.isNestedElementMoving=!0)},n.onLayerInit=function(e){if(e){var t=n.calculateOffset(e),r=t.left,i=t.top;n.layerOffsetLeft=r,n.layerOffsetTop=i}},n.state={paperWidth:0,paperHeight:0,offsetX:0,offsetY:0},n}return r.__extends(EmbeddedLayer,e),EmbeddedLayer.prototype.componentDidMount=function(){var e=this,t=this.context.ontodiaElement.element,n=this.context.ontodiaPaperArea,r=n.paperArea,i=n.view;this.listener.listen(i.model.events,"changeGroupContent",(function(n){if(n.group===t.id){e.listenNestedElements(e.getNestedElements());var r=e.getOffset(),i=r.offsetX,o=r.offsetY;e.moveNestedElements(i,o)}})),this.listener.listen(t.events,"changePosition",(function(){if(!e.isNestedElementMoving){var t=e.getOffset(),n=t.offsetX,r=t.offsetY,i=e.getContentFittingBox(),o=n-i.x,a=r-i.y;e.moveNestedElements(o,a),e.setState({offsetX:n,offsetY:r})}})),this.listener.listen(r.events,"pointerUp",(function(t){e.isNestedElementMoving=!1}));var o=this.getNestedElements();if(this.listenNestedElements(o),o.length>0){var a=this.getContentFittingBox(),s=a.x,l=a.y,c=a.width,u=a.height;this.setState({offsetX:s,offsetY:l,paperWidth:c,paperHeight:u},(function(){return t.redraw()}))}else t.requestGroupContent()},EmbeddedLayer.prototype.listenNestedElements=function(e){for(var t=new c.EventObserver,n=0,r=e;n<r.length;n++){var i=r[n];t.listen(i.events,"changePosition",this.recomputeSelfBounds),t.listen(i.events,"changeSize",this.recomputeSelfBounds)}this.nestedElementListener.stopListening(),this.nestedElementListener=t},EmbeddedLayer.prototype.componentWillUnmount=function(){this.listener.stopListening(),this.nestedElementListener.stopListening(),this.removeElements(),this.setState({paperWidth:0,paperHeight:0,offsetX:0,offsetY:0})},EmbeddedLayer.prototype.getNestedElements=function(){var e=this.context.ontodiaElement.element;return this.context.ontodiaPaperArea.view.model.elements.filter((function(t){return t.group===e.id}))},EmbeddedLayer.prototype.getContentFittingBox=function(){var e=this.getNestedElements();return u.getContentFittingBox(e,[])},EmbeddedLayer.prototype.removeElements=function(){for(var e=this.context.ontodiaPaperArea.view,t=e.model.history.startBatch(),n=0,r=this.getNestedElements();n<r.length;n++){var i=r[n];e.model.removeElement(i.id)}t.discard()},EmbeddedLayer.prototype.getOffset=function(){var e=this.context.ontodiaElement.element.position,t=e.x,n=e.y;return{offsetX:t+this.layerOffsetLeft,offsetY:n+this.layerOffsetTop}},EmbeddedLayer.prototype.calculateOffset=function(e){var t=this.context.ontodiaPaperArea.paperArea.getScale(),n=function findParentElement(e){var t=e.parentElement;if(t)return t.hasAttribute("data-element-id")?t:findParentElement(t);throw new Error("Cannot find parent diagram element for EmbeddedLayer")}(e),r=e.getBoundingClientRect(),i=r.left,o=r.top,a=n.getBoundingClientRect();return{left:(i-a.left)/t,top:(o-a.top)/t}},EmbeddedLayer.prototype.render=function(){var e=this.context.ontodiaElement.element,t=this.context.ontodiaPaperArea.view,n=this.state,r={width:n.paperWidth,height:n.paperHeight,originX:-n.offsetX,originY:-n.offsetY,scale:1,paddingX:0,paddingY:0};return i.createElement("div",{className:"ontodia-embedded-layer",ref:this.onLayerInit},i.createElement(o.Paper,{view:t,paperTransform:r,onPointerDown:this.onPaperPointerDown,group:e.id}))},EmbeddedLayer.contextTypes=r.__assign(r.__assign({},l.ElementContextTypes),a.PaperAreaContextTypes),EmbeddedLayer}(i.Component);t.EmbeddedLayer=d},2271:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(11),o=n(1),a=n(1591),s=n(1560),l=n(1554),c=n(1964),u=n(2272),d=n(1655),p=n(1634);!function(e){e[e.None=0]="None",e[e.Render=1]="Render",e[e.RecomputeTemplate=3]="RecomputeTemplate",e[e.RecomputeBlurred=5]="RecomputeBlurred"}(r||(r={}));var h=function(e){function ElementLayer(t,n){var i=e.call(this,t,n)||this;i.listener=new l.EventObserver,i.redrawBatch={requests:new Map,forAll:r.None},i.delatedRedraw=new s.Debouncer,i.sizeRequests=new Map,i.delayedUpdateSizes=new s.Debouncer,i.onMount=function(e){i.layer=e},i.requestRedraw=function(e,t){if((i.redrawBatch.forAll|t)!==i.redrawBatch.forAll){var n=i.redrawBatch.requests.get(e.id);i.redrawBatch.requests.set(e.id,n|t),i.delatedRedraw.call(i.redrawElements)}},i.redrawElements=function(){var e=i.props;i.setState((function(t){return{elementStates:applyRedrawRequests(e.view,e.group,i.redrawBatch,t.elementStates)}}))},i.requestSizeUpdate=function(e,t){i.sizeRequests.set(e.id,{element:e,node:t}),i.delayedUpdateSizes.call(i.recomputeQueuedSizes)},i.recomputeQueuedSizes=function(){var e=i.sizeRequests;i.sizeRequests=new Map,e.forEach((function(e){var t=e.element,n=e.node,r=n.clientWidth,i=n.clientHeight;t.setSize({width:r,height:i})}))};var o=i.props,a=o.view,c=o.group;return i.state={elementStates:applyRedrawRequests(a,c,i.redrawBatch,new Map)},i}return i.__extends(ElementLayer,e),ElementLayer.prototype.render=function(){for(var e=this,t=this.props,n=t.view,r=t.style,i=t.scale,a=this.state.elementStates,s=[],l=0,c=n.model.elements;l<c.length;l++){var u=c[l].id,d=a.get(u);d&&s.push(d)}return o.createElement("div",{className:"ontodia-element-layer",ref:this.onMount,style:r},s.map((function(t){var r=o.createElement(f,{key:t.element.id,state:t,view:n,scale:i,onInvalidate:e.requestRedraw,requestResize:e.requestSizeUpdate}),a=n._decorateElement(t.element);return a?o.createElement("div",{key:t.element.id},r,a):r})))},ElementLayer.prototype.componentDidMount=function(){var e=this,t=this.props.view;this.listener.listen(t.model.events,"changeCells",(function(t){t.updateAll?e.requestRedrawAll(r.None):t.changedElement&&e.requestRedraw(t.changedElement,r.None)})),this.listener.listen(t.events,"changeLanguage",(function(){e.requestRedrawAll(r.RecomputeTemplate)})),this.listener.listen(t.events,"changeHighlight",(function(){e.requestRedrawAll(r.RecomputeBlurred)})),this.listener.listen(t.model.events,"elementEvent",(function(t){var n=t.data,i=n.changeData||n.changeExpanded||n.changeElementState;i&&e.requestRedraw(i.source,r.RecomputeTemplate);var o=n.changePosition||n.requestedRedraw;o&&e.requestRedraw(o.source,r.Render)})),this.listener.listen(t.events,"syncUpdate",(function(t){var n=t.layer;n===p.RenderingLayer.Element?e.delatedRedraw.runSynchronously():n===p.RenderingLayer.ElementSize&&e.delayedUpdateSizes.runSynchronously()}))},ElementLayer.prototype.componentWillReceiveProps=function(e){var t=this;this.props.group!==e.group&&this.setState((function(n){return{elementStates:applyRedrawRequests(e.view,e.group,t.redrawBatch,n.elementStates)}}))},ElementLayer.prototype.componentWillUnmount=function(){this.listener.stopListening(),this.delatedRedraw.dispose(),this.delayedUpdateSizes.dispose()},ElementLayer.prototype.requestRedrawAll=function(e){this.redrawBatch.forAll|=e,this.delatedRedraw.call(this.redrawElements)},ElementLayer}(o.Component);function applyRedrawRequests(e,t,n,i){for(var o=new Map,a=0,s=e.model.elements;a<s.length;a++){var l=s[a];if(l.group===t){var c=l.id;if(i.has(c)){var u=i.get(c),d=(n.requests.get(c)||r.None)|n.forAll;d&r.Render&&(u={element:l,templateProps:(d&r.RecomputeTemplate)===r.RecomputeTemplate?computeTemplateProps(u.element,e):u.templateProps,blurred:(d&r.RecomputeBlurred)===r.RecomputeBlurred?computeIsBlurred(u.element,e):u.blurred}),o.set(c,u),n.requests.delete(c)}else o.set(l.id,{element:l,templateProps:computeTemplateProps(l,e),blurred:computeIsBlurred(l,e)})}}return n.forAll=r.None,o}t.ElementLayer=h,t.ElementContextTypes={ontodiaElement:c.PropTypes.anything};var f=function(e){function OverlayedElement(){var t=null!==e&&e.apply(this,arguments)||this;return t.listener=new l.EventObserver,t.disposed=!1,t.rerenderTemplate=function(){t.disposed||t.props.onInvalidate(t.props.state.element,r.RecomputeTemplate)},t.onInitResize=function(e){e.preventDefault(),window.addEventListener("mousemove",t.onResize),window.addEventListener("mouseup",t.onResizeComplete)},t.onResize=function(e){t.props.state.element.setFixedSize(!0);var n=t.htmlElement.firstElementChild,r=n.getBoundingClientRect(),i=(e.clientX-r.left)/t.props.scale,o=(e.clientY-r.top)/t.props.scale,a=i<t.minSize.width?t.minSize.width:i,s=o<t.minSize.height?t.minSize.height:o;t.props.state.element.setSize({width:a,height:s}),n.style.width=a+"px",n.style.height=s+"px"},t.onResizeComplete=function(){window.removeEventListener("mousemove",t.onResize),window.removeEventListener("mouseup",t.onResizeComplete)},t.onResetResize=function(e){if(e.preventDefault(),t.props.state.element.isFixedSize){var n=t.htmlElement.firstElementChild;n.style.width=t.minSize.width+"px",n.style.height=t.minSize.height+"px",t.props.state.element.setFixedSize(!1),t.requestResize()}},t.initSize=function(){var e=t.htmlElement.firstElementChild;t.minSize={height:parseInt(e.style.height.slice(0,-2)),width:parseInt(e.style.width.slice(0,-2))};var n=t.props.state.element;n.isFixedSize&&(e.style.width=n.size.width+"px",e.style.height=n.size.height+"px")},t.onMount=function(e){e&&(t.htmlElement=e)},t.onDoubleClick=function(e){e.preventDefault(),e.stopPropagation();var n=t.props,r=n.view,i=n.state.element;r.model.history.execute(d.setElementExpanded(i,!i.isExpanded))},t.requestResize=function(){var e=t.props.state.element,n=e.isFixedSize;e.temporary||n||t.props.requestResize(t.props.state.element,t.htmlElement)},t}return i.__extends(OverlayedElement,e),OverlayedElement.prototype.getChildContext=function(){return{ontodiaElement:{element:this.props.state.element}}},OverlayedElement.prototype.render=function(){var e=this.props.state,t=e.element,n=e.blurred;if(t.temporary)return o.createElement("div",null);var r=t.position,a=r.x,s=void 0===a?0:a,l=r.y,c="translate("+s+"px,"+(void 0===l?0:l)+"px)",u="ontodia-overlayed-element "+(n?"ontodia-overlayed-element--blurred":"");return o.createElement("div",{className:u,"data-element-id":t.id,style:{position:"absolute",transform:c},tabIndex:0,ref:this.onMount,onDoubleClick:this.onDoubleClick},o.createElement(m,i.__assign({},this.props)),o.createElement("span",{className:"ontodia-overlayed-element__resizable-handle",onMouseDown:this.onInitResize,onDoubleClick:this.onResetResize,title:"double-click on resize handle to reset the card size"}))},OverlayedElement.prototype.componentDidMount=function(){var e=this,t=this.props,n=t.state,r=t.view;this.listener.listen(n.element.events,"requestedFocus",(function(){e.htmlElement&&e.htmlElement.focus()})),this.typesObserver=u.observeElementTypes(r.model,"changeLabel",this.rerenderTemplate),this.propertiesObserver=u.observeProperties(r.model,"changeLabel",this.rerenderTemplate),this.observeTypes(),this.requestResize()},OverlayedElement.prototype.componentWillUnmount=function(){this.listener.stopListening(),this.typesObserver.stopListening(),this.propertiesObserver.stopListening(),this.disposed=!0},OverlayedElement.prototype.shouldComponentUpdate=function(e){return this.props.state!==e.state},OverlayedElement.prototype.componentDidUpdate=function(){this.observeTypes(),this.requestResize(),void 0!==this.minSize||this.props.state.element.temporary||this.initSize()},OverlayedElement.prototype.observeTypes=function(){var e=this.props.state.element;this.typesObserver.observe(e.data.types),this.propertiesObserver.observe(Object.keys(e.data.properties))},OverlayedElement.childContextTypes=t.ElementContextTypes,OverlayedElement}(o.Component),m=function(e){function TemplatedElement(){return null!==e&&e.apply(this,arguments)||this}return i.__extends(TemplatedElement,e),TemplatedElement.prototype.render=function(){var e=this.props,t=e.state,n=e.view,r=t.element,i=t.templateProps,a=n.getElementTemplate(r.data.types);return this.cachedTemplateClass=a,this.cachedTemplateProps=i,o.createElement(a,i)},TemplatedElement.prototype.shouldComponentUpdate=function(e){var t=e.view.getElementTemplate(e.state.element.data.types);return!(this.cachedTemplateClass===t&&this.cachedTemplateProps===e.state.templateProps)},TemplatedElement}(o.Component);function computeTemplateProps(e,t){var n=e.data.types.length>0?t.getElementTypeString(e.data):"Thing",r=t.formatLabel(e.data.label.values,e.iri),i=function computeStyleFor(e,t){var n=t.getTypeStyle(e.data.types),r=n.color,i=r.h,o=r.c,s=r.l;return{icon:n.icon,color:a.hcl(i,o,s).toString()}}(e,t),o=i.color,s=i.icon,l=function computePropertyTable(e,t){if(!e.data.properties)return[];var n=Object.keys(e.data.properties).map((function(n){var r=t.model.createProperty(n);return{id:n,name:t.formatLabel(r.label,n),property:e.data.properties[n]}}));return n.sort((function(e,t){var n=(e.name||e.id).toLowerCase(),r=(t.name||t.id).toLowerCase();return n.localeCompare(r)})),n}(e,t);return{elementId:e.id,data:e.data,iri:e.iri,types:n,label:r,color:o,iconUrl:s,imgUrl:e.data.image,isExpanded:e.isExpanded,props:e.data.properties,propsAsList:l}}function computeIsBlurred(e,t){return t.highlighter&&!t.highlighter(e)}},2272:function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function KeyedObserver(e){this.subscribe=e,this.observedKeys=new Map}return KeyedObserver.prototype.observe=function(e){if(0!==e.length||0!==this.observedKeys.size){for(var t=new Map,n=0,r=e;n<r.length;n++){var i=r[n];if(!t.has(i)){var o=this.observedKeys.get(i);o||(o=this.subscribe(i)),t.set(i,o)}}this.observedKeys.forEach((function(e,n){t.has(n)||e()})),this.observedKeys=t}},KeyedObserver.prototype.stopListening=function(){this.observe([])},KeyedObserver}();t.KeyedObserver=n,t.observeElementTypes=function observeElementTypes(e,t,r){return new n((function(n){var i=e.getClass(n);if(i)return i.events.on(t,r),function(){return i.events.off(t,r)}}))},t.observeProperties=function observeProperties(e,t,r){return new n((function(n){var i=e.getProperty(n);if(i)return i.events.on(t,r),function(){return i.events.off(t,r)}}))},t.observeLinkTypes=function observeLinkTypes(e,t,r){return new n((function(n){var i=e.createLinkType(n);if(i)return i.events.on(t,r),function(){return i.events.off(t,r)}}))}},2273:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(1580);t.LINK_SHOW_IRI={renderLink:function(e){return{properties:[{position:.5,attrs:{text:{text:[{value:e.typeId,language:""}],fill:"gray","font-size":12,"font-weight":"lighter"}}}]}}};var i={markerTarget:{fill:"#f8a485",stroke:"#cf8e76"},renderLink:function(){return{connection:{stroke:"#f8a485","stroke-width":2}}}},o={markerTarget:{fill:"#34c7f3",stroke:"#38b5db"},renderLink:function(){return{connection:{stroke:"#34c7f3","stroke-width":2}}}},a={markerTarget:{fill:"#34c7f3",stroke:"#38b5db"},renderLink:function(){return{connection:{stroke:"#34c7f3","stroke-width":2}}}},s={markerTarget:{fill:"#8cd965",stroke:"#5b9a3b"},renderLink:function(){return{connection:{stroke:"#8cd965","stroke-width":2}}}};t.DefaultLinkTemplateBundle=function(e){return"http://www.w3.org/2000/01/rdf-schema#subClassOf"===e?i:"http://www.w3.org/2000/01/rdf-schema#domain"===e?o:"http://www.w3.org/2000/01/rdf-schema#range"===e?a:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===e?s:e===r.PLACEHOLDER_LINK_TYPE?{markerTarget:{fill:"none"}}:void 0}},2274:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(11),o=n(1),a=n(1),s=n(1560),l=n(1554),c=n(1655),u=n(1573),d=n(1574),p=n(1634);!function(e){e[e.Partial=1]="Partial",e[e.All=2]="All"}(r||(r={}));var h=function(e){function LinkLayer(t,n){var i=e.call(this,t,n)||this;return i.listener=new l.EventObserver,i.delayedUpdate=new s.Debouncer,i.updateState=r.Partial,i.scheduledToUpdate=new Set,i.scheduleUpdateAll=function(){i.updateState!==r.All&&(i.updateState=r.All,i.scheduledToUpdate=new Set),i.delayedUpdate.call(i.performUpdate)},i.performUpdate=function(){i.forceUpdate()},i.getLinks=function(){var e=i.props,t=e.view,n=e.links,r=e.group;if(!r)return n;var o=function computeDeepNestedElements(e,t){var n={};function collectNestedItems(t){n[t]=!0;var r=e.get(t);if(r)for(var i=0,o=r;i<o.length;i++){var a=o[i];a.group===t&&collectNestedItems(a.id)}}return collectNestedItems(t),n}(d.computeGrouping(t.model.elements),r);return n.filter((function(e){var n=e.sourceId,r=e.targetId,i=t.model.getElement(n),a=t.model.getElement(r);if(!i||!a)return!1;var s=i.group,l=a.group;return o[s]||o[l]}))},i}return i.__extends(LinkLayer,e),LinkLayer.prototype.componentDidMount=function(){var e=this,t=this.props.view,scheduleUpdateElementLinks=function(t){for(var n=0,r=t.links;n<r.length;n++){var i=r[n];e.scheduleUpdateLink(i.id)}};this.listener.listen(t.events,"changeLanguage",this.scheduleUpdateAll),this.listener.listen(t.events,"changeHighlight",this.scheduleUpdateAll);var updateChangedRoutes=function(t,n){t.forEach((function(t,r){n.get(r)!==t&&e.scheduleUpdateLink(r)}))};this.listener.listen(t.events,"updateRoutings",(function(e){var n=e.previous,r=t.getRoutings();updateChangedRoutes(r,n),updateChangedRoutes(n,r)})),this.listener.listen(t.model.events,"changeCells",(function(t){if(t.updateAll)e.scheduleUpdateAll();else if(t.changedElement&&scheduleUpdateElementLinks(t.changedElement),t.changedLinks)for(var n=0,r=t.changedLinks;n<r.length;n++){var i=r[n];e.scheduleUpdateLink(i.id)}})),this.listener.listen(t.model.events,"elementEvent",(function(e){var t=e.data,n=t.changePosition||t.changeSize;n&&scheduleUpdateElementLinks(n.source)})),this.listener.listen(t.model.events,"linkEvent",(function(t){var n=t.data,r=n.changeData||n.changeLayoutOnly||n.changeVertices||n.changeLinkState;r&&e.scheduleUpdateLink(r.source.id)})),this.listener.listen(t.model.events,"linkTypeEvent",(function(n){var r=n.data,i=r.changeLabel||r.changeVisibility;if(i)for(var o=i.source.id,a=0,s=t.model.linksOfType(o);a<s.length;a++){var l=s[a];e.scheduleUpdateLink(l.id)}})),this.listener.listen(t.events,"syncUpdate",(function(t){t.layer===p.RenderingLayer.Link&&e.delayedUpdate.runSynchronously()}))},LinkLayer.prototype.shouldComponentUpdate=function(){return!1},LinkLayer.prototype.componentWillUnmount=function(){this.listener.stopListening(),this.delayedUpdate.dispose()},LinkLayer.prototype.scheduleUpdateLink=function(e){this.updateState===r.Partial&&this.scheduledToUpdate.add(e),this.delayedUpdate.call(this.performUpdate)},LinkLayer.prototype.popShouldUpdatePredicate=function(){var e=this.updateState,t=this.scheduledToUpdate;return this.scheduledToUpdate=new Set,this.updateState=r.Partial,e===r.All?function(){return!0}:function(e){return t.has(e.id)}},LinkLayer.prototype.render=function(){var e=this.props.view,t=this.popShouldUpdatePredicate();return o.createElement("g",{className:"ontodia-link-layer"},this.getLinks().map((function(n){return o.createElement(g,{key:n.id,view:e,model:n,shouldUpdate:t(n),route:e.getRouting(n.id)})})))},LinkLayer}(a.Component);t.LinkLayer=h;var f="ontodia-link",m=new Map,g=function(e){function LinkView(t,n){var r=e.call(this,t,n)||this;return r.onRemoveLinkVertex=function(e){r.props.view.model.history.registerToUndo(c.restoreCapturedLinkGeometry(e.link)),e.remove()},r.onBoundsUpdate=function(e){r.props.model.setLabelBounds(e)},r.grabLinkTemplate(r.props),r}return i.__extends(LinkView,e),LinkView.prototype.componentWillReceiveProps=function(e){this.linkType.id!==e.model.typeId&&this.grabLinkTemplate(e)},LinkView.prototype.shouldComponentUpdate=function(e,t){return e.shouldUpdate},LinkView.prototype.grabLinkTemplate=function(e){this.linkType=e.view.model.getLinkType(e.model.typeId),this.template=e.view.createLinkTemplate(this.linkType)},LinkView.prototype.render=function(){var e=this.props,t=e.view,n=e.model,r=e.route,a=t.model.getElement(n.sourceId),s=t.model.getElement(n.targetId);if(!a||!s)return null;var l=n.vertices||[],c=r?r.vertices:l,p=d.computePolyline(a,s,c),h="M"+p.map((function(e){return e.x+","+e.y})).join(" L"),m=this.linkType,g=m.index,v=m.showLabel,y=this.template.renderLink(n),k=function getPathAttributes(e,t){var n=t.connection||{},r=e.layoutOnly?"5,5":void 0,i=n.fill,o=void 0===i?"none":i,a=n.stroke,s=void 0===a?"black":a,l=n["stroke-width"],c=n["stroke-dasharray"];return{fill:o,stroke:s,strokeWidth:l,strokeDasharray:void 0===c?r:c}}(n,y),E=t.highlighter&&!t.highlighter(n),b=f+" "+(E?f+"--blurred":"");return o.createElement("g",{className:b,"data-link-id":n.id,"data-source-id":a.id,"data-target-id":s.id},o.createElement("path",i.__assign({className:f+"__connection",d:h},k,{markerStart:"url(#"+u.linkMarkerKey(g,!0)+")",markerEnd:"url(#"+u.linkMarkerKey(g,!1)+")"})),o.createElement("path",{className:f+"__wrap",d:h}),v?this.renderLabels(p,y):void 0,this.renderVertices(l,k.stroke))},LinkView.prototype.renderVertices=function(e,t){for(var n=[],r=0,i=0,a=e;i<a.length;i++){var s=a[i],l=s.x,c=s.y;n.push(o.createElement("circle",{key:2*r,"data-vertex":r,className:"ontodia-link__vertex",cx:l,cy:c,r:10,fill:t})),n.push(o.createElement(y,{key:2*r+1,className:f+"__vertex-tools",model:this.props.model,vertexIndex:r,vertexRadius:10,x:l,y:c,onRemove:this.onRemoveLinkVertex})),r++}return o.createElement("g",{className:f+"__vertices"},n)},LinkView.prototype.renderLabels=function(e,t){var n=this,r=this.props,i=r.view,a=r.model,s=r.route,l=function computeLinkLabels(e,t,n){var r,i=[],o=t.label||{},a=o.attrs&&o.attrs.text?o.attrs.text.text:void 0,s=o.title;if(a&&a.length>0)r=n.selectLabel(a);else{var l=n.model.getLinkType(e.typeId);r=n.selectLabel(l.label)||{value:n.formatLabel(l.label,l.id),language:""},void 0===s&&(s=r.value+" "+n.formatIri(e.typeId))}if(i.push({offset:o.position||.5,text:r,title:s,attributes:{text:getLabelTextAttributes(o),rect:getLabelRectAttributes(o)}}),t.properties)for(var c=0,u=t.properties;c<u.length;c++){var d=u[c];d.attrs&&d.attrs.text&&d.attrs.text.text&&i.push({offset:d.position||.5,text:n.selectLabel(d.attrs.text.text),title:d.title,attributes:{text:getLabelTextAttributes(d),rect:getLabelRectAttributes(d)}})}return i}(a,t,i),c="middle";s&&s.labelTextAnchor&&(c=s.labelTextAnchor);var u=d.computePolylineLength(e);return m.clear(),o.createElement("g",{className:f+"__labels"},l.map((function(t,r){var i=d.getPointAlongPolyline(e,u*t.offset),a=i.x,s=i.y,l=Math.round(100*t.offset)/100,p=m.get(l)||0;return m.set(l,p+1),o.createElement(v,{key:r,x:a,y:s,line:p,label:t,textAnchor:c,onBoundsUpdate:0===r?n.onBoundsUpdate:void 0})})))},LinkView}(a.Component);function getLabelTextAttributes(e){var t=e.attrs?e.attrs.text:{},n=t.fill,r=void 0===n?"black":n,i=t.stroke,o=void 0===i?"none":i,a=t["stroke-width"],s=void 0===a?0:a,l=t["font-family"],c=void 0===l?'"Helvetica Neue", "Helvetica", "Arial", sans-serif':l,u=t["font-size"],d=void 0===u?"inherit":u,p=t["font-weight"];return{fill:r,stroke:o,strokeWidth:s,fontFamily:c,fontSize:d,fontWeight:void 0===p?"bold":p}}function getLabelRectAttributes(e){var t=e.attrs&&e.attrs.rect?e.attrs.rect:{},n=t.fill,r=void 0===n?"white":n,i=t.stroke,o=void 0===i?"none":i,a=t["stroke-width"];return{fill:r,stroke:o,strokeWidth:void 0===a?0:a}}var v=function(e){function LinkLabel(t){var n=e.call(this,t)||this;return n.shouldUpdateBounds=!0,n.onTextMount=function(e){n.text=e},n.state={width:0,height:0},n}return i.__extends(LinkLabel,e),LinkLabel.prototype.render=function(){var e=this.props,t=e.x,n=e.y,r=e.label,i=e.line,a=e.textAnchor,s=this.state,l=s.width,c=s.height,u=this.getLabelRectangle(l,c),d=u.x,p=u.y,h=0===i?void 0:"translate(0, "+i*(c+2)+"px)";return o.createElement("g",{style:h?{transform:h}:void 0},r.title?o.createElement("title",null,r.title):void 0,o.createElement("rect",{x:d,y:p,width:l,height:c,style:r.attributes.rect}),o.createElement("text",{ref:this.onTextMount,x:t,y:n,dy:"0.6ex",textAnchor:a,style:r.attributes.text},r.text.value))},LinkLabel.prototype.getLabelRectangle=function(e,t){var n=this.props,r=n.x,i=n.y,o=n.textAnchor,a=0;return"middle"===o?a=-e/2:"end"===o&&(a=-e),{x:r+a,y:i-t/2,width:e,height:t}},LinkLabel.prototype.componentDidMount=function(){this.recomputeBounds(this.props)},LinkLabel.prototype.componentWillUnmount=function(){(0,this.props.onBoundsUpdate)(void 0)},LinkLabel.prototype.componentWillReceiveProps=function(e){this.shouldUpdateBounds=!0},LinkLabel.prototype.componentDidUpdate=function(e){this.recomputeBounds(this.props)},LinkLabel.prototype.recomputeBounds=function(e){if(this.shouldUpdateBounds){var t=this.props.onBoundsUpdate;this.shouldUpdateBounds=!1;var n=this.text.getBBox();if(t)t(this.getLabelRectangle(n.width,n.height));this.setState({width:n.width,height:n.height})}},LinkLabel}(a.Component),y=function(e){function VertexTools(){var t=null!==e&&e.apply(this,arguments)||this;return t.onRemoveVertex=function(e){if(0===e.button){e.preventDefault(),e.stopPropagation();var n=t.props,r=n.onRemove,i=n.model,o=n.vertexIndex;r(new u.LinkVertex(i,o))}},t}return i.__extends(VertexTools,e),VertexTools.prototype.render=function(){var e=this.props,t=e.className,n=(e.vertexIndex,e.vertexRadius),r="translate("+(e.x+2*n)+","+(e.y-2*n)+")scale("+n+")";return o.createElement("g",{className:t,transform:r,onMouseDown:this.onRemoveVertex},o.createElement("title",null,"Remove vertex"),o.createElement("circle",{r:1}),o.createElement("path",{d:"M-0.5,-0.5 L0.5,0.5 M0.5,-0.5 L-0.5,0.5",strokeWidth:2/n}))},VertexTools}(a.Component),k=function(e){function LinkMarkers(){var t=null!==e&&e.apply(this,arguments)||this;return t.listener=new l.EventObserver,t.delayedUpdate=new s.Debouncer,t}return i.__extends(LinkMarkers,e),LinkMarkers.prototype.render=function(){var e=this.props.view,t=[];return e.getLinkTemplates().forEach((function(n,r){var i=e.model.getLinkType(r);if(i){var a=i.index;n.markerSource&&t.push(o.createElement(E,{key:2*a,linkTypeIndex:a,style:n.markerSource,isStartMarker:!0})),n.markerTarget&&t.push(o.createElement(E,{key:2*a+1,linkTypeIndex:a,style:n.markerTarget,isStartMarker:!1}))}})),o.createElement("defs",null,t)},LinkMarkers.prototype.componentDidMount=function(){var e=this,t=this.props.view;this.listener.listen(t.events,"syncUpdate",(function(t){t.layer===p.RenderingLayer.Link&&e.delayedUpdate.runSynchronously()})),this.listener.listen(t.events,"changeLinkTemplates",(function(){e.delayedUpdate.call((function(){return e.forceUpdate()}))}))},LinkMarkers.prototype.shouldComponentUpdate=function(){return!1},LinkMarkers.prototype.componentWillUnmount=function(){this.listener.stopListening(),this.delayedUpdate.dispose()},LinkMarkers}(a.Component);t.LinkMarkers=k;var E=function(e){function LinkMarker(){var t=null!==e&&e.apply(this,arguments)||this;return t.onMarkerMount=function(e){if(e){var n=t.props,r=n.linkTypeIndex,i=n.isStartMarker,o=n.style;e.setAttribute("id",u.linkMarkerKey(r,i)),e.setAttribute("markerWidth",o.width.toString()),e.setAttribute("markerHeight",o.height.toString()),e.setAttribute("orient","auto");var a=i?0:o.width-1;e.setAttribute("refX",a.toString()),e.setAttribute("refY",(o.height/2).toString()),e.setAttribute("markerUnits","userSpaceOnUse");var s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",o.d),void 0!==o.fill&&s.setAttribute("fill",o.fill),void 0!==o.stroke&&s.setAttribute("stroke",o.stroke),void 0!==o.strokeWidth&&s.setAttribute("stroke-width",o.strokeWidth),e.appendChild(s)}},t}return i.__extends(LinkMarker,e),LinkMarker.prototype.render=function(){return o.createElement("marker",{ref:this.onMarkerMount})},LinkMarker.prototype.shouldComponentUpdate=function(){return!1},LinkMarker}(a.Component)},2275:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(16),o=n(1574);function exportSVG(e){return r.__awaiter(this,void 0,Promise,(function(){var t,n,a,s,l,c,u,d,p,h,f,m=this;return r.__generator(this,(function(g){switch(g.label){case 0:return t=e.contentBox,n=function clonePaperSvg(e,t){var n=e.model,r=e.paper,a=e.getOverlayedElement,s=r.cloneNode(!0);s.removeAttribute("class"),s.removeAttribute("style");var l=function findViewport(){for(var e=s.firstChild;e;){if(e instanceof SVGGElement)return e;e=e.nextSibling}}();l.removeAttribute("transform"),l.setAttribute("class","rs-application");for(var c={},_loop_2=function(e){var n=e.id,r=a(n);if(!r)return"continue";var s=document.createElementNS("http://www.w3.org/2000/svg","g"),u=r.firstChild.cloneNode(!0);s.setAttribute("class","ontodia-exported-element");var d=void 0;(d=document.createElementNS("http://www.w3.org/2000/svg","foreignObject")).appendChild(u);var p=o.boundsOf(e),h=p.x,f=p.y,m=p.width,g=p.height;d.setAttribute("transform","translate("+h+","+f+")"),d.setAttribute("width",(m+t).toString()),d.setAttribute("height",(g+t).toString()),s.appendChild(d),l.appendChild(s);var v=u.querySelectorAll("img");foreachNode(r.querySelectorAll("img"),(function(e,t){var n=i.uniqueId("export-key-");v[t].setAttribute("export-key",n),c[n]={width:e.clientWidth,height:e.clientHeight}}))},u=0,d=n.elements;u<d.length;u++){var p=d[u];_loop_2(p)}return{svgClone:s,imageBounds:c}}(e,2),a=n.svgClone,s=n.imageBounds,l=t.width+200,c=t.height+200,e.preserveDimensions?(a.setAttribute("width",l.toString()),a.setAttribute("height",c.toString())):(a.setAttribute("width","100%"),a.setAttribute("height","100%")),u={x:t.x-100,y:t.y-100,width:l,height:c},a.setAttribute("viewBox",u.x+" "+u.y+" "+u.width+" "+u.height),d=[],foreachNode(a.querySelectorAll("img"),(function(e){return d.push(e)})),[4,Promise.all(d.map((function(e){return r.__awaiter(m,void 0,void 0,(function(){var t,n,i,o,a,l;return r.__generator(this,(function(r){switch(r.label){case 0:if(t=e.getAttribute("export-key"),e.removeAttribute("export-key"),!t)return[3,5];n=s[t],i=n.width,o=n.height,e.setAttribute("width",i.toString()),e.setAttribute("height",o.toString()),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,exportImageAsDataUri(e)];case 2:return(a=r.sent())&&"data:image/svg+xml,"!==a&&(e.src=a),[3,4];case 3:return l=r.sent(),console.warn("Failed to export image: "+e.src,l),[3,4];case 4:return[3,6];case 5:return[2,Promise.resolve()];case 6:return[2]}}))}))})))];case 1:return g.sent(),p=document.createElementNS("http://www.w3.org/2000/svg","defs"),h=document.createElement("style"),f=h,[4,extractStylesheets()];case 2:return f.textContent=g.sent(),p.appendChild(h),a.insertBefore(p,a.firstChild),e.elementsToRemoveSelector&&foreachNode(a.querySelectorAll(e.elementsToRemoveSelector),(function(e){return e.remove()})),[2,a]}}))}))}function extractStylesheets(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n;return r.__generator(this,(function(i){switch(i.label){case 0:e=[],t=function(t){var n,i,o,a,s,l,c,u;return r.__generator(this,(function(r){switch(r.label){case 0:return n=document.styleSheets[t],i=n.ownerNode,o=void 0,a=void 0,i instanceof HTMLLinkElement?(s=i.href,l=new Request(s),a=l.url,[4,fetch(l).then((function(e){if(!e.ok)throw new Error("Ontodia was not able to fetch stylesheet: "+s);return e.text()}))]):[3,2];case 1:return o=r.sent(),[3,3];case 2:if(!(i instanceof HTMLStyleElement))throw new Error("Current HTML document contains css stylesheet with @import rule, that is currently not supported by ontodia. See ontodia sources toSvg.ts#extractStylesheets");o=i.innerHTML,a=document.baseURI,r.label=3;case 3:return u=(c=e).push,[4,embedExternalResources(a,o)];case 4:return u.apply(c,[r.sent()]),[2]}}))},n=0,i.label=1;case 1:return n<document.styleSheets.length?[5,t(n)]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return[2,""+e.join("\n")]}}))}))}function embedExternalResources(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,o,a,s,l;return r.__generator(this,(function(r){switch(r.label){case 0:for(n=/url\((.*?)\)/gm,o=[];null!==(a=n.exec(t));)a.index===n.lastIndex&&n.lastIndex++,s=a[1],i.includes(s,"data:")||o.push(s);return[4,Promise.all(o.map((function(t){var n=t;return(t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'"))&&(n=t.slice(1,-1)),exportAsDataUri(new URL(n,e).href)})))];case 1:return l=r.sent(),[2,o.reduce((function(e,t,n){return e.replace(t,'"'+l[n]+'"')}),t)]}}))}))}function exportImageAsDataUri(e){var t=e.src;return!t||t.startsWith("data:")?Promise.resolve(t):exportAsDataUri(t)}function exportAsDataUri(e){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return[4,fetch(e)];case 1:return[4,n.sent().blob()];case 2:return t=n.sent(),[2,new Promise((function(e){var n=new FileReader;n.onload=function(){e(n.result)},n.readAsDataURL(t)}))]}}))}))}function foreachNode(e,t){for(var n=0;n<e.length;n++)t(e[n],n)}t.toSVG=function toSVG(e){return r.__awaiter(this,void 0,Promise,(function(){var t;return r.__generator(this,(function(n){switch(n.label){case 0:return[4,exportSVG(e)];case 1:return t=n.sent(),[2,(new XMLSerializer).serializeToString(t)]}}))}))};function loadImage(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=function(e){n(e)},r.src=e}))}function fitRectKeepingAspectRatio(e,t,n,r){if("number"!=typeof n&&"number"!=typeof r)return{width:e,height:t};var i=e/t;return n="number"==typeof n?n:r*i,(r="number"==typeof r?r:n/i)*i<=n?{width:r*i,height:r}:{width:n,height:n/i}}t.toDataURL=function toDataURL(e){return r.__awaiter(this,void 0,Promise,(function(){var t,n,i,o,a,s,l,c,u,d,p,h,f,m;return r.__generator(this,(function(g){switch(g.label){case 0:return t=e.mimeType,n=void 0===t?"image/png":t,[4,exportSVG(r.__assign(r.__assign({},e),{convertImagesToDataUris:!0,preserveDimensions:!0}))];case 1:return i=g.sent(),o={width:Number(i.getAttribute("width")),height:Number(i.getAttribute("height"))},a="number"==typeof e.width||"number"==typeof e.height?{width:e.width,height:e.height}:function fallbackContainerSize(e){var t=Math.min(4096/e.width,4096/e.height),n=Math.min(2,t),r=Math.floor(e.width*n),i=Math.floor(e.height*n);return{width:r,height:i}}(o),s=function computeAutofit(e,t){var n=fitRectKeepingAspectRatio(e.width,e.height,t.width,t.height),r={width:Math.floor(n.width),height:Math.floor(n.height)},i={width:"number"==typeof t.width?t.width:r.width,height:"number"==typeof t.height?t.height:r.height},o={x:Math.round((i.width-r.width)/2),y:Math.round((i.height-r.height)/2)};return{innerSize:r,outerSize:i,offset:o}}(o,a),l=s.innerSize,c=s.outerSize,u=s.offset,i.setAttribute("width",l.width.toString()),i.setAttribute("height",l.height.toString()),d=(new XMLSerializer).serializeToString(i),p=function createCanvas(e,t,n){var r=document.createElement("canvas");r.width=e,r.height=t;var i=r.getContext("2d");return n&&(i.fillStyle=n,i.fillRect(0,0,e,t)),{canvas:r,context:i}}(c.width,c.height,e.backgroundColor),h=p.canvas,f=p.context,[4,loadImage("data:image/svg+xml,"+encodeURIComponent(d))];case 2:return m=g.sent(),f.drawImage(m,u.x,u.y,l.width,l.height),[2,h.toDataURL(n,e.quality)]}}))}))},t.loadImage=loadImage,t.fitRectKeepingAspectRatio=fitRectKeepingAspectRatio,t.dataURLToBlob=function dataURLToBlob(e){if(-1===e.indexOf(";base64,")){var t=(r=e.split(","))[0].split(":")[1],n=decodeURIComponent(r[1]);return new Blob([n],{type:t})}t=(r=e.split(";base64,"))[0].split(":")[1];for(var r,i=(n=window.atob(r[1])).length,o=new Uint8Array(i),a=0;a<i;++a)o[a]=n.charCodeAt(a);return new Blob([o],{type:t})}},2276:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1656),a=n(1560),s=n(1657),l=n(1635),c=function(e){function AuthoredEntity(t,n){var r=e.call(this,t,n)||this;return r.queryCancellation=new a.Cancellation,r.onChangeAuthoringState=function(e){var t=e.source,n=e.previous,i=r.props.templateProps.data.id;t.authoringState.elements.get(i)!==n.elements.get(i)&&r.queryAllowedActions()},r.onEdit=function(){var e=r.context.ontodiaWorkspace.editor,t=r.props.templateProps.elementId,n=e.model.getElement(t);e.showEditEntityForm(n)},r.onDelete=function(){var e=r.context.ontodiaWorkspace.editor,t=r.props.templateProps.data;e.deleteEntity(t.id)},r.state={},r}return r.__extends(AuthoredEntity,e),AuthoredEntity.prototype.componentDidMount=function(){this.context.ontodiaWorkspace.editor.events.on("changeAuthoringState",this.onChangeAuthoringState),this.queryAllowedActions()},AuthoredEntity.prototype.componentDidUpdate=function(e){this.props.templateProps.data!==e.templateProps.data&&this.queryAllowedActions()},AuthoredEntity.prototype.componentWillUnmount=function(){this.context.ontodiaWorkspace.editor.events.off("changeAuthoringState",this.onChangeAuthoringState),this.queryCancellation.abort()},AuthoredEntity.prototype.queryAllowedActions=function(){var e=this.props.templateProps.data;this.queryCancellation.abort(),this.queryCancellation=new a.Cancellation;var t=this.context.ontodiaWorkspace.editor;!t.metadataApi||l.AuthoringState.isDeletedElement(t.authoringState,e.id)?this.setState({canEdit:!1,canDelete:!1}):(this.queryCanEdit(e),this.queryCanDelete(e))},AuthoredEntity.prototype.queryCanEdit=function(e){var t=this,n=this.context.ontodiaWorkspace.editor,r=this.queryCancellation.signal;this.setState({canEdit:void 0}),a.CancellationToken.mapCancelledToNull(r,n.metadataApi.canEditElement(e,r)).then((function(e){null!==e&&t.setState({canEdit:e})}))},AuthoredEntity.prototype.queryCanDelete=function(e){var t=this,n=this.context.ontodiaWorkspace.editor,r=this.queryCancellation.signal;this.setState({canDelete:void 0}),a.CancellationToken.mapCancelledToNull(r,n.metadataApi.canDeleteElement(e,r)).then((function(e){null!==e&&t.setState({canDelete:e})}))},AuthoredEntity.prototype.render=function(){var e=this.props.children,t=this.context.ontodiaPaperArea.view,n=this.context.ontodiaWorkspace.editor,r=this.state,i=r.canEdit,o=r.canDelete,a=this.props.templateProps.iri,s=n.authoringState.elements.get(a);return e({editor:n,view:t,canEdit:i,canDelete:o,editedIri:s&&s.type===l.AuthoringKind.ChangeElement?s.newIri:void 0,onEdit:this.onEdit,onDelete:this.onDelete})},AuthoredEntity.contextTypes=r.__assign(r.__assign({},o.PaperAreaContextTypes),s.WorkspaceContextTypes),AuthoredEntity}(i.Component);t.AuthoredEntity=c},2317:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11);t.RDFSettings={linkConfigurations:[],openWorldLinks:!1,propertyConfigurations:[],openWorldProperties:!1,linksInfoQuery:"SELECT ?source ?type ?target\n            WHERE {\n                ${linkConfigurations}\n                VALUES (?source) {${ids}}\n                VALUES (?target) {${ids}}\n            }",defaultPrefix:"",schemaLabelProperty:"rdfs:label",dataLabelProperty:"rdfs:label",fullTextSearch:{prefix:"",queryPattern:""},classTreeQuery:"",classInfoQuery:'SELECT ?class ?label ?instcount WHERE {\n    VALUES(?class) {${ids}}\n    OPTIONAL { ?class ${schemaLabelProperty} ?label }\n    BIND("" as ?instcount)\n}',linkTypesQuery:"SELECT DISTINCT ?link ?instcount ?label WHERE {\n    ${linkTypesPattern}\n    OPTIONAL { ?link ${schemaLabelProperty} ?label }\n}",linkTypesPattern:"",linkTypesInfoQuery:"SELECT ?link ?label WHERE {\n    VALUES(?link) {${ids}}\n    OPTIONAL { ?link ${schemaLabelProperty} ?label }\n}",propertyInfoQuery:"SELECT ?property ?label WHERE {\n    VALUES(?property) {${ids}}\n    OPTIONAL { ?property ${schemaLabelProperty} ?label }\n}",elementInfoQuery:"",imageQueryPattern:"",linkTypesOfQuery:"",linkTypesStatisticsQuery:"",filterRefElementLinkPattern:"",filterTypePattern:"",filterAdditionalRestriction:"",filterElementInfoPattern:""};t.WikidataSettings=r.__assign(r.__assign({},t.RDFSettings),{defaultPrefix:"PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\n PREFIX wdt: <http://www.wikidata.org/prop/direct/>\n PREFIX wd: <http://www.wikidata.org/entity/>\n PREFIX owl:  <http://www.w3.org/2002/07/owl#>\n\n",schemaLabelProperty:"rdfs:label",dataLabelProperty:"rdfs:label",fullTextSearch:{prefix:"PREFIX bds: <http://www.bigdata.com/rdf/search#>\n",queryPattern:"\n              ?inst rdfs:label ?searchLabel.\n              SERVICE bds:search {\n                     ?searchLabel bds:search \"${text}*\" ;\n                                  bds:minRelevance '0.5' ;\n                                  bds:matchAllTerms 'true' .\n              }\n              BIND(IF(STRLEN(?strInst) > 33,\n                            0-<http://www.w3.org/2001/XMLSchema#integer>(SUBSTR(?strInst, 33)),\n                            -10000) as ?score)\n            "},classTreeQuery:"\n            SELECT distinct ?class ?label ?parent WHERE {\n              ?class rdfs:label ?label.\n              { ?class wdt:P279 wd:Q35120. }\n                UNION\n              { ?parent wdt:P279 wd:Q35120.\n                ?class wdt:P279 ?parent. }\n                UNION\n              { ?parent wdt:P279/wdt:P279 wd:Q35120.\n                ?class wdt:P279 ?parent. }\n            }\n        ",linkTypesPattern:"?link wdt:P279* wd:Q18616576.\n    BIND(0 as ?instcount)\n",elementInfoQuery:"\n        CONSTRUCT {\n            ?inst <https://ontodia.org/context/v1.json/type> ?class .\n            ?inst <https://ontodia.org/context/v1.json/label> ?label .\n            ?inst ?propType ?propValue.\n        } WHERE {\n            VALUES (?inst) {${ids}}\n            OPTIONAL {\n                ?inst wdt:P31 ?class\n            }\n            OPTIONAL {?inst rdfs:label ?label}\n            OPTIONAL {\n                ${propertyConfigurations}\n                FILTER (isLiteral(?propValue))\n            }\n        }\n    ",imageQueryPattern:' { ?inst ?linkType ?fullImage } union { ?inst wdt:P163/wdt:P18 ?fullImage }\n                BIND(CONCAT("https://commons.wikimedia.org/w/thumb.php?f=",\n                    STRAFTER(STR(?fullImage), "Special:FilePath/"), "&w=200") AS ?image)',linkTypesOfQuery:"\n        SELECT DISTINCT ?link\n        WHERE {\n            ${linkConfigurations}\n            ?claim <http://wikiba.se/ontology#directClaim> ?link .\n        }\n    ",linkTypesStatisticsQuery:"\n        SELECT (${linkId} as ?link) (COUNT(?outObject) AS ?outCount) (COUNT(?inObject) AS ?inCount)\n        WHERE {\n            {\n                {\n                    SELECT DISTINCT ?outObject WHERE {\n                        ${linkConfigurationOut}\n                        FILTER(ISIRI(?outObject))\n                        ?outObject ?someprop ?someobj.\n                    }\n                    LIMIT 101\n                }\n            } UNION {\n                {\n                    SELECT DISTINCT ?inObject WHERE {\n                        ${linkConfigurationIn}\n                        FILTER(ISIRI(?inObject))\n                        ?inObject ?someprop ?someobj.\n                    }\n                    LIMIT 101\n                }\n            }\n        }\n    ",filterRefElementLinkPattern:"?claim <http://wikiba.se/ontology#directClaim> ?link .",filterTypePattern:"?inst wdt:P31 ?instType. ?instType wdt:P279* ?class",filterAdditionalRestriction:"FILTER ISIRI(?inst)\n                        BIND(STR(?inst) as ?strInst)\n                        FILTER exists {?inst ?someprop ?someobj}\n",filterElementInfoPattern:"OPTIONAL {?inst wdt:P31 ?foundClass}\n                BIND (coalesce(?foundClass, owl:Thing) as ?class)\n                OPTIONAL {?inst rdfs:label ?label}\n"}),t.OWLRDFSSettingsOverride={defaultPrefix:"PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\n PREFIX owl:  <http://www.w3.org/2002/07/owl#>\n",schemaLabelProperty:"rdfs:label",dataLabelProperty:"rdfs:label",fullTextSearch:{prefix:"",queryPattern:' OPTIONAL {?inst ${dataLabelProperty} ?search1}\n        FILTER regex(COALESCE(str(?search1), str(?extractedLabel)), "${text}", "i")\n        BIND(0 as ?score)\n',extractLabel:!0},classTreeQuery:"\n            SELECT ?class ?label ?parent\n            WHERE {\n                {\n                    ?class a rdfs:Class\n                } UNION {\n                    ?class a owl:Class\n                }\n                FILTER ISIRI(?class)\n                OPTIONAL {?class rdfs:label ?label}\n                OPTIONAL {?class rdfs:subClassOf ?parent. FILTER ISIRI(?parent)}\n            }\n        ",linkTypesPattern:"{\t?link a rdf:Property\n                    } UNION {\n                    ?link a owl:ObjectProperty\n                }\n                BIND('' as ?instcount)\n    ",elementInfoQuery:"\n        CONSTRUCT {\n            ?inst <https://ontodia.org/context/v1.json/type> ?class .\n            ?inst <https://ontodia.org/context/v1.json/label> ?label .\n            ?inst ?propType ?propValue.\n        } WHERE {\n            VALUES (?inst) {${ids}}\n            OPTIONAL { ?inst a ?class }\n            OPTIONAL {?inst ${dataLabelProperty} ?label}\n            OPTIONAL {\n                ${propertyConfigurations}\n                FILTER (isLiteral(?propValue))\n            }\n        }\n    ",imageQueryPattern:"{ ?inst ?linkType ?image } UNION { [] ?linkType ?inst. BIND(?inst as ?image) }",linkTypesOfQuery:"\n        SELECT DISTINCT ?link\n        WHERE {\n            ${linkConfigurations}\n        }\n    ",linkTypesStatisticsQuery:"\n        SELECT ?link ?outCount ?inCount\n        WHERE {\n            {\n                SELECT (${linkId} as ?link) (count(?outObject) as ?outCount) WHERE {\n                    ${linkConfigurationOut}\n                    ${navigateElementFilterOut}\n                } LIMIT 101\n            } {\n                SELECT (${linkId} as ?link) (count(?inObject) as ?inCount) WHERE {\n                    ${linkConfigurationIn}\n                    ${navigateElementFilterIn}\n                } LIMIT 101\n            }\n        }\n    ",filterRefElementLinkPattern:"",filterTypePattern:"?inst a ?instType. ?instType rdfs:subClassOf* ?class",filterElementInfoPattern:"OPTIONAL {?inst rdf:type ?foundClass}\n                BIND (coalesce(?foundClass, owl:Thing) as ?class)\n                OPTIONAL {?inst ${dataLabelProperty} ?label}",filterAdditionalRestriction:""},t.OWLRDFSSettings=r.__assign(r.__assign({},t.RDFSettings),t.OWLRDFSSettingsOverride);t.OWLStatsSettings=r.__assign(r.__assign({},t.OWLRDFSSettings),{classTreeQuery:"\n        SELECT ?class ?instcount ?label ?parent\n        WHERE {\n            {SELECT ?class (count(?inst) as ?instcount)\n                WHERE {\n                    ?inst rdf:type ?class.\n                    FILTER ISIRI(?class)\n                } GROUP BY ?class } UNION\n            {\n                ?class rdf:type rdfs:Class\n            } UNION {\n                ?class rdf:type owl:Class\n            }\n            OPTIONAL {?class rdfs:label ?label}\n            OPTIONAL {?class rdfs:subClassOf ?parent. FILTER ISIRI(?parent)}\n        }\n    "});t.DBPediaSettings=r.__assign(r.__assign({},t.OWLRDFSSettings),{fullTextSearch:{prefix:"PREFIX dbo: <http://dbpedia.org/ontology/>\n",queryPattern:'\n              ?inst rdfs:label ?searchLabel.\n              ?searchLabel bif:contains "${text}".\n              ?inst dbo:wikiPageID ?origScore .\n              BIND(0-?origScore as ?score)\n        '},classTreeQuery:"\n        SELECT distinct ?class ?label ?parent WHERE {\n            ?class rdfs:label ?label.\n            OPTIONAL {?class rdfs:subClassOf ?parent}\n            ?root rdfs:subClassOf owl:Thing.\n            ?class rdfs:subClassOf? | rdfs:subClassOf/rdfs:subClassOf ?root\n        }\n    ",elementInfoQuery:"\n        CONSTRUCT {\n            ?inst <https://ontodia.org/context/v1.json/type> ?class .\n            ?inst <https://ontodia.org/context/v1.json/label> ?label .\n            ?inst ?propType ?propValue.\n        } WHERE {\n            VALUES (?inst) {${ids}}\n            ?inst a ?class .\n            ?inst rdfs:label ?label .\n            FILTER (!contains(str(?class), 'http://dbpedia.org/class/yago'))\n            OPTIONAL {\n                ${propertyConfigurations}\n                FILTER (isLiteral(?propValue))\n            }\n        }\n    ",filterTypePattern:"?inst a ?instType. ?instType rdfs:subClassOf* ?class",filterElementInfoPattern:"\n        OPTIONAL {?inst rdf:type ?foundClass. FILTER (!contains(str(?foundClass), 'http://dbpedia.org/class/yago'))}\n        BIND (coalesce(?foundClass, owl:Thing) as ?class)\n        OPTIONAL {?inst ${dataLabelProperty} ?label}",imageQueryPattern:' { ?inst ?linkType ?fullImage } UNION { [] ?linkType ?inst. BIND(?inst as ?fullImage) }\n            BIND(CONCAT("https://commons.wikimedia.org/w/thumb.php?f=",\n            STRAFTER(STR(?fullImage), "Special:FilePath/"), "&w=200") AS ?image)\n    '})},2318:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(332);function n3toRdfNode(e){return r.Util.isLiteral(e)?{type:"literal",value:r.Util.getLiteralValue(e),datatype:r.Util.getLiteralType(e),"xml:lang":r.Util.getLiteralLanguage(e)}:{type:"uri",value:e}}t.parseTurtleText=function parseTurtleText(e){return new Promise((function(t,n){var i=[];r.Parser().parse(e,(function(e,r,o){e?n(e):r?i.push({subject:n3toRdfNode(r.subject),predicate:n3toRdfNode(r.predicate),object:n3toRdfNode(r.object)}):t(i)}))}))},t.n3toRdfNode=n3toRdfNode},2319:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(16),i=n(1580),o=n(1980),a=n(1748),s=n(2318),l=function(){function GraphBuilder(e){this.dataProvider=e}return GraphBuilder.prototype.createGraph=function(e){return this.dataProvider.elementInfo({elementIds:e.elementIds}).then((function(t){return{preloadedElements:t,diagram:makeLayout(e.elementIds,e.links)}}))},GraphBuilder.prototype.getGraphFromRDFGraph=function(e){var t=makeGraphItems(e),n=t.elementIds,r=t.links;return this.createGraph({elementIds:n,links:r})},GraphBuilder.prototype.getGraphFromTurtleGraph=function(e){var t=this;return s.parseTurtleText(e).then((function(e){return t.getGraphFromRDFGraph(e)}))},GraphBuilder}();function makeGraphItems(e){for(var t={},n=[],r=0,i=e;r<i.length;r++){var o=i[r],a=o.subject,s=o.predicate,l=o.object;"uri"!==a.type||t[a.value]||(t[a.value]=!0),"uri"!==l.type||t[l.value]||(t[l.value]=!0),"uri"===a.type&&"uri"===l.type&&n.push({linkTypeId:s.value,sourceId:a.value,targetId:l.value})}return{elementIds:Object.keys(t),links:n}}function makeLayout(e,t){var n=Math.ceil(Math.sqrt(e.length)),s=a.uniformGrid({rows:n,cellSize:{x:150,y:150}}),l=e.map((function(e,t){var n=s(t),r=n.x,o=n.y;return{"@type":"Element","@id":i.GenerateID.forElement(),iri:e,position:{x:r,y:o}}})),c=r.keyBy(l,"iri"),u=[];return t.forEach((function(e,t){var n=c[e.sourceId],r=c[e.targetId];n&&r&&u.push({"@type":"Link","@id":i.GenerateID.forLink(),property:e.linkTypeId,source:{"@id":n["@id"]},target:{"@id":r["@id"]}})})),o.makeSerializedDiagram({layoutData:{"@type":"Layout",elements:l,links:u},linkTypeOptions:[]})}t.GraphBuilder=l,t.makeGraphItems=makeGraphItems,t.makeLayout=makeLayout},2326:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1580),o=n(1554),a=n(1573),s=n(3277),l=n(1693),c=function(){function DiagramModel(e){this.history=e,this.source=new o.EventSource,this.events=this.source,this.graph=new s.Graph,this.graphListener=new o.EventObserver}return Object.defineProperty(DiagramModel.prototype,"elements",{get:function(){return this.graph.getElements()},enumerable:!0,configurable:!0}),Object.defineProperty(DiagramModel.prototype,"links",{get:function(){return this.graph.getLinks()},enumerable:!0,configurable:!0}),DiagramModel.prototype.getElement=function(e){return this.graph.getElement(e)},DiagramModel.prototype.getLinkById=function(e){return this.graph.getLink(e)},DiagramModel.prototype.linksOfType=function(e){return this.graph.getLinks().filter((function(t){return t.typeId===e}))},DiagramModel.prototype.findLink=function(e,t,n){return this.graph.findLink(e,t,n)},DiagramModel.prototype.sourceOf=function(e){return this.getElement(e.sourceId)},DiagramModel.prototype.targetOf=function(e){return this.getElement(e.targetId)},DiagramModel.prototype.isSourceAndTargetVisible=function(e){return Boolean(this.sourceOf(e)&&this.targetOf(e))},DiagramModel.prototype.resetGraph=function(){this.graphListener&&(this.graphListener.stopListening(),this.graphListener=new o.EventObserver),this.graph=new s.Graph},DiagramModel.prototype.subscribeGraph=function(){var e=this;this.graphListener.listen(this.graph.events,"changeCells",(function(t){e.source.trigger("changeCells",t)})),this.graphListener.listen(this.graph.events,"elementEvent",(function(t){e.source.trigger("elementEvent",t)})),this.graphListener.listen(this.graph.events,"linkEvent",(function(t){e.source.trigger("linkEvent",t)})),this.graphListener.listen(this.graph.events,"linkTypeEvent",(function(t){e.source.trigger("linkTypeEvent",t)})),this.graphListener.listen(this.graph.events,"classEvent",(function(t){e.source.trigger("classEvent",t)})),this.source.trigger("changeCells",{updateAll:!0})},DiagramModel.prototype.reorderElements=function(e){this.graph.reorderElements(e)},DiagramModel.prototype.createElement=function(e,t){var n="string"==typeof e?e:e.id,o=this.elements.filter((function(e){return e.iri===n&&e.group===t}));if(o.length>0)return o[0];var s="string"==typeof e?placeholderDataFromIri(n):e;s=r.__assign(r.__assign({},s),{id:s.id});var l=new a.Element({id:i.GenerateID.forElement(),data:s,group:t});return this.addElement(l),l},DiagramModel.prototype.addElement=function(e){this.history.execute(addElement(this.graph,e,[]))},DiagramModel.prototype.removeElement=function(e){var t=this.getElement(e);t&&this.history.execute(removeElement(this.graph,t))},DiagramModel.prototype.addLink=function(e){var t=e.typeId,n=e.sourceId,r=e.targetId,i=e.data;if(i&&i.linkTypeId!==t)throw new Error("linkTypeId must match linkType.id");var o=this.findLink(t,n,r);if(o)return e.data&&(o.setLayoutOnly(!1),o.setData(i)),o;var a=this.createLinkType(e.typeId),s=this.getElement(n),l=this.getElement(r);return a.visible&&s&&l?(e.data||e.setData({linkTypeId:t,sourceId:s.iri,targetId:l.iri}),this.graph.addLink(e),e):void 0},DiagramModel.prototype.removeLink=function(e){this.graph.removeLink(e)},DiagramModel.prototype.getClass=function(e){return this.graph.getClass(e)},DiagramModel.prototype.createClass=function(e){var t=this.graph.getClass(e);if(t)return t;var n=new a.FatClassModel({id:e});return this.addClass(n),n},DiagramModel.prototype.addClass=function(e){this.graph.addClass(e)},DiagramModel.prototype.getLinkType=function(e){return this.graph.getLinkType(e)},DiagramModel.prototype.createLinkType=function(e){var t=this.graph.getLinkType(e);if(t)return t;var n=new a.FatLinkType({id:e});return this.graph.addLinkType(n),n},DiagramModel.prototype.getProperty=function(e){return this.graph.getProperty(e)},DiagramModel.prototype.createProperty=function(e){var t=this.graph.getProperty(e);if(t)return t;var n=new a.RichProperty({id:e});return this.graph.addProperty(n),n},DiagramModel.prototype.triggerChangeGroupContent=function(e){this.source.trigger("changeGroupContent",{group:e})},DiagramModel.prototype.createTemporaryElement=function(){var e=new a.Element({id:i.GenerateID.forElement(),data:placeholderDataFromIri(""),temporary:!0});return this.graph.addElement(e),e},DiagramModel}();function placeholderDataFromIri(e){return{id:e,types:[],label:{values:[]},properties:{}}}function addElement(e,t,n){return l.Command.create("Add element",(function(){e.addElement(t);for(var r=0,i=n;r<i.length;r++){var o=i[r];e.getLink(o.id)||e.findLink(o.typeId,o.sourceId,o.targetId)||e.addLink(o)}return removeElement(e,t)}))}function removeElement(e,t){return l.Command.create("Remove element",(function(){var n=r.__spreadArrays(t.links);return e.removeElement(t.id),addElement(e,t,n)}))}t.DiagramModel=c,t.placeholderDataFromIri=placeholderDataFromIri},2327:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(11),o=n(1),a=n(1607),s=n(1655),l=n(1573),c=n(1574),u=n(1693),d=n(1634),p=n(1554),h=n(3279),f=n(2328),m=n(3280),g=n(3281),v=n(3285),y=n(3286),k=n(3287),E=n(3288),b=n(3289),L=n(3290),S=n(1748),w=n(1585),_=n(1984),T=n(1635),C=n(3291),P=n(2331),x=n(1560),I=n(1623);!function(e){e[e.ConnectionsMenu=0]="ConnectionsMenu",e[e.EditEntityForm=1]="EditEntityForm",e[e.EditLinkForm=2]="EditLinkForm",e[e.EditEntityTypeForm=3]="EditEntityTypeForm",e[e.EditLinkLabelForm=4]="EditLinkLabelForm"}(r=t.DialogTypes||(t.DialogTypes={}));var D=function(){function EditorController(e){var t=this;this.listener=new p.EventObserver,this.source=new p.EventSource,this.events=this.source,this._authoringState=T.AuthoringState.empty,this._validationState=P.ValidationState.empty,this._temporaryState=T.TemporaryState.empty,this._selection=[],this.cancellation=new x.Cancellation,this.onKeyUp=function(e){46===e.keyCode&&"input"!==document.activeElement.localName&&t.removeSelectedElements()};var n=e.model,r=e.view,a=i.__rest(e,["model","view"]);this.model=n,this.view=r,this.options=a,this.listener.listen(this.events,"changeValidationState",(function(e){for(var n=0,r=t.model.elements;n<r.length;n++){var i=r[n],o=e.previous.elements.get(i.iri);t.validationState.elements.get(i.iri)!==o&&i.redraw()}})),this.listener.listen(this.events,"changeAuthoringState",(function(e){if(t.options.validationApi){var n=P.changedElementsToValidate(e.previous,t);P.validateElements(n,t.options.validationApi,t,t.cancellation.signal)}})),this.view._setElementDecorator((function(e){return o.createElement(L.ElementDecorator,{model:e,view:t.view,editor:t,position:e.position})}))}return EditorController.prototype._initializePaperComponents=function(e){var t=this;this.listener.listen(e.events,"pointerUp",(function(e){return t.onPaperPointerUp(e)})),this.listener.listen(this.model.events,"changeCells",(function(){return t.onCellsChanged()})),this.listener.listen(this.model.events,"elementEvent",(function(e){"requestedGroupContent"===e.key&&t.loadGroupContent(e.data.requestedGroupContent.source)})),this.listener.listen(this.model.events,"loadingStart",(function(){return t.setSpinner({})})),this.listener.listen(this.model.events,"loadingSuccess",(function(){t.setSpinner(void 0);var e=o.createElement(b.LinkStateWidget,{view:t.view,editor:t});t.view.setPaperWidget({key:"states",widget:e,attachment:d.WidgetAttachment.OverLinks})})),this.listener.listen(this.model.events,"loadingError",(function(e){var n=e.error,r=n?n.message:void 0;t.setSpinner({statusText:r,errorOccured:!0})})),this.options.disableHalo||(this.configureHalo(),document.addEventListener("keyup",this.onKeyUp),this.listener.listen(this.view.events,"dispose",(function(){document.removeEventListener("keyup",t.onKeyUp)})))},Object.defineProperty(EditorController.prototype,"inAuthoringMode",{get:function(){return Boolean(this._metadataApi)},enumerable:!0,configurable:!0}),Object.defineProperty(EditorController.prototype,"metadataApi",{get:function(){return this._metadataApi},enumerable:!0,configurable:!0}),EditorController.prototype.setMetadataApi=function(e){var t=this._metadataApi;e!==t&&(this._metadataApi=e,Boolean(e)!==Boolean(t)&&this.source.trigger("changeMode",{source:this}))},Object.defineProperty(EditorController.prototype,"authoringState",{get:function(){return this._authoringState},enumerable:!0,configurable:!0}),EditorController.prototype.setAuthoringState=function(e){this._authoringState!==e&&this.model.history.execute(this.updateAuthoringState(e))},EditorController.prototype.updateAuthoringState=function(e){var t=this,n=this._authoringState;return u.Command.create("Create or delete entities and links",(function(){return t._authoringState=e,t.source.trigger("changeAuthoringState",{source:t,previous:n}),t.updateAuthoringState(n)}))},Object.defineProperty(EditorController.prototype,"validationState",{get:function(){return this._validationState},enumerable:!0,configurable:!0}),EditorController.prototype.setValidationState=function(e){var t=this._validationState;e!==t&&(this._validationState=e,this.source.trigger("changeValidationState",{source:this,previous:t}))},Object.defineProperty(EditorController.prototype,"temporaryState",{get:function(){return this._temporaryState},enumerable:!0,configurable:!0}),EditorController.prototype.setTemporaryState=function(e){var t=this._temporaryState;e!==t&&(this._temporaryState=e,this.source.trigger("changeTemporaryState",{source:this,previous:t}))},Object.defineProperty(EditorController.prototype,"selection",{get:function(){return this._selection},enumerable:!0,configurable:!0}),EditorController.prototype.setSelection=function(e){var t=this._selection;t!==e&&(this._selection=e,this.source.trigger("changeSelection",{source:this,previous:t}))},EditorController.prototype.cancelSelection=function(){this.setSelection([])},EditorController.prototype.removeSelectedElements=function(){var e=this.selection;0!==e.length&&(this.cancelSelection(),this.removeItems(e))},EditorController.prototype.removeItems=function(e){for(var t=this.model.history.startBatch(),n=new Set,r=0,i=e;r<i.length;r++){var o=i[r];if(o instanceof l.Element){var a=this.authoringState.elements.get(o.iri);a&&this.discardChange(a),this.model.removeElement(o.id),n.add(o.iri)}else o instanceof l.Link&&T.AuthoringState.isNewLink(this.authoringState,o.data)&&this.deleteLink(o.data)}if(n.size>0){var s=T.AuthoringState.deleteNewLinksConnectedToElements(this.authoringState,n);this.setAuthoringState(s)}t.store()},EditorController.prototype.onPaperPointerUp=function(e){if(!this.options.disableHalo){var t=e.sourceEvent,n=e.target,i=e.triggerAsClick;t.ctrlKey||t.shiftKey||t.metaKey||this.dialogTarget&&this.dialogType===r.EditEntityForm||(n instanceof l.Element?(this.setSelection([n]),n.focus()):n instanceof l.Link?this.setSelection([n]):n instanceof l.LinkVertex?this.setSelection([n.link]):!n&&i&&(this.setSelection([]),this.hideDialog(),document.activeElement&&document.activeElement.blur()))}},EditorController.prototype.onCellsChanged=function(){var e=this;if(0!==this.selection.length){var t=this.selection.filter((function(t){return t instanceof l.Element?e.model.getElement(t.id):t instanceof l.Link&&e.model.getLinkById(t.id)}));t.length<this.selection.length&&this.setSelection(t)}},EditorController.prototype.setSpinner=function(e){var t=e?o.createElement(A,{spinnerProps:e}):void 0;this.view.setPaperWidget({key:A.Key,widget:t,attachment:d.WidgetAttachment.Viewport})},EditorController.prototype.configureHalo=function(){var e=this;this.options.disableHalo||(this.listener.listen(this.events,"changeSelection",(function(){var t=1===e.selection.length?e.selection[0]:void 0;e.dialogTarget&&t!==e.dialogTarget&&e.hideDialog(),e.bringSelectedElementsToFront(),e.renderDefaultHalo()})),this.listener.listen(this.events,"toggleDialog",(function(t){t.isOpened;e.renderDefaultHalo()})),this.renderDefaultHalo())},EditorController.prototype.bringSelectedElementsToFront=function(){0!==this.selection.length&&this.model.reorderElements(I.makeMoveComparator(this.model.elements,this.selection.filter((function(e){return e instanceof l.Element})),I.MoveDirection.ToEnd))},EditorController.prototype.renderDefaultHalo=function(){var e,t=this,n=1===this.selection.length?this.selection[0]:void 0;n instanceof l.Element?e=o.createElement(k.Halo,{editor:this,metadataApi:this.metadataApi,target:n,onRemove:function(){return t.removeSelectedElements()},onExpand:function(){t.model.history.execute(s.setElementExpanded(n,!n.isExpanded))},navigationMenuOpened:this.dialogType===r.ConnectionsMenu,onToggleNavigationMenu:function(){t.dialogTarget&&t.dialogType===r.ConnectionsMenu?t.hideDialog():t.showConnectionsMenu(n),t.renderDefaultHalo()},onAddToFilter:function(){return n.addToFilter()},onEstablishNewLink:function(e){return t.startEditing({target:n,mode:C.EditLayerMode.establishLink,point:e})},onFollowLink:function(e,n){return t.view.onIriClick(e.iri,e,d.IriClickIntent.JumpToEntity,n)}}):n instanceof l.Link&&(e=o.createElement(E.HaloLink,{view:this.view,editor:this,metadataApi:this.metadataApi,target:n,onEdit:function(){return t.showEditLinkForm(n)},onDelete:function(){return t.deleteLink(n.data)},onSourceMove:function(e){return t.startEditing({target:n,mode:C.EditLayerMode.moveLinkSource,point:e})},onTargetMove:function(e){return t.startEditing({target:n,mode:C.EditLayerMode.moveLinkTarget,point:e})},onEditLabel:function(){return t.showEditLinkLabelForm(n)}})),this.view.setPaperWidget({key:"halo",widget:e,attachment:d.WidgetAttachment.OverElements})},EditorController.prototype.showConnectionsMenu=function(e){var t=this,n=r.ConnectionsMenu,onClose=function(){return t.hideDialog()},i=o.createElement(f.ConnectionsMenu,{view:this.view,editor:this,target:e,onAddElements:function(n,r){return t.onAddElementsInConnectionMenu(n,e,r)},onClose,suggestProperties:this.options.suggestProperties});this.showDialog({target:e,dialogType:n,content:i,onClose})},EditorController.prototype.showEditEntityForm=function(e){var t,n=this,a=this.options.propertyEditor,s=r.EditEntityForm,onSubmit=function(t){n.hideDialog(),n.changeEntityData(e.data.id,t)};if(T.AuthoringState.isElementWithModifiedIri(this.authoringState,e.data.id)){var l=this.authoringState.elements.get(e.data.id);t=i.__assign(i.__assign({},e.data),{id:l.newIri})}else t=e.data;var onCancel=function(){return n.hideDialog()},c=a?a({elementData:e.data,onSubmit,onCancel}):o.createElement(m.EditEntityForm,{view:this.view,entity:t,onApply:onSubmit,onCancel});this.showDialog({target:e,dialogType:s,content:c,onClose:onCancel})},EditorController.prototype.showEditElementTypeForm=function(e){var t=this,n=e.link,a=e.source,s=e.target,c=e.targetIsNew,u=r.EditEntityTypeForm,onCancel=function(){t.removeTemporaryElement(s),t.removeTemporaryLink(n),t.hideDialog()},d=o.createElement(g.EditElementTypeForm,{editor:this,view:this.view,metadataApi:this.metadataApi,link:n.data,source:a.data,target:{value:s.data,isNew:c},onChangeElement:function(e){var n=s.data;t.setTemporaryState(T.TemporaryState.deleteElement(t.temporaryState,n)),s.setData(e),t.setTemporaryState(T.TemporaryState.addElement(t.temporaryState,e))},onChangeLink:function(e){t.removeTemporaryLink(n);var r=makeLinkWithDirection(new l.Link({typeId:e.linkTypeId,sourceId:a.id,targetId:s.id,data:i.__assign(i.__assign({},e),{sourceId:a.iri,targetId:s.iri})}),e);n=t.createNewLink({link:r,temporary:!0})},onApply:function(e,r,o){t.removeTemporaryElement(s),t.removeTemporaryLink(n);var c=t.model.history.startBatch(r?"Create new entity":"Link to entity");t.model.addElement(s),r?(s.setExpanded(!0),t.setAuthoringState(T.AuthoringState.addElement(t._authoringState,s.data))):t.model.requestLinksOfType();var u=makeLinkWithDirection(new l.Link({typeId:n.typeId,sourceId:a.id,targetId:s.id,data:i.__assign(i.__assign({},n.data),{sourceId:a.iri,targetId:s.iri})}),o);t.createNewLink({link:u}),c.store(),t.hideDialog(),r&&t.showEditEntityForm(s)},onCancel});this.showDialog({target:s,dialogType:u,content:d,caption:"Establish New Connection",onClose:onCancel})},EditorController.prototype.showEditLinkForm=function(e){var t=this,n=r.EditLinkForm,i=this.model.getElement(e.sourceId).data,a=this.model.getElement(e.targetId).data,onCancel=function(){t.temporaryState.links.has(e.data)&&t.removeTemporaryLink(e),t.hideDialog()},s=o.createElement(v.EditLinkForm,{editor:this,view:this.view,metadataApi:this.metadataApi,link:e.data,source:i,target:a,onChange:function(n){if(t.temporaryState.links.has(e.data)){t.removeTemporaryLink(e);var r=makeLinkWithDirection(e,n);t.showEditLinkForm(t.createNewLink({link:r,temporary:!0}))}},onApply:function(n){if(t.temporaryState.links.has(e.data)){t.removeTemporaryLink(e);var r=makeLinkWithDirection(e,n);t.createNewLink({link:r})}else t.changeLink(e.data,n);t.hideDialog()},onCancel}),l=this.temporaryState.links.has(e.data)?"Establish New Connection":"Edit Connection";this.showDialog({target:e,dialogType:n,content:s,size:{width:300,height:160},caption:l,onClose:onCancel})},EditorController.prototype.showEditLinkLabelForm=function(e){var t=this,n=this.view.model.getLinkType(e.typeId),i=this.view.createLinkTemplate(n),a={width:300,height:145},onCancel=function(){return t.hideDialog()};this.showDialog({target:e,dialogType:r.EditLinkLabelForm,content:o.createElement(y.EditLinkLabelForm,{view:this.view,link:e,onApply:function(n){i.setLinkLabel(e,n),t.hideDialog()},onCancel}),size:a,caption:"Edit Link Label",offset:{x:25,y:-a.height/2},calculatePosition:function(){var t=e.labelBounds,n=t.x,r=t.y;return{x:n+t.width,y:r+t.height/2}},onClose:onCancel})},EditorController.prototype.showDialog=function(e){var t=e.target,n=e.dialogType,r=e.content,i=e.size,a=e.caption,s=e.offset,l=e.calculatePosition,c=e.onClose;this.dialogTarget=t,this.dialogType=n;var u=o.createElement(h.Dialog,{view:this.view,target:t,size:i,caption:a,offset:s,calculatePosition:l,onClose:c},r);this.view.setPaperWidget({key:"dialog",widget:u,attachment:d.WidgetAttachment.OverElements}),this.source.trigger("toggleDialog",{isOpened:!0})},EditorController.prototype.hideDialog=function(){if(this.dialogTarget){var e=this.dialogTarget instanceof l.Element&&this.temporaryState.elements.has(this.dialogTarget.iri),t=this.dialogTarget instanceof l.Link&&this.temporaryState.links.has(this.dialogTarget.data);(e||t)&&this.resetTemporaryState(),this.dialogType=void 0,this.dialogTarget=void 0,this.view.setPaperWidget({key:"dialog",widget:void 0,attachment:d.WidgetAttachment.OverElements}),this.source.trigger("toggleDialog",{isOpened:!1})}},EditorController.prototype.onDragDrop=function(e,t){var n=this.model.history.startBatch("Drag and drop onto diagram"),r=function placeElements(e,t,n){for(var r=t.map((function(t){return e.model.createElement(t)})),i=0,o=r;i<o.length;i++){(p=o[i]).setPosition(n)}e.performSyncUpdate();for(var a=n.x,s=n.y,l=!0,u=0,d=r;u<d.length;u++){var p=d[u],h=c.boundsOf(p),f=h.width,m=h.height;0===f&&(f=100),0===m&&(m=50),l&&(l=!1,a-=f/2,s-=m/2),p.setPosition({x:a,y:s}),s+=m+20}return r}(this.view,e,t),i=r.map((function(e){return e.iri}));n.history.execute(_.requestElementData(this.model,i)),n.history.execute(_.restoreLinksBetweenElements(this.model)),n.store(),r.length>0&&r[r.length-1].focus(),this.setSelection(r),this.source.trigger("addElements",{elements:r})},EditorController.prototype.onAddElementsInConnectionMenu=function(e,t,n){var r=this,i=this.view.model.history.startBatch(),o=e.map((function(e){return r.model.createElement(e)}));this.view.performSyncUpdate(),S.placeElementsAround({model:this.model,elements:o,targetElement:t,prefferedLinksLength:300}).then((function(){r.source.trigger("addElements",{elements:o})})),n&&!n.visible&&i.history.execute(s.changeLinkTypeVisibility({linkType:n,visible:!0,showLabel:!0,preventLoading:!0})),i.history.execute(_.requestElementData(this.model,e)),i.history.execute(_.restoreLinksBetweenElements(this.model)),i.store()},EditorController.prototype.loadGroupContent=function(e){var t=this;return this.model.loadEmbeddedElements(e.iri).then((function(n){var r=t.model.history.startBatch(),i=Object.keys(n);i.map((function(r){return t.model.createElement(n[r],e.id)}));return r.discard(),Promise.all([t.model.requestElementData(i),t.model.requestLinksOfType()]).then((function(){t.view.performSyncUpdate(),S.applyLayout(t.model,S.forceLayout({model:t.model,group:e.id})),t.model.triggerChangeGroupContent(e.id)}))}))},EditorController.prototype.createNewEntity=function(e){var t=e.elementModel,n=e.temporary,r=this.model.history.startBatch("Create new entity"),i=new Set(this.model.elements),o=this.model.createElement(t);return o.setPosition({x:Math.random(),y:Math.random()}),o.setExpanded(!0),n?(this.setTemporaryState(T.TemporaryState.addElement(this.temporaryState,o.data)),r.discard()):(this.setAuthoringState(T.AuthoringState.addElement(this._authoringState,o.data)),r.store()),this.view.performSyncUpdate(),S.applyLayout(this.model,S.removeOverlaps({model:this.model,fixedElements:i,padding:{x:15,y:15}})),o},EditorController.prototype.changeEntityData=function(e,t){var n=this.model.elements.filter((function(t){return t.iri===e}));if(0!==n.length){var r=n[0].data,i=this.model.history.startBatch("Edit entity"),o=T.AuthoringState.changeElement(this._authoringState,r,t),a=o.elements.get(e)||o.elements.get(t.id);this.model.history.execute(s.setElementData(this.model,e,a.after)),this.setAuthoringState(o),i.store()}},EditorController.prototype.deleteEntity=function(e){var t=this,n=this.authoringState,r=this.model.elements.filter((function(t){return t.iri===e}));if(0!==r.length){for(var i=this.model.history.startBatch("Delete entity"),o=r[0].data,a=n.elements.get(e),s=new Set,l=0,c=r;l<c.length;l++)for(var u=0,d=c[l].links;u<d.length;u++){var p=d[u];p.data&&T.AuthoringState.isNewLink(n,p.data)&&s.add(p.id)}s.forEach((function(e){return t.model.removeLink(e)})),a&&this.discardChange(a),this.setAuthoringState(T.AuthoringState.deleteElement(n,o)),i.store()}},EditorController.prototype.createNewLink=function(e){var t=e.link,n=e.temporary;if(this.model.findLink(t.typeId,t.sourceId,t.targetId))throw Error("The link already exists");var r=this.model.history.startBatch("Create new link"),i=this.model.addLink(t);return n||this.model.createLinks(t.data),this.model.links.filter((function(e){return a.sameLink(e.data,t.data)})).length>0?n?(this.setTemporaryState(T.TemporaryState.addLink(this.temporaryState,t.data)),r.discard()):(this.setAuthoringState(T.AuthoringState.addLink(this._authoringState,t.data)),r.store()):r.discard(),i},EditorController.prototype.changeLink=function(e,t){var n=this,r=this.model.history.startBatch("Change link");if(a.sameLink(e,t))this.model.history.execute(s.setLinkData(this.model,e,t)),this.setAuthoringState(T.AuthoringState.changeLink(this._authoringState,e,t));else{var i=this._authoringState;i=T.AuthoringState.deleteLink(i,e),i=T.AuthoringState.addLink(i,t),T.AuthoringState.isNewLink(this._authoringState,e)&&this.model.links.filter((function(t){return a.sameLink(t.data,e)})).forEach((function(e){return n.model.removeLink(e.id)})),this.model.createLinks(t),this.setAuthoringState(i)}r.store()},EditorController.prototype.moveLinkSource=function(e){var t=e.link,n=e.newSource,r=this.model.history.startBatch("Move link to another element");this.changeLink(t.data,i.__assign(i.__assign({},t.data),{sourceId:n.iri}));var o=this.model.findLink(t.typeId,n.id,t.targetId);return o.setVertices(t.vertices),r.store(),o},EditorController.prototype.moveLinkTarget=function(e){var t=e.link,n=e.newTarget,r=this.model.history.startBatch("Move link to another element");this.changeLink(t.data,i.__assign(i.__assign({},t.data),{targetId:n.iri}));var o=this.model.findLink(t.typeId,t.sourceId,n.id);return o.setVertices(t.vertices),r.store(),o},EditorController.prototype.deleteLink=function(e){var t=this,n=this.authoringState;if(!T.AuthoringState.isDeletedLink(n,e)){var r=this.model.history.startBatch("Delete link"),i=T.AuthoringState.deleteLink(n,e);T.AuthoringState.isNewLink(n,e)&&this.model.links.filter((function(t){var n=t.data;return a.sameLink(n,e)})).forEach((function(e){return t.model.removeLink(e.id)})),this.setAuthoringState(i),r.store()}},EditorController.prototype.startEditing=function(e){var t=this,n=e.target,r=e.mode,i=e.point,a=o.createElement(C.EditLayer,{view:this.view,editor:this,metadataApi:this.metadataApi,mode:r,target:n,point:i,onFinishEditing:function(){t.view.setPaperWidget({key:"editLayer",widget:void 0,attachment:d.WidgetAttachment.OverElements})}});this.view.setPaperWidget({key:"editLayer",widget:a,attachment:d.WidgetAttachment.OverElements})},EditorController.prototype.resetTemporaryState=function(){var e=this;this.temporaryState.elements.size&&this.model.elements.forEach((function(t){e.temporaryState.elements.has(t.iri)&&e.removeTemporaryElement(t)})),this.temporaryState.links.size&&this.model.links.forEach((function(t){e.temporaryState.links.get(t.data)&&e.removeTemporaryLink(t)}))},EditorController.prototype.removeTemporaryElement=function(e){var t=this.model.history.startBatch();this.model.removeElement(e.id),t.discard(),this.setTemporaryState(T.TemporaryState.deleteElement(this.temporaryState,e.data))},EditorController.prototype.removeTemporaryLink=function(e){this.model.removeLink(e.id),this.setTemporaryState(T.TemporaryState.deleteLink(this.temporaryState,e.data))},EditorController.prototype.discardChange=function(e){var t=this,n=T.AuthoringState.discard(this._authoringState,e);if(n!==this._authoringState){var r=this.model.history.startBatch("Discard change");e.type===T.AuthoringKind.ChangeElement?e.deleted||(e.before?this.model.history.execute(s.setElementData(this.model,e.after.id,e.before)):this.model.elements.filter((function(t){return t.iri===e.after.id})).forEach((function(e){return t.model.removeElement(e.id)}))):e.type===T.AuthoringKind.ChangeLink&&(e.deleted||(e.before?this.model.history.execute(s.setLinkData(this.model,e.after,e.before)):this.model.links.filter((function(t){var n=t.data;return a.sameLink(n,e.after)})).forEach((function(e){return t.model.removeLink(e.id)})))),this.setAuthoringState(n),r.store()}},EditorController}();t.EditorController=D;var A=function(e){function LoadingWidget(){return null!==e&&e.apply(this,arguments)||this}return i.__extends(LoadingWidget,e),LoadingWidget.prototype.render=function(){var e=this.props,t=e.spinnerProps,n=e.paperArea.getAreaMetrics(),r=n.clientWidth,a=n.clientHeight,s={x:t.statusText?r/3:r/2,y:a/2};return o.createElement("div",{className:"ontodia-loading-widget"},o.createElement("svg",{width:r,height:a},o.createElement(w.Spinner,i.__assign({position:s},t))))},LoadingWidget.Key="loadingWidget",LoadingWidget}(o.Component);function makeLinkWithDirection(e,t){if(t.sourceId!==e.data.sourceId&&t.sourceId!==e.data.targetId)throw new Error("New link source IRI is unrelated to original link");if(t.targetId!==e.data.sourceId&&t.targetId!==e.data.targetId)throw new Error("New link target IRI is unrelated to original link");var n=t.sourceId===e.data.sourceId?e.sourceId:e.targetId,r=t.targetId===e.data.targetId?e.targetId:e.sourceId;return new l.Link({typeId:t.linkTypeId,sourceId:n,targetId:r,data:t})}},2328:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1573),a=n(1554),s=n(1697),l=n(1698),c=n(1986),u=n(1657),d=new o.FatLinkType({id:"allRelatedElements",label:[{value:"All",language:""}]}),p=function(e){function ConnectionsMenu(){var t=null!==e&&e.apply(this,arguments)||this;return t.handler=new a.EventObserver,t.linkTypesListener=new a.EventObserver,t.loadingState=s.ProgressState.none,t.updateAll=function(){return t.forceUpdate()},t.addSelectedElements=function(e){var n=t.props,r=n.onClose,i=n.onAddElements,o=e.map((function(e){return e.model.id})),a=t.linkDataChunk?t.linkDataChunk.link:void 0;i(o,t.linkDataChunk&&a!==d?a:void 0),r()},t.onExpandLink=function(e){t.objects&&t.linkDataChunk&&t.linkDataChunk.link===e.link&&t.linkDataChunk.direction===e.direction||t.loadObjects(e),t.updateAll(),t.context.ontodiaWorkspace.triggerWorkspaceEvent(u.WorkspaceEventKey.connectionsExpandLink)},t.onMoveToFilter=function(e){var n=t.props,r=n.view,i=n.target,o=e.link,a=e.direction;o===d?i.addToFilter():r.model.getElement(i.id).addToFilter(o,a)},t}return r.__extends(ConnectionsMenu,e),ConnectionsMenu.prototype.componentDidMount=function(){var e=this.props.view;this.handler.listen(e.events,"changeLanguage",this.updateAll),this.loadLinks()},ConnectionsMenu.prototype.componentWillUnmount=function(){this.handler.stopListening(),this.linkTypesListener.stopListening()},ConnectionsMenu.prototype.resubscribeOnLinkTypeEvents=function(e){this.linkTypesListener.stopListening();for(var t=0,n=e;t<n.length;t++){var r=n[t];this.linkTypesListener.listen(r.events,"changeLabel",this.updateAll),this.linkTypesListener.listen(r.events,"changeVisibility",this.updateAll)}},ConnectionsMenu.prototype.loadLinks=function(){var e=this,t=this.props,n=t.view,r=t.editor,i=t.target;this.loadingState=s.ProgressState.loading,this.links=[],this.countMap={},r.model.dataProvider.linkTypesOf({elementId:i.iri}).then((function(t){e.loadingState=s.ProgressState.completed;for(var r={},i=[],o=0,a=t;o<a.length;o++){var l=a[o],c=l.id,p=l.inCount,h=l.outCount;r[c]={inCount:p,outCount:h},i.push(n.model.createLinkType(c))}r[d.id]=Object.keys(r).map((function(e){return r[e]})).reduce((function(e,t){return{inCount:e.inCount+t.inCount,outCount:e.outCount+t.outCount}}),{inCount:0,outCount:0}),e.countMap=r,e.links=i,e.resubscribeOnLinkTypeEvents(e.links),e.updateAll(),e.context.ontodiaWorkspace.triggerWorkspaceEvent(u.WorkspaceEventKey.connectionsLoadLinks)})).catch((function(t){console.error(t),e.loadingState=s.ProgressState.error,e.updateAll()})),this.updateAll()},ConnectionsMenu.prototype.loadObjects=function(e){var t=this,n=this.props,r=n.view,i=n.editor,o=n.target,a=e.link,l=e.direction,c=e.offset||0;this.loadingState=s.ProgressState.loading,this.linkDataChunk=e,this.objects=[],i.model.dataProvider.linkElements({elementId:o.iri,linkId:a===d?void 0:a.id,limit:c+100,offset:c,direction:l}).then((function(e){t.loadingState=s.ProgressState.completed,t.objects=Object.keys(e).map((function(t){return{model:e[t],presentOnDiagram:r.model.elements.findIndex((function(e){return e.iri===t&&void 0===e.group}))>=0}})),t.updateAll(),t.context.ontodiaWorkspace.triggerWorkspaceEvent(u.WorkspaceEventKey.connectionsLoadElements)})).catch((function(e){console.error(e),t.loadingState=s.ProgressState.error,t.updateAll()}))},ConnectionsMenu.prototype.render=function(){var e={links:this.links||[],countMap:this.countMap||{}},t=null;this.linkDataChunk&&this.objects&&(t={linkDataChunk:this.linkDataChunk,objects:this.objects});var n=this.props,r=n.view,o=n.target,a=n.suggestProperties;return i.createElement(h,{target:o,connectionsData:e,objectsData:t,state:this.loadingState,view:r,onExpandLink:this.onExpandLink,onPressAddSelected:this.addSelectedElements,onMoveToFilter:this.onMoveToFilter,propertySuggestionCall:a})},ConnectionsMenu.contextTypes=u.WorkspaceContextTypes,ConnectionsMenu}(i.Component);t.ConnectionsMenu=p;var h=function(e){function ConnectionsMenuMarkup(t){var n=e.call(this,t)||this;return n.onChangeFilter=function(e){var t=e.currentTarget.value;n.setState({filterKey:t})},n.getTitle=function(){return n.props.objectsData&&"objects"===n.state.panel?"Objects":n.props.connectionsData&&"connections"===n.state.panel?"Connections":"Error"},n.onExpandLink=function(e){n.setState({filterKey:"",panel:"objects"}),n.props.onExpandLink(e)},n.onCollapseLink=function(){n.setState({filterKey:"",panel:"connections"})},n.getBreadCrumbs=function(){if(n.props.objectsData&&"objects"===n.state.panel){var e=n.props.objectsData.linkDataChunk,t=e.link,r=e.direction,o=n.props.view.formatLabel(t.label,t.id);return i.createElement("span",{className:"ontodia-connections-menu_bread-crumbs"},i.createElement("a",{className:"ontodia-connections-menu__link",onClick:n.onCollapseLink},"Connections"),"/",o," ",r?"("+r+")":null)}return null},n.getBody=function(){return"error"===n.props.state?i.createElement("label",{className:"ontodia-label ontodia-connections-menu__error"},"Error"):n.props.objectsData&&"objects"===n.state.panel?i.createElement(g,{data:n.props.objectsData,onMoveToFilter:n.props.onMoveToFilter,view:n.props.view,filterKey:n.state.filterKey,loading:n.props.state===s.ProgressState.loading,onPressAddSelected:n.props.onPressAddSelected}):n.props.connectionsData&&"connections"===n.state.panel?n.props.state===s.ProgressState.loading?i.createElement("label",{className:"ontodia-label ontodia-connections-menu__loading"},"Loading..."):i.createElement(f,{id:n.props.target.id,data:n.props.connectionsData,view:n.props.view,filterKey:n.state.filterKey,onExpandLink:n.onExpandLink,onMoveToFilter:n.props.onMoveToFilter,propertySuggestionCall:n.props.propertySuggestionCall,sortMode:n.state.sortMode}):i.createElement("div",null)},n.onSortChange=function(e){var t=e.target.value;n.state.sortMode!==t&&n.setState({sortMode:t})},n.renderSortSwitch=function(e,t,r){return i.createElement("div",null,i.createElement("input",{type:"radio",name:"sort",id:e,value:e,className:"ontodia-connections-menu__sort-switch",onChange:n.onSortChange,checked:n.state.sortMode===e}),i.createElement("label",{htmlFor:e,className:"ontodia-connections-menu__sort-switch-label",title:r},i.createElement("i",{className:"fa "+t})))},n.renderSortSwitches=function(){return"connections"===n.state.panel&&n.props.propertySuggestionCall?i.createElement("div",{className:"ontodia-connections-menu_search-line-sort-switches"},n.renderSortSwitch("alphabet","fa-sort-alpha-asc","Sort alphabetically"),n.renderSortSwitch("smart","fa-lightbulb-o","Smart sort")):null},n.state={filterKey:"",panel:"connections",sortMode:"alphabet"},n}return r.__extends(ConnectionsMenuMarkup,e),ConnectionsMenuMarkup.prototype.render=function(){return i.createElement("div",{className:"ontodia-connections-menu"},i.createElement("label",{className:"ontodia-label ontodia-connections-menu__title-label"},this.getTitle()),this.getBreadCrumbs(),i.createElement("div",{className:"ontodia-connections-menu_search-line"},i.createElement("input",{type:"text",className:"search-input ontodia-form-control ontodia-connections-menu__search-line-input",value:this.state.filterKey,onChange:this.onChangeFilter,placeholder:"Search for..."}),this.renderSortSwitches()),i.createElement(s.ProgressBar,{state:this.props.state,height:10}),this.getBody())},ConnectionsMenuMarkup}(i.Component),f=function(e){function ConnectionsList(t){var n=e.call(this,t)||this;return n.updateScores=function(e){if(e.propertySuggestionCall&&(e.filterKey||"smart"===e.sortMode)){var t=e.id,r=e.data,i=e.view,o=e.filterKey,a=i.getLanguage(),s=o.trim(),l=r.links.map((function(e){return e.id}));e.propertySuggestionCall({elementId:t,token:s,properties:l,lang:a}).then((function(e){return n.setState({scores:e})}))}},n.compareLinks=function(e,t){var r=n.props.view,i=r.formatLabel(e.label,e.id),o=r.formatLabel(t.label,t.id);return i.localeCompare(o)},n.compareLinksByWeight=function(e,t){var r=n.props.view,i=r.formatLabel(e.label,e.id),o=r.formatLabel(t.label,t.id),a=n.state.scores[e.id]?n.state.scores[e.id].score:0,s=n.state.scores[t.id]?n.state.scores[t.id].score:0;return a>s?-1:a<s?1:i.localeCompare(o)},n.getLinks=function(){var e=n.props,t=e.view,r=e.data,i=e.filterKey;return(r.links||[]).filter((function(e){var n=t.formatLabel(e.label,e.id).toLowerCase();return!i||n.indexOf(i.toLowerCase())>=0})).sort(n.compareLinks)},n.getProbableLinks=function(){var e=n.isSmartMode();return(n.props.data.links||[]).filter((function(t){return n.state.scores[t.id]&&(n.state.scores[t.id].score>0||e)})).sort(n.compareLinksByWeight)},n.getViews=function(e,t){for(var r=n.props.view,o=n.props.data.countMap||{},a=[],addView=function(e,s){var l="in"===s?o[e.id].inCount:o[e.id].outCount;if(0!==l){var c=t?"-probable":"";a.push(i.createElement(m,{key:s+"-"+e.id+"-"+c,link:e,onExpandLink:n.props.onExpandLink,view:r,count:l,direction:s,filterKey:t?"":n.props.filterKey,onMoveToFilter:n.props.onMoveToFilter,probability:n.state.scores[e.id]&&t?n.state.scores[e.id].score:0}))}},s=0,l=e;s<l.length;s++){var c=l[s];addView(c,"in"),addView(c,"out")}return a},n.state={scores:{}},n.updateScores(t),n}return r.__extends(ConnectionsList,e),ConnectionsList.prototype.componentWillReceiveProps=function(e){this.updateScores(e)},ConnectionsList.prototype.isSmartMode=function(){return"smart"===this.props.sortMode&&!this.props.filterKey},ConnectionsList.prototype.render=function(){var e,t=this.props.view,n=this.isSmartMode(),r=n?[]:this.getLinks(),o=this.getProbableLinks().filter((function(e){return-1===r.indexOf(e)})),a=this.getViews(r),s=this.getViews(o,!0);if(0===a.length&&0===s.length)e=i.createElement("label",{className:"ontodia-label ontodia-connections-menu_links-list__empty"},"List empty");else if(e=a,a.length>1||n&&s.length>1){var l=(this.props.data.countMap||{})[d.id];e=[i.createElement(m,{key:d.id,link:d,onExpandLink:this.props.onExpandLink,view:t,count:l.inCount+l.outCount,onMoveToFilter:this.props.onMoveToFilter}),i.createElement("hr",{key:"ontodia-hr-line",className:"ontodia-connections-menu_links-list__hr"})].concat(e)}var c=null;return 0!==s.length&&(c=[n?null:i.createElement("li",{key:"probable-links"},i.createElement("span",{className:"ontodia-label"},"Probably, you're looking for..")),s]),i.createElement("ul",{className:"ontodia-connections-menu_links-list "+(0===a.length&&0===s.length?"ocm_links-list-empty":"")},e,c)},ConnectionsList}(i.Component),m=function(e){function LinkInPopupMenu(t){var n=e.call(this,t)||this;return n.onExpandLink=function(e,t){n.props.onExpandLink({link:n.props.link,direction:t,expectedCount:e})},n.onMoveToFilter=function(e){e.stopPropagation(),n.props.onMoveToFilter({link:n.props.link,direction:n.props.direction,expectedCount:n.props.count})},n}return r.__extends(LinkInPopupMenu,e),LinkInPopupMenu.prototype.render=function(){var e=this,t=this.props,n=t.view,r=t.link,o=n.formatLabel(r.label,r.id),a=Math.round(100*this.props.probability),s=l.highlightSubstring(o+(a>0?" ("+a+"%)":""),this.props.filterKey),c="in"===this.props.direction?"source":"out"===this.props.direction?"target":"all connected";return i.createElement("li",{"data-linktypeid":this.props.link.id,className:"link-in-popup-menu",title:c+' of "'+o+'" '+n.formatIri(r.id),onClick:function(){return e.onExpandLink(e.props.count,e.props.direction)}},"in"===this.props.direction||"out"===this.props.direction?i.createElement("div",{className:"link-in-popup-menu_direction"},"in"===this.props.direction&&i.createElement("div",{className:"link-in-popup-menu_direction__in-direction"}),"out"===this.props.direction&&i.createElement("div",{className:"link-in-popup-menu_direction__out-direction"})):null,i.createElement("div",{className:"link-in-popup-menu__link-title"},s),i.createElement("span",{className:"ontodia-badge link-in-popup-menu__count"},this.props.count<=100?this.props.count:"100+"),i.createElement("div",{className:"link-in-popup-menu__filter-button",onClick:this.onMoveToFilter,title:"Set as filter in the Instances panel"}),i.createElement("div",{className:"link-in-popup-menu__navigate-button",title:"Navigate to "+c+' "'+o+'" elements'}))},LinkInPopupMenu}(i.Component),g=function(e){function ObjectsPanel(t){var n=e.call(this,t)||this;return n.onSelectAll=function(){var e=n.props.data.objects;if(0!==e.length){var t=allNonPresentedAreSelected(e,n.state.selection)?new Set:function selectNonPresented(e){for(var t=new Set,n=0,r=e;n<r.length;n++){var i=r[n];i.presentOnDiagram||t.add(i.model.id)}return t}(n.props.data.objects);n.updateSelection(t)}},n.updateSelection=function(e){n.setState({selection:e})},n.counter=function(e){var t=e+"of"+n.props.data.objects.length,r=Math.min(100,n.props.data.linkDataChunk.expectedCount)-n.props.data.objects.length,o=Math.abs(r)>100?"100+":Math.abs(r).toString(),a=0===r?"":"("+o+")",s=0===r?"":r>0?"Unavailable nodes":"Extra nodes";return i.createElement("div",{className:"ontodia-label ontodia-connections-menu_objects-panel_bottom-panel__count-label"},i.createElement("span",null,t),i.createElement("span",{className:"ontodia-connections-menu_objects-panel_bottom-panel__extra-elements",title:s},a))},n.state={selection:new Set},n}return r.__extends(ObjectsPanel,e),ObjectsPanel.prototype.componentWillReceiveProps=function(e){this.props.data.objects.length<e.data.objects.length&&this.setState({selection:new Set})},ObjectsPanel.prototype.getFilteredObjects=function(){var e=this;if(!this.props.filterKey)return this.props.data.objects;var t=this.props.filterKey.toLowerCase();return this.props.data.objects.filter((function(n){var r=e.props.view.formatLabel(n.model.label.values,n.model.id).toLowerCase();return r&&r.indexOf(t)>=0}))},ObjectsPanel.prototype.getItems=function(e){for(var t={},n=[],r=0,i=e;r<i.length;r++){var o=i[r];t[o.model.id]||(t[o.model.id]=!0,n.push(o.model))}return n},ObjectsPanel.prototype.render=function(){var e=this,t=this.props,n=t.onPressAddSelected,r=t.filterKey,o=this.state.selection,a=this.getFilteredObjects(),s=allNonPresentedAreSelected(a,o),l=a.filter((function(e){return!e.presentOnDiagram})),u=l.filter((function(e){return o.has(e.model.id)}));return i.createElement("div",{className:"ontodia-connections-menu_objects-panel"},i.createElement("div",{className:"ontodia-connections-menu_objects-panel__select-all"},i.createElement("label",null,i.createElement("input",{type:"checkbox",checked:s&&l.length>0,onChange:this.onSelectAll,disabled:0===l.length}),i.createElement("span",null,"Select All"))),this.props.loading?i.createElement("label",{className:"ontodia-label ontodia-connections-menu__loading-objects"},"Loading..."):0===a.length?i.createElement("label",{className:"ontodia-label ontodia-connections-menu__loading-objects"},"No available nodes"):i.createElement("div",{className:"ontodia-connections-menu_objects-panel_objects-list"},i.createElement(c.SearchResults,{view:this.props.view,items:this.getItems(a),selection:this.state.selection,onSelectionChanged:this.updateSelection,highlightText:r}),this.props.data.linkDataChunk.expectedCount>100?i.createElement("div",{className:"ontodia-connections-menu__move-to-filter",onClick:function(){return e.props.onMoveToFilter(e.props.data.linkDataChunk)}},"The list was truncated, for more data click here to use the filter panel"):null),i.createElement("div",{className:"ontodia-connections-menu_objects-panel_bottom-panel"},this.counter(u.length),i.createElement("button",{className:"ontodia-btn ontodia-btn-primary pull-right ontodia-connections-menu_objects-panel_bottom-panel__add-button",disabled:this.props.loading||0===l.length,onClick:function(){return n(u.length>0?u:l)}},u.length>0?"Add selected":"Add all")))},ObjectsPanel}(i.Component);function allNonPresentedAreSelected(e,t){for(var n=!0,r=0,i=e;r<i.length;r++){var o=i[r];o.presentOnDiagram||(n=n&&t.has(o.model.id))}return n}},2329:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1554),a=n(1697),s=n(1986),l=n(1657),c=n(3283),u=n(3284),d="ontodia-instances-search",p=function(e){function InstancesSearch(t,n){var r=e.call(this,t,n)||this;return r.listener=new o.EventObserver,r.onSelectionChanged=function(e){r.setState({selection:e})},r.state={resultId:0,selection:new Set},r}return r.__extends(InstancesSearch,e),InstancesSearch.prototype.render=function(){var e=this,t=d+" "+(this.props.className||""),n=this.state.quering?a.ProgressState.loading:this.state.error?a.ProgressState.error:this.state.items?a.ProgressState.completed:a.ProgressState.none,r=void 0===this.state.inputText?this.props.criteria.text:this.state.inputText;return i.createElement("div",{className:t},i.createElement(a.ProgressBar,{state:n}),i.createElement("div",{className:d+"__criteria"},this.renderCriteria(),i.createElement("div",{className:d+"__text-criteria ontodia-input-group"},i.createElement("input",{type:"text",className:"ontodia-form-control",placeholder:"Search for...",value:r||"",onChange:function(t){return e.setState({inputText:t.currentTarget.value})},onKeyUp:function(t){13===t.keyCode&&e.submitCriteriaUpdate()}}),i.createElement("span",{className:"ontodia-input-group-btn"},i.createElement("button",{className:"ontodia-btn ontodia-btn-default",type:"button",title:"Search",onClick:function(){return e.submitCriteriaUpdate()}},i.createElement("span",{className:"fa fa-search","aria-hidden":"true"}))))),i.createElement("div",{className:d+"__rest ontodia-scrollable",key:this.state.resultId},i.createElement(s.SearchResults,{view:this.props.view,items:this.state.items,highlightText:this.props.criteria.text,selection:this.state.selection,onSelectionChanged:this.onSelectionChanged}),i.createElement("div",{className:d+"__rest-end"},i.createElement("button",{type:"button",className:d+"__load-more ontodia-btn ontodia-btn-primary",disabled:this.state.quering,style:{display:this.state.moreItemsAvailable?void 0:"none"},onClick:function(){return e.queryItems(!0)}},i.createElement("span",{className:"fa fa-chevron-down","aria-hidden":"true"}),"Show more"))))},InstancesSearch.prototype.renderCriteria=function(){var e=this,t=this.props,n=t.criteria,o=void 0===n?{}:n,a=t.view,s=[];if(o.elementType){var l=o.elementType,p=a.formatLabel(l.label,l.id);s.push(i.createElement("div",{key:"hasType",className:d+"__criterion"},this.renderRemoveCriterionButtons((function(){return e.props.onCriteriaChanged(r.__assign(r.__assign({},e.props.criteria),{elementType:void 0}))})),"Has type"," ",i.createElement("span",{className:d+"__criterion-class",title:l.id},p)))}else if(o.refElement){var h=o.refElement,f=a.formatLabel(h.data.label.values,h.iri),m=o.refElementLink,g=m?a.formatLabel(m.label,m.id):void 0;s.push(i.createElement("div",{key:"hasLinkedElement",className:d+"__criterion"},this.renderRemoveCriterionButtons((function(){return e.props.onCriteriaChanged(r.__assign(r.__assign({},e.props.criteria),{refElement:void 0,refElementLink:void 0}))})),"Connected to"," ",i.createElement("span",{className:d+"__criterion-element",title:h?h.iri:void 0},f),m&&i.createElement("span",null," through ",i.createElement("span",{className:d+"__criterion-link-type",title:m?m.id:void 0},g),"in"===o.linkDirection&&i.createElement("span",null," as ",i.createElement("img",{className:d+"__link-direction",src:c}),"source"),"out"===o.linkDirection&&i.createElement("span",null," as ",i.createElement("img",{className:d+"__link-direction",src:u}),"target"))))}return i.createElement("div",{className:d+"__criterions"},s)},InstancesSearch.prototype.renderRemoveCriterionButtons=function(e){return i.createElement("div",{className:d+"__criterion-remove ontodia-btn-group ontodia-btn-group-xs"},i.createElement("button",{type:"button",className:"ontodia-btn ontodia-btn-default",title:"Remove criteria",onClick:e},i.createElement("span",{className:"fa fa-times","aria-hidden":"true"})))},InstancesSearch.prototype.submitCriteriaUpdate=function(){var e=void 0===this.state.inputText?this.props.criteria.text:this.state.inputText;e=""===e?void 0:e,this.props.onCriteriaChanged(r.__assign(r.__assign({},this.props.criteria),{text:e}))},InstancesSearch.prototype.componentDidMount=function(){var e=this;this.listener.listen(this.props.view.events,"changeLanguage",(function(){return e.forceUpdate()})),this.queryItems(!1)},InstancesSearch.prototype.componentWillReceiveProps=function(e){var t=this,n=!!this.currentRequest&&this.currentRequest.languageCode!==e.view.getLanguage();(this.props.criteria!==e.criteria||n)&&this.setState({inputText:void 0},(function(){return t.queryItems(!1)}))},InstancesSearch.prototype.componentWillUnmount=function(){this.listener.stopListening(),this.currentRequest=void 0},InstancesSearch.prototype.queryItems=function(e){var t,n=this;if(e){if(!this.currentRequest)throw new Error("Cannot request more items without initial request.");var i=this.currentRequest,o=i.offset,a=i.limit;t=r.__assign(r.__assign({},this.currentRequest),{offset:o+a})}else t=createRequest(this.props.criteria,this.props.view.getLanguage());t.text||t.elementTypeId||t.refElementId||t.refElementLinkId?(this.currentRequest=t,this.setState({quering:!0,error:void 0,moreItemsAvailable:!1}),this.props.model.dataProvider.filter(t).then((function(e){n.currentRequest===t&&(n.processFilterData(e),n.context.ontodiaWorkspace.triggerWorkspaceEvent(l.WorkspaceEventKey.searchQueryItem))})).catch((function(e){n.currentRequest===t&&(console.error(e),n.setState({quering:!1,error:e}))}))):this.setState({quering:!1,error:void 0,items:void 0,selection:new Set,moreItemsAvailable:!1})},InstancesSearch.prototype.processFilterData=function(e){var t=this.currentRequest.offset>0,n={};t&&this.state.items.forEach((function(e){return n[e.id]=!0}));var i=t?r.__spreadArrays(this.state.items):[];for(var o in e)e.hasOwnProperty(o)&&(n[o]||i.push(e[o]));var a=Object.keys(e).length>=this.currentRequest.limit;t?this.setState({quering:!1,items:i,error:void 0,moreItemsAvailable:a}):this.setState({quering:!1,resultId:this.state.resultId+1,items:i,selection:new Set,error:void 0,moreItemsAvailable:a})},InstancesSearch.contextTypes=l.WorkspaceContextTypes,InstancesSearch}(i.Component);function createRequest(e,t){var n=e.text,r=e.elementType,i=e.refElement,o=e.refElementLink,a=e.linkDirection;return{text:n,elementTypeId:r?r.id:void 0,refElementId:i?i.iri:void 0,refElementLinkId:o?o.id:void 0,linkDirection:a,offset:0,limit:100,languageCode:t||"en"}}t.InstancesSearch=p,t.createRequest=createRequest},2330:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1607),a=n(1580),s=n(1573),l=n(1554),c=n(1560),u=n(1585),d=function(e){function LinkTypeSelector(t){var n=e.call(this,t)||this;return n.listener=new l.EventObserver,n.cancellation=new c.Cancellation,n.updateAll=function(){return n.forceUpdate()},n.onChangeType=function(e){var t=n.props.linkValue.value,i=t.link,o=t.direction,a=parseInt(e.currentTarget.value,10),s=n.state.fatLinkTypes[a],l=s.fatLinkType,c=s.direction,u=r.__assign(r.__assign({},i),{linkTypeId:l.id});o!==c&&(u.sourceId=i.targetId,u.targetId=i.sourceId),n.props.onChange({link:u,direction:c})},n.renderPossibleLinkType=function(e,t){var r,o=e.fatLinkType,a=e.direction,l=n.props,c=l.view,u=(l.linkValue,l.source),d=l.target,p=c.formatLabel(o.label,o.id),h=[u,d].map((function(e){return c.formatLabel(e.label.values,e.id)})),f=h[0],m=h[1];return a===s.LinkDirection.in&&(f=(r=[m,f])[0],m=r[1]),i.createElement("option",{key:t,value:t},p," [",f,"  ",m,"]")},n.state={fatLinkTypes:[]},n}return r.__extends(LinkTypeSelector,e),LinkTypeSelector.prototype.componentDidMount=function(){this.fetchPossibleLinkTypes()},LinkTypeSelector.prototype.componentDidUpdate=function(e){var t=this.props,n=t.source,r=t.target;e.source===n&&e.target===r||(this.setState({fatLinkTypes:void 0}),this.fetchPossibleLinkTypes())},LinkTypeSelector.prototype.componentWillUnmount=function(){this.listener.stopListening(),this.cancellation.abort()},LinkTypeSelector.prototype.fetchPossibleLinkTypes=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,i,o,a,l;return r.__generator(this,(function(r){switch(r.label){case 0:return e=this.props,t=e.view,n=e.metadataApi,i=e.source,o=e.target,n?[4,c.CancellationToken.mapCancelledToNull(this.cancellation.signal,n.possibleLinkTypes(i,o,this.cancellation.signal))]:[2];case 1:return null===(a=r.sent())||(l=[],a.forEach((function(e){var n=e.linkTypeIri,r=e.direction,i=t.model.createLinkType(n);l.push({fatLinkType:i,direction:r})})),l.sort(function makeLinkTypeComparatorByLabelAndDirection(e){return function(t,n){var r=e.formatLabel(t.fatLinkType.label,t.fatLinkType.id),i=e.formatLabel(n.fatLinkType.label,n.fatLinkType.id),o=r.localeCompare(i);return 0!==o?o:t.direction===s.LinkDirection.out&&n.direction===s.LinkDirection.in?-1:t.direction===s.LinkDirection.in&&n.direction===s.LinkDirection.out?1:0}}(t)),this.setState({fatLinkTypes:l}),this.listenToLinkLabels(l)),[2]}}))}))},LinkTypeSelector.prototype.listenToLinkLabels=function(e){var t=this;e.forEach((function(e){var n=e.fatLinkType;return t.listener.listen(n.events,"changeLabel",t.updateAll)}))},LinkTypeSelector.prototype.render=function(){var e=this.props,t=e.linkValue,n=e.disabled,r=this.state.fatLinkTypes,o=(r||[]).findIndex((function(e){var n=e.fatLinkType,r=e.direction;return n.id===t.value.link.linkTypeId&&r===t.value.direction}));return i.createElement("div",{className:"ontodia-edit-form__control-row"},i.createElement("label",null,"Link Type"),r?i.createElement("select",{className:"ontodia-form-control",value:o,onChange:this.onChangeType,disabled:n},i.createElement("option",{value:-1,disabled:!0},"Select link type"),r.map(this.renderPossibleLinkType)):i.createElement("div",null,i.createElement(u.HtmlSpinner,{width:20,height:20})),t.error?i.createElement("span",{className:"ontodia-edit-form__control-error"},t.error):"")},LinkTypeSelector}(i.Component);t.LinkTypeSelector=d,t.validateLinkType=function validateLinkType(e,t,n){return t.linkTypeId===a.PLACEHOLDER_LINK_TYPE?Promise.resolve({error:"Required.",allowChange:!0}):o.sameLink(t,n)?Promise.resolve({error:void 0,allowChange:!0}):e.model.links.find((function(n){var r=n.data,i=r.linkTypeId,o=r.sourceId,a=r.targetId;return i===t.linkTypeId&&o===t.sourceId&&a===t.targetId&&!e.temporaryState.links.has(t)}))?Promise.resolve({error:"The link already exists.",allowChange:!1}):e.model.dataProvider.linksInfo({elementIds:[t.sourceId,t.targetId],linkTypeIds:[t.linkTypeId]}).then((function(e){return e.some((function(e){return o.sameLink(e,t)}))?{error:"The link already exists.",allowChange:!1}:{error:void 0,allowChange:!0}}))}},2331:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(11),o=n(16),a=n(1607),s=n(1560),l=n(1623);function processValidationResult(e,t,n,r,s){return i.__awaiter(this,void 0,Promise,(function(){var c,u,d,p,h,f,m;return i.__generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return null===(c=i.sent())?[2]:[3,3];case 2:return u=i.sent(),console.error("Failed to validate element",r.target,u),c=[{type:"element",target:r.target.id,message:"Failed to validate element"}],[3,3];case 3:for(d=[],p=new l.HashMap(a.hashLink,a.sameLink),r.outboundLinks.forEach((function(e){return p.set(e,[])})),h=0,f=c;h<f.length;h++)"element"===(m=f[h]).type&&m.target===r.target.id?d.push(m):"link"===m.type&&p.has(m.target)&&p.get(m.target).push(m);return s.elements.get(r.target.id)===t&&(d.length>0?s.elements.set(r.target.id,{loading:!1,errors:d}):s.elements.delete(r.target.id)),p.forEach((function(e,t){s.links.get(t)===n&&(e.length>0?s.links.set(t,{loading:!1,errors:e}):s.links.delete(t))})),s.isValid=s.isValid&&o.isEmpty(c),[2,s]}}))}))}!function(e){function createMutable(){return{elements:new Map,links:new l.HashMap(a.hashLink,a.sameLink),isValid:!0}}e.empty=createMutable(),e.emptyElement={loading:!1,errors:[]},e.emptyLink={loading:!1,errors:[]},e.createMutable=createMutable}(r=t.ValidationState||(t.ValidationState={})),t.changedElementsToValidate=function changedElementsToValidate(e,t){var n=t.authoringState,r=new l.HashMap(a.hashLink,a.sameLink);e.links.forEach((function(e,t){return r.set(t,!0)})),n.links.forEach((function(e,t){return r.set(t,!0)}));var i=new Set;r.forEach((function(t,r){n.links.get(r)!==e.links.get(r)&&i.add(r.sourceId)}));for(var o=0,s=t.model.elements;o<s.length;o++){var c=s[o],u=n.elements.get(c.iri),d=e.elements.get(c.iri);if(u!==d&&(i.add(c.iri),(u||d).deleted))for(var p=0,h=c.links;p<h.length;p++){var f=h[p];f.data.sourceId!==c.iri&&i.add(f.data.sourceId)}}return i},t.validateElements=function validateElements(e,t,n,a){return i.__awaiter(this,void 0,void 0,(function(){var l,c,u,d,p,h;return i.__generator(this,(function(f){switch(f.label){case 0:l=n.validationState,c=r.createMutable(),u=function(r){var u,d,p,h,f,m,g,v,y,k;return i.__generator(this,(function(i){switch(i.label){case 0:return c.elements.has(r.iri)?[2,"continue"]:(u=r.links.reduce((function(e,t){return t.sourceId===r.id&&e.push(t.data),e}),[]),e.has(r.iri)?(d={target:r.data,outboundLinks:u,state:n.authoringState,model:n.model,cancellation:a},p=s.CancellationToken.mapCancelledToNull(a,t.validate(d)),h={loading:!0,errors:[]},f={loading:!0,errors:[]},c.elements.set(r.iri,h),u.forEach((function(e){return c.links.set(e,f)})),[4,processValidationResult(p,h,f,d,c)]):[3,2]);case 1:return c=i.sent(),[3,3];case 2:for(m=l.elements.get(r.iri),c.elements.set(r.iri,m),c.isValid=c.isValid&&o.isEmpty(null==m?void 0:m.errors),g=0,v=u;g<v.length;g++)y=v[g],k=l.links.get(y),c.isValid=c.isValid&&o.isEmpty(null==k?void 0:k.errors),c.links.set(y,k);i.label=3;case 3:return[2]}}))},d=0,p=n.model.elements,f.label=1;case 1:return d<p.length?(h=p[d],[5,u(h)]):[3,4];case 2:f.sent(),f.label=3;case 3:return d++,[3,1];case 4:return n.setValidationState(c),[2]}}))}))}},2332:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=function(e){function DefaultToolbar(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChangeLanguage=function(e){var n=e.currentTarget.value;t.props.onChangeLanguage(n)},t.onExportSVG=function(){t.props.onExportSVG()},t.onExportPNG=function(){t.props.onExportPNG()},t}return r.__extends(DefaultToolbar,e),DefaultToolbar.prototype.renderSaveDiagramButton=function(){return this.props.onSaveDiagram?i.createElement("button",{type:"button",className:"saveDiagramButton ontodia-btn ontodia-btn-primary",disabled:!1===this.props.canSaveDiagram,onClick:this.props.onSaveDiagram},i.createElement("span",{className:"fa fa-floppy-o","aria-hidden":"true"})," Save diagram"):null},DefaultToolbar.prototype.renderPersistAuthoredChangesButton=function(){return this.props.onPersistChanges?i.createElement("button",{type:"button",className:"saveDiagramButton ontodia-btn ontodia-btn-success",disabled:!1===this.props.canPersistChanges,onClick:this.props.onPersistChanges},i.createElement("span",{className:"fa fa-floppy-o","aria-hidden":"true"})," Save data"):null},DefaultToolbar.prototype.renderLanguages=function(){var e=this.props,t=e.selectedLanguage,n=e.languages;return n.length<=1?null:i.createElement("span",{className:"ontodia-btn-group ontodia-toolbar__language-selector"},i.createElement("label",{className:"ontodia-label"},i.createElement("span",null,"Data Language - ")),i.createElement("select",{value:t,onChange:this.onChangeLanguage},n.map((function(e){var t=e.code,n=e.label;return i.createElement("option",{key:t,value:t},n)}))))},DefaultToolbar.prototype.render=function(){return i.createElement("div",{className:"ontodia-toolbar"},i.createElement("div",{className:"ontodia-btn-group ontodia-btn-group-sm"},this.renderSaveDiagramButton(),this.renderPersistAuthoredChangesButton(),this.props.onClearAll?i.createElement("button",{type:"button",className:"ontodia-btn ontodia-btn-default",title:"Clear All",onClick:this.props.onClearAll},i.createElement("span",{className:"fa fa-trash","aria-hidden":"true"}),"Clear All"):null,i.createElement("button",{type:"button",className:"ontodia-btn ontodia-btn-default",title:"Force layout",onClick:this.props.onForceLayout},i.createElement("span",{className:"fa fa-sitemap","aria-hidden":"true"})," Layout"),i.createElement("button",{type:"button",className:"ontodia-btn ontodia-btn-default",title:"Zoom In",onClick:this.props.onZoomIn},i.createElement("span",{className:"fa fa-search-plus","aria-hidden":"true"})),i.createElement("button",{type:"button",className:"ontodia-btn ontodia-btn-default",title:"Zoom Out",onClick:this.props.onZoomOut},i.createElement("span",{className:"fa fa-search-minus","aria-hidden":"true"})),i.createElement("button",{type:"button",className:"ontodia-btn ontodia-btn-default",title:"Fit to Screen",onClick:this.props.onZoomToFit},i.createElement("span",{className:"fa fa-arrows-alt","aria-hidden":"true"})),i.createElement("button",{type:"button",className:"ontodia-btn ontodia-btn-default",title:"Export diagram as PNG",onClick:this.onExportPNG},i.createElement("span",{className:"fa fa-picture-o","aria-hidden":"true"})," PNG"),i.createElement("button",{type:"button",className:"ontodia-btn ontodia-btn-default",title:"Export diagram as SVG",onClick:this.onExportSVG},i.createElement("span",{className:"fa fa-picture-o","aria-hidden":"true"})," SVG"),i.createElement("button",{type:"button",className:"ontodia-btn ontodia-btn-default",title:"Print diagram",onClick:this.props.onPrint},i.createElement("span",{className:"fa fa-print","aria-hidden":"true"})),this.renderLanguages()))},DefaultToolbar}(i.Component);t.DefaultToolbar=o},2333:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(11),o=n(1),a=n(3304),s=n(3305);!function(e){e.Row="row",e.Column="column",e.Component="component"}(r=t.WorkspaceLayoutType||(t.WorkspaceLayoutType={}));var l=function(e){function WorkspaceLayout(){return null!==e&&e.apply(this,arguments)||this}return i.__extends(WorkspaceLayout,e),WorkspaceLayout.prototype.renderAccordion=function(e){var t=this,n=e.children,i=e.direction,l=e.animationDuration,c=this.props,u=c._onStartResize,d=c._onResize,p=n.map((function(e,a){var l;"horizontal"!==i||e.undocked||(0===a?l=s.DockSide.Left:a===n.length-1&&(l=s.DockSide.Right));var c=e.collapsedSize;return void 0===c&&"horizontal"===i&&(c=28),o.createElement(s.AccordionItem,{key:e.type===r.Component?e.id:a,heading:e.type===r.Component?e.heading:void 0,className:e.type===r.Component?e.className:void 0,dockSide:l,defaultSize:e.defaultSize,defaultCollapsed:e.defaultCollapsed,collapsedSize:c,minSize:e.minSize},t.renderLayout(e))}));return o.createElement(a.Accordion,{direction:i,onStartResize:u,onResize:d,animationDuration:l},p)},WorkspaceLayout.prototype.renderLayout=function(e){return e.type===r.Row?this.renderAccordion({children:e.children,direction:"horizontal",animationDuration:e.animationDuration}):e.type===r.Column?this.renderAccordion({children:e.children,direction:"vertical",animationDuration:e.animationDuration}):e.type===r.Component?o.Children.only(e.content):null},WorkspaceLayout.prototype.render=function(){var e=this.props.layout;return this.renderLayout(e)},WorkspaceLayout}(o.Component);t.WorkspaceLayout=l},3153:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},3154:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(2269),a=function(e){function DefaultElementTemplate(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(DefaultElementTemplate,e),DefaultElementTemplate.prototype.render=function(){var e=this.props,t=e.imgUrl?i.createElement("div",{className:"ontodia-default-template__thumbnail"},i.createElement("img",{src:e.imgUrl})):void 0,n=e.isExpanded?i.createElement("div",null,i.createElement("div",{className:"ontodia-default-template_body_expander"},i.createElement("div",{className:"ontodia-default-template_body_expander__iri_label"},"IRI:"),i.createElement("div",{className:"ontodia-default-template_body_expander_iri"},i.createElement("a",{className:"ontodia-default-template_body_expander_iri__link",href:e.iri,title:e.iri},e.iri))),i.createElement("hr",{className:"ontodia-default-template_body_expander__hr"}),this.renderPropertyTable()):null;return i.createElement("div",{className:"ontodia-default-template",style:{backgroundColor:e.color,borderColor:e.color},"data-expanded":this.props.isExpanded},i.createElement("div",{className:"ontodia-default-template_type-line",title:e.label},i.createElement("div",{className:"ontodia-default-template_type-line__icon","aria-hidden":"true"},i.createElement("img",{src:e.iconUrl})),i.createElement("div",{title:e.types,className:"ontodia-default-template_type-line_text-container"},i.createElement("div",{className:"ontodia-default-template_type-line_text-container__text"},e.types))),t,i.createElement("div",{className:"ontodia-default-template_body",style:{borderColor:e.color}},i.createElement("span",{className:"ontodia-default-template_body__label",title:e.label},e.label),n))},DefaultElementTemplate.prototype.renderPropertyTable=function(){var e=this.props.propsAsList;return e&&e.length>0?i.createElement("div",{className:"ontodia-default-template_body_expander_property-table"},e.map((function(e){var t=o.getPropertyValues(e.property).map((function(e,t){return i.createElement("div",{className:"ontodia-default-template_body_expander_property-table_row_key_values__value",key:t,title:e},e)}));return i.createElement("div",{key:e.id,className:"ontodia-default-template_body_expander_property-table_row"},i.createElement("div",{title:e.name+" ("+e.id+")",className:"ontodia-default-template_body_expander_property-table_row__key"},e.name),i.createElement("div",{className:"ontodia-default-template_body_expander_property-table_row_key_values"},t))}))):i.createElement("div",null,"no properties")},DefaultElementTemplate}(i.Component);t.DefaultElementTemplate=a},3155:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(2270),a="ontodia-group-template",s=function(e){function GroupTemplate(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(GroupTemplate,e),GroupTemplate.prototype.render=function(){var e=this.props,t=e.label,n=e.iconUrl,r=e.types,s=e.color,l=e.isExpanded;return i.createElement("div",{className:a},i.createElement("div",{className:a+"__wrap",style:{backgroundColor:s,borderColor:s}},i.createElement("div",{className:a+"__type-line",title:t},i.createElement("div",{className:a+"__type-line-icon"},i.createElement("img",{src:n})),i.createElement("div",{title:r,className:a+"__type-line-text-container"},i.createElement("div",{className:a+"__type-line-text"},r))),i.createElement("div",{className:a+"__body",style:{borderColor:s}},i.createElement("span",{className:a+"__label",title:t},t),l?i.createElement("div",{className:a+"__embedded-layer"},i.createElement(o.EmbeddedLayer,null)):null)))},GroupTemplate}(i.Component);t.GroupTemplate=s},3156:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(3157),i=n(3158),o=n(3159),a=n(3160),s=n(3161),l=n(3162),c=n(3163),u=n(3164),d=n(3165);t.DefaultTypeStyleBundle=function(e){return-1!==e.indexOf("http://www.w3.org/2002/07/owl#Class")||-1!==e.indexOf("http://www.w3.org/2000/01/rdf-schema#Class")?{color:"#eaac77",icon:r}:-1!==e.indexOf("http://www.w3.org/2002/07/owl#ObjectProperty")?{color:"#34c7f3",icon:i}:-1!==e.indexOf("http://www.w3.org/2002/07/owl#DatatypeProperty")?{color:"#34c7f3",icon:o}:-1!==e.indexOf("http://xmlns.com/foaf/0.1/Person")||-1!==e.indexOf("http://www.wikidata.org/entity/Q5")?{color:"#eb7777",icon:a}:-1!==e.indexOf("http://www.wikidata.org/entity/Q6256")?{color:"#77ca98",icon:s}:-1!==e.indexOf("http://schema.org/Organization")||-1!==e.indexOf("http://dbpedia.org/ontology/Organisation")||-1!==e.indexOf("http://xmlns.com/foaf/0.1/Organization")||-1!==e.indexOf("http://www.wikidata.org/entity/Q43229")?{color:"#77ca98",icon:l}:-1!==e.indexOf("http://www.wikidata.org/entity/Q618123")?{color:"#bebc71",icon:c}:-1!==e.indexOf("http://www.wikidata.org/entity/Q1190554")?{color:"#b4b1fb",icon:u}:-1!==e.indexOf("http://www.wikidata.org/entity/Q488383")?{color:"#53ccb2",icon:d}:void 0}},3157:function(e,t,n){"use strict";n.r(t),t.default=n.p+"cab65e2315f76cf56a3770a5beeeab59.svg"},3158:function(e,t,n){"use strict";n.r(t),t.default=n.p+"5be47e72a75723a361b5d77280341b06.svg"},3159:function(e,t,n){"use strict";n.r(t),t.default=n.p+"efb6a7d0bd589a4824dca3c7fa20b72d.svg"},3160:function(e,t,n){"use strict";n.r(t),t.default=n.p+"a611ce4b1c21523088ac82ad304c569c.svg"},3161:function(e,t,n){"use strict";n.r(t),t.default=n.p+"c24aa430e34aa6a64f1d0d26f27cc215.svg"},3162:function(e,t,n){"use strict";n.r(t),t.default=n.p+"ad307120dd0372e10c3334a40e7877bb.svg"},3163:function(e,t,n){"use strict";n.r(t),t.default=n.p+"23d23fe36bf5518fd59ecd152c469a04.svg"},3164:function(e,t,n){"use strict";n.r(t),t.default=n.p+"01cf2fccdcf763aff705a71df4b6f70c.svg"},3165:function(e,t,n){"use strict";n.r(t),t.default=n.p+"f196018229024e8524818df83812fc74.svg"},3166:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(1574),i=function(){function DefaultLinkRouter(e){void 0===e&&(e=20),this.gap=e}return DefaultLinkRouter.prototype.route=function(e){for(var t=new Map,n=0,r=e.links;n<r.length;n++){var i=r[n];if(!t.has(i.id)){var o=i.sourceId,a=i.targetId;o&&a&&(o===a?this.routeFeedbackSiblingLinks(e,o,t):this.routeNormalSiblingLinks(e,o,a,t))}}return t},DefaultLinkRouter.prototype.routeFeedbackSiblingLinks=function(e,t,n){for(var r=e.getElement(t),i=r.position,o=i.x,a=i.y,s=r.size,l=s.width,c=s.height,u=0,d=0,p=r.links;d<p.length;d++){var h=p[d];if(!n.has(h.id)&&!hasUserPlacedVertices(h))if(h.sourceId===h.targetId){var f=this.gap*(u+1),m=[{x:o-f,y:a+c/2},{x:o-f,y:a-f},{x:o+l/2,y:a-f}];n.set(h.id,{linkId:h.id,vertices:m}),u++}}},DefaultLinkRouter.prototype.routeNormalSiblingLinks=function(e,t,n,i){var o=this,a=e.getElement(t),s=e.getElement(n),l=centerOfElement(a),c=centerOfElement(s),u=(l.x+c.x)/2,d=(l.y+c.y)/2,p=r.Vector.normalize({x:c.x-l.x,y:c.y-l.y}),h=a.links.filter((function(e){return!(e.sourceId!==n&&e.targetId!==n||i.has(e.id)||hasUserPlacedVertices(e))}));if(!(h.length<=1)){var f=h.length%2?0:1;h.forEach((function(e,t){var n=t+f,r=o.gap*Math.ceil(n/2)-(f?o.gap/2:0),a=n%2?{x:-p.y,y:p.x}:{x:p.y,y:-p.x},s={x:u+a.x*r,y:d+a.y*r};i.set(e.id,{linkId:e.id,vertices:[s],labelTextAnchor:o.getLabelAlignment(p,t,h.length)})}))}},DefaultLinkRouter.prototype.getLabelAlignment=function(e,t,n){var r=Math.atan2(e.y,e.x),i=Math.abs(r),o=r<0,a=r>0,s=n-2,l=n-1;if(!(i<1*Math.PI/8||i>7*Math.PI/8)){if(o&&t===l||a&&t===s)return"end";if(o&&t===s||a&&t===l)return"start"}return"middle"},DefaultLinkRouter}();function hasUserPlacedVertices(e){var t=e.vertices;return t&&t.length>0}function centerOfElement(e){var t=e.position,n=t.x,r=t.y,i=e.size;return{x:n+i.width/2,y:r+i.height/2}}t.DefaultLinkRouter=i},3167:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1),a=n(1965),s=n(2269),l=n(1580),c=n(2276),u=n(1635),d=n(1585),p="ontodia-standard-template",h=function(e){function StandardTemplate(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(StandardTemplate,e),StandardTemplate.prototype.render=function(){var e=this;return i.createElement(c.AuthoredEntity,{templateProps:this.props},(function(t){return e.renderTemplate(t)}))},StandardTemplate.prototype.renderTemplate=function(e){var t=this.props,n=t.color,r=t.types,o=t.isExpanded,a=t.iri,s=t.propsAsList,l=this.getLabel(),c=e.editor,d=u.AuthoringState.isNewElement(c.authoringState,a)?"white":n,h=this.findPinnedProperties(e);return i.createElement("div",{className:p},i.createElement("div",{className:p+"__main",style:{backgroundColor:d,borderColor:n}},i.createElement("div",{className:p+"__body",style:{borderLeftColor:n}},i.createElement("div",{className:p+"__body-horizontal"},this.renderThumbnail(),i.createElement("div",{className:p+"__body-content"},i.createElement("div",{title:r,className:p+"__type"},i.createElement("div",{className:p+"__type-value"},this.getTypesLabel())),i.createElement("div",{className:p+"__label",title:l},l))),h?i.createElement("div",{className:p+"__pinned-props",style:{borderColor:n}},this.renderProperties(h)):null)),o?i.createElement("div",{className:p+"__dropdown",style:{borderColor:n}},this.renderPhoto(),i.createElement("div",{className:p+"__dropdown-content"},this.renderIri(e),this.renderProperties(s),c.inAuthoringMode?i.createElement("hr",{className:p+"__hr"}):null,c.inAuthoringMode?this.renderActions(e):null)):null)},StandardTemplate.prototype.findPinnedProperties=function(e){var t=this.props,n=t.isExpanded,r=t.propsAsList,i=t.elementId;if(!n){var o=e.view.model.getElement(i).elementState;if(o){var a=o[l.TemplateProperties.PinnedProperties];if(a){var s=r.filter((function(e){return Boolean(a[e.id])}));return 0===s.length?void 0:s}}}},StandardTemplate.prototype.renderProperties=function(e){return e.length?i.createElement("div",{className:p+"__properties"},e.map((function(e){var t=e.name,n=e.id,r=e.property,o=s.getPropertyValues(r);return i.createElement("div",{key:n,className:p+"__properties-row"},i.createElement("div",{className:p+"__properties-key",title:t+" ("+n+")"},t),i.createElement("div",{className:p+"__properties-values"},o.map((function(e,t){return i.createElement("div",{className:p+"__properties-value",key:t,title:e},e)}))))}))):i.createElement("div",null,"no properties")},StandardTemplate.prototype.renderPhoto=function(){var e=this.props,t=e.color,n=e.imgUrl;return n?i.createElement("div",{className:p+"__photo",style:{borderColor:t}},i.createElement("img",{src:n,className:p+"__photo-image"})):null},StandardTemplate.prototype.renderIri=function(e){var t=this.props.iri,n=void 0===e.editedIri?t:e.editedIri;return i.createElement("div",null,i.createElement("div",{className:p+"__iri"},i.createElement("div",{className:p+"__iri-key"},"IRI",e.editedIri?"(edited)":"",":"),i.createElement("div",{className:p+"__iri-value"},a.isEncodedBlank(n)?i.createElement("span",null,"(blank node)"):i.createElement("a",{href:n,title:n,"data-iri-click-intent":"openEntityIri"},n))),i.createElement("hr",{className:p+"__hr"}))},StandardTemplate.prototype.renderThumbnail=function(){var e=this.props,t=e.color,n=e.imgUrl,r=e.iconUrl;if(n)return i.createElement("div",{className:p+"__thumbnail","aria-hidden":"true"},i.createElement("img",{src:n,className:p+"__thumbnail-image"}));if(r)return i.createElement("div",{className:p+"__thumbnail","aria-hidden":"true"},i.createElement("img",{src:r,className:p+"__thumbnail-icon"}));var o=this.getTypesLabel();return i.createElement("div",{className:p+"__thumbnail","aria-hidden":"true",style:{color:t}},o.length>0?o.charAt(0).toUpperCase():"")},StandardTemplate.prototype.getTypesLabel=function(){return this.props.types},StandardTemplate.prototype.getLabel=function(){var e=this.props,t=e.label,n=e.props;return s.getProperty(n,"http://xmlns.com/foaf/0.1/name")||t},StandardTemplate.prototype.renderActions=function(e){var t=e.canEdit,n=e.canDelete,r=e.onEdit,o=e.onDelete;return i.createElement("div",{className:p+"__actions"},i.createElement("button",{type:"button",className:"ontodia-btn ontodia-btn-default",title:n?"Delete entity":"Deletion is unavailable for the selected element",disabled:!n,onClick:o},i.createElement("span",{className:"fa fa-trash"}),"",void 0===t?i.createElement(d.HtmlSpinner,{width:15,height:12}):"Delete"),i.createElement("button",{type:"button",className:"ontodia-btn ontodia-btn-default",title:t?"Edit entity":"Editing is unavailable for the selected element",disabled:!t,onClick:r},i.createElement("span",{className:"fa fa-edit"}),"",void 0===t?i.createElement(d.HtmlSpinner,{width:15,height:12}):"Edit"))},StandardTemplate}(o.Component);t.StandardTemplate=h},3168:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},3169:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},3170:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},3171:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(16),i=function(){function DemoDataProvider(e,t,n,r){this.allClasses=e,this.allLinkTypes=t,this.allElements=n,this.allLinks=r}return DemoDataProvider.prototype.simulateNetwork=function(e){var t=r.cloneDeep(e),n=200*-Math.log(Math.random());return new Promise((function(e){setTimeout((function(){return e(t)}),n)}))},DemoDataProvider.prototype.classTree=function(){return this.simulateNetwork(this.allClasses)},DemoDataProvider.prototype.classInfo=function(e){var t=e.classIds||[];return this.simulateNetwork(this.allClasses.filter((function(e){return t.indexOf(e.id)})))},DemoDataProvider.prototype.linkTypes=function(){return this.simulateNetwork(this.allLinkTypes)},DemoDataProvider.prototype.linkTypesInfo=function(e){var t=r.keyBy(e.linkTypeIds),n=this.allLinkTypes.filter((function(e){return t[e.id]}));return this.simulateNetwork(n)},DemoDataProvider.prototype.elementInfo=function(e){var t=this,n=e.elementIds.map((function(e){return t.allElements[e]})).filter((function(e){return void 0!==e}));return this.simulateNetwork(r.keyBy(n,(function(e){return e.id})))},DemoDataProvider.prototype.linksInfo=function(e){var t=r.keyBy(e.elementIds),n=r.keyBy(e.linkTypeIds),i=this.allLinks.filter((function(e){return n[e.linkTypeId]&&t[e.sourceId]&&t[e.targetId]}));return this.simulateNetwork(i)},DemoDataProvider.prototype.linkTypesOf=function(e){for(var t={},n=0,i=this.allLinks;n<i.length;n++){var o=i[n];if(o.sourceId===e.elementId||o.targetId===e.elementId){var a=t[o.linkTypeId],s=o.sourceId===e.elementId;a?s?a.outCount++:a.inCount++:t[o.linkTypeId]=s?{id:o.linkTypeId,inCount:0,outCount:1}:{id:o.linkTypeId,inCount:1,outCount:0}}}return this.simulateNetwork(r.map(t))},DemoDataProvider.prototype.linkElements=function(e){return this.filter({refElementId:e.elementId,refElementLinkId:e.linkId,linkDirection:e.direction,limit:e.limit,offset:e.offset,languageCode:""})},DemoDataProvider.prototype.filter=function(e){if(void 0===e.limit&&(e.limit=100),e.offset>0)return Promise.resolve({});var t={};if(e.elementTypeId)r.each(this.allElements,(function(n){n.types.indexOf(e.elementTypeId)>=0&&(t[n.id]=n)}));else if(e.refElementId)for(var n=e.refElementLinkId?this.allLinks.filter((function(t){return t.linkTypeId===e.refElementLinkId})):this.allLinks,i=e.refElementId,o=0,a=n;o<a.length;o++){var s=a[o],l=void 0;if(s.sourceId===i&&"in"!==e.linkDirection?l=s.targetId:s.targetId===i&&"out"!==e.linkDirection&&(l=s.sourceId),void 0!==l){var c=this.allElements[l];c&&(t[c.id]=c)}}else{if(!e.text)return Promise.reject(new Error("This type of filter is not implemented"));t=this.allElements}if(e.text){var u={},d=e.text.toLowerCase();return r.each(t,(function(e){(e.id.toLowerCase().indexOf(d)>=0||e.label.values.some((function(e){return e.value.toLowerCase().indexOf(d)>=0})))&&(u[e.id]=e)})),this.simulateNetwork(u)}return this.simulateNetwork(t)},DemoDataProvider}();t.DemoDataProvider=i},3172:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(3173),o=n(3263),a=n(3264),s={RDF:i.prefixFactory("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),RDFS:i.prefixFactory("http://www.w3.org/2000/01/rdf-schema#"),FOAF:i.prefixFactory("http://xmlns.com/foaf/0.1/"),XSD:i.prefixFactory("http://www.w3.org/2001/XMLSchema#"),OWL:i.prefixFactory("http://www.w3.org/2002/07/owl#")},l=function(){function RDFDataProvider(e){var t=this,n=new a.RDFCompositeParser(e.parsers);this.rdfStorage=new i.RDFCacheableStore({parser:n,acceptBlankNodes:e.acceptBlankNodes}),this.rdfLoader=new o.RDFLoader({parser:n,proxy:e.proxy}),this.dataFetching=e.dataFetching;var r=(e.data||[]).map((function(e){return n.parse(e.content,e.type,e.fileName).then((function(e){return t.rdfStorage.add(e),!0}))}));this.initStatement=Promise.all(r).catch((function(e){throw e.message="Initialization failed! Cause: "+e.message,e})),this.options=e}return RDFDataProvider.prototype.addGraph=function(e){this.rdfStorage.add(e)},RDFDataProvider.prototype.waitInitCompleted=function(){var e=this;return this.initStatement?this.initStatement.then((function(){delete e.initStatement})):Promise.resolve()},RDFDataProvider.prototype.classTree=function(){return r.__awaiter(this,void 0,Promise,(function(){var e,t,n,o,a,l,c,u,d,p,h,f,m,g,v,y,k,E,b,L,S,w,_,T,C,P,x,I,D;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.waitInitCompleted()];case 1:return r.sent(),e=this.rdfStorage.match(null,s.RDF("type"),s.RDFS("Class"),null),t=this.rdfStorage.match(null,s.RDF("type"),s.OWL("Class")),n=this.rdfStorage.match(null,s.RDF("type"),null),o=this.rdfStorage.match(null,s.RDFS("subClassOf"),null),[4,Promise.all([e,t,n,o])];case 2:for(a=r.sent(),l=a[0],c=a[1],u=a[2],d=a[3],p=l.toArray().map((function(e){return e.subject})),h=c.toArray().map((function(e){return e.subject})),f=u.toArray().map((function(e){return e.object})),m=d.toArray(),g=p.concat(h).concat(f),v=g.filter((function(e){return"BlankNode"!==e.interfaceName})).map((function(e){return e.nominalValue})),y={},k=0,E=m;k<E.length;k++)b=E[k],L=b.subject.nominalValue,S=b.object.nominalValue,i.isNamedNode(b.subject)&&!y[L]&&(y[L]=[]),i.isNamedNode(b.object)&&-1===y[L].indexOf(S)&&y[L].push(S);for(w={},_={},T=[],C=function(e){var t;if(w[e]?t=w[e]:(t=P.createEmptyClass(e),w[e]=t,_[e]=t,T.push(P.getLabels(e).then((function(e){t.label={values:e}})))),y[e])for(var _loop_2=function(e){if(!w[e]){var n=P.createEmptyClass(e);w[e]=n,_[e]=n,T.push(P.getLabels(e).then((function(e){n.label={values:e}})))}-1===w[e].children.indexOf(t)&&(w[e].children.push(t),w[e].count+=t.count),delete _[t.id]},n=0,r=y[e];n<r.length;n++){_loop_2(r[n])}},P=this,x=0,I=v;x<I.length;x++)D=I[x],C(D);return[4,Promise.all(T)];case 3:return r.sent(),[2,Object.keys(_).map((function(e){return _[e]}))]}}))}))},RDFDataProvider.prototype.propertyInfo=function(e){return r.__awaiter(this,void 0,Promise,(function(){var t,n,i,o,a,s,l=this;return r.__generator(this,(function(c){switch(c.label){case 0:return[4,this.waitInitCompleted()];case 1:return c.sent(),t={},n=e.propertyIds.map((function(e){return r.__awaiter(l,void 0,void 0,(function(){var t,n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),[4,this.checkElement(e)];case 1:return t=r.sent(),[4,this.fetchIfNecessary(e,t)];case 2:return r.sent(),[4,this.getLabels(e)];case 3:return n=r.sent(),[2,{id:e,label:{values:n}}];case 4:return i=r.sent(),console.warn(i),[2,null];case 5:return[2]}}))}))})),[4,Promise.all(n)];case 2:for(i=c.sent(),o=0,a=i;o<a.length;o++)(s=a[o])&&(t[s.id]=s);return[2,t]}}))}))},RDFDataProvider.prototype.classInfo=function(e){return r.__awaiter(this,void 0,Promise,(function(){var t,n=this;return r.__generator(this,(function(i){switch(i.label){case 0:return[4,this.waitInitCompleted()];case 1:return i.sent(),t=e.classIds.map((function(e){return r.__awaiter(n,void 0,void 0,(function(){var t,n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),[4,this.checkElement(e)];case 1:return t=r.sent(),[4,this.fetchIfNecessary(e,t)];case 2:return r.sent(),[4,this.getLabels(e)];case 3:return n=r.sent(),[2,{id:e,label:{values:n},count:this.rdfStorage.getTypeCount(e),children:[]}];case 4:return i=r.sent(),console.warn(i),[2,null];case 5:return[2]}}))}))})),[4,Promise.all(t)];case 2:return[2,i.sent().filter((function(e){return e}))]}}))}))},RDFDataProvider.prototype.linkTypesInfo=function(e){return r.__awaiter(this,void 0,Promise,(function(){var t,n=this;return r.__generator(this,(function(i){switch(i.label){case 0:return[4,this.waitInitCompleted()];case 1:return i.sent(),t=e.linkTypeIds.map((function(e){return r.__awaiter(n,void 0,void 0,(function(){var t,n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),[4,this.rdfStorage.checkElement(e)];case 1:return t=r.sent(),[4,this.fetchIfNecessary(e,t)];case 2:return r.sent(),[4,this.getLabels(e)];case 3:return n=r.sent(),[2,{id:e,label:{values:n},count:this.rdfStorage.getTypeCount(e)}];case 4:return i=r.sent(),console.warn(i),[2,null];case 5:return[2]}}))}))})),[4,Promise.all(t)];case 2:return[2,i.sent().filter((function(e){return e}))]}}))}))},RDFDataProvider.prototype.linkTypes=function(){return r.__awaiter(this,void 0,Promise,(function(){var e,t,n,i,o,a,l,c,u,d,p,h,f,m,g=this;return r.__generator(this,(function(v){switch(v.label){case 0:return[4,this.waitInitCompleted()];case 1:return v.sent(),e=[],t=this.rdfStorage.match(void 0,s.RDF("type"),s.RDF("Property")),n=this.rdfStorage.match(void 0,s.RDF("type"),s.OWL("ObjectProperty")),[4,Promise.all([t,n])];case 2:for(i=v.sent(),o=i[0],a=i[1],l=new Set,c=function(t){return r.__awaiter(g,void 0,Promise,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return l.has(t.subject.nominalValue)?[3,2]:(l.add(t.subject.nominalValue),[4,this.getLabels(t.subject.nominalValue)]);case 1:n=r.sent(),e.push({id:t.subject.nominalValue,label:{values:n},count:this.rdfStorage.getTypeCount(t.subject.nominalValue)}),r.label=2;case 2:return[2]}}))}))},u=[],d=0,p=o.toArray();d<p.length;d++)m=p[d],u.push(c(m));for(h=0,f=a.toArray();h<f.length;h++)m=f[h],u.push(c(m));return[4,Promise.all(u)];case 3:return v.sent(),[2,e]}}))}))},RDFDataProvider.prototype.elementInfo=function(e){return r.__awaiter(this,void 0,Promise,(function(){var t,n,i,o,a,s,l=this;return r.__generator(this,(function(c){switch(c.label){case 0:return[4,this.waitInitCompleted()];case 1:return c.sent(),t={},n=e.elementIds.map((function(e){return r.__awaiter(l,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this.rdfStorage.checkElement(e)];case 1:return t=r.sent(),[4,this.fetchIfNecessary(e,t)];case 2:return r.sent(),[2,this.getElementInfo(e)];case 3:return n=r.sent(),console.warn(n),[2,null];case 4:return[2]}}))}))})),[4,Promise.all(n)];case 2:for(i=c.sent(),o=0,a=i;o<a.length;o++)(s=a[o])&&(t[s.id]=s);return[2,t]}}))}))},RDFDataProvider.prototype.linksInfo=function(e){return r.__awaiter(this,void 0,Promise,(function(){var t,n,o,a,s,l,c,u,d,p=this;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.waitInitCompleted()];case 1:for(r.sent(),t=[],n=function(n){for(var _loop_4=function(e){t.push(Promise.all([o.rdfStorage.checkElement(n).then((function(e){return p.fetchIfNecessary(n,e)})),o.rdfStorage.checkElement(e).then((function(t){return p.fetchIfNecessary(e,t)}))]).then((function(){return{subject:n,object:e}})).catch((function(e){return console.warn(e),null})))},r=0,i=e.elementIds;r<i.length;r++){_loop_4(i[r])}},o=this,a=0,s=e.elementIds;a<s.length;a++)l=s[a],n(l);return[4,Promise.all(t)];case 2:return c=r.sent(),[4,this.rdfStorage.matchAll(c.filter((function(e){return e})))];case 3:return u=r.sent(),d=this.options.acceptBlankNodes?u.toArray():u.toArray().filter((function(e){return i.isNamedNode(e.subject)&&i.isNamedNode(e.object)})),[2,d.map((function(e){return{linkTypeId:e.predicate.nominalValue,sourceId:e.subject.nominalValue,targetId:e.object.nominalValue}}))]}}))}))},RDFDataProvider.prototype.linkTypesOf=function(e){return r.__awaiter(this,void 0,Promise,(function(){var t,n,o,a,s,l,c,u,d,p,h,f,m;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.waitInitCompleted()];case 1:return r.sent(),t=[],n=e.elementId,o={},[4,this.rdfStorage.match(null,null,n)];case 2:for(a=r.sent(),s=a.toArray().filter((function(e){return i.isNamedNode(e.subject)})).map((function(e){return e.predicate})),l=0,c=s;l<c.length;l++)f=c[l],m=f.nominalValue,o[m]?o[m].inCount++:(o[m]={id:m,inCount:1,outCount:0},t.push(o[m]));return[4,this.rdfStorage.match(n,null,null)];case 3:for(u=r.sent(),d=u.toArray().filter((function(e){return i.isNamedNode(e.object)})).map((function(e){return e.predicate})),p=0,h=d;p<h.length;p++)f=h[p],m=f.nominalValue,o[m]?o[m].outCount++:(o[m]={id:m,inCount:0,outCount:1},t.push(o[m]));return[2,t]}}))}))},RDFDataProvider.prototype.linkElements=function(e){return r.__awaiter(this,void 0,Promise,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this.waitInitCompleted()];case 1:return t.sent(),[4,this.filter({refElementId:e.elementId,refElementLinkId:e.linkId,linkDirection:e.direction,limit:e.limit,offset:e.offset,languageCode:""})];case 2:return[2,t.sent()]}}))}))},RDFDataProvider.prototype.filter=function(e){return r.__awaiter(this,void 0,Promise,(function(){var t,n,o,a,s,l,c;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.waitInitCompleted()];case 1:return r.sent(),void 0===e.limit&&(e.limit=100),t=function(e,t){return(a||i.isNamedNode(e))&&n<=t&&t<o},n=e.offset,o=e.offset+e.limit,a=this.options.acceptBlankNodes,e.elementTypeId?(s=this.filterByTypeId(e.elementTypeId,t),[3,7]):[3,2];case 2:return e.refElementId&&e.refElementLinkId?(s=this.filterByRefAndLink(e.refElementId,e.refElementLinkId,e.linkDirection,t),[3,7]):[3,3];case 3:return e.refElementId?(s=this.filterByRef(e.refElementId,t),[3,7]):[3,4];case 4:return e.text?[4,this.getAllElements(e.text,t)]:[3,6];case 5:return l=r.sent(),[2,this.filterByKey(void 0,l)];case 6:return[2,{}];case 7:return[4,s];case 8:return c=r.sent(),[2,this.filterByKey(e.text,c)]}}))}))},RDFDataProvider.prototype.filterByTypeId=function(e,t){return r.__awaiter(this,void 0,Promise,(function(){var n,i=this;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.rdfStorage.match(void 0,s.RDF("type"),e)];case 1:return n=r.sent(),[2,Promise.all(n.toArray().filter((function(e,n){return t(e.subject,n)})).map((function(e){return i.getElementInfo(e.subject.nominalValue,!0)})))]}}))}))},RDFDataProvider.prototype.filterByRefAndLink=function(e,t,n,i){return r.__awaiter(this,void 0,Promise,(function(){var o,a=this;return r.__generator(this,(function(r){switch(r.label){case 0:return"in"!==n?[3,2]:[4,this.rdfStorage.match(null,t,e)];case 1:return o=r.sent(),[2,Promise.all(o.toArray().filter((function(e,t){return i(e.subject,t)})).map((function(e){return a.getElementInfo(e.subject.nominalValue,!0)})))];case 2:return[4,this.rdfStorage.match(e,t,null)];case 3:return o=r.sent(),[2,Promise.all(o.toArray().filter((function(e,t){return i(e.object,t)})).map((function(e){return a.getElementInfo(e.object.nominalValue,!0)})))]}}))}))},RDFDataProvider.prototype.filterByRef=function(e,t){return r.__awaiter(this,void 0,Promise,(function(){var n,i,o,a,s=this;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.rdfStorage.match(null,null,e)];case 1:return n=r.sent(),[4,Promise.all(n.toArray().filter((function(e,n){return t(e.subject,n)})).map((function(e){return s.getElementInfo(e.subject.nominalValue,!0)})))];case 2:return i=r.sent(),[4,this.rdfStorage.match(e,null,null)];case 3:return o=r.sent(),[4,Promise.all(o.toArray().filter((function(e,n){return t(e.object,n)})).map((function(e){return s.getElementInfo(e.object.nominalValue,!0)})))];case 4:return a=r.sent(),[2,i.concat(a)]}}))}))},RDFDataProvider.prototype.getAllElements=function(e,t){return r.__awaiter(this,void 0,Promise,(function(){var n,o,a,s,l,c,u,d;return r.__generator(this,(function(r){switch(r.label){case 0:return n=e?e.toLowerCase():null,[4,this.rdfStorage.match(null,null,null)];case 1:for(o=r.sent(),a=[],s=0,l=o.toArray();s<l.length;s++)c=l[s],t(c.subject,a.length)&&(u="Literal"===c.object.interfaceName,d=i.isLabelType(c.predicate.nominalValue),(d&&-1!==c.object.nominalValue.toLowerCase().indexOf(n)||!u&&-1!==c.subject.nominalValue.toLowerCase().indexOf(n))&&a.push(this.getElementInfo(c.subject.nominalValue,!0)));return[2,Promise.all(a)]}}))}))},RDFDataProvider.prototype.filterByKey=function(e,t){var n={},r=e?e.toLowerCase():null;if(r)for(var i=0,o=t;i<o.length;i++){for(var a=!1,s=0,l=(p=o[i]).label.values;s<l.length;s++){var c=l[s];if(a=a||-1!==c.value.toLowerCase().indexOf(r))break}(a=a||-1!==p.id.toLowerCase().indexOf(r))&&(n[p.id]=p)}else for(var u=0,d=t;u<d.length;u++){var p;n[(p=d[u]).id]=p}return n},RDFDataProvider.prototype.checkElement=function(e){return this.dataFetching?this.rdfStorage.checkElement(e):Promise.resolve(!0)},RDFDataProvider.prototype.fetchIfNecessary=function(e,t){var n=this;return t||!this.dataFetching?Promise.resolve():this.rdfLoader.downloadElement(e).then((function(e){n.rdfStorage.add(e)})).catch((function(e){console.warn(e)}))},RDFDataProvider.prototype.getElementInfo=function(e,t){return Promise.all([this.getTypes(e),t?Promise.resolve({}):this.getProps(e),this.getLabels(e)]).then((function(t){var n=t[0],r=t[1],i=t[2];return{id:e,types:n,label:{values:i},properties:r}}))},RDFDataProvider.prototype.getLabels=function(e){return this.rdfStorage.getLabels(e).then((function(e){return e.toArray().map((function(e){return{value:e.object.nominalValue,language:i.isLiteral(e.object)&&e.object.language||""}}))}))},RDFDataProvider.prototype.getProps=function(e){return this.rdfStorage.match(e,null,null).then((function(e){for(var t={},n=0,o=e.toArray();n<o.length;n++){var a=o[n];if(i.isLiteral(a.object)&&a.predicate.nominalValue!==s.RDFS("label")){var l=t[a.predicate.nominalValue],c={text:a.object.nominalValue,lang:a.object.language||""};t[a.predicate.nominalValue]={type:"string",values:l?r.__spreadArrays(l.values,[c]):[c]}}}return t}))},RDFDataProvider.prototype.getTypes=function(e){return this.rdfStorage.match(e,s.RDF("type"),null).then((function(e){return e.toArray().map((function(e){return e.object.nominalValue}))}))},RDFDataProvider.prototype.createEmptyClass=function(e){return{id:e,label:{values:[]},count:this.rdfStorage.getTypeCount(e),children:[]}},RDFDataProvider}();t.RDFDataProvider=l},3173:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(1967),i=n(16);function prefixFactory(e){var t=e[e.length-1],n="/"===t||"#"===t?e:e+"/";return function(e){return n+e}}function isLiteral(e){return"Literal"===e.interfaceName}function isNamedNode(e){return"NamedNode"===e.interfaceName}function isLabelType(e){var n=-1!==t.LABEL_URIS.indexOf(e),r=e.toLocaleLowerCase(),i=Boolean(t.LABEL_POSTFIXES.find((function(e,t,n){var i=e.toLocaleLowerCase();return-1!==r.indexOf(i)})));return n||i}t.prefixFactory=prefixFactory,t.isLiteral=isLiteral,t.isNamedNode=isNamedNode,t.LABEL_URIS=["http://www.w3.org/2004/02/skos/core#prefLabel","http://www.w3.org/2004/02/skos/core#label","http://www.w3.org/2004/02/skos/core#altLabel","http://www.w3.org/2000/01/rdf-schema#prefLabel","http://www.w3.org/2000/01/rdf-schema#label","http://xmlns.com/foaf/0.1/name","http://schema.org/name"],t.LABEL_POSTFIXES=["prefLabel","prefName","label","name","title"],t.isLabelType=isLabelType;var o=function(){function RDFCacheableStore(e){this.checkingElementMap={},this.labelsMap={},this.countMap={},this.elementTypes={},this.parser=e.parser,this.acceptBlankNodes=Boolean(e.acceptBlankNodes),this.rdfStorage=r.createStore(),this.prefs={RDF:prefixFactory("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),RDFS:prefixFactory("http://www.w3.org/2000/01/rdf-schema#"),FOAF:prefixFactory("http://xmlns.com/foaf/0.1/"),XSD:prefixFactory("http://www.w3.org/2001/XMLSchema#"),OWL:prefixFactory("http://www.w3.org/2002/07/owl#")}}return RDFCacheableStore.prototype.add=function(e,t){this.rdfStorage.add(i.uniqueId(t)||i.uniqueId("http://ontodia.org/defaultGraph"),e),this.enrichMaps(e)},RDFCacheableStore.prototype.match=function(e,n,r,i,o,a){return e&&-1!==t.LABEL_URIS.indexOf(n)&&!r?Promise.resolve(this._getLabels(e)):e&&n===this.prefs.RDF("type")&&!r?Promise.resolve(this.getTypes(e)):this.rdfStorage.match(e,n,r,i,o,a)},RDFCacheableStore.prototype.matchAll=function(e){var n=this,r=[],i=[];return e.forEach((function(e){e.subject&&-1!==t.LABEL_URIS.indexOf(e.predicate)&&!e.object?i.push(n._getLabels(e.subject)):e.subject&&e.predicate===n.prefs.RDF("type")&&!e.object?i.push(n.getTypes(e.subject)):r.push(e)})),i.push(this.multipleMatch(r)),Promise.resolve(this.combineGraphs(i))},RDFCacheableStore.prototype.getLabels=function(e){return Promise.resolve(r.createGraph(this.labelsMap[e]))},RDFCacheableStore.prototype.checkElement=function(e){return this.labelsMap[e]?Promise.resolve(!0):(this.checkingElementMap[e]||(this.checkingElementMap[e]=this.rdfStorage.match(e,null,null).then((function(e){return 0!==e.toArray().length}))),this.checkingElementMap[e])},RDFCacheableStore.prototype.getTypeCount=function(e){return this.countMap[e]||0},RDFCacheableStore.prototype.enrichMaps=function(e){for(var n=this,r=0,i=e.toArray();r<i.length;r++){var o=i[r],a=o.subject.nominalValue;isLabelType(o.predicate.nominalValue)&&(this.labelsMap[a]||(this.labelsMap[a]=[]),isLiteral(o.object)&&(this.labelsMap[a].push(o),this.labelsMap[a].sort((function(e,n){var r=t.LABEL_URIS.indexOf(e.predicate.nominalValue),i=t.LABEL_URIS.indexOf(n.predicate.nominalValue);return r>i?1:r<i?-1:0}))))}for(var s=e.match(null,this.prefs.RDF("type"),null).toArray(),l={},c=0,u=s;c<u.length;c++){var d=u[c],p=d.object.nominalValue,h=d.subject.nominalValue;l[p]||(l[p]=[]),(this.acceptBlankNodes||isNamedNode(d.subject))&&(this.elementTypes[h]||(this.elementTypes[h]=[]),-1===l[p].indexOf(h)&&l[p].push(h),this.elementTypes[h].push(d))}return Object.keys(l).forEach((function(e){return n.countMap[e]=l[e].length})),!0},RDFCacheableStore.prototype._getLabels=function(e){return r.createGraph(this.labelsMap[e])},RDFCacheableStore.prototype.getTypes=function(e){return r.createGraph(this.elementTypes[e])},RDFCacheableStore.prototype.combineGraphs=function(e){for(var t=[],n=0,i=e;n<i.length;n++)for(var o=0,a=i[n].toArray();o<a.length;o++){var s=a[o];t.push(s)}return r.createGraph(t)},RDFCacheableStore.prototype.multipleMatch=function(e){for(var t=this,n=[],i=0,o=Object.keys(this.rdfStorage.graphs).map((function(e){return t.rdfStorage.graphs[e]}));i<o.length;i++)for(var a=0,s=o[i]._graph;a<s.length;a++)for(var l=s[a],c=0,u=e;c<u.length;c++){var d=u[c];d.object&&d.object!==l.object.nominalValue||d.predicate&&d.predicate!==l.predicate.nominalValue||d.subject&&d.subject!==l.subject.nominalValue||n.push(l)}return r.createGraph(n)},RDFCacheableStore}();t.RDFCacheableStore=o},3202:function(e,t){},3203:function(e,t){},3253:function(e,t){},3255:function(e,t){},3263:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_PROXY="/lod-proxy/";var n=function(){function RDFLoader(e){this.fetchingFileCatche={},this.parser=e.parser,this.proxy=e.proxy||t.DEFAULT_PROXY}return RDFLoader.prototype.parseData=function(e,t,n){return this.parser.parse(e,t)},RDFLoader.prototype.downloadElement=function(e){var t=this,n=e.indexOf("#"),r=-1!==n?e.substr(0,n):e,i=0,o=Object.keys(this.parser.parserMap),recursivePart=function(){var n=o[i++];if(n&&(e.startsWith("http")||e.startsWith("file")))return function fetchFile(e){return fetch(e.proxy+e.url,{method:"GET",credentials:"same-origin",mode:"cors",cache:"default",headers:e.headers||{Accept:"application/rdf+xml"}}).then((function(e){if(e.ok)return e.text();var t=new Error(e.statusText);throw t.response=e,t}))}({url:e,proxy:t.proxy,headers:{Accept:n}}).then((function(r){return t.parseData(r,n,e).catch((function(e){if(console.warn(e),i<o.length)return recursivePart();throw new Error("Unable to parse response. Response: "+r)}))}));throw new Error("Unable to fetch data using this id ("+e+")")};return this.fetchingFileCatche[r]||(this.fetchingFileCatche[r]=recursivePart()),this.fetchingFileCatche[r]},RDFLoader}();t.RDFLoader=n},3264:function(e,t){function workaroundForRDFXmlParser(e){return e.replace(/parseType=["']Collection["']/gi,'parseType="Collection1"')}Object.defineProperty(t,"__esModule",{value:!0});var n={xml:"application/rdf+xml",rdf:"application/rdf+xml",owl:"application/rdf+xml",nttl:"application/x-turtle",jsonld:"application/ld+json",rj:"application/ld+json",ttl:"text/turtle",nt:"text/turtle",nq:"text/turtle"};var r=function(){function RDFCompositeParser(e){this.parserMap=e}return RDFCompositeParser.prototype.parse=function(e,t,n){if(t){if("application/rdf+xml"===t&&(e=workaroundForRDFXmlParser(e)),!this.parserMap[t])throw Error("There is no parser for this MIME type");return this.parserMap[t].parse(e)}return this.tryToGuessMimeType(e,n)},RDFCompositeParser.prototype.tryToGuessMimeType=function(e,t){var r=this,i=0,o=Object.keys(this.parserMap);if(t){var a=function getMimeTypeByFileName(e){var t=(e.match(/\.([\S]*)$/i)||[])[1];return t?n[t]:void 0}(t);a&&(o=[a].concat(o.filter((function(e){return e!==a}))))}var s=[],recursion=function(){if(!(i<o.length))throw new Error("Unknow mime type. Parse errors:\n"+s.map((function(e){return e.mimeType+": "+e.error.message+" "+e.error.stack+";\n"})).join("\n"));var t=o[i++];try{var n="application/rdf+xml"===t?workaroundForRDFXmlParser(e):e;return r.parserMap[t].parse(n).catch((function(e){return s.push({mimeType:t,error:e}),recursion()}))}catch(e){return recursion()}};return recursion()},RDFCompositeParser}();t.RDFCompositeParser=r},3265:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(11),o=n(1623),a=n(3266),s=n(2317),l=n(1965),c=n(2318);!function(e){e[e.GET=1]="GET",e[e.POST=2]="POST"}(r=t.SparqlQueryMethod||(t.SparqlQueryMethod={}));var u=function(){function SparqlDataProvider(e,t){void 0===t&&(t=s.OWLStatsSettings),this.linkByPredicate=new Map,this.linkById=new Map,this.propertyByPredicate=new Map;var n=e.queryFunction,r=void 0===n?queryInternal:n;this.options=i.__assign(i.__assign({},e),{queryFunction:r}),this.settings=t;for(var l=0,c=t.linkConfigurations;l<c.length;l++){var u=c[l];this.linkById.set(u.id,u);var d=a.isDirectLink(u)?u.path:u.id;o.getOrCreateArrayInMap(this.linkByPredicate,d).push(u)}this.openWorldLinks=0===t.linkConfigurations.length||Boolean(t.openWorldLinks);for(var p=0,h=t.propertyConfigurations;p<h.length;p++){var f=h[p];d=a.isDirectProperty(f)?f.path:f.id;o.getOrCreateArrayInMap(this.propertyByPredicate,d).push(f)}this.openWorldProperties=0===t.propertyConfigurations.length||Boolean(t.openWorldProperties)}return SparqlDataProvider.prototype.classTree=function(){return i.__awaiter(this,void 0,Promise,(function(){var e,t,n,r,o,s,l;return i.__generator(this,(function(i){switch(i.label){case 0:return e=this.settings,t=e.defaultPrefix,n=e.schemaLabelProperty,(r=e.classTreeQuery)?(o=t+resolveTemplate(r,{schemaLabelProperty:n}),[4,this.executeSparqlQuery(o)]):[2,[]];case 1:return s=i.sent(),l=a.getClassTree(s),this.options.prepareLabels?[4,attachLabels(a.flattenClassTree(l),this.options.prepareLabels)]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2,l]}}))}))},SparqlDataProvider.prototype.propertyInfo=function(e){return i.__awaiter(this,void 0,Promise,(function(){var t,n,r,s,l,c,u,d,p,h,f;return i.__generator(this,(function(i){switch(i.label){case 0:return t=this.settings,n=t.defaultPrefix,r=t.schemaLabelProperty,(s=t.propertyInfoQuery)?(c=e.propertyIds.map(escapeIri).map((function(e){return" ( "+e+" )"})).join(" "),u=n+resolveTemplate(s,{ids:c,schemaLabelProperty:r}),[4,this.executeSparqlQuery(u)]):[3,2];case 1:return d=i.sent(),l=a.getPropertyInfo(d),[3,3];case 2:for(l={},p=0,h=e.propertyIds;p<h.length;p++)f=h[p],l[f]={id:f,label:{values:[]}};i.label=3;case 3:return this.options.prepareLabels?[4,attachLabels(o.objectValues(l),this.options.prepareLabels)]:[3,5];case 4:i.sent(),i.label=5;case 5:return[2,l]}}))}))},SparqlDataProvider.prototype.classInfo=function(e){return i.__awaiter(this,void 0,Promise,(function(){var t,n,r,o,s,l,c,u;return i.__generator(this,(function(i){switch(i.label){case 0:return t=this.settings,n=t.defaultPrefix,r=t.schemaLabelProperty,(o=t.classInfoQuery)?(l=e.classIds.map(escapeIri).map((function(e){return" ( "+e+" )"})).join(" "),c=n+resolveTemplate(o,{ids:l,schemaLabelProperty:r}),[4,this.executeSparqlQuery(c)]):[3,2];case 1:return u=i.sent(),s=a.getClassInfo(u),[3,3];case 2:s=e.classIds.map((function(e){return{id:e,label:{values:[]},children:[]}})),i.label=3;case 3:return this.options.prepareLabels?[4,attachLabels(s,this.options.prepareLabels)]:[3,5];case 4:i.sent(),i.label=5;case 5:return[2,s]}}))}))},SparqlDataProvider.prototype.linkTypesInfo=function(e){return i.__awaiter(this,void 0,Promise,(function(){var t,n,r,o,s,l,c,u;return i.__generator(this,(function(i){switch(i.label){case 0:return t=this.settings,n=t.defaultPrefix,r=t.schemaLabelProperty,(o=t.linkTypesInfoQuery)?(l=e.linkTypeIds.map(escapeIri).map((function(e){return" ( "+e+" )"})).join(" "),c=n+resolveTemplate(o,{ids:l,schemaLabelProperty:r}),[4,this.executeSparqlQuery(c)]):[3,2];case 1:return u=i.sent(),s=a.getLinkTypes(u),[3,3];case 2:s=e.linkTypeIds.map((function(e){return{id:e,label:{values:[]}}})),i.label=3;case 3:return this.options.prepareLabels?[4,attachLabels(s,this.options.prepareLabels)]:[3,5];case 4:i.sent(),i.label=5;case 5:return[2,s]}}))}))},SparqlDataProvider.prototype.linkTypes=function(){return i.__awaiter(this,void 0,Promise,(function(){var e,t,n,r,o,s,l,c;return i.__generator(this,(function(i){switch(i.label){case 0:return e=this.settings,t=e.defaultPrefix,n=e.schemaLabelProperty,r=e.linkTypesQuery,o=e.linkTypesPattern,r?(s=t+resolveTemplate(r,{linkTypesPattern:o,schemaLabelProperty:n}),[4,this.executeSparqlQuery(s)]):[2,[]];case 1:return l=i.sent(),c=a.getLinkTypes(l),this.options.prepareLabels?[4,attachLabels(c,this.options.prepareLabels)]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2,c]}}))}))},SparqlDataProvider.prototype.elementInfo=function(e){return i.__awaiter(this,void 0,Promise,(function(){var t,n,r,s,c,u,d,p,h,f,m,g,v,y,k;return i.__generator(this,(function(i){switch(i.label){case 0:return t=e.elementIds.filter((function(e){return!l.isEncodedBlank(e)})),n=this.options.acceptBlankNodes?l.elementInfo(e.elementIds):void 0,t.length>0?(s=t.map(escapeIri).map((function(e){return" ("+e+")"})).join(" "),c=this.settings,u=c.defaultPrefix,d=c.dataLabelProperty,p=c.elementInfoQuery,h=u+resolveTemplate(p,{ids:s,dataLabelProperty:d,propertyConfigurations:this.formatPropertyInfo()}),[4,this.executeSparqlConstruct(h)]):[3,2];case 1:return r=i.sent(),[3,3];case 2:r=[],i.label=3;case 3:return f=this.queryManyElementTypes(this.settings.propertyConfigurations.length>0?e.elementIds:[]),m=a.triplesToElementBinding(r),g=a.prependAdditionalBindings(m,n),y=a.getElementsInfo,k=[g],[4,f];case 4:return v=y.apply(void 0,k.concat([i.sent(),this.propertyByPredicate,this.openWorldProperties])),this.options.prepareLabels?[4,attachLabels(o.objectValues(v),this.options.prepareLabels)]:[3,6];case 5:i.sent(),i.label=6;case 6:return this.options.prepareImages?[4,(E=this.options.prepareImages,b=v,E(b).then((function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&b[t]&&(b[t].image=e[t])})))]:[3,8];case 7:return i.sent(),[3,10];case 8:return this.options.imagePropertyUris&&this.options.imagePropertyUris.length?[4,this.attachImages(v,this.options.imagePropertyUris)]:[3,10];case 9:i.sent(),i.label=10;case 10:return[2,v]}var E,b}))}))},SparqlDataProvider.prototype.attachImages=function(e,t){return i.__awaiter(this,void 0,Promise,(function(){var n,r,o,s,c;return i.__generator(this,(function(i){switch(i.label){case 0:n=Object.keys(e).filter((function(e){return!l.isEncodedBlank(e)})).map(escapeIri).map((function(e){return" ( "+e+" )"})).join(" "),r=t.map(escapeIri).map((function(e){return" ( "+e+" )"})).join(" "),o=this.settings.defaultPrefix+"\n            SELECT ?inst ?linkType ?image\n            WHERE {{\n                VALUES (?inst) {"+n+"}\n                VALUES (?linkType) {"+r+"}\n                "+this.settings.imageQueryPattern+"\n            }}\n        ",i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.executeSparqlQuery(o)];case 2:return s=i.sent(),a.enrichElementsWithImages(s,e),[3,4];case 3:return c=i.sent(),console.error(c),[3,4];case 4:return[2]}}))}))},SparqlDataProvider.prototype.linksInfo=function(e){return i.__awaiter(this,void 0,Promise,(function(){var t,n,r,o,s,c,u,d,p,h,f;return i.__generator(this,(function(i){switch(i.label){case 0:return t=e.elementIds.filter((function(e){return!l.isEncodedBlank(e)})),n=this.options.acceptBlankNodes?l.linksInfo(e.elementIds):void 0,r=this.formatLinkLinks(),t.length>0?(c=t.map(escapeIri).map((function(e){return" ( "+e+" )"})).join(" "),u=this.settings.defaultPrefix+resolveTemplate(this.settings.linksInfoQuery,{ids:c,linkConfigurations:r}),o=this.executeSparqlQuery(u),s=this.queryManyElementTypes(e.elementIds)):(o=Promise.resolve({head:{vars:[]},results:{bindings:[]}}),s=this.queryManyElementTypes([])),p=a.prependAdditionalBindings,[4,o];case 1:return d=p.apply(void 0,[i.sent(),n]),h=a.getLinksInfo,f=[d],[4,s];case 2:return[2,h.apply(void 0,f.concat([i.sent(),this.linkByPredicate,this.openWorldLinks]))]}}))}))},SparqlDataProvider.prototype.linkTypesOf=function(e){return i.__awaiter(this,void 0,Promise,(function(){var t,n,r,o,s,c,u,d,p,h,f,m,g,v=this;return i.__generator(this,(function(y){switch(y.label){case 0:return this.options.acceptBlankNodes&&l.isEncodedBlank(e.elementId)?[2,Promise.resolve(a.getLinksTypesOf(l.linkTypesOf(e)))]:(t=this.settings,n=t.defaultPrefix,r=t.linkTypesOfQuery,o=t.linkTypesStatisticsQuery,s=t.filterTypePattern,c=escapeIri(e.elementId),(u=this.formatLinkUnion(e.elementId,void 0,void 0,"?outObject","?inObject",!1)).usePredicatePart&&(u.unionParts.push("{ "+c+" ?link ?outObject }"),u.unionParts.push("{ ?inObject ?link "+c+" }")),d=n+resolveTemplate(r,{elementIri:c,linkConfigurations:u.unionParts.join("\nUNION\n")}),[4,this.executeSparqlQuery(d)]);case 1:return p=y.sent(),h=a.getLinksTypeIds(p,this.linkByPredicate,this.openWorldLinks),f=this.options.acceptBlankNodes?"FILTER (IsIri(?outObject) || IsBlank(?outObject))":"FILTER IsIri(?outObject)",m=this.options.acceptBlankNodes?"FILTER (IsIri(?inObject) || IsBlank(?inObject))":"FILTER IsIri(?inObject)",g=[],[4,Promise.all(h.map((function(e){return i.__awaiter(v,void 0,void 0,(function(){var t,r,l,u,d,p,h,v,y,k,E;return i.__generator(this,(function(i){switch(i.label){case 0:return!(t=this.linkById.get(e))||a.isDirectLink(t)?(u=escapeIri(t&&a.isDirectLink(t)?t.path:e),r=c+" "+u+" ?outObject",l="?inObject "+u+" "+c):(r=this.formatLinkPath(t.path,c,"?outObject"),l=this.formatLinkPath(t.path,"?inObject",c)),t&&(null===(E=t.domain)||void 0===E?void 0:E.length)>0&&(d=t.domain.map(escapeIri).join(", "),p=s.replace(/[?$]inst\b/g,c),h=s.replace(/[?$]inst\b/g,"?inObject"),r+=" { "+p+" FILTER(?class IN ("+d+")) }",l+=" { "+h+" FILTER(?class IN ("+d+")) }"),v=n+resolveTemplate(o,{linkId:escapeIri(e),elementIri:c,linkConfigurationOut:r,linkConfigurationIn:l,navigateElementFilterOut:f,navigateElementFilterIn:m}),[4,this.executeSparqlQuery(v)];case 1:return y=i.sent(),(k=a.getLinkStatistics(y))&&g.push(k),[2]}}))}))})))];case 2:return y.sent(),[2,g]}}))}))},SparqlDataProvider.prototype.linkElements=function(e){return this.filter({refElementId:e.elementId,refElementLinkId:e.linkId,linkDirection:e.direction,limit:e.limit,offset:e.offset,languageCode:""})},SparqlDataProvider.prototype.filter=function(e){return i.__awaiter(this,void 0,Promise,(function(){var t,n,r,s,c,u,d,p,h,f,m,g=this;return i.__generator(this,(function(v){switch(v.label){case 0:return void 0===(t=i.__assign({},e)).limit&&(t.limit=100),n=this.querySingleElementTypes(t.refElementId&&this.settings.linkConfigurations.length>0?t.refElementId:void 0),(r=this.options.acceptBlankNodes?l.filter(t):void 0)&&r.results.bindings.length>0?(s=a.getFilteredData,c=[r],[4,n]):[3,2];case 1:return[2,s.apply(void 0,c.concat([v.sent(),this.linkByPredicate,this.openWorldLinks]))];case 2:return u=this.createFilterQuery(t),[4,this.executeSparqlQuery(u)];case 3:return d=v.sent(),this.options.acceptBlankNodes?[4,l.updateFilterResults(d,(function(e){return g.executeSparqlQuery(e)}),this.settings)]:[3,5];case 4:return p=v.sent(),[3,6];case 5:p=d,v.label=6;case 6:return f=a.getFilteredData,m=[p],[4,n];case 7:return h=f.apply(void 0,m.concat([v.sent(),this.linkByPredicate,this.openWorldLinks])),this.options.prepareLabels?[4,attachLabels(o.objectValues(h),this.options.prepareLabels)]:[3,9];case 8:v.sent(),v.label=9;case 9:return[2,h]}}))}))},SparqlDataProvider.prototype.createFilterQuery=function(e){if(!e.refElementId&&e.refElementLinkId)throw new Error("Cannot execute refElementLink filter without refElement");var t="?inst ?class ?label ?blankType",n="?inst ?localName",r="",i="";e.refElementId&&(t+=" ?link ?direction",n+=" ?link ?direction",r=this.createRefQueryPart({elementId:e.refElementId,linkId:e.refElementLinkId,direction:e.linkDirection}),this.settings.linkConfigurations.length>0&&(t+=" ?classAll",i=this.settings.filterTypePattern.replace(/[?$]class\b/g,"?classAll")));var o="";if(e.elementTypeId){var a=escapeIri(e.elementTypeId);o=this.settings.filterTypePattern.replace(/[?$]class\b/g,a)}var s=this.settings,c=s.defaultPrefix,u=s.fullTextSearch,d=s.dataLabelProperty,p="";e.text&&(n+=" ?score",this.settings.fullTextSearch.extractLabel&&(p+=function sparqlExtractLabel(e,t){return"\n        BIND ( str( "+e+' ) as ?uriStr)\n        BIND ( strafter(?uriStr, "#") as ?label3)\n        BIND ( strafter(strafter(?uriStr, "//"), "/") as ?label6)\n        BIND ( strafter(?label6, "/") as ?label5)\n        BIND ( strafter(?label5, "/") as ?label4)\n        BIND (if (?label3 != "", ?label3,\n            if (?label4 != "", ?label4,\n            if (?label5 != "", ?label5, ?label6))) as '+t+")\n    "}("?inst","?extractedLabel")),p=resolveTemplate(u.queryPattern,{text:e.text,dataLabelProperty:d}));var h=this.options.acceptBlankNodes;return h&&(t+=" "+l.BLANK_NODE_QUERY_PARAMETERS),c+"\n            "+u.prefix+"\n\n        SELECT DISTINCT "+t+"\n        WHERE {\n            {\n                SELECT DISTINCT "+n+" WHERE {\n                    "+o+"\n                    "+r+"\n                    "+p+"\n                    "+this.settings.filterAdditionalRestriction+"\n                    BIND(REPLACE(LCASE(STR(?inst)), '(^.*)(#|/)([^/]*)$', '$3') AS ?localName)\n                    OPTIONAL { ?inst "+d+" ?label }\n                }\n                ORDER BY "+(p?"DESC(?score)":"")+" ASC(STR(LCASE(?label))) ASC(?localName)\n                LIMIT "+e.limit+" OFFSET "+e.offset+"\n            }\n            "+i+"\n            "+resolveTemplate(this.settings.filterElementInfoPattern,{dataLabelProperty:d})+"\n            "+(h?l.BLANK_NODE_QUERY:"")+"\n        }\n        ORDER BY "+(p?"DESC(?score)":"")+" ASC(STR(LCASE(?label))) ASC(?localName)\n        "},SparqlDataProvider.prototype.executeSparqlQuery=function(e){var t=this.options.queryMethod?this.options.queryMethod:r.GET;return executeSparqlQuery(this.options.endpointUrl,e,t,this.options.queryFunction)},SparqlDataProvider.prototype.executeSparqlConstruct=function(e){var t=this.options.queryMethod?this.options.queryMethod:r.GET;return executeSparqlConstruct(this.options.endpointUrl,e,t,this.options.queryFunction)},SparqlDataProvider.prototype.createRefQueryPart=function(e){var t=e.elementId,n=e.linkId,r=e.direction,i=this.formatLinkUnion(t,n,r,"?inst","?inst",!0),o=i.unionParts;if(i.usePredicatePart){var s=escapeIri(e.elementId),l=void 0;if(n){var c=this.linkById.get(n);l=c&&a.isDirectLink(c)?escapeIri(c.path):escapeIri(n)}var u=l||"?link",d=l?"BIND("+l+" as ?link)":"",p=this.options.acceptBlankNodes?"FILTER(isIri(?inst) || isBlank(?inst))":"FILTER(isIri(?inst))";r&&"out"!==r||o.push("{ "+s+" "+u+' ?inst BIND("out" as ?direction) '+d+" "+p+" }"),r&&"in"!==r||o.push("{ ?inst "+u+" "+s+' BIND("in" as ?direction) '+d+" "+p+" }")}var h=0===o.length?"FILTER(false)":o.join("\nUNION\n");return!n&&this.settings.filterRefElementLinkPattern.length>0&&(h+="\n"+this.settings.filterRefElementLinkPattern),h},SparqlDataProvider.prototype.formatLinkUnion=function(e,t,n,r,i,o){for(var s=this.settings.linkConfigurations,l=escapeIri(e),c=[],u=!1,d=0,p=s;d<p.length;d++){var h=p[d];if(!t||h.id===t)if(a.isDirectLink(h))u=!0;else{var f=escapeIri(h.id);if(!n||"out"===n){var m=this.formatLinkPath(h.path,l,r),g=o?'BIND("out" as ?direction) ':"";c.push("{ "+m+" BIND("+f+" as ?link) "+g+"}")}if(!n||"in"===n){m=this.formatLinkPath(h.path,i,l),g=o?'BIND("in" as ?direction) ':"";c.push("{ "+m+" BIND("+f+" as ?link) "+g+"}")}}}return{unionParts:c,usePredicatePart:this.openWorldLinks||u}},SparqlDataProvider.prototype.formatLinkLinks=function(){for(var e=[],t=!1,n=0,r=this.settings.linkConfigurations;n<r.length;n++){var i=r[n];if(a.isDirectLink(i))t=!0;else{var o=escapeIri(i.id);e.push("{ "+this.formatLinkPath(i.path,"?source","?target")+" BIND("+o+" as ?type) }")}}return(this.openWorldLinks||t)&&e.push("{ ?source ?type ?target }"),e.join("\nUNION\n")},SparqlDataProvider.prototype.formatLinkPath=function(e,t,n){return e.replace(/[?$]source\b/g,t).replace(/[?$]target\b/g,n)},SparqlDataProvider.prototype.formatPropertyInfo=function(){for(var e=[],t=!1,n=0,r=this.settings.propertyConfigurations;n<r.length;n++){var i=r[n];if(a.isDirectProperty(i))t=!0;else{var o=escapeIri(i.id),s=this.formatPropertyPath(i.path,"?inst","?propValue");e.push("{ "+s+" BIND("+o+" as ?propType) }")}}return(this.openWorldProperties||t)&&e.push("{ ?inst ?propType ?propValue }"),e.join("\nUNION\n")},SparqlDataProvider.prototype.formatPropertyPath=function(e,t,n){return e.replace(/[?$]inst\b/g,t).replace(/[?$]value\b/g,n)},SparqlDataProvider.prototype.querySingleElementTypes=function(e){return i.__awaiter(this,void 0,Promise,(function(){return i.__generator(this,(function(t){switch(t.label){case 0:return[4,this.queryManyElementTypes(e?[e]:[])];case 1:return[2,t.sent().get(e)]}}))}))},SparqlDataProvider.prototype.queryManyElementTypes=function(e){return i.__awaiter(this,void 0,Promise,(function(){var t,n,r,o,s;return i.__generator(this,(function(i){switch(i.label){case 0:return 0===e.length?[2,new Map]:(t=this.settings.filterTypePattern,n=e.filter((function(e){return!l.isEncodedBlank(e)})).map((function(e){return"("+escapeIri(e)+")"})).join(" "),"\n              SELECT ?inst ?class {\n                VALUES(?inst) { ${ids} }\n                {\n                  ${filterTypePattern}\n                } UNION {\n                  BIND(rdfs:Resource as ?class)\n                }\n              }\n            ",r=resolveTemplate("\n              SELECT ?inst ?class {\n                VALUES(?inst) { ${ids} }\n                {\n                  ${filterTypePattern}\n                } UNION {\n                  BIND(rdfs:Resource as ?class)\n                }\n              }\n            ",{ids:n,filterTypePattern:t}),[4,this.executeSparqlQuery(r)]);case 1:return o=i.sent(),this.options.acceptBlankNodes&&e.find(l.isEncodedBlank)&&(s=l.getElementTypes(e),o=a.prependAdditionalBindings(o,s)),[2,a.getElementTypes(o)]}}))}))},SparqlDataProvider}();function attachLabels(e,t){return i.__awaiter(this,void 0,Promise,(function(){var n,r,o,a,s,c,u;return i.__generator(this,(function(i){switch(i.label){case 0:for(n=new Set,r=0,o=e;r<o.length;r++)u=o[r],l.isEncodedBlank(u.id)||n.add(u.id);return[4,t(n)];case 1:for(a=i.sent(),s=0,c=e;s<c.length;s++)u=c[s],a.has(u.id)&&(u.label={values:a.get(u.id)});return[2]}}))}))}function resolveTemplate(e,t){var n=e;for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];i&&(n=n.replace(new RegExp("\\${"+r+"}","g"),i))}return n}function executeSparqlQuery(e,t,n,i){return(n===r.GET?i({url:appendQueryParams(e,{query:t}),headers:{Accept:"application/sparql-results+json"},method:"GET"}):i({url:e,body:t,headers:{Accept:"application/sparql-results+json","Content-Type":"application/sparql-query; charset=UTF-8"},method:"POST"})).then((function(e){if(e.ok)return e.json();var t=new Error(e.statusText);throw t.response=e,t}))}function executeSparqlConstruct(e,t,n,i){return(n===r.GET?i({url:appendQueryParams(e,{query:t}),headers:{Accept:"text/turtle"},method:"GET"}):i({url:e,body:t,headers:{Accept:"text/turtle","Content-Type":"application/sparql-query; charset=UTF-8"},method:"POST"})).then((function(e){if(e.ok)return e.text();var t=new Error(e.statusText);throw t.response=e,t})).then(c.parseTurtleText)}function appendQueryParams(e,t){void 0===t&&(t={});var n=e.indexOf("?")<0?"?":"&";return e+(n+Object.keys(t).map((function(e){return e+"="+encodeURIComponent(t[e])})).join("&"))}function queryInternal(e){return fetch(e.url,{method:e.method,body:e.body,credentials:"same-origin",mode:"cors",cache:"default",headers:e.headers})}function escapeIri(e){if("string"!=typeof e)throw new Error('Cannot escape IRI of type "'+typeof e+'"');return"<"+e+">"}t.SparqlDataProvider=u,t.executeSparqlQuery=executeSparqlQuery,t.executeSparqlConstruct=executeSparqlConstruct},3266:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1966),o=n(1607),a=n(1623),s="https://ontodia.org/context/v1.json/label",l=new Map;function mapPropertiesByConfig(e,t,n,r){var i={};for(var o in e.properties)if(Object.hasOwnProperty.call(e.properties,o)){var a=n.get(o);if(a&&a.length>0)for(var s=0,l=a;s<l.length;s++){var c=l[s];typeMatchesDomain(c,t)&&(i[c.id]=e.properties[o])}else r&&(i[o]=e.properties[o])}return i}function matchesDomainForLink(e,t,n){if(!t)return!0;var r=!1;return t.forEach((function(t){var i=n.get(t);if(i)for(var o=0,a=i;o<a.length;o++){typeMatchesDomain(a[o],e)&&(r=!0)}})),r}function isDirectLink(e){return!/[?$][a-zA-Z]+\b/.test(e.path)}function typeMatchesDomain(e,t){if(e.domain&&0!==e.domain.length){if(t){for(var n=0,r=e.domain;n<r.length;n++){var i=r[n];if(t.has(i))return!0}return!1}return!1}return!0}function mergeProperties(e,t,n){var a=e[t.value];if(i.isRdfIri(n))a||(a={type:"uri",values:[]}),o.isIriProperty(a)&&a.values.every((function(e){return e.value!==n.value}))&&(a.values=r.__spreadArrays(a.values,[n]));else if(i.isRdfLiteral(n)){a||(a={type:"string",values:[]});var s=getLocalizedString(n);o.isLiteralProperty(a)&&a.values.every((function(e){return!isLocalizedEqual(e,s)}))&&(a.values=r.__spreadArrays(a.values,[s]))}e[t.value]=a}function enrichElement(e,t){if(e){if(t.label){var n=getLocalizedString(t.label);e.label.values.every((function(e){return!isLocalizedEqual(e,n)}))&&e.label.values.push(n)}t.class&&e.types.indexOf(t.class.value)<0&&e.types.push(t.class.value),t.propType&&t.propType.value!==s&&mergeProperties(e.properties,t.propType,t.propValue)}}function appendLabel(e,t){if(t){for(var n=0,r=e.values;n<r.length;n++){if(isLocalizedEqual(r[n],t))return}e.values.push(t)}}function isLocalizedEqual(e,t){return e.language===t.language&&e.value===t.value}function getLocalizedString(e){return e?{value:e.value,language:e["xml:lang"],datatype:e.datatype?{value:e.datatype}:void 0}:void 0}function getInstCount(e){return e?+e.value:void 0}function getPropertyModel(e){var t=getLocalizedString(e.label);return{id:e.property.value,label:{values:t?[t]:[]}}}function getLinkCount(e){return{id:e.link.value,inCount:getInstCount(e.inCount),outCount:getInstCount(e.outCount)}}function emptyElementInfo(e){return{id:e,label:{values:[]},types:[],properties:{}}}function getLinkTypeInfo(e){if(e){var t=getLocalizedString(e.label);return{id:e.link.value,label:{values:t?[t]:[]},count:getInstCount(e.instcount)}}}t.getClassTree=function getClassTree(e){var t=function createClassMap(e){for(var t=new Map,n=0,r=e;n<r.length;n++){var o=r[n];if(i.isRdfIri(o.class)){var a=o.class.value,s=t.get(a);if(s||(s=createEmptyModel(a),t.set(a,s)),o.label&&appendLabel(s.label,getLocalizedString(o.label)),o.parent){var l=o.parent.value;s.parents.add(l)}o.instcount&&(s.count=getInstCount(o.instcount))}}for(var c=0,u=e;c<u.length;c++){if((o=u[c]).parent){l=o.parent.value;t.has(l)||t.set(l,createEmptyModel(l))}}function createEmptyModel(e){return{id:e,children:[],label:{values:[]},count:void 0,parents:new Set}}return t}(e.results.bindings),n=[];t.forEach((function(e){n.push(e),e.parents.forEach((function(n){t.get(n).children.push(e)})),e.parents=void 0}));for(var r=function breakCyclesAndCalculateCounts(e){var t=new Set;return e.reduce((function reduceChildren(e,n){return t.has(n.id)?e:n.children?(t.add(n.id),n.children=n.children.reduce(reduceChildren,[]),t.delete(n.id),n.children.forEach((function(e){var t=e.count;void 0!==t&&(r=void 0===r?t:r+t)})),void 0!==r&&(n.count=void 0===n.count?r:n.count+r),e.push(n),e):void 0;var r}),[])}(n),o=new Set,a=0,s=r;a<s.length;a++)for(var l=0,c=s[a].children;l<c.length;l++){var u=c[l];o.add(u.id)}return r.filter((function(e){return!o.has(e.id)}))},t.flattenClassTree=function flattenClassTree(e){var t=[],visitClasses=function(e){for(var n=0,r=e;n<r.length;n++){var i=r[n];t.push(i),visitClasses(i.children)}};return visitClasses(e),t},t.getClassInfo=function getClassInfo(e){for(var t={},n=0,r=e.results.bindings;n<r.length;n++){var i=r[n];if(i.class)if(c=t[l=i.class.value]){appendLabel(c.label,getLocalizedString(i.label));var o=getInstCount(i.instcount);void 0!==o&&(c.count=Math.max(c.count,o))}else{var a=getLocalizedString(i.label);t[l]={id:l,children:[],label:{values:a?[a]:[]},count:getInstCount(i.instcount)}}}var s=[];for(var l in t)if(t.hasOwnProperty(l)){var c=t[l];s.push(c)}return s},t.getPropertyInfo=function getPropertyInfo(e){for(var t={},n=0,r=e.results.bindings;n<r.length;n++){var i=r[n],o=i.property.value;if(t[o]){if(i.label){var a=t[o].label;1!==a.values.length||a.values[0].language||(a.values=[]),a.values.push(getLocalizedString(i.label))}}else t[o]=getPropertyModel(i)}return t},t.getLinkTypes=function getLinkTypes(e){for(var t=[],n={},r=0,i=e.results.bindings;r<i.length;r++){var o=i[r],a=o.link.value;if(n[a]){if(o.label){var s=n[a].label;1!==s.values.length||s.values[0].language||(s.values=[]),s.values.push(getLocalizedString(o.label))}}else n[a]=getLinkTypeInfo(o),t.push(n[a])}return t},t.triplesToElementBinding=function triplesToElementBinding(e){for(var t={},n={head:{vars:["inst","class","label","blankType","propType","propValue"]},results:{bindings:[]}},r=0,o=e;r<o.length;r++){var a=o[r],l=a.subject.value;t[l]||(t[l]=createAndPushBinding(a)),a.predicate.value===s&&i.isRdfLiteral(a.object)?(t[l].label&&(t[l]=createAndPushBinding(a)),t[l].label=a.object):"https://ontodia.org/context/v1.json/type"===a.predicate.value&&i.isRdfIri(a.object)&&i.isRdfIri(a.predicate)?(t[l].class&&(t[l]=createAndPushBinding(a)),t[l].class=a.object):!i.isRdfBlank(a.object)&&i.isRdfIri(a.predicate)&&(t[l].propType&&(t[l]=createAndPushBinding(a)),t[l].propType=a.predicate,t[l].propValue=a.object)}function createAndPushBinding(e){var t={inst:e.subject};return n.results.bindings.push(t),t}return n},t.getElementsInfo=function getElementsInfo(e,t,n,r){void 0===t&&(t=l),void 0===n&&(n=l),void 0===r&&(r=!0);for(var o={},a=0,s=e.results.bindings;a<s.length;a++){var c=s[a];if(i.isRdfIri(c.inst))(d=o[u=c.inst.value])||(d=emptyElementInfo(u),o[u]=d),enrichElement(d,c)}if(!r||n.size>0)for(var u in o)if(Object.hasOwnProperty.call(o,u)){var d=o[u],p=t.get(d.id);d.properties=mapPropertiesByConfig(d,p,n,r)}return o},t.enrichElementsWithImages=function enrichElementsWithImages(e,t){for(var n=0,r=e.results.bindings;n<r.length;n++){var i=r[n],o=t[i.inst.value];o&&(o.image=i.image.value)}},t.getElementTypes=function getElementTypes(e){for(var t=new Map,n=0,r=e.results.bindings;n<r.length;n++){var o=r[n];if(i.isRdfIri(o.inst)&&i.isRdfIri(o.class)){var s=o.inst.value,l=o.class.value;a.getOrCreateSetInMap(t,s).add(l)}}return t},t.getLinksInfo=function getLinksInfo(e,t,n,i){void 0===t&&(t=l),void 0===n&&(n=l),void 0===i&&(i=!0);for(var s=e.results.bindings,c=new a.HashMap(o.hashLink,o.sameLink),u=0,d=s;u<d.length;u++){var p=d[u],h={sourceId:p.source.value,linkTypeId:p.type.value,targetId:p.target.value,properties:{}};if(c.has(h)){if(p.propType)mergeProperties(c.get(h).properties,p.propType,p.propValue)}else{p.propType&&mergeProperties(h.properties,p.propType,p.propValue);var f=n.get(h.linkTypeId);if(f&&f.length>0)for(var m=0,g=f;m<g.length;m++){var v=g[m];if(typeMatchesDomain(v,t.get(h.sourceId))){var y=isDirectLink(v)?r.__assign(r.__assign({},h),{linkTypeId:v.id}):h;c.set(y,y)}}else i&&c.set(h,h)}}var k=[];return c.forEach((function(e){return k.push(e)})),k},t.getLinksTypesOf=function getLinksTypesOf(e){return e.results.bindings.filter((function(e){return!i.isRdfBlank(e.link)})).map((function(e){return getLinkCount(e)}))},t.getLinksTypeIds=function getLinksTypeIds(e,t,n){void 0===t&&(t=l),void 0===n&&(n=!0);for(var r=[],o=0,a=e.results.bindings;o<a.length;o++){var s=a[o];if(i.isRdfIri(s.link)){var c=t.get(s.link.value);if(c&&c.length>0)for(var u=0,d=c;u<d.length;u++){var p=d[u],h=isDirectLink(p)?p.id:s.link.value;r.push(h)}else n&&r.push(s.link.value)}}return r},t.getLinkStatistics=function getLinkStatistics(e){for(var t=0,n=e.results.bindings;t<n.length;t++){var r=n[t];if(i.isRdfIri(r.link))return getLinkCount(r)}},t.getFilteredData=function getFilteredData(e,t,n,r){void 0===n&&(n=l),void 0===r&&(r=!0);for(var o={},s=new Map,c=new Map,u=new Map,d=0,p=e.results.bindings;d<p.length;d++){var h=p[d];if(i.isRdfIri(h.inst)||i.isRdfBlank(h.inst)){var f=h.inst.value;if((k=o[f])||(k=emptyElementInfo(f),o[f]=k),enrichElement(k,h),i.isRdfIri(h.classAll)&&a.getOrCreateSetInMap(s,f).add(h.classAll.value),!r&&h.link&&h.direction){var m="out"===h.direction.value?c:u;a.getOrCreateSetInMap(m,k.id).add(h.link.value)}}}if(!r)for(var g=0,v=Object.keys(o);g<v.length;g++){var y=v[g],k=o[y],E=s.get(k.id);matchesDomainForLink(t,c.get(k.id),n)&&matchesDomainForLink(E,u.get(k.id),n)||delete o[y]}return o},t.isDirectLink=isDirectLink,t.isDirectProperty=function isDirectProperty(e){return!/[?$][a-zA-Z]+\b/.test(e.path)},t.enrichElement=enrichElement,t.getLocalizedString=getLocalizedString,t.getInstCount=getInstCount,t.getPropertyModel=getPropertyModel,t.getLinkCount=getLinkCount,t.emptyElementInfo=emptyElementInfo,t.getLinkTypeInfo=getLinkTypeInfo,t.prependAdditionalBindings=function prependAdditionalBindings(e,t){return t?{head:{vars:e.head.vars},results:{bindings:r.__spreadArrays(t.results.bindings,e.results.bindings)}}:e}},3267:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(3268);var i=function(){function CompositeDataProvider(e,t){this.mergeMode="fetchAll";var n=1;this.dataProviders=e.map((function(e){return function isDefinition(e){var t=e;return void 0!==t.name&&void 0!==t.dataProvider}(e)?e:{name:"dataProvider_"+n++,dataProvider:e}})),t&&t.mergeMode&&(this.mergeMode=t.mergeMode)}return CompositeDataProvider.prototype.classTree=function(){return this.fetchSequentially("classTree",r.mergeClassTree,void 0)},CompositeDataProvider.prototype.propertyInfo=function(e){if("fetchAll"===this.mergeMode)return this.fetchSequentially("propertyInfo",r.mergePropertyInfo,e);var t=e.propertyIds;return this.queueProcessResults((function(e,n){return(t=t.filter((function(t){return!e||!e[t]}))).length>0?n.dataProvider.propertyInfo({propertyIds:t}):void 0})).then(r.mergePropertyInfo)},CompositeDataProvider.prototype.classInfo=function(e){if("fetchAll"===this.mergeMode)return this.fetchSequentially("classInfo",r.mergeClassInfo,e);var t=e.classIds;return this.queueProcessResults((function(e,n){return(t=t.filter((function(t){return!e||-1===e.map((function(e){return e.id})).indexOf(t)}))).length>0?n.dataProvider.classInfo({classIds:t}):void 0})).then(r.mergeClassInfo)},CompositeDataProvider.prototype.linkTypesInfo=function(e){if("fetchAll"===this.mergeMode)return this.fetchSequentially("linkTypesInfo",r.mergeLinkTypesInfo,e);var t=e.linkTypeIds;return this.queueProcessResults((function(e,n){return(t=t.filter((function(t){return!e||-1===e.map((function(e){return e.id})).indexOf(t)}))).length>0?n.dataProvider.linkTypesInfo({linkTypeIds:t}):void 0})).then(r.mergeLinkTypesInfo)},CompositeDataProvider.prototype.linkTypes=function(){return this.fetchSequentially("linkTypes",r.mergeLinkTypes,void 0)},CompositeDataProvider.prototype.elementInfo=function(e){if("fetchAll"===this.mergeMode)return this.fetchSequentially("elementInfo",r.mergeElementInfo,e);var t=e.elementIds;return this.queueProcessResults((function(e,n){return(t=t.filter((function(t){return!e||!e[t]}))).length>0?n.dataProvider.elementInfo({elementIds:t}):void 0})).then(r.mergeElementInfo)},CompositeDataProvider.prototype.linksInfo=function(e){if("fetchAll"===this.mergeMode)return this.fetchSequentially("linksInfo",r.mergeLinksInfo,e);var t=e.elementIds;return this.queueProcessResults((function(n,r){return(t=t.filter((function(e){if(n)for(var t=0,r=n;t<r.length;t++){if(r[t].sourceId===e)return!1}return!0}))).length>0?r.dataProvider.linksInfo({elementIds:t,linkTypeIds:e.linkTypeIds}):void 0})).then(r.mergeLinksInfo)},CompositeDataProvider.prototype.linkTypesOf=function(e){return"fetchAll"===this.mergeMode?this.fetchSequentially("linkTypesOf",r.mergeLinkTypesOf,e):this.queueProcessResults((function(t,n){return!t||t&&0===t.length?n.dataProvider.linkTypesOf(e):void 0})).then(r.mergeLinkTypesOf)},CompositeDataProvider.prototype.linkElements=function(e){return"fetchAll"===this.mergeMode?this.fetchSequentially("linkElements",r.mergeLinkElements,e):this.queueProcessResults((function(t,n){return!t||t&&0===Object.keys(t).length?n.dataProvider.linkElements(e):void 0})).then(r.mergeLinkElements)},CompositeDataProvider.prototype.filter=function(e){return"fetchAll"===this.mergeMode?this.fetchSequentially("filter",r.mergeFilter,e):this.queueProcessResults((function(t,n){return!t||t&&0===Object.keys(t).length?n.dataProvider.filter(e):void 0})).then(r.mergeFilter)},CompositeDataProvider.prototype.processResults=function(e,t,n){return e.then((function(e){return{dataSourceName:t,useInStats:n,response:e}})).catch((function(e){return console.error(e),{dataSourceName:t,useInStats:n,response:void 0}}))},CompositeDataProvider.prototype.queueProcessResults=function(e){var t=this,n=0,r=[],recursiveCall=function(i){if(t.dataProviders.length>n){var o=t.dataProviders[n++],a=e(i,o);return a?a.then((function(e){return r.push({dataSourceName:o.name,response:e}),recursiveCall(e)})).catch((function(e){return console.error(e),recursiveCall(i)})):Promise.resolve(r)}return Promise.resolve(r)};return recursiveCall()},CompositeDataProvider.prototype.fetchSequentially=function(e,t,n){var r=this,i=this.dataProviders.map((function(t){var i=t.dataProvider[e];return r.processResults(i.call(t.dataProvider,n),t.name,t.useInStats)}));return Promise.all(i).then(t)},CompositeDataProvider}();t.CompositeDataProvider=i},3268:function(e,t){Object.defineProperty(t,"__esModule",{value:!0});function mergeLinkTypesInfo(e){for(var t,n,r=e.filter((function(e){return e.response})).map((function(e){return e.response})),i={},o=0,a=r;o<a.length;o++)for(var s=0,l=a[o];s<l.length;s++){var c=l[s];i[c.id]?i[c.id]=(t=i[c.id],n=c,{id:t.id,label:mergeLabels(t.label,n.label),count:t.count+n.count}):i[c.id]=c}return Object.keys(i).map((function(e){return i[e]}))}function mergeElementInfo(e){for(var mergeElementModels=function(e,t){for(var n=e.types,r=0,i=t.types;r<i.length;r++){var o=i[r];-1===n.indexOf(o)&&n.push(o)}for(var a=[],s=0,l=e.sources;s<l.length;s++){var c=l[s];-1===a.indexOf(c)&&a.push(c)}for(var u=0,d=t.sources;u<d.length;u++){c=d[u];-1===a.indexOf(c)&&a.push(c)}return{id:e.id,label:mergeLabels(e.label,t.label),types:n,image:e.image||t.image,properties:mergeProperties(e.properties,t.properties),sources:a}},t=(e.filter((function(e){return e.response})).map((function(e){return e.response})),{}),_loop_2=function(e){if(!e.response)return"continue";for(var n=0,r=Object.keys(e.response).map((function(t){return e.response[t]}));n<r.length;n++){var i=r[n];i.sources=[e.dataSourceName],i.properties["http://ontodia.org/property/DataProvider"]={type:"string",values:[{value:e.dataSourceName,language:""}]},t[i.id]?t[i.id]=mergeElementModels(t[i.id],i):t[i.id]=i}},n=0,r=e;n<r.length;n++){_loop_2(r[n])}return t}function mergeProperties(e,t){var n=Object.keys(e),r=Object.keys(t),i={};function createIdForProperty(e){for(var t=1;i[e+"_"+t];)t++;return e+"_"+t}for(var o=0,a=n;o<a.length;o++){var s=e[u=a[o]];i[u]?i[createIdForProperty(u)]=s:i[u]=s}for(var l=0,c=r;l<c.length;l++){var u;s=t[u=c[l]];i[u]?i[createIdForProperty(u)]=s:i[u]=s}return i}function classTreeToArray(e){var t=e;function getDescendants(e){for(var t=e.children||[],n=0,r=t;n<r.length;n++){var i=getDescendants(r[n]);t=t.concat(i)}return t}for(var n=0,r=e;n<r.length;n++){var i=getDescendants(r[n]);t=t.concat(i)}return t}function mergeLabels(e,t){for(var n=e.values,_loop_4=function(e){n.some((function(t){return function compareLabels(e,t){return e.language===t.language&&e.value===t.value}(t,e)}))||n.push(e)},r=0,i=t.values;r<i.length;r++){_loop_4(i[r])}return{values:n}}function mergeCounts(e,t){if(void 0!==e||void 0!==t)return(e||0)+(t||0)}function mergeClassModel(e,t){for(var n={},r=0,i=e.children.concat(t.children);r<i.length;r++){var o=i[r];n[o.id]||(n[o.id]=o)}return{id:e.id,label:mergeLabels(e.label,t.label),count:mergeCounts(e.count,t.count),children:Object.keys(n).map((function(e){return n[e]}))}}t.mergeClassTree=function mergeClassTree(e){for(var t=e.filter((function(e){return e.response})).map((function(e){return{useInStats:e.useInStats,classes:classTreeToArray(e.response)}})),n={},r={},i={},o=0,a=t;o<a.length;o++)for(var s=a[o],l=s.useInStats,_loop_1=function(e){var t=i[e.id]||[];e.children.map((function(e){return e.id})).forEach((function(e){-1===t.indexOf(e)&&t.push(e)})),e.children=[],l||delete e.count,n[e.id]?(r[e.id]=mergeClassModel(n[e.id],e),n[e.id]=r[e.id]):(r[e.id]=e,n[e.id]=e,i[e.id]=t)},c=0,u=s.classes;c<u.length;c++){_loop_1(u[c])}for(var d=0,p=Object.keys(n).map((function(e){return n[e]}));d<p.length;d++){var h=p[d];h.children=(i[h.id]||[]).map((function(e){return delete r[e],n[e]}))}return Object.keys(r).map((function(e){return r[e]}))},t.mergePropertyInfo=function mergePropertyInfo(e){for(var t={},n=0,r=e.filter((function(e){return e.response})).map((function(e){return e.response}));n<r.length;n++)for(var i=r[n],o=0,a=Object.keys(i);o<a.length;o++){var s=a[o],l=i[s];t[s]?t[s].label=mergeLabels(t[s].label,l.label):t[s]=l}return t},t.mergeClassInfo=function mergeClassInfo(e){for(var t=e.filter((function(e){return e.response})).map((function(e){return e.response})),n={},r=0,i=t;r<i.length;r++)for(var o=0,a=i[r];o<a.length;o++){var s=a[o];n[s.id]?n[s.id]=mergeClassModel(n[s.id],s):n[s.id]=s}return Object.keys(n).map((function(e){return n[e]}))},t.mergeLinkTypesInfo=mergeLinkTypesInfo,t.mergeLinkTypes=function mergeLinkTypes(e){return mergeLinkTypesInfo(e)},t.mergeElementInfo=mergeElementInfo,t.mergeProperties=mergeProperties,t.mergeLinksInfo=function mergeLinksInfo(e){for(var t=e.filter((function(e){return e.response})).map((function(e){return e.response})),n=[],r=0,i=t;r<i.length;r++)for(var _loop_3=function(e){n.some((function(t){return r=e,(n=t).sourceId===r.sourceId&&n.targetId===r.targetId&&n.linkTypeId===r.linkTypeId;var n,r}))||n.push(e)},o=0,a=i[r];o<a.length;o++){_loop_3(a[o])}return n},t.mergeLinkTypesOf=function mergeLinkTypesOf(e){for(var t,n,r=e.filter((function(e){return e.response})).map((function(e){return e.response})),i={},o=0,a=r;o<a.length;o++)for(var s=0,l=a[o];s<l.length;s++){var c=l[s];i[c.id]?i[c.id]=(t=c,n=i[c.id],{id:t.id,inCount:t.inCount+n.inCount,outCount:t.outCount+n.outCount}):i[c.id]=c}return Object.keys(i).map((function(e){return i[e]}))},t.mergeLinkElements=function mergeLinkElements(e){return mergeElementInfo(e)},t.mergeFilter=function mergeFilter(e){return mergeElementInfo(e)},t.classTreeToArray=classTreeToArray,t.mergeLabels=mergeLabels,t.mergeCounts=mergeCounts,t.mergeClassModel=mergeClassModel},3276:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(2319),i=function(){function SparqlGraphBuilder(e){this.dataProvider=e,this.graphBuilder=new r.GraphBuilder(e)}return SparqlGraphBuilder.prototype.getGraphFromConstruct=function(e){var t=this,n="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\n PREFIX owl:  <http://www.w3.org/2002/07/owl#>\n\n"+e;return this.dataProvider.executeSparqlConstruct(n).then((function(e){return t.graphBuilder.getGraphFromRDFGraph(e)}))},SparqlGraphBuilder}();t.SparqlGraphBuilder=i},3277:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1623),o=n(1554),a=function(){function Graph(){var e=this;this.source=new o.EventSource,this.events=this.source,this.elements=new i.OrderedMap,this.links=new i.OrderedMap,this.classesById=new Map,this.propertiesById=new Map,this.linkTypes=new Map,this.onElementEvent=function(t,n){e.source.trigger("elementEvent",{key:n,data:t})},this.onLinkEvent=function(t,n){e.source.trigger("linkEvent",{key:n,data:t})},this.onLinkTypeEvent=function(t,n){e.source.trigger("linkTypeEvent",{key:n,data:t})},this.onClassEvent=function(t,n){e.source.trigger("classEvent",{key:n,data:t})}}return Graph.prototype.getElements=function(){return this.elements.items},Graph.prototype.getLinks=function(){return this.links.items},Graph.prototype.getLink=function(e){return this.links.get(e)},Graph.prototype.findLink=function(e,t,n){var r=this.getElement(t);if(r){var i=findLinkIndex(r.links,e,t,n);return i>=0?r.links[i]:void 0}},Graph.prototype.sourceOf=function(e){return this.getElement(e.sourceId)},Graph.prototype.targetOf=function(e){return this.getElement(e.targetId)},Graph.prototype.reorderElements=function(e){this.elements.reorder(e)},Graph.prototype.getElement=function(e){return this.elements.get(e)},Graph.prototype.addElement=function(e){if(this.getElement(e.id))throw new Error("Element '"+e.id+"' already exists.");e.events.onAny(this.onElementEvent),this.elements.push(e.id,e),this.source.trigger("changeCells",{updateAll:!1,changedElement:e})},Graph.prototype.removeElement=function(e){var t=this.elements.get(e);if(t){for(var n={silent:!0},i=r.__spreadArrays(t.links),o=0,a=i;o<a.length;o++){var s=a[o];this.removeLink(s.id,n)}this.elements.delete(e),t.events.offAny(this.onElementEvent),this.source.trigger("changeCells",{updateAll:!1,changedElement:t,changedLinks:i})}},Graph.prototype.addLink=function(e){if(this.getLink(e.id))throw new Error("Link '"+e.id+"' already exists.");if(!this.getLinkType(e.typeId))throw new Error("Link type '"+e.typeId+"' not found.");this.registerLink(e)},Graph.prototype.registerLink=function(e){this.sourceOf(e).links.push(e),e.sourceId!==e.targetId&&this.targetOf(e).links.push(e),e.events.onAny(this.onLinkEvent),this.links.push(e.id,e),this.source.trigger("changeCells",{updateAll:!1,changedLinks:[e]})},Graph.prototype.removeLink=function(e,t){var n=this.links.delete(e);if(n){var r=n.typeId,i=n.sourceId,o=n.targetId;n.events.offAny(this.onLinkEvent),this.removeLinkReferences(r,i,o),t&&t.silent||this.source.trigger("changeCells",{updateAll:!1,changedLinks:[n]})}},Graph.prototype.removeLinkReferences=function(e,t,n){var r=this.getElement(t);r&&removeLinkFrom(r.links,e,t,n);var i=this.getElement(n);i&&removeLinkFrom(i.links,e,t,n)},Graph.prototype.getLinkTypes=function(){var e=[];return this.linkTypes.forEach((function(t){return e.push(t)})),e},Graph.prototype.getLinkType=function(e){return this.linkTypes.get(e)},Graph.prototype.addLinkType=function(e){if(this.getLinkType(e.id))throw new Error("Link type '"+e.id+"' already exists.");e.setIndex(Graph.nextLinkTypeIndex++),e.events.onAny(this.onLinkTypeEvent),this.linkTypes.set(e.id,e)},Graph.prototype.getProperty=function(e){return this.propertiesById.get(e)},Graph.prototype.addProperty=function(e){if(this.getProperty(e.id))throw new Error("Property '"+e.id+"' already exists.");this.propertiesById.set(e.id,e)},Graph.prototype.getClass=function(e){return this.classesById.get(e)},Graph.prototype.getClasses=function(){var e=[];return this.classesById.forEach((function(t){return e.push(t)})),e},Graph.prototype.addClass=function(e){if(this.getClass(e.id))throw new Error("Class '"+e.id+"' already exists.");e.events.onAny(this.onClassEvent),this.classesById.set(e.id,e)},Graph.nextLinkTypeIndex=0,Graph}();function removeLinkFrom(e,t,n,r){if(e)for(;;){var i=findLinkIndex(e,t,n,r);if(i<0)break;e.splice(i,1)}}function findLinkIndex(e,t,n,r){for(var i=0;i<e.length;i++){var o=e[i];if(o.sourceId===n&&o.targetId===r&&o.typeId===t)return i}return-1}t.Graph=a},3278:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1560),o=function(){function DataFetcher(e,t){var n=this;this.graph=e,this.dataProvider=t,this.classQueue=new i.BufferingQueue((function(e){n.dataProvider.classInfo({classIds:e}).then(n.onClassesLoaded)})),this.linkTypeQueue=new i.BufferingQueue((function(e){n.dataProvider.linkTypesInfo({linkTypeIds:e}).then(n.onLinkTypesLoaded)})),this.propertyTypeQueue=new i.BufferingQueue((function(e){n.dataProvider.propertyInfo({propertyIds:e}).then(n.onPropertyTypesLoaded)})),this.onElementInfoLoaded=function(e){for(var t=0,r=n.graph.getElements();t<r.length;t++){var i=r[t],o=e[i.iri];o&&i.setData(o)}},this.onClassesLoaded=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],o=i.id,a=i.label,s=i.count,l=n.graph.getClass(o);l&&(l.setLabel(a.values),"number"==typeof s&&l.setCount(s))}},this.onLinkTypesLoaded=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],o=i.id,a=i.label,s=n.graph.getLinkType(o);s&&s.setLabel(a.values)}},this.onPropertyTypesLoaded=function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var r=e[t],i=r.id,o=r.label,a=n.graph.getProperty(i);a&&a.setLabel(o.values)}}}return DataFetcher.prototype.fetchElementData=function(e){return 0===e.length?Promise.resolve():this.dataProvider.elementInfo({elementIds:r.__spreadArrays(e)}).then(this.onElementInfoLoaded)},DataFetcher.prototype.fetchClass=function(e){this.classQueue.push(e.id)},DataFetcher.prototype.fetchLinkType=function(e){this.linkTypeQueue.push(e.id)},DataFetcher.prototype.fetchPropertyType=function(e){this.dataProvider.propertyInfo&&this.propertyTypeQueue.push(e.id)},DataFetcher}();t.DataFetcher=o},3279:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1573),a=n(1554),s=n(1574),l=n(1985),c="ontodia-dialog",u=function(e){function Dialog(t){var n=e.call(this,t)||this;return n.unsubscribeFromTarget=void 0,n.handler=new a.EventObserver,n.updateAll=function(){return n.forceUpdate()},n.onStartDragging=function(e){n.preventSelection();var t=n.props.size;n.startSize={x:n.state.width||t.width,y:n.state.height||t.height}},n.onDragHandleBottom=function(e,t,r){var i=n.calculateHeight(n.startSize.y+r);n.setState({height:i})},n.onDragHandleRight=function(e,t){var r=n.calculateWidth(n.startSize.x+t);n.setState({width:r})},n.onDragHandleBottomRight=function(e,t,r){var i=n.calculateWidth(n.startSize.x+t),o=n.calculateHeight(n.startSize.y+r);n.setState({width:i,height:o})},n.preventSelection=function(){var onMouseUp=function(){document.body.classList.remove("ontodia--unselectable"),document.removeEventListener("mouseup",onMouseUp)};document.addEventListener("mouseup",onMouseUp),document.body.classList.add("ontodia--unselectable")},n.state={},n}return r.__extends(Dialog,e),Dialog.prototype.componentDidMount=function(){this.listenToTarget(this.props.target),this.focusOn()},Dialog.prototype.componentWillReceiveProps=function(e){e.target!==this.props.target&&this.listenToTarget(e.target)},Dialog.prototype.componentWillUnmount=function(){this.listenToTarget(void 0)},Dialog.prototype.listenToTarget=function(e){var t=this;if(this.unsubscribeFromTarget&&(this.unsubscribeFromTarget(),this.unsubscribeFromTarget=void 0),e){var n=this.props.view;e instanceof o.Element?this.listenToElement(e):e instanceof o.Link&&this.listenToLink(e),this.handler.listen(n.events,"changeLanguage",this.updateAll),this.unsubscribeFromTarget=function(){t.handler.stopListening()}}},Dialog.prototype.listenToElement=function(e){this.handler.listen(e.events,"changePosition",this.updateAll),this.handler.listen(e.events,"changeSize",this.updateAll)},Dialog.prototype.listenToLink=function(e){var t=this.props.view,n=t.model.getElement(e.sourceId),r=t.model.getElement(e.targetId);this.listenToElement(n),this.listenToElement(r),this.handler.listen(e.events,"changeVertices",this.updateAll),this.handler.listen(e.events,"changeLabelBounds",this.updateAll)},Dialog.prototype.calculatePositionForElement=function(e){var t=this.props,n=t.paperArea,r=t.size,i=s.boundsOf(e),o=n.paperToScrollablePaneCoords(i.x,i.y).y,a=n.paperToScrollablePaneCoords(i.x+i.width,i.y+i.height);return{x:a.x+40,y:(o+a.y)/2-r.height/2}},Dialog.prototype.calculatePositionForLink=function(e){var t=this.props,n=t.view,r=t.paperArea,i=n.model.getElement(e.sourceId),o=n.model.getElement(e.targetId);if(!i||!o)throw new Error("Source and target are not specified");var a=n.getRouting(e.id),l=e.vertices||[],c=a?a.vertices:l,u=s.computePolyline(i,o,c),d=s.computePolylineLength(u),p=s.getPointAlongPolyline(u,d/2),h=r.paperToScrollablePaneCoords(p.x,p.y),f=h.x;return{y:h.y+20,x:f+20}},Dialog.prototype.calculatePosition=function(){var e=this.props,t=e.target,n=e.paperArea,r=e.offset,i=void 0===r?{x:0,y:0}:r,a=e.calculatePosition;if(a){var s=a(),l=n.paperToScrollablePaneCoords(s.x,s.y),c=l.x,u=l.y;return{x:c+i.x,y:u+i.y}}if(t instanceof o.Element)return this.calculatePositionForElement(t);if(t instanceof o.Link)return this.calculatePositionForLink(t);throw new Error("Unknown target type")},Dialog.prototype.getViewPortScrollablePoints=function(){var e=this.props.paperArea,t=e.getAreaMetrics();return{min:e.clientToScrollablePaneCoords(0,0),max:e.clientToScrollablePaneCoords(t.clientWidth,t.clientHeight)}},Dialog.prototype.getDialogScrollablePoints=function(){var e=this.props.size,t=this.calculatePosition(),n={x:t.x-20,y:t.y-20};return{min:n,max:{x:n.x+e.width+40,y:n.y+e.height+40}}},Dialog.prototype.focusOn=function(){var e=this.props.paperArea,t=this.getViewPortScrollablePoints(),n=t.min,r=t.max,i=this.getDialogScrollablePoints(),o=i.min,a=i.max,s=0;o.x<n.x?s=o.x-n.x:a.x>r.x&&(s=a.x-r.x);var l=0;o.y<n.y?l=o.y-n.y:a.y>r.y&&(l=a.y-r.y);var c={x:n.x+(r.x-n.x)/2+s,y:n.y+(r.y-n.y)/2+l},u=e.scrollablePaneToPaperCoords(c.x,c.y);e.centerTo(u)},Dialog.prototype.calculateHeight=function(e){var t=this.props.size,n=Math.min(t.height,250),r=Math.max(t.height,800);return Math.max(n,Math.min(r,e))},Dialog.prototype.calculateWidth=function(e){var t=this.props.size,n=Math.min(t.width,250),r=Math.max(t.width,800);return Math.max(n,Math.min(r,e))},Dialog.prototype.render=function(){var e=this,t=this.props,n=t.size,r=t.caption,o=this.calculatePosition(),a=o.x,s={top:o.y,left:a,width:this.state.width||n.width,height:this.state.height||n.height};return i.createElement("div",{className:c,style:s},i.createElement("button",{className:c+"__close-button",onClick:function(){return e.props.onClose()}}),r?i.createElement("div",{className:"ontodia-dialog__caption"},r):null,this.props.children,i.createElement(l.DraggableHandle,{className:c+"__bottom-handle",onBeginDragHandle:this.onStartDragging,onDragHandle:this.onDragHandleBottom}),i.createElement(l.DraggableHandle,{className:c+"__right-handle",onBeginDragHandle:this.onStartDragging,onDragHandle:this.onDragHandleRight}),i.createElement(l.DraggableHandle,{className:c+"__bottom-right-handle",onBeginDragHandle:this.onStartDragging,onDragHandle:this.onDragHandleBottomRight}))},Dialog.defaultProps={size:{width:300,height:300}},Dialog}(i.Component);t.Dialog=u},3280:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1607),a="ontodia-edit-form",s=function(e){function EditEntityForm(t){var n=e.call(this,t)||this;return n.renderProperty=function(e,t){var r=n.props.view,s=r.model.getProperty(e),l=r.formatLabel(s.label,e),c=[];return(o.isIriProperty(t)||o.isLiteralProperty(t))&&(c=t.values.map((function(e){return e.value}))),i.createElement("div",{key:e,className:a+"__form-row"},i.createElement("label",null,l,c.map((function(e,t){return i.createElement("input",{key:t,className:"ontodia-form-control",defaultValue:e})}))))},n.onChangeIri=function(e){var t=e.target.value;n.setState((function(e){return{elementModel:r.__assign(r.__assign({},e.elementModel),{id:t})}}))},n.onChangeLabel=function(e){var t=e.target,i=t.value.length>0?[{value:t.value,language:""}]:[];n.setState({elementModel:r.__assign(r.__assign({},n.state.elementModel),{label:{values:i}})})},n.state={elementModel:t.entity},n}return r.__extends(EditEntityForm,e),EditEntityForm.prototype.componentWillReceiveProps=function(e){this.props.entity!==e.entity&&this.setState({elementModel:e.entity})},EditEntityForm.prototype.renderProperties=function(){var e=this,t=this.props.entity.properties,n=Object.keys(t);return i.createElement("div",null,n.map((function(n){return e.renderProperty(n,t[n])})))},EditEntityForm.prototype.renderType=function(){var e=this.props.view,t=this.state.elementModel,n=e.getElementTypeString(t);return i.createElement("label",null,"Type",i.createElement("input",{className:"ontodia-form-control",value:n,disabled:!0}))},EditEntityForm.prototype.renderIri=function(){var e=this.state.elementModel;return i.createElement("label",null,"IRI",i.createElement("input",{className:"ontodia-form-control",defaultValue:e.id,onChange:this.onChangeIri}))},EditEntityForm.prototype.renderLabel=function(){var e=this.props.view.selectLabel(this.state.elementModel.label.values),t=e?e.value:"";return i.createElement("label",null,"Label",i.createElement("input",{className:"ontodia-form-control",value:t,onChange:this.onChangeLabel}))},EditEntityForm.prototype.render=function(){var e=this;return i.createElement("div",{className:a},i.createElement("div",{className:a+"__body"},i.createElement("div",{className:a+"__form-row"},this.renderIri()),i.createElement("div",{className:a+"__form-row"},this.renderType()),i.createElement("div",{className:a+"__form-row"},this.renderLabel()),this.renderProperties()),i.createElement("div",{className:a+"__controls"},i.createElement("button",{className:"ontodia-btn ontodia-btn-success "+a+"__apply-button",onClick:function(){return e.props.onApply(e.state.elementModel)}},"Apply"),i.createElement("button",{className:"ontodia-btn ontodia-btn-danger",onClick:this.props.onCancel},"Cancel")))},EditEntityForm}(i.Component);t.EditEntityForm=s},3281:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1573),a=n(1560),s=n(1585),l=n(1697),c=n(3282),u=n(2330),d="ontodia-edit-form",p=function(e){function EditElementTypeForm(t){var n=e.call(this,t)||this;n.validationCancellation=new a.Cancellation;var r=n.props,i=r.target,s=r.link;return n.state={elementValue:{value:i.value,isNew:i.isNew,loading:!1,validated:!0,allowChange:!0},linkValue:{value:{link:s,direction:o.LinkDirection.out},validated:!0,allowChange:!0}},n}return r.__extends(EditElementTypeForm,e),EditElementTypeForm.prototype.componentDidMount=function(){this.validate()},EditElementTypeForm.prototype.componentWillUnmount=function(){this.validationCancellation.abort()},EditElementTypeForm.prototype.setElementOrLink=function(e){var t=this,n=e.elementValue,r=e.linkValue;this.setState((function(e){return{elementValue:n||e.elementValue,linkValue:r||e.linkValue}}),(function(){(n&&!n.validated||r&&!r.validated)&&t.validate(),n&&n.validated&&n.allowChange&&t.props.onChangeElement(n.value),r&&r.validated&&r.allowChange&&t.props.onChangeLink(r.value.link)}))},EditElementTypeForm.prototype.validate=function(){var e=this,t=this.props,n=t.editor,i=t.link,o=this.state,s=o.elementValue,l=o.linkValue;this.setState({isValidating:!0}),this.validationCancellation.abort(),this.validationCancellation=new a.Cancellation;var d=this.validationCancellation.signal,p=c.validateElementType(s.value),h=u.validateLinkType(n,l.value.link,i);Promise.all([p,h]).then((function(t){var n=t[0],i=t[1];d.aborted||(e.setState({isValidating:!1}),e.setElementOrLink({elementValue:r.__assign(r.__assign(r.__assign({},s),n),{validated:!0}),linkValue:r.__assign(r.__assign(r.__assign({},l),i),{validated:!0})}))}))},EditElementTypeForm.prototype.render=function(){var e=this,t=this.props,n=t.editor,a=t.view,p=t.metadataApi,h=t.source,f=t.link,m=this.state,g=m.elementValue,v=m.linkValue,y=m.isValidating,k=!g.error&&!v.error;return i.createElement("div",{className:d},i.createElement("div",{className:d+"__body"},i.createElement(c.ElementTypeSelector,{editor:n,view:a,metadataApi:p,source:h,elementValue:g,onChange:function(t){e.setElementOrLink({elementValue:{value:t.value,isNew:t.isNew,loading:t.loading,error:void 0,validated:!1,allowChange:!1},linkValue:{value:{link:r.__assign(r.__assign({},f),{targetId:t.value.id}),direction:o.LinkDirection.out},validated:!1,allowChange:!1}})}}),g.loading?i.createElement("div",{style:{display:"flex"}},i.createElement(s.HtmlSpinner,{width:20,height:20}),"Loading entity..."):i.createElement(u.LinkTypeSelector,{editor:n,view:a,metadataApi:p,linkValue:v,source:h,target:g.value,onChange:function(t){return e.setElementOrLink({linkValue:{value:t,error:void 0,validated:!1,allowChange:!1}})},disabled:void 0!==g.error}),y?i.createElement("div",{className:d+"__progress"},i.createElement(l.ProgressBar,{state:l.ProgressState.loading,height:10})):null),i.createElement("div",{className:d+"__controls"},i.createElement("button",{className:"ontodia-btn ontodia-btn-success "+d+"__apply-button",onClick:function(){return e.props.onApply(g.value,g.isNew,v.value.link)},disabled:g.loading||!k||y},"Apply"),i.createElement("button",{className:"ontodia-btn ontodia-btn-danger",onClick:this.props.onCancel},"Cancel")))},EditElementTypeForm}(i.Component);t.EditElementTypeForm=p},3282:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1580),a=n(2329),s=n(1698),l=n(1560),c=n(1585),u="ontodia-edit-form",d=function(e){function ElementTypeSelector(t){var n=e.call(this,t)||this;return n.cancellation=new l.Cancellation,n.filterCancellation=new l.Cancellation,n.loadingItemCancellation=new l.Cancellation,n.onElementTypeChange=function(e){return r.__awaiter(n,void 0,void 0,(function(){var t,n,i,o,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:return this.setState({isLoading:!0}),this.loadingItemCancellation.abort(),this.loadingItemCancellation=new l.Cancellation,t=this.loadingItemCancellation.signal,n=this.props,i=n.onChange,o=n.metadataApi,a=e.target.value,[4,l.CancellationToken.mapCancelledToNull(t,o.generateNewElement([a],t))];case 1:return null===(s=r.sent())||(this.setState({isLoading:!1}),i({value:s,isNew:!0,loading:!1})),[2]}}))}))},n.renderPossibleElementType=function(e){var t=n.props.view,r=t.model.createClass(e),o=t.formatLabel(r.label,r.id);return i.createElement("option",{key:e,value:e},o)},n.state={searchString:"",existingElements:[]},n}return r.__extends(ElementTypeSelector,e),ElementTypeSelector.prototype.componentDidMount=function(){this.fetchPossibleElementTypes()},ElementTypeSelector.prototype.componentDidUpdate=function(e,t){this.state.searchString!==t.searchString&&this.searchExistingElements()},ElementTypeSelector.prototype.componentWillUnmount=function(){this.cancellation.abort(),this.filterCancellation.abort(),this.loadingItemCancellation.abort()},ElementTypeSelector.prototype.fetchPossibleElementTypes=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,n,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return e=this.props,t=e.view,n=e.metadataApi,i=e.source,n?[4,l.CancellationToken.mapCancelledToNull(this.cancellation.signal,n.typesOfElementsDraggedFrom(i,this.cancellation.signal))]:[2];case 1:return null===(o=r.sent())||(o.sort(function makeElementTypeComparatorByLabel(e){return function(t,n){var r=e.model.createClass(t),i=e.model.createClass(n),o=e.formatLabel(r.label,r.id),a=e.formatLabel(i.label,i.id);return o.localeCompare(a)}}(t)),this.setState({elementTypes:o})),[2]}}))}))},ElementTypeSelector.prototype.searchExistingElements=function(){var e=this,t=this.props,n=t.editor,r=t.view,i=this.state.searchString;if(this.setState({existingElements:[]}),i.length>0){this.setState({isLoading:!0}),this.filterCancellation.abort(),this.filterCancellation=new l.Cancellation;var o=this.filterCancellation.signal,s=a.createRequest({text:i},r.getLanguage());n.model.dataProvider.filter(s).then((function(t){if(!o.aborted){var n=Object.keys(t).map((function(e){return t[e]}));e.setState({existingElements:n,isLoading:!1})}}))}},ElementTypeSelector.prototype.renderElementTypeSelector=function(){var e=this.props.elementValue,t=this.state,n=t.elementTypes,r=t.isLoading,a=e.value.types.length?e.value.types[0]:"";return r?i.createElement(c.HtmlSpinner,{width:20,height:20}):i.createElement("div",{className:u+"__control-row"},i.createElement("label",null,"Entity Type"),n?i.createElement("select",{className:"ontodia-form-control",value:a,onChange:this.onElementTypeChange},i.createElement("option",{value:o.PLACEHOLDER_ELEMENT_TYPE,disabled:!0},"Select entity type"),n.map(this.renderPossibleElementType)):i.createElement("div",null,i.createElement(c.HtmlSpinner,{width:20,height:20})),e.error?i.createElement("span",{className:u+"__control-error"},e.error):"")},ElementTypeSelector.prototype.renderExistingElementsList=function(){var e=this,t=this.props,n=t.view,r=t.editor,o=t.elementValue,a=this.state,l=a.elementTypes,u=a.isLoading,d=a.existingElements;return u?i.createElement(c.HtmlSpinner,{width:20,height:20}):d.length>0?d.map((function(t){var a=!r.temporaryState.elements.has(t.id)&&Boolean(r.model.elements.find((function(e){var n=e.iri,r=e.group;return n===t.id&&void 0===r}))),c=Boolean(l.find((function(e){return t.types.indexOf(e)>=0})));return i.createElement(s.ListElementView,{key:t.id,view:n,model:t,disabled:a||!c,selected:t.id===o.value.id,onClick:function(t,n){return e.onSelectExistingItem(n)}})})):i.createElement("span",null,"No results")},ElementTypeSelector.prototype.onSelectExistingItem=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,o,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this.props,n=t.editor,i=t.onChange,this.loadingItemCancellation.abort(),this.loadingItemCancellation=new l.Cancellation,o=this.loadingItemCancellation.signal,i({value:e,isNew:!1,loading:!0}),[4,n.model.dataProvider.elementInfo({elementIds:[e.id]})];case 1:return a=r.sent(),o.aborted?[2]:(s=a[e.id],i({value:s,isNew:!1,loading:!1}),[2])}}))}))},ElementTypeSelector.prototype.render=function(){var e=this,t=this.state.searchString;return i.createElement("div",{className:u+"__form-row "+u+"__element-selector"},i.createElement("div",{className:u+"__search"},i.createElement("i",{className:"fa fa-search "+u+"__search-icon"}),i.createElement("input",{value:t,onChange:function(t){return e.setState({searchString:t.target.value})},className:"ontodia-form-control "+u+"__search-input",placeholder:"Search for...",autoFocus:!0})),t.length>0?i.createElement("div",{className:u+"__existing-elements-list"},this.renderExistingElementsList()):i.createElement("div",null,i.createElement("div",{className:u+"__separator"},i.createElement("span",{className:u+"__separator-text"},"or create new entity")),this.renderElementTypeSelector()))},ElementTypeSelector}(i.Component);t.ElementTypeSelector=d,t.validateElementType=function validateElementType(e){var t=e.types.indexOf(o.PLACEHOLDER_ELEMENT_TYPE)<0?void 0:"Required.";return Promise.resolve({error:t,allowChange:!0})}},3283:function(e,t,n){"use strict";n.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAbCAYAAAAOEM1uAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAZEQAAGREBkIelaAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAG2SURBVFiFzde9axRRFMbhJ3Hjx0YRgkWElGIRGyVgaaG9XQpBrNIETJHKjxBSJCA2NiIWdhYKgoqCIELq/AU2tiJpAiliDMHEWEyKZfdO5szHrr4wzcx77vnNnXPnnktcK9jBwYCuLcwNBeHGsIGovyltDweNbYOHg9Eo4D9Tq0bsGj40BXKoO5isEjiht4ifHuE/qVpJvO/O049PvIxN/MBMH8ZP6pzeGVxK+C4kfAsl8vTMYBnI1x1Bv3E54bmWSHCAx2KfvBbgKGbxJAfOIcS7HMjnKCqpWoBRtfE5B/IVRsoAtnAGd3GlQchd/NE7Y7dwCtPYiw72xuD216KFk/zN3Ii+SYOajhqHZUU9aK1GjS3M4xumFK+yMuPexLHEsy9YbChPJR3HW+na+yjbBvNU+zdzHbcxfoTnUw7cS8XNSS3AFx1B6zif8FzKgXsmVj6VAduyFrwzcCUHcL/L9yiaJAUYXRRjON1172zC9xX3ZS+ziTk8KAFYWWX7wRGcqJAnudVV1RTu1YhP6WL3jWjXO4HvzbLE9N8fmqKAv/SpNyvQdmorSmlHVvhX1TsJltFPPPwL/+nTC6wUIf8AAAAASUVORK5CYII="},3284:function(e,t,n){"use strict";n.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAbCAYAAAAOEM1uAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAZEQAAGREBkIelaAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAGCSURBVFiFzdi9ShxRFAfwn+uiaAoRVBQbbfMEFqIoFja+QCoLLQQr8R0sbdIJgTQiSgT1AcTKzkdIQhpTaOlX0GyK2WJ2c8d1Pt0/XBjOnTnnP+eerxnYxj0aJa9nfEOvlLirgFx8zaQhV8Ng2jfKiVT2amWxKAr1gOwElwXpH8NWXiXtMbKZV2EMHwP6F2P7dR1O8T2PeBW/8EMHp5TpwWGtJewF06JEuWmzu4ueqgnC55juw6ZsHE8B218F8qJsgkS1b0Grh74EbDdwioGqCYbQj6MEkhcYIlxm3opZrGEyh47eJqH22JvDOZbJ5sEJ4Rgqeh1nLTMr6Mv4bBpMZSV4hj9FMknA96wxeC3qCOvyxWAd88L17wobdHkWV0VwxP+e3ksgd6LiOrgtyvhn7DRlo3gM2K68kwziNqb7QTSC9eN3m9136cWvjVuf8FOHaSZPJ8mLfRw0r/8m3RQiuIQPBZEY67CfSCyOsttV0hG/CV3/0VQTTbxVIrW9rv6z8A+8NRQ5z9bcwQAAAABJRU5ErkJggg=="},3285:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1607),a=n(1573),s=n(1560),l=n(1697),c=n(2330),u="ontodia-edit-form",d=function(e){function EditLinkForm(t){var n=e.call(this,t)||this;return n.validationCancellation=new s.Cancellation,n.state={linkValue:{value:{link:t.link,direction:a.LinkDirection.out},validated:!0,allowChange:!0}},n}return r.__extends(EditLinkForm,e),EditLinkForm.prototype.componentDidMount=function(){this.validate()},EditLinkForm.prototype.componentDidUpdate=function(e,t){var n=this.state.linkValue;o.sameLink(n.value.link,t.linkValue.value.link)||this.validate(),n!==t.linkValue&&n.validated&&n.allowChange&&this.props.onChange(n.value.link)},EditLinkForm.prototype.componentWillUnmount=function(){this.validationCancellation.abort()},EditLinkForm.prototype.validate=function(){var e=this,t=this.props,n=t.editor,i=t.link,o=this.state.linkValue.value;this.setState({isValidating:!0}),this.validationCancellation.abort(),this.validationCancellation=new s.Cancellation;var a=this.validationCancellation.signal;c.validateLinkType(n,o.link,i).then((function(t){a.aborted||e.setState((function(e){var n=e.linkValue;return{linkValue:r.__assign(r.__assign(r.__assign({},n),t),{validated:!0}),isValidating:!1}}))}))},EditLinkForm.prototype.render=function(){var e=this,t=this.props,n=t.editor,r=t.view,o=t.metadataApi,a=t.source,s=t.target,d=this.state,p=d.linkValue,h=d.isValidating,f=!p.error;return i.createElement("div",{className:u},i.createElement("div",{className:u+"__body"},i.createElement(c.LinkTypeSelector,{editor:n,view:r,metadataApi:o,linkValue:p,source:a,target:s,onChange:function(t){return e.setState({linkValue:{value:t,error:void 0,validated:!1,allowChange:!1}})}}),h?i.createElement("div",{className:u+"__progress"},i.createElement(l.ProgressBar,{state:l.ProgressState.loading,height:10})):null),i.createElement("div",{className:u+"__controls"},i.createElement("button",{className:"ontodia-btn ontodia-btn-success "+u+"__apply-button",onClick:function(){return e.props.onApply(p.value.link)},disabled:!f||h},"Apply"),i.createElement("button",{className:"ontodia-btn ontodia-btn-danger",onClick:this.props.onCancel},"Cancel")))},EditLinkForm}(i.Component);t.EditLinkForm=d},3286:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o="ontodia-edit-form",a=function(e){function EditLinkLabelForm(t){var n=e.call(this,t)||this,r=n.computeLabel();return n.state={label:r},n}return r.__extends(EditLinkLabelForm,e),EditLinkLabelForm.prototype.componentDidUpdate=function(e){if(this.props.link.typeId!==e.link.typeId){var t=this.computeLabel();this.setState({label:t})}},EditLinkLabelForm.prototype.computeLabel=function(){var e=this.props,t=e.view,n=e.link,r=t.model.getLinkType(n.typeId),i=t.createLinkTemplate(r).renderLink(n).label,o=void 0===i?{}:i,a=o.attrs&&o.attrs.text?o.attrs.text.text:void 0;return a&&a.length>0?t.selectLabel(a).value:t.formatLabel(r.label,r.id)},EditLinkLabelForm.prototype.render=function(){var e=this,t=this.props,n=t.onApply,r=t.onCancel,a=this.state.label;return i.createElement("div",{className:o},i.createElement("div",{className:o+"__body"},i.createElement("div",{className:o+"__form-row"},i.createElement("label",null,"Link Label"),i.createElement("input",{className:"ontodia-form-control",value:a,onChange:function(t){return e.setState({label:t.target.value})}}))),i.createElement("div",{className:o+"__controls"},i.createElement("button",{className:"ontodia-btn ontodia-btn-success "+o+"__apply-button",onClick:function(){return n(a)}},"Apply"),i.createElement("button",{className:"ontodia-btn ontodia-btn-danger",onClick:function(){return r()}},"Cancel")))},EditLinkLabelForm}(i.Component);t.EditLinkLabelForm=a},3287:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1574),a=n(1635),s=n(1554),l=n(1560),c=n(1585),u="ontodia-halo",d=function(e){function Halo(t){var n=e.call(this,t)||this;return n.listener=new s.EventObserver,n.targetListener=new s.EventObserver,n.queryDebouncer=new l.Debouncer,n.queryCancellation=new l.Cancellation,n.onElementEvent=function(e){(e.changePosition||e.changeSize||e.changeExpanded)&&n.forceUpdate(),e.changeData&&n.queryAllowedActions()},n.onEstablishNewLink=function(e){var t=n.props.paperArea.pageToPaperCoords(e.pageX,e.pageY);n.props.onEstablishNewLink(t)},n.state={},n}return r.__extends(Halo,e),Halo.prototype.componentDidMount=function(){var e=this,t=this.props,n=t.editor,r=t.target;this.listener.listen(n.events,"changeAuthoringState",(function(){e.queryAllowedActions()})),this.listenToElement(r),this.queryAllowedActions()},Halo.prototype.componentDidUpdate=function(e){e.target!==this.props.target&&(this.listenToElement(this.props.target),this.queryAllowedActions())},Halo.prototype.componentWillUnmount=function(){this.listener.stopListening(),this.listenToElement(void 0),this.queryDebouncer.dispose(),this.queryCancellation.abort()},Halo.prototype.listenToElement=function(e){this.targetListener.stopListening(),e&&this.targetListener.listenAny(e.events,this.onElementEvent)},Halo.prototype.queryAllowedActions=function(){var e=this;this.queryDebouncer.call((function(){e.queryCancellation.abort(),e.queryCancellation=new l.Cancellation,e.canLink(e.props.target)}))},Halo.prototype.canLink=function(e){var t=this,n=this.props,r=n.metadataApi,i=n.editor;if(r){var o=i.authoringState.elements.get(e.iri);if(o&&o.deleted)this.setState({canLink:!1});else{this.setState({canLink:void 0});var a=this.queryCancellation.signal;l.CancellationToken.mapCancelledToNull(a,r.canLinkElement(e.data,a)).then((function(n){null!==n&&t.props.target.iri===e.iri&&t.setState({canLink:n})}))}}else this.setState({canLink:!1})},Halo.prototype.render=function(){var e=this.props,t=e.paperArea,n=e.editor,r=e.target,a=e.navigationMenuOpened,s=e.onToggleNavigationMenu,l=e.onAddToFilter,c=e.onExpand,d=e.onFollowLink;if(!r)return i.createElement("div",{className:u,style:{display:"none"}});var p=o.boundsOf(r),h=t.paperToScrollablePaneCoords(p.x,p.y),f=h.x,m=h.y,g=t.paperToScrollablePaneCoords(p.x+p.width,p.y+p.height),v={left:f-5,top:m-5,width:g.x-f+10,height:g.y-m+10};return i.createElement("div",{className:u,style:v},this.renderRemoveOrDeleteButton(),s&&i.createElement("div",{className:u+"__navigate "+u+"__navigate--"+(a?"closed":"open"),role:"button",title:"Open a dialog to navigate to connected elements",onClick:s}),d&&i.createElement("a",{className:u+"__folow",href:r.iri,role:"button",title:"Jump to resource",onClick:function(e){return d(r,e)}}),l&&i.createElement("div",{className:u+"__add-to-filter",role:"button",title:"Search for connected elements",onClick:l}),c&&i.createElement("div",{className:u+"__expand "+u+"__expand--"+(r.isExpanded?"closed":"open"),role:"button",title:"Expand an element to reveal additional properties",onClick:c}),n.inAuthoringMode?this.renderEstablishNewLinkButton():null)},Halo.prototype.renderRemoveOrDeleteButton=function(){var e=this.props,t=e.editor,n=e.target,r=e.onRemove;if(!r)return null;var o=a.AuthoringState.isNewElement(t.authoringState,n.iri);return i.createElement("div",{className:o?u+"__delete":u+"__remove",role:"button",title:o?"Delete new element":"Remove an element from the diagram",onClick:r})},Halo.prototype.renderEstablishNewLinkButton=function(){var e=this.props.onEstablishNewLink,t=this.state.canLink;if(!e)return null;if(void 0===t)return i.createElement("div",{className:u+"__establish-connection-spinner"},i.createElement(c.HtmlSpinner,{width:20,height:20}));var n=t?"Establish connection":"Establishing connection is unavailable for the selected element";return i.createElement("button",{className:u+"__establish-connection",title:n,onMouseDown:this.onEstablishNewLink,disabled:!t})},Halo}(i.Component);t.Halo=d},3288:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1574),a=n(1554),s=n(1560),l=n(1585),c="ontodia-halo-link",u=function(e){function HaloLink(t){var n=e.call(this,t)||this;return n.listener=new a.EventObserver,n.targetListener=new a.EventObserver,n.queryDebouncer=new s.Debouncer,n.queryCancellation=new s.Cancellation,n.updateAll=function(){return n.forceUpdate()},n.onSourceMove=function(e){var t=n.props.paperArea.pageToPaperCoords(e.pageX,e.pageY);n.props.onSourceMove(t)},n.onTargetMove=function(e){var t=n.props.paperArea.pageToPaperCoords(e.pageX,e.pageY);n.props.onTargetMove(t)},n.state={},n}return r.__extends(HaloLink,e),HaloLink.prototype.componentDidMount=function(){var e=this,t=this.props,n=t.target,r=t.editor;this.listener.listen(r.events,"changeAuthoringState",(function(){e.queryAllowedActions()})),this.listenToTarget(n),this.queryAllowedActions()},HaloLink.prototype.componentDidUpdate=function(e){e.target!==this.props.target&&(this.listenToTarget(this.props.target),this.queryAllowedActions())},HaloLink.prototype.componentWillUnmount=function(){this.listener.stopListening(),this.listenToTarget(void 0),this.queryDebouncer.dispose(),this.queryCancellation.abort()},HaloLink.prototype.queryAllowedActions=function(){var e=this;this.queryDebouncer.call((function(){e.queryCancellation.abort(),e.queryCancellation=new s.Cancellation,e.queryCanDelete(e.props.target),e.queryCanEdit(e.props.target)}))},HaloLink.prototype.queryCanDelete=function(e){var t=this,n=this.props,r=n.metadataApi,i=n.editor,o=n.view;if(r)if(isSourceOrTargetDeleted(i.authoringState,e))this.setState({canDelete:!1});else{this.setState({canDelete:void 0});var a=o.model.getElement(e.sourceId),l=o.model.getElement(e.targetId),c=this.queryCancellation.signal;s.CancellationToken.mapCancelledToNull(c,r.canDeleteLink(e.data,a.data,l.data,c)).then((function(n){null!==n&&t.props.target.id===e.id&&t.setState({canDelete:n})}))}else this.setState({canDelete:!1})},HaloLink.prototype.queryCanEdit=function(e){var t=this,n=this.props,r=n.metadataApi,i=n.editor,o=n.view;if(r)if(isDeletedLink(i.authoringState,e))this.setState({canEdit:!1});else{this.setState({canEdit:void 0});var a=o.model.getElement(e.sourceId),l=o.model.getElement(e.targetId),c=this.queryCancellation.signal;s.CancellationToken.mapCancelledToNull(c,r.canEditLink(e.data,a.data,l.data,c)).then((function(n){null!==n&&t.props.target.id===e.id&&t.setState({canEdit:n})}))}else this.setState({canEdit:!1})},HaloLink.prototype.listenToTarget=function(e){var t=this,n=this.props.view;if(this.targetListener.stopListening(),e){var r=n.model.getElement(e.sourceId),i=n.model.getElement(e.targetId),listenToElement=function(e){t.targetListener.listen(e.events,"changePosition",t.updateAll),t.targetListener.listen(e.events,"changeSize",t.updateAll)};listenToElement(r),listenToElement(i),this.targetListener.listen(e.events,"changeVertices",this.updateAll),this.targetListener.listen(e.events,"changeLabelBounds",this.updateAll)}},HaloLink.prototype.paperToScrollablePaneCoords=function(e){return this.props.paperArea.paperToScrollablePaneCoords(e.x,e.y)},HaloLink.prototype.computePolyline=function(){var e=this.props,t=e.view,n=e.target,r=t.model.getElement(n.sourceId),i=t.model.getElement(n.targetId);if(r&&i){var a=t.getRouting(n.id),s=n.vertices||[],l=a?a.vertices:s;return o.computePolyline(r,i,l)}},HaloLink.prototype.calculateDegree=function(e,t){var n=t.x-e.x,r=t.y-e.y,i=Math.sqrt(n*n+r*r),o={x:n/i,y:r/i};return Math.atan2(o.y,o.x)*(180/Math.PI)},HaloLink.prototype.renderSourceButton=function(e){var t=this.props,n=t.editor,r=t.target,a=o.getPointAlongPolyline(e,0),s=this.paperToScrollablePaneCoords(a),l=s.x,u={top:s.y-10,left:l-10};return i.createElement("button",{className:c+"__button",style:u,disabled:isDeletedLink(n.authoringState,r),onMouseDown:this.onSourceMove},i.createElement("svg",{width:20,height:20},i.createElement("g",{transform:"scale(20)"},i.createElement("circle",{r:.5,cx:.5,cy:.5,fill:"#198AD3"}))))},HaloLink.prototype.getButtonPosition=function(e,t){var n=o.computePolylineLength(e),r=o.getPointAlongPolyline(e,n-25*t),i=this.paperToScrollablePaneCoords(r),a=i.x;return{top:i.y-10,left:a-10}},HaloLink.prototype.renderTargetButton=function(e){var t=this.props,n=t.editor,r=t.target,o=this.getButtonPosition(e,0),a=e.length,s=this.calculateDegree(e[a-1],e[a-2]);return i.createElement("button",{className:c+"__button",style:o,disabled:isDeletedLink(n.authoringState,r),onMouseDown:this.onTargetMove},i.createElement("svg",{width:20,height:20,style:{transform:"rotate("+s+"deg)"}},i.createElement("g",{transform:"scale(20)"},i.createElement("polygon",{points:"0,0.5 1,1 1,0",fill:"#198AD3"}))))},HaloLink.prototype.renderEditButton=function(e){var t=this.state.canEdit,n=this.getButtonPosition(e,1);if(void 0===t)return i.createElement("div",{className:c+"__spinner",style:n},i.createElement(l.HtmlSpinner,{width:20,height:20}));var r=t?"Edit link":"Editing is unavailable for the selected link";return i.createElement("button",{className:c+"__button "+c+"__edit",style:n,title:r,onClick:this.props.onEdit,disabled:!t})},HaloLink.prototype.renderDeleteButton=function(e){var t=this.state.canDelete,n=this.getButtonPosition(e,2);if(void 0===t)return i.createElement("div",{className:c+"__spinner",style:n},i.createElement(l.HtmlSpinner,{width:20,height:20}));var r=t?"Delete link":"Deletion is unavailable for the selected link";return i.createElement("button",{className:c+"__button "+c+"__delete",style:n,title:r,onClick:this.props.onDelete,disabled:!t})},HaloLink.prototype.renderEditLabelButton=function(){var e=this.props,t=e.view,n=e.target,r=e.paperArea,o=e.onEditLabel,a=t.model.getLinkType(n.typeId);if(!t.createLinkTemplate(a).setLinkLabel||!n.labelBounds)return null;var s=n.labelBounds,l=s.x,u=s.y,d=s.width,p=s.height,h=r.paperToScrollablePaneCoords(l+d,u+p/2),f=h.x,m=17,g={width:15,height:m,top:h.y-m/2,left:f};return i.createElement("button",{className:c+"__edit-label-button",style:g,onClick:function(){return o()},title:"Edit Link Label"})},HaloLink.prototype.render=function(){var e=this.props,t=e.editor,n=e.target,r=e.metadataApi,o=this.computePolyline();if(!o)return null;var a=Boolean(r),s=isDeletedByItself(t.authoringState,n)||isSourceOrTargetDeleted(t.authoringState,n)?null:this.renderDeleteButton(o);return i.createElement("div",{className:""+c},a?this.renderTargetButton(o):null,a?this.renderSourceButton(o):null,!a||isDeletedLink(t.authoringState,n)?null:this.renderEditButton(o),a?s:null,this.renderEditLabelButton())},HaloLink}(i.Component);function isDeletedLink(e,t){return isDeletedByItself(e,t)||isSourceOrTargetDeleted(e,t)}function isDeletedByItself(e,t){var n=e.links.get(t.data);return n&&n.deleted}function isSourceOrTargetDeleted(e,t){var n=e.elements.get(t.data.sourceId),r=e.elements.get(t.data.targetId);return n&&n.deleted||r&&r.deleted}t.HaloLink=u},3289:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1574),a=n(1692),s=n(1634),l=n(1560),c=n(1554),u=n(1585),d=n(1635),p="ontodia-authoring-state",h=function(e){function LinkStateWidget(){var t=null!==e&&e.apply(this,arguments)||this;return t.listener=new c.EventObserver,t.delayedUpdate=new l.Debouncer,t.scheduleUpdate=function(){t.delayedUpdate.call(t.performUpdate)},t.performUpdate=function(){t.forceUpdate()},t}return r.__extends(LinkStateWidget,e),LinkStateWidget.prototype.componentDidMount=function(){this.listenEvents()},LinkStateWidget.prototype.componentDidUpdate=function(e){this.props.view===e.view||(this.listener.stopListening(),this.listenEvents())},LinkStateWidget.prototype.componentWillUnmount=function(){this.listener.stopListening()},LinkStateWidget.prototype.listenEvents=function(){var e=this,t=this.props,n=t.editor,r=t.view;this.listener.listen(n.model.events,"elementEvent",(function(t){var n=t.data;(n.changeSize||n.changePosition)&&e.scheduleUpdate()})),this.listener.listen(n.model.events,"linkEvent",(function(t){var n=t.data;(n.changeVertices||n.changeLabelBounds)&&e.scheduleUpdate()})),this.listener.listen(n.model.events,"changeCells",this.scheduleUpdate),this.listener.listen(n.events,"changeAuthoringState",this.scheduleUpdate),this.listener.listen(n.events,"changeTemporaryState",this.scheduleUpdate),this.listener.listen(n.events,"changeValidationState",this.scheduleUpdate),this.listener.listen(r.events,"syncUpdate",(function(t){t.layer===s.RenderingLayer.Editor&&e.delayedUpdate.runSynchronously()}))},LinkStateWidget.prototype.calculateLinkPath=function(e){return"M"+this.calculatePolyline(e).map((function(e){return e.x+","+e.y})).join(" L")},LinkStateWidget.prototype.calculatePolyline=function(e){var t=this.props,n=t.editor,r=t.view,i=n.model.getElement(e.sourceId),a=n.model.getElement(e.targetId),s=r.getRouting(e.id),l=e.vertices||[],c=s?s.vertices:l;return o.computePolyline(i,a,c)},LinkStateWidget.prototype.renderLinkStateLabels=function(){var e=this,t=this.props.editor;return t.model.links.map((function(n){var r=null,o=t.authoringState.links.get(n.data);if(o){var a=void 0,s=void 0;o.deleted?(a="Delete",s="Revert deletion of the link"):o.before?(a="Change",s="Revert all changes in properties of the link"):(a="New",s="Revert creation of the link"),a&&s&&(r=i.createElement("span",null,i.createElement("span",{className:p+"__state-label"},a),"[",i.createElement("span",{className:p+"__state-cancel",onClick:function(){return t.discardChange(o)},title:s},"cancel"),"]"))}var l=e.renderLinkErrors(n.data);if(r||l){var c=e.getLinkStateLabelPosition(n);if(!c)return null;var u={left:c.x,top:c.y};return i.createElement("div",{className:p+"__state-indicator",key:n.id,style:u},i.createElement("div",{className:p+"__state-indicator-container"},i.createElement("div",{className:p+"__state-indicator-body"},r,l)))}return null}))},LinkStateWidget.prototype.renderLinkStateHighlighting=function(){var e=this,t=this.props.editor;return t.model.links.map((function(n){if(t.temporaryState.links.has(n.data)){var r=e.calculateLinkPath(n);return i.createElement("path",{key:n.id,d:r,fill:"none",stroke:"grey",strokeWidth:5,strokeOpacity:.5,strokeDasharray:"8 8"})}var o=t.authoringState.links.get(n.data),a=d.AuthoringState.isDeletedLink(t.authoringState,n.data),s=d.AuthoringState.isUncertainLink(t.authoringState,n.data);if(o||a||s){r=e.calculateLinkPath(n);var l=void 0;return a?l="red":s?l="blue":o&&o.type===d.AuthoringKind.ChangeLink&&(l=o.before?"blue":"green"),i.createElement("path",{key:n.id,d:r,fill:"none",stroke:l,strokeWidth:5,strokeOpacity:.5})}return null}))},LinkStateWidget.prototype.getLinkStateLabelPosition=function(e){if(e.labelBounds){var t=e.labelBounds;return{x:t.x,y:t.y-2.5}}var n=this.calculatePolyline(e),r=o.computePolylineLength(n);return o.getPointAlongPolyline(n,r/2)},LinkStateWidget.prototype.renderLinkErrors=function(e){var t=this.props.editor.validationState.links.get(e);if(!t)return null;var n=t.errors.map((function(e){return e.message})).join("\n");return this.renderErrorIcon(n,t)},LinkStateWidget.prototype.renderErrorIcon=function(e,t){return i.createElement("div",{className:p+"__item-error",title:e},t.loading?i.createElement(u.HtmlSpinner,{width:15,height:17}):i.createElement("div",{className:p+"__item-error-icon"}),!t.loading&&t.errors.length>0?t.errors.length:void 0)},LinkStateWidget.prototype.render=function(){var e=this.props,t=e.editor,n=e.paperTransform,r=n.scale,o=n.originX,s=n.originY;if(!t.inAuthoringMode)return null;var l={position:"absolute",left:0,top:0,transform:"scale("+r+","+r+")translate("+o+"px,"+s+"px)"};return i.createElement("div",{className:""+p},i.createElement(a.TransformedSvgCanvas,{paperTransform:n,style:{overflow:"visible",pointerEvents:"none"}},this.renderLinkStateHighlighting()),i.createElement("div",{className:p+"__validation-layer",style:l},this.renderLinkStateLabels()))},LinkStateWidget}(i.Component);t.LinkStateWidget=h},3290:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1554),a=n(1585),s="ontodia-authoring-state",l=function(e){function ElementDecorator(t){var n=e.call(this,t)||this;n.listener=new o.EventObserver;var r=t.model,i=t.editor;return n.state={state:i.authoringState.elements.get(r.iri),validation:i.validationState.elements.get(r.iri),isTemporary:i.temporaryState.elements.has(r.iri)},n}return r.__extends(ElementDecorator,e),ElementDecorator.prototype.componentDidMount=function(){var e=this,t=this.props,n=t.model,r=t.editor;this.listener.listen(n.events,"changeSize",(function(){return e.forceUpdate()})),this.listener.listen(r.events,"changeAuthoringState",(function(t){var i=r.authoringState.elements.get(n.iri);i!==t.previous.elements.get(n.iri)&&e.setState({state:i})})),this.listener.listen(r.events,"changeValidationState",(function(t){var i=r.validationState.elements.get(n.iri);i!==t.previous.elements.get(n.iri)&&e.setState({validation:i})})),this.listener.listen(r.events,"changeTemporaryState",(function(t){var i=r.temporaryState.elements.has(n.iri);i!==t.previous.elements.has(n.iri)&&e.setState({isTemporary:i})})),this.listener.listen(n.events,"changeData",(function(t){t.previous.id!==n.iri&&e.setState({isTemporary:r.temporaryState.elements.has(n.iri),validation:r.validationState.elements.get(n.iri),state:r.authoringState.elements.get(n.iri)})}))},ElementDecorator.prototype.componentWillUnmount=function(){this.listener.stopListening()},ElementDecorator.prototype.shouldComponentUpdate=function(e,t){return this.state.state!==t.state||this.state.validation!==t.validation||this.state.isTemporary!==t.isTemporary||this.props.position!==e.position},ElementDecorator.prototype.renderElementOutlines=function(){var e=this.props.model,t=this.state,n=t.state,r=t.isTemporary,o=e.size,a=o.width,s=o.height;if(r)return[i.createElement("rect",{key:e.id+"-opacity",x:0,y:0,width:a,height:s,fill:"rgba(255, 255, 255, 0.5)"}),i.createElement("rect",{key:e.id+"-stripes",x:0,y:0,width:a,height:s,fill:"url(#stripe-pattern)"})];if(n&&n.deleted){var l=a,c=s;return i.createElement("g",{key:e.id},i.createElement("rect",{x:0,y:0,width:a,height:s,fill:"white",fillOpacity:.5}),i.createElement("line",{x1:0,y1:0,x2:l,y2:c,stroke:"red"}),i.createElement("line",{x1:l,y1:0,x2:0,y2:c,stroke:"red"}))}return null},ElementDecorator.prototype.renderErrorIcon=function(e,t){return i.createElement("div",{className:s+"__item-error",title:e},t.loading?i.createElement(a.HtmlSpinner,{width:15,height:17}):i.createElement("div",{className:s+"__item-error-icon"}),!t.loading&&t.errors.length>0?t.errors.length:void 0)},ElementDecorator.prototype.renderElementErrors=function(){var e=this.props.view,t=this.state.validation;if(!t)return null;var n=t.errors.map((function(t){if(t.propertyType){var n=e.model.createProperty(t.propertyType),r=n.id,i=n.label;return e.formatLabel(i,r)+": "+t.message}return t.message})).join("\n");return this.renderErrorIcon(n,t)},ElementDecorator.prototype.renderElementState=function(){var e=this.props,t=e.model,n=e.editor,r=this.state.state;if(r){var o=void 0,a=void 0,l=void 0;r.deleted?(a="Delete",l="Revert deletion of the element"):r.before?(a="Change",l="Revert all changes in properties of the element"):(a="New",l="Revert creation of the element"),a&&l&&(o=i.createElement("span",null,i.createElement("span",{className:s+"__state-label"},a),"[",i.createElement("span",{className:s+"__state-cancel",onClick:function(){return n.discardChange(r)},title:l},"cancel"),"]"));var c=this.renderElementErrors();if(o||c)return i.createElement("div",{className:s+"__state-indicator",key:t.id,style:{left:0,top:0}},i.createElement("div",{className:s+"__state-indicator-container"},i.createElement("div",{className:s+"__state-indicator-body"},o,c)))}return null},ElementDecorator.prototype.render=function(){var e=this.props.model,t=e.position,n=e.size,r="translate("+t.x+"px,"+t.y+"px)",o=this.renderElementOutlines(),a=this.renderElementState();return o||a?i.createElement("div",{style:{position:"absolute",transform:r}},o?i.createElement("svg",{width:n.width,height:n.height,style:{position:"absolute",pointerEvents:"none",overflow:"visible"}},i.createElement("defs",null,i.createElement("pattern",{id:"stripe-pattern",patternUnits:"userSpaceOnUse",width:13,height:13,patternTransform:"rotate(45)"},i.createElement("line",{x1:0,y:0,x2:0,y2:13,stroke:"#ddd",strokeWidth:10,strokeOpacity:.2}))),this.renderElementOutlines()):null,a):null},ElementDecorator}(i.Component);t.ElementDecorator=l},3291:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(11),o=n(1),a=n(1580),s=n(2274),l=n(1573),c=n(1574),u=n(1692),d=n(1560),p=n(1554),h=n(1585),f=n(1635);!function(e){e[e.establishLink=0]="establishLink",e[e.moveLinkSource=1]="moveLinkSource",e[e.moveLinkTarget=2]="moveLinkTarget"}(r=t.EditLayerMode||(t.EditLayerMode={}));var m=function(e){function EditLayer(t){var n=e.call(this,t)||this;return n.listener=new p.EventObserver,n.cancellation=new d.Cancellation,n.canDropOnElementCancellation=new d.Cancellation,n.beginCreatingLink=function(e){var t=n.props.editor,r=e.sourceId,i=e.point,o=n.createTemporaryElement(i),s=new l.Link({typeId:a.PLACEHOLDER_LINK_TYPE,sourceId:r,targetId:o.id}),c=t.createNewLink({link:s,temporary:!0});t.model.createLinkType(c.typeId).setVisibility({visible:!0,showLabel:!1}),n.temporaryElement=o,n.temporaryLink=c},n.onMouseMove=function(e){var t=n.props,r=t.view,i=t.paperArea,o=n.state,a=o.targetElement,s=o.waitingForMetadata;if(e.preventDefault(),e.stopPropagation(),!s){var l=i.pageToPaperCoords(e.pageX,e.pageY);n.temporaryElement.setPosition(l);var u=c.findElementAtPoint(r.model.elements,l);u!==a&&n.queryCanDropOnElement(u),n.setState({targetElement:u})}},n.onMouseUp=function(e){if(!n.state.waitingForMetadata){n.setState({waitingForMetadata:!0});var t=n.props.paperArea.pageToPaperCoords(e.pageX,e.pageY);n.executeEditOperation(t)}},n.createNewElement=function(e){return i.__awaiter(n,void 0,Promise,(function(){var t,n,r,o,s,l;return i.__generator(this,(function(i){switch(i.label){case 0:return t=this.props,n=t.editor,(r=t.metadataApi)?[4,d.CancellationToken.mapCancelledToNull(this.cancellation.signal,r.typesOfElementsDraggedFrom(e,this.cancellation.signal))]:[2];case 1:return null===(o=i.sent())?[2]:(s=1===o.length?o[0]:a.PLACEHOLDER_ELEMENT_TYPE,[4,d.CancellationToken.mapCancelledToNull(this.cancellation.signal,r.generateNewElement([s],this.cancellation.signal))]);case 2:return null===(l=i.sent())?[2]:[2,n.createNewEntity({elementModel:l,temporary:!0})]}}))}))},n.state={},n}return i.__extends(EditLayer,e),EditLayer.prototype.componentDidMount=function(){var e=this.props,t=e.mode,n=e.target,i=e.point;if(t===r.establishLink)this.beginCreatingLink({sourceId:n.id,point:i});else{if(t!==r.moveLinkSource&&t!==r.moveLinkTarget)throw new Error("Unknown edit mode");this.beginMovingLink(n,i)}this.forceUpdate(),this.queryCanLinkFrom(),this.queryCanDropOnCanvas(),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},EditLayer.prototype.componentWillUnmount=function(){this.listener.stopListening(),this.cancellation.abort(),this.canDropOnElementCancellation.abort(),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)},EditLayer.prototype.beginMovingLink=function(e,t){var n=this.props,o=n.editor,a=n.mode;if(a!==r.moveLinkSource&&a!==r.moveLinkTarget)throw new Error("Unexpected edit mode for moving link");this.oldLink=e,o.model.removeLink(e.id);e.id;var s=e.typeId,c=e.sourceId,u=e.targetId,d=i.__rest(e,["id","typeId","sourceId","targetId"]),p=this.createTemporaryElement(t),h=new l.Link(i.__assign({typeId:s,sourceId:a===r.moveLinkSource?p.id:c,targetId:a===r.moveLinkTarget?p.id:u},d)),f=o.createNewLink({link:h,temporary:!0});this.temporaryElement=p,this.temporaryLink=f},EditLayer.prototype.createTemporaryElement=function(e){var t=this.props.view.model.createTemporaryElement();return t.setPosition(e),t},EditLayer.prototype.queryCanLinkFrom=function(){var e=this,t=this.props,n=t.editor,r=t.metadataApi;if(r){this.setState({canLinkFrom:void 0});var i=n.model.getElement(this.temporaryLink.sourceId);d.CancellationToken.mapCancelledToNull(this.cancellation.signal,r.canLinkElement(i.data,this.cancellation.signal)).then((function(t){null!==t&&e.setState({canLinkFrom:t})}),(function(t){console.error("Error calling canLinkElement:",t),e.setState({canLinkFrom:!1})}))}else this.setState({canLinkFrom:!1})},EditLayer.prototype.queryCanDropOnCanvas=function(){var e=this,t=this.props,n=t.mode,i=t.editor,o=t.metadataApi;if(o&&n===r.establishLink){this.setState({canDropOnCanvas:void 0});var a=i.model.getElement(this.temporaryLink.sourceId);d.CancellationToken.mapCancelledToNull(this.cancellation.signal,o.canDropOnCanvas(a.data,this.cancellation.signal)).then((function(t){null!==t&&e.setState({canDropOnCanvas:t})}),(function(t){console.error("Error calling canDropOnCanvas:",t),e.setState({canDropOnCanvas:!1})}))}else this.setState({canDropOnCanvas:!1})},EditLayer.prototype.queryCanDropOnElement=function(e){var t=this,n=this.props,i=n.mode,o=n.editor,a=n.metadataApi;if(this.canDropOnElementCancellation.abort(),this.canDropOnElementCancellation=new d.Cancellation,a&&e){var s,l;this.setState({canDropOnElement:void 0}),i===r.establishLink||i===r.moveLinkTarget?(s=o.model.getElement(this.temporaryLink.sourceId).data,l=e.data):i===r.moveLinkSource&&(s=e.data,l=o.model.getElement(this.temporaryLink.targetId).data);var c=this.canDropOnElementCancellation.signal;d.CancellationToken.mapCancelledToNull(c,a.canDropOnElement(s,l,c)).then((function(e){null!==e&&t.setState({canDropOnElement:e})}))}else this.setState({canDropOnElement:!1})},EditLayer.prototype.executeEditOperation=function(e){return i.__awaiter(this,void 0,Promise,(function(){var t,n,o,a,s,l,c,u,d,p,h,f,m,g,v;return i.__generator(this,(function(i){switch(i.label){case 0:t=this.props,n=t.view,o=t.editor,a=t.mode,i.label=1;case 1:if(i.trys.push([1,,11,12]),s=this.state,l=s.targetElement,c=s.canLinkFrom,u=s.canDropOnCanvas,d=s.canDropOnElement,this.oldLink&&o.model.addLink(this.oldLink),p=l?d:u,!c||!p)return[3,10];switch(h=void 0,f=l,a){case r.establishLink:return[3,2];case r.moveLinkSource:return[3,6];case r.moveLinkTarget:return[3,7]}return[3,8];case 2:return f?[3,4]:(v=o.model.getElement(this.temporaryLink.sourceId),[4,this.createNewElement(v.data)]);case 3:(f=i.sent()).setPosition(e),n.performSyncUpdate(),function centerElementAtPoint(e,t){e.setPosition({x:t.x-e.size.width/2,y:t.y-e.size.height/2})}(f,e),i.label=4;case 4:return m=o.model.getElement(this.temporaryLink.sourceId),[4,this.createNewLink(m,f)];case 5:return h=i.sent(),[3,9];case 6:return h=o.moveLinkSource({link:this.oldLink,newSource:l}),[3,9];case 7:return h=o.moveLinkTarget({link:this.oldLink,newTarget:l}),[3,9];case 8:throw new Error("Unknown edit mode");case 9:l?(g=h||this.oldLink,o.setSelection([g]),o.showEditLinkForm(g)):f&&h&&(o.setSelection([f]),v=o.model.getElement(h.sourceId),o.showEditElementTypeForm({link:h,source:v,target:f,targetIsNew:!0})),i.label=10;case 10:return[3,12];case 11:return this.cleanupAndFinish(),[7];case 12:return[2]}}))}))},EditLayer.prototype.createNewLink=function(e,t){return i.__awaiter(this,void 0,Promise,(function(){var n,r,o,s,c,u,p,h,f,m,g,v,y,k;return i.__generator(this,(function(i){switch(i.label){case 0:return n=this.props,r=n.editor,(o=n.metadataApi)?[4,d.CancellationToken.mapCancelledToNull(this.cancellation.signal,o.possibleLinkTypes(e.data,t.data,this.cancellation.signal))]:[2,void 0];case 1:return null===(s=i.sent())?[2,void 0]:(c={linkTypeIri:a.PLACEHOLDER_LINK_TYPE,direction:l.LinkDirection.out},u=1===s.length?s[0]:c,p=u.linkTypeIri,h=u.direction,f={linkTypeId:p,sourceId:e.iri,targetId:t.iri},m=[e.id,t.id],g=m[0],v=m[1],h===l.LinkDirection.in&&(f.sourceId=t.iri,f.targetId=e.iri,g=(k=[v,g])[0],v=k[1]),y=new l.Link({typeId:p,sourceId:g,targetId:v,data:f}),[2,r.model.findLink(y.typeId,y.sourceId,y.targetId)||r.createNewLink({link:y,temporary:!0})])}}))}))},EditLayer.prototype.cleanupAndFinish=function(){var e=this.props,t=e.editor,n=e.onFinishEditing,r=t.model.history.startBatch();t.model.removeElement(this.temporaryElement.id),t.model.removeLink(this.temporaryLink.id),t.setTemporaryState(f.TemporaryState.deleteLink(t.temporaryState,this.temporaryLink.data)),r.discard(),n()},EditLayer.prototype.render=function(){var e=this.props,t=e.view,n=e.paperTransform,r=this.state.waitingForMetadata;return this.temporaryLink?o.createElement(u.TransformedSvgCanvas,{paperTransform:n,style:{overflow:"visible"}},o.createElement(s.LinkMarkers,{view:t}),this.renderHighlight(),this.renderCanDropIndicator(),r?null:o.createElement(s.LinkLayer,{view:t,links:[this.temporaryLink]})):null},EditLayer.prototype.renderHighlight=function(){var e=this.state,t=e.targetElement,n=e.canLinkFrom,r=e.canDropOnElement,i=e.waitingForMetadata;if(!t)return null;var a=c.boundsOf(t),s=a.x,l=a.y,u=a.width,d=a.height;if(void 0===n||void 0===r||i)return o.createElement("g",{transform:"translate("+s+","+l+")"},o.createElement("rect",{width:u,height:d,fill:"white",fillOpacity:.5}),o.createElement(h.Spinner,{size:30,position:{x:u/2,y:d/2}}));var p=n&&r?"#5cb85c":"#c9302c";return o.createElement("rect",{x:s,y:l,width:u,height:d,fill:"transparent",stroke:p,strokeWidth:3})},EditLayer.prototype.renderCanDropIndicator=function(){var e=this.state,t=e.targetElement,n=e.canLinkFrom,r=e.canDropOnCanvas,i=e.waitingForMetadata;if(t)return null;var a,s=this.temporaryElement.position,l=s.x,c=s.y;return a=void 0===n||void 0===r?o.createElement(h.Spinner,{size:1.2,position:{x:.5,y:-.5}}):n&&r?o.createElement("path",{d:"M0.5,0 L0.5,-1 M0,-0.5 L1,-0.5",strokeWidth:.2,stroke:"#5cb85c"}):o.createElement("g",null,o.createElement("circle",{cx:"0.5",cy:"-0.5",r:"0.5",fill:"none",strokeWidth:.2,stroke:"#c9302c"}),o.createElement("path",{d:"M0.5,0 L0.5,-1",strokeWidth:.2,stroke:"#c9302c",transform:"rotate(-45 0.5 -0.5)"})),o.createElement("g",{transform:"translate("+l+" "+c+")scale(40)"},o.createElement("rect",{x:-.5,y:-.5,width:1,height:1,fill:"rgba(0, 0, 0, 0.1)",rx:.25,ry:.25}),i?o.createElement(h.Spinner,{size:.8}):o.createElement("g",{transform:"translate(0.5, -0.5)scale(0.25)"},a))},EditLayer}(o.Component);t.EditLayer=m},3292:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(20),a=n(1213),s=n(1655),l=n(1693),c=n(1634),u=n(1984),d=n(1635),p=n(2327),h=n(1554),f=n(2275),m=n(3293),g=n(2332),v=n(3294),y=n(1657),k=n(1748),E=function(e){function Workspace(t){var n=e.call(this,t)||this;n.listener=new h.EventObserver,n.zoomToFit=function(){n.markup.paperArea.zoomToFit()},n.zoomToFitRect=function(e){n.markup.paperArea.zoomToFitRect(e)},n.clearAll=function(){n.editor.removeItems(r.__spreadArrays(n.model.elements))},n.forceLayout=function(){var e=n.model.history.startBatch("Force layout");e.history.registerToUndo(s.RestoreGeometry.capture(n.model)),k.applyLayout(n.model,k.forceLayout({model:n.model}));for(var t=0,r=n.model.links;t<r.length;t++){r[t].setVertices([])}e.store()},n.exportSvg=function(e){n.markup.paperArea.exportSVG().then((function(t){e=e||"diagram.svg";var n=new Blob(['<?xml version="1.0" encoding="UTF-8"?>'+t],{type:"image/svg+xml"});a.saveAs(n,e)}))},n.exportPng=function(e){e=e||"diagram.png",n.markup.paperArea.exportPNG({backgroundColor:"white"}).then((function(t){var n=f.dataURLToBlob(t);a.saveAs(n,e)}))},n.undo=function(){n.model.history.undo()},n.redo=function(){n.model.history.redo()},n.zoomBy=function(e){n.markup.paperArea.zoomBy(e)},n.zoomIn=function(){n.markup.paperArea.zoomIn()},n.zoomOut=function(){n.markup.paperArea.zoomOut()},n.print=function(){n.markup.paperArea.exportSVG().then((function(e){var t=window.open("",void 0,"width=1280,height=720");t.document.write(e),t.document.close(),t.print()}))},n.changeLanguage=function(e){var t=n.props.onLanguageChange;t?t(e):(n.view.setLanguage(e),n.forceUpdate())},n.centerTo=function(e){n.markup.paperArea.centerTo(e)};var i=n.props,o=i.hideHalo,d=i.history,m=i.viewOptions,g=void 0===m?{}:m,v=i.metadataApi,y=i.validationApi,E=i.propertyEditor,b=i.elementTemplateResolver,L=i.linkTemplateResolver,S=i.typeStyleResolver,w=i.selectLabelLanguage,_=g.linkRouter,T=g.onIriClick,C=g.disableDefaultHalo,P=g.suggestProperties,x=g.groupBy;return n.model=new u.AsyncModel(d||new l.NonRememberingHistory,x||[]),n.view=new c.DiagramView(n.model,{elementTemplateResolver:b,linkTemplateResolver:L,typeStyleResolver:S,selectLabelLanguage:w,linkRouter:_,onIriClick:T}),n.editor=new p.EditorController({model:n.model,view:n.view,disableHalo:o||C,suggestProperties:P,validationApi:y,propertyEditor:E}),n.editor.setMetadataApi(v),n.view.setLanguage(n.props.language),n.state={},n}return r.__extends(Workspace,e),Workspace.prototype._getPaperArea=function(){return this.markup?this.markup.paperArea:void 0},Workspace.prototype.render=function(){var e=this,t=this.props,n=t.hidePanels,r=t.hideToolbar,o=t.metadataApi,a=t.hideScrollBars,s=t.onWorkspaceEvent,l=t._elementsSearchPanel;return i.createElement(v.WorkspaceMarkup,{ref:function(t){e.markup=t},hidePanels:n,hideToolbar:r,hideScrollBars:a,model:this.model,view:this.view,editor:this.editor,metadataApi:o,leftPanelInitiallyOpen:this.props.leftPanelInitiallyOpen,rightPanelInitiallyOpen:this.props.rightPanelInitiallyOpen,searchCriteria:this.state.criteria,onSearchCriteriaChanged:function(t){return e.setState({criteria:t})},zoomOptions:this.props.zoomOptions,onZoom:this.props.onZoom,isLeftPanelOpen:this.props.leftPanelInitiallyOpen,isRightPanelOpen:this.props.rightPanelInitiallyOpen,toolbar:i.createElement(b,{workspace:this}),onWorkspaceEvent:s,elementsSearchPanel:l})},Workspace.prototype.componentDidMount=function(){var e=this,t=this.props.onWorkspaceEvent;this.editor._initializePaperComponents(this.markup.paperArea),this.updateNavigator(!this.props.hideNavigator),this.listener.listen(this.model.events,"loadingSuccess",(function(){e.view.performSyncUpdate(),e.markup.paperArea.centerContent()})),this.listener.listen(this.model.events,"elementEvent",(function(n){n.key;var r=n.data;if(r.requestedAddToFilter){var i=r.requestedAddToFilter,o=i.source,a=i.linkType,s=i.direction;e.setState({criteria:{refElement:o,refElementLink:a,linkDirection:s}}),t&&t(y.WorkspaceEventKey.searchUpdateCriteria)}})),this.listener.listen(this.markup.paperArea.events,"pointerUp",(function(t){e.props.onPointerUp&&e.props.onPointerUp(t)})),this.listener.listen(this.markup.paperArea.events,"pointerMove",(function(t){e.props.onPointerMove&&e.props.onPointerMove(t)})),this.listener.listen(this.markup.paperArea.events,"pointerDown",(function(t){e.props.onPointerDown&&e.props.onPointerDown(t)})),t&&(this.listener.listen(this.editor.events,"changeSelection",(function(){return t(y.WorkspaceEventKey.editorChangeSelection)})),this.listener.listen(this.editor.events,"toggleDialog",(function(){return t(y.WorkspaceEventKey.editorToggleDialog)})),this.listener.listen(this.editor.events,"addElements",(function(){return t(y.WorkspaceEventKey.editorAddElements)})))},Workspace.prototype.componentWillReceiveProps=function(e){Boolean(e.onLanguageChange)&&e.language!==this.view.getLanguage()&&this.view.setLanguage(e.language),e.metadataApi!==this.editor.metadataApi&&this.editor.setMetadataApi(e.metadataApi),e.hideNavigator!==this.props.hideNavigator&&this.updateNavigator(!e.hideNavigator)},Workspace.prototype.componentWillUnmount=function(){this.listener.stopListening(),this.view.dispose()},Workspace.prototype.updateNavigator=function(e){if(e){var t=i.createElement(m.Navigator,{view:this.view,expanded:!this.props.collapseNavigator});this.view.setPaperWidget({key:"navigator",widget:t,attachment:c.WidgetAttachment.Viewport})}else this.view.setPaperWidget({key:"navigator",widget:void 0,attachment:c.WidgetAttachment.Viewport})},Workspace.prototype.getModel=function(){return this.model},Workspace.prototype.getDiagram=function(){return this.view},Workspace.prototype.getEditor=function(){return this.editor},Workspace.prototype.preventTextSelectionUntilMouseUp=function(){this.markup.preventTextSelection()},Workspace.prototype.showWaitIndicatorWhile=function(e){var t=this;this.editor.setSpinner({}),e&&e.then((function(){t.editor.setSpinner(void 0)})).catch((function(e){console.error(e),t.editor.setSpinner({statusText:"Unknown error occured",errorOccured:!0})}))},Workspace.defaultProps={hideTutorial:!0,collapseNavigator:!1,leftPanelInitiallyOpen:!0,rightPanelInitiallyOpen:!1,languages:[{code:"en",label:"English"},{code:"ru",label:"Russian"}],language:"en"},Workspace}(i.Component);t.Workspace=E;var b=function(e){function ToolbarWrapper(){var t=null!==e&&e.apply(this,arguments)||this;return t.listener=new h.EventObserver,t}return r.__extends(ToolbarWrapper,e),ToolbarWrapper.prototype.render=function(){var e=this.props.workspace,t=e.getDiagram(),n=e.getEditor(),o=e.props,a=o.languages,s=o.onSaveDiagram,l=o.onPersistChanges,c=o.hidePanels,u=o.toolbar,p=!d.AuthoringState.isEmpty(n.authoringState),h=l?p:void 0,f=!h;l&&e.props.validationApi.shouldEnforceConstraints()&&(f=!p,h=h&&n.validationState.isValid);var m={onZoomIn:e.zoomIn,onZoomOut:e.zoomOut,onZoomToFit:e.zoomToFit,onPrint:e.print,onExportSVG:e.exportSvg,onExportPNG:e.exportPng,canSaveDiagram:f,onSaveDiagram:s?function(){return s(e)}:void 0,canPersistChanges:h,hasUnpersistedChanges:p,onPersistChanges:l?function(){return l(e)}:void 0,onForceLayout:function(){e.forceLayout(),e.getDiagram().performSyncUpdate(),e.zoomToFit()},onClearAll:e.clearAll,languages:a,selectedLanguage:t.getLanguage(),onChangeLanguage:e.changeLanguage,hidePanels:c};if(u){var v=r.__assign(r.__assign({},m),u.props);return i.cloneElement(u,v)}return i.createElement(g.DefaultToolbar,m)},ToolbarWrapper.prototype.componentDidMount=function(){var e=this,t=this.props.workspace.getEditor();this.listener.listen(t.events,"changeAuthoringState",(function(){e.forceUpdate()})),this.listener.listen(t.events,"changeValidationState",(function(){e.forceUpdate()}))},ToolbarWrapper.prototype.componentWillUnmount=function(){this.listener.stopListening()},ToolbarWrapper}(i.Component);t.renderTo=function renderTo(e,t,n){o.render(i.createElement(e,n),t)}},3293:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1591),a=n(1560),s=n(1554),l=n(1692),c="ontodia-navigator",u=function(e){function Navigator(t,n){var r=e.call(this,t,n)||this;return r.delayedRedraw=new a.Debouncer,r.listener=new s.EventObserver,r.scheduleRedraw=function(){r.state.expanded&&r.delayedRedraw.call(r.draw)},r.draw=function(){var e=r.props,t=e.paperTransform,n=e.width,i=e.height;r.calculateTransform();var o=r.canvas.getContext("2d");o.fillStyle="#EEEEEE",o.clearRect(0,0,n,i),o.fillRect(0,0,n,i);var a=l.paneTopLeft(t),s=l.totalPaneSize(t),c={x:a.x+s.x,y:a.y+s.y},u=canvasFromPaneCoords(a,t,r.transform),d=canvasFromPaneCoords(c,t,r.transform);o.fillStyle="white",o.fillRect(u.x,u.y,d.x-u.x,d.y-u.y),o.save(),r.drawElements(o),r.drawViewport(o),o.restore()},r.onDragViewport=function(e){if(e.preventDefault(),r.isDraggingViewport){var t=function paperFromCanvasCoords(e,t,n){var r={x:n.paneOffset.x+(e.x-n.canvasOffset.x)/n.scale,y:n.paneOffset.y+(e.y-n.canvasOffset.y)/n.scale};return l.paperFromPaneCoords(r,t)}(r.canvasFromPageCoords(e.pageX,e.pageY),r.props.paperTransform,r.transform);r.props.paperArea.centerTo(t)}},r.onMouseUp=function(){r.stopDraggingViewport()},r.onWheel=function(e){e.preventDefault();var t=Math.max(-1,Math.min(1,e.deltaY||e.deltaX));r.props.paperArea.zoomBy(.1*-t)},r.onToggleClick=function(){r.setState((function(e){return{expanded:!e.expanded}}),r.scheduleRedraw)},r.state={expanded:r.props.expanded},r}return r.__extends(Navigator,e),Navigator.prototype.componentDidMount=function(){var e=this.props,t=e.view,n=e.paperArea;this.listener.listen(t.events,"changeHighlight",this.scheduleRedraw),this.listener.listen(t.model.events,"changeCells",this.scheduleRedraw),this.listener.listen(t.model.events,"elementEvent",this.scheduleRedraw),this.listener.listen(n.events,"pointerMove",this.scheduleRedraw),this.listener.listen(n.events,"scroll",this.scheduleRedraw)},Navigator.prototype.shouldComponentUpdate=function(e,t){return t!==this.state},Navigator.prototype.componentWillUnmount=function(){this.delayedRedraw.dispose(),this.listener.stopListening(),this.stopDraggingViewport()},Navigator.prototype.drawElements=function(e){var t=this,n=this.props,r=n.view,i=n.paperTransform;r.model.elements.forEach((function(n){var r=n.position,o=n.size;e.fillStyle=t.chooseElementColor(n);var a=canvasFromPaperCoords(r,i,t.transform),s=a.x,l=a.y,c=canvasFromPaperCoords({x:r.x+o.width,y:r.y+o.height},i,t.transform),u=c.x,d=c.y;e.fillRect(s,l,u-s,d-l)}))},Navigator.prototype.chooseElementColor=function(e){var t=this.props.view;if(t.highlighter&&!t.highlighter(e))return"lightgray";var n=t.getTypeStyle(e.data.types).color,r=n.h,i=n.c,a=n.l;return o.hcl(r,i,a).toString()},Navigator.prototype.drawViewport=function(e){var t=this.props,n=t.paperArea,r=t.paperTransform,i=t.width,o=t.height;e.strokeStyle="#337ab7",e.lineWidth=2;var a=n.getAreaMetrics(),s=a.clientWidth,l=a.clientHeight,c=n.clientToScrollablePaneCoords(0,0),u=n.clientToScrollablePaneCoords(s,l),d=canvasFromPaneCoords(c,r,this.transform),p=d.x,h=d.y,f=canvasFromPaneCoords(u,r,this.transform),m=f.x,g=f.y;e.strokeRect(p,h,m-p,g-h),e.beginPath(),p<0&&(e.moveTo(0,h),e.lineTo(0,g)),h<0&&(e.moveTo(p,0),e.lineTo(m,0)),m>i&&(e.moveTo(i,h),e.lineTo(i,g)),g>o&&(e.moveTo(p,o),e.lineTo(m,o)),e.lineWidth=4,e.strokeStyle="#a0d2ff",e.setLineDash([5,5]),e.stroke()},Navigator.prototype.calculateTransform=function(){var e=this.props,t=e.paperArea,n=e.paperTransform,r=e.width,i=e.height,o=e.scalePadding,a=t.getContentFittingBox(),s=Math.max(a.width,r/.25)*o,c=Math.max(a.height,i/.25)*o,u=l.paneFromPaperCoords({x:a.x-s,y:a.y-c},n),d=l.paneFromPaperCoords({x:a.x+a.width+s,y:a.y+a.height+c},n),p=d.x-u.x,h=d.y-u.y,f=Math.min(r/p,i/h),m={x:(r-p*f)/2,y:(i-h*f)/2};this.transform={scale:f,canvasOffset:m,paneOffset:u}},Navigator.prototype.canvasFromPageCoords=function(e,t){var n=this.canvas.getBoundingClientRect(),r=n.top;return{x:e-n.left-window.pageXOffset,y:t-r-window.pageYOffset}},Navigator.prototype.render=function(){var e=this,t=this.props,n=t.width,r=t.height,o=this.state.expanded;return i.createElement("div",{className:c+" "+c+"--"+(o?"expanded":"collapsed"),style:o?{width:n,height:r}:void 0},i.createElement("canvas",{ref:function(t){return e.canvas=t},width:n,height:r,onMouseDown:function(t){e.startDragginViewport(),e.onDragViewport(t)},onWheel:this.onWheel}),i.createElement("button",{className:c+"__toggle",title:o?"Collapse navigator":"Expand navigator",onClick:this.onToggleClick},i.createElement("div",{className:c+"__toggle-icon"})))},Navigator.prototype.startDragginViewport=function(){this.isDraggingViewport||(this.isDraggingViewport=!0,document.addEventListener("mousemove",this.onDragViewport),document.addEventListener("mouseup",this.onMouseUp))},Navigator.prototype.stopDraggingViewport=function(){this.isDraggingViewport&&(this.isDraggingViewport=!1,document.removeEventListener("mousemove",this.onDragViewport),document.removeEventListener("mouseup",this.onMouseUp))},Navigator.defaultProps={width:300,height:160,scalePadding:.2,expanded:!0},Navigator}(i.Component);function canvasFromPaneCoords(e,t,n){return{x:n.canvasOffset.x+(e.x-n.paneOffset.x)*n.scale,y:n.canvasOffset.y+(e.y-n.paneOffset.y)*n.scale}}function canvasFromPaperCoords(e,t,n){return canvasFromPaneCoords(l.paneFromPaperCoords(e,t),0,n)}t.Navigator=u},3294:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1634),a=n(1656),s=n(3295),l=n(2329),c=n(3303),u=n(1657),d=n(1560),p=n(2333),h=function(e){function WorkspaceMarkup(){var t=null!==e&&e.apply(this,arguments)||this;return t.untilMouseUpClasses=[],t.cancellation=new d.Cancellation,t.triggerWorkspaceEvent=function(e){var n=t.props.onWorkspaceEvent;n&&n(e)},t.onCreateInstance=function(e,n){return r.__awaiter(t,void 0,void 0,(function(){var t,i,o,a,s,l,c,u,p,h;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this.props,i=t.editor,o=t.view,a=t.model,s=t.metadataApi,[4,forceNonReactExecutionContext()];case 1:return r.sent(),l=a.history.startBatch(),c=this.cancellation.signal,[4,d.CancellationToken.mapCancelledToNull(c,s.generateNewElement([e],c))];case 2:return null===(u=r.sent())||(p=i.createNewEntity({elementModel:u,position:n}),n&&(h=n,p.setPosition(h),o.performSyncUpdate(),centerElementToPosition(p,h)),l.store(),i.setSelection([p]),i.showEditEntityForm(p)),[2]}}))}))},t.onDocumentMouseUp=function(){for(var e=0,n=t.untilMouseUpClasses;e<n.length;e++){var r=n[e];t.element.classList.remove(r)}t.untilMouseUpClasses=[]},t.onDropOnPaper=function(e,n){e.preventDefault();var r={dragEvent:e,paperPosition:n};if(!t.props.view._tryHandleDropOnPaper(r)){var i=tryParseDefaultDragAndDropData(e);i.length>0&&t.props.editor.onDragDrop(i,n)}},t}return r.__extends(WorkspaceMarkup,e),WorkspaceMarkup.prototype.getChildContext=function(){return{ontodiaWorkspace:{editor:this.props.editor,triggerWorkspaceEvent:this.triggerWorkspaceEvent}}},WorkspaceMarkup.prototype.addToolbarWidgetToPaper=function(){var e=this.props,t=e.hideToolbar,n=e.view,r=e.toolbar;t||n.setPaperWidget({key:"toolbar",widget:i.createElement(f,null,r),attachment:o.WidgetAttachment.Viewport})},WorkspaceMarkup.prototype.getLeftPanelLayout=function(){var e=this.props,t=e.view,n=e.editor,r=e.model,o=e.searchCriteria,a=e.onSearchCriteriaChanged,c=i.createElement(s.ClassTree,{view:t,editor:n,onClassSelected:function(e){var t=r.createClass(e);a({elementType:t})},onCreateInstance:this.onCreateInstance}),u=i.createElement(l.InstancesSearch,{view:t,model:r,criteria:o||{},onCriteriaChanged:a});return{type:p.WorkspaceLayoutType.Column,children:[{id:"classes",type:p.WorkspaceLayoutType.Component,content:c,heading:"Classes"},{id:"instances",type:p.WorkspaceLayoutType.Component,content:u,heading:"Instances"}],defaultSize:275,defaultCollapsed:!this.props.isLeftPanelOpen}},WorkspaceMarkup.prototype.getRightPanelLayout=function(){var e=this.props,t=e.view,n=e.editor,o=e.elementsSearchPanel,a={type:p.WorkspaceLayoutType.Column,children:[{id:"connections",type:p.WorkspaceLayoutType.Component,content:i.createElement(c.LinkTypesToolbox,{view:t,editor:n}),heading:"Connections"}],defaultSize:275,defaultCollapsed:!this.props.isRightPanelOpen};return o&&(a.children=r.__spreadArrays(a.children,[{id:"search",type:p.WorkspaceLayoutType.Component,content:i.cloneElement(o,{view:t,editor:n}),heading:"Search in diagram"}])),a},WorkspaceMarkup.prototype.render=function(){var e=this,t={id:"paper",type:p.WorkspaceLayoutType.Component,content:i.createElement("div",{className:"ontodia__main-panel",style:{flex:"1 1 0px",width:"100%"}},i.createElement(a.PaperArea,{ref:function(t){return e.paperArea=t},view:this.props.view,zoomOptions:this.props.zoomOptions,hideScrollBars:this.props.hideScrollBars,onDragDrop:this.onDropOnPaper,onZoom:this.props.onZoom}))},n=this.props.hidePanels?t:{type:p.WorkspaceLayoutType.Row,children:[this.getLeftPanelLayout(),t,this.getRightPanelLayout()]};return i.createElement("div",{ref:function(t){return e.element=t},className:"ontodia"},i.createElement("div",{className:"ontodia__workspace"},i.createElement(p.WorkspaceLayout,{layout:n,_onStartResize:function(t){return e.untilMouseUp({preventTextSelection:!0,verticalResizing:"vertical"===t,horizontalResizing:"horizontal"===t})}})))},WorkspaceMarkup.prototype.componentDidMount=function(){document.addEventListener("mouseup",this.onDocumentMouseUp),this.addToolbarWidgetToPaper()},WorkspaceMarkup.prototype.componentWillUnmount=function(){document.removeEventListener("mouseup",this.onDocumentMouseUp),this.cancellation.abort()},WorkspaceMarkup.prototype.preventTextSelection=function(){this.untilMouseUp({preventTextSelection:!0})},WorkspaceMarkup.prototype.untilMouseUp=function(e){this.untilMouseUpClasses=[],e.preventTextSelection&&this.untilMouseUpClasses.push("ontodia--unselectable"),e.horizontalResizing&&this.untilMouseUpClasses.push("ontodia--horizontal-resizing"),e.verticalResizing&&this.untilMouseUpClasses.push("ontodia--vertical-resizing");for(var t=0,n=this.untilMouseUpClasses;t<n.length;t++){var r=n[t];this.element.classList.add(r)}},WorkspaceMarkup.childContextTypes=u.WorkspaceContextTypes,WorkspaceMarkup}(i.Component);t.WorkspaceMarkup=h;var f=function(e){function ToolbarWidget(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(ToolbarWidget,e),ToolbarWidget.prototype.render=function(){return i.createElement("div",{className:"ontodia__toolbar-widget"},this.props.children)},ToolbarWidget}(i.Component);function forceNonReactExecutionContext(){return Promise.resolve()}function centerElementToPosition(e,t){var n={x:t.x-e.size.width/2,y:t.y-e.size.height/2};e.setPosition(n)}function tryParseDefaultDragAndDropData(e){var tryGetIri=function(t){try{var n=e.dataTransfer.getData(t);if(!n)return;var r=void 0;try{r=JSON.parse(n)}catch(e){r=[n]}return 0===r.length?void 0:r}catch(e){return}};return tryGetIri("application/x-ontodia-elements")||tryGetIri("text/uri-list")||tryGetIri("text")||[]}},3295:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(3296);t.ClassTree=r.ClassTree,t.ClassTreeProps=r.ClassTreeProps},3296:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1573),a=n(1560),s=n(1623),l=n(1554),c=n(1585),u=n(1697),d=n(3297),p=n(3298),h="ontodia-class-tree",f=function(e){function ClassTree(t){var n=e.call(this,t)||this;return n.listener=new l.EventObserver,n.delayedClassUpdate=new a.Debouncer,n.delayedSearch=new a.Debouncer(200),n.loadClassesOperation=new a.Cancellation,n.refreshOperation=new a.Cancellation,n.onSearchTextChange=function(e){var t=e.currentTarget.value;n.setState({requestedSearchText:t}),n.delayedSearch.call(n.performSearch)},n.performSearch=function(){var e=normalizeSearchText(n.state.requestedSearchText);if(e!==n.state.appliedSearchText){var t=e.length<3?void 0:e;n.setState((function(e){return applyFilters(r.__assign(r.__assign({},e),{appliedSearchText:t}))}))}},n.onShowOnlyCreatableChange=function(e){n.setState((function(e){return applyFilters(r.__assign(r.__assign({},e),{showOnlyConstructible:!e.showOnlyConstructible}))}))},n.onSelectNode=function(e){var t=n.props.onClassSelected;n.setState({selectedNode:e}),t(e.model.id)},n.onCreateInstance=function(e){(0,n.props.onCreateInstance)(e.model.id)},n.onDragCreate=function(e){var t=n.props,r=t.view,i=t.onCreateInstance;r.setHandlerForNextDropOnPaper((function(t){i(e.model.id,t.paperPosition)}))},n.refreshClassTree=function(){var e=new a.Cancellation,t=n.props.editor;n.refreshOperation.abort(),n.refreshOperation=e,n.setState((function(i,o){if(!n.classTree)return{refreshingState:u.ProgressState.none};var a=u.ProgressState.none;if(t.inAuthoringMode){var s=function getNewClassIris(e,t){var n=new Set,visitClass=function(t){e.has(t.id)||n.add(t.id),t.children.forEach(visitClass)};return t.forEach(visitClass),n}(i.constructibleClasses,n.classTree);s.size>0&&(a=u.ProgressState.loading,n.queryCreatableTypes(s,e.signal))}var l=function createRoots(e,t){var mapClass=function(e){var n=t.model.createClass(e.id);return{model:n,label:t.formatLabel(n.label,n.id),derived:e.children.map(mapClass)}};return e.map(mapClass)}(n.classTree,o.view);return applyFilters(r.__assign(r.__assign({},i),{roots:sortTree(l),refreshingState:a}))}))},n.state={refreshingState:u.ProgressState.none,roots:[],filteredRoots:[],requestedSearchText:"",appliedSearchText:"",constructibleClasses:new Map,showOnlyConstructible:!1},n}return r.__extends(ClassTree,e),ClassTree.prototype.render=function(){var e=this.props,t=e.view,n=e.editor,r=this.state,o=r.refreshingState,a=r.requestedSearchText,s=r.appliedSearchText,l=r.filteredRoots,d=r.selectedNode,f=r.constructibleClasses,m=r.showOnlyConstructible,g=normalizeSearchText(a),v=s?g:void 0;return i.createElement("div",{className:h},i.createElement("div",{className:h+"__filter"},i.createElement("div",{className:h+"__filter-group"},i.createElement("input",{type:"text",className:"search-input ontodia-form-control",placeholder:"Search for...",value:this.state.requestedSearchText,onChange:this.onSearchTextChange}),n.inAuthoringMode?i.createElement("label",{className:h+"__only-creatable"},i.createElement("input",{type:"checkbox",checked:m,onChange:this.onShowOnlyCreatableChange})," Show only constructible"):null)),i.createElement(u.ProgressBar,{state:o}),this.classTree?i.createElement(p.Forest,{className:h+"__tree ontodia-scrollable",view:t,nodes:l,searchText:v,selectedNode:d,onSelect:this.onSelectNode,creatableClasses:f,onClickCreate:this.onCreateInstance,onDragCreate:this.onDragCreate}):i.createElement("div",{className:h+"__spinner"},i.createElement(c.HtmlSpinner,{width:30,height:30})))},ClassTree.prototype.componentDidMount=function(){var e=this,t=this.props,n=t.view,r=t.editor;this.listener.listen(n.events,"changeLanguage",(function(){return e.refreshClassTree()})),this.listener.listen(r.model.events,"loadingStart",(function(){e.initClassTree()})),this.listener.listen(r.model.events,"classEvent",(function(t){var n=t.data;(n.changeLabel||n.changeCount)&&e.delayedClassUpdate.call(e.refreshClassTree)})),this.initClassTree()},ClassTree.prototype.componentWillUnmount=function(){this.listener.stopListening(),this.delayedClassUpdate.dispose(),this.delayedSearch.dispose(),this.loadClassesOperation.abort(),this.refreshOperation.abort()},ClassTree.prototype.initClassTree=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(n){switch(n.label){case 0:return this.dataProvider===this.props.editor.model.dataProvider?[3,2]:(this.dataProvider=this.props.editor.model.dataProvider,this.classTree=void 0,e=new a.Cancellation,this.loadClassesOperation.abort(),this.loadClassesOperation=e,[4,this.dataProvider.classTree()]);case 1:if(t=n.sent(),e.signal.aborted)return[2];this.setClassTree(t),n.label=2;case 2:return this.refreshClassTree(),[2]}}))}))},ClassTree.prototype.setClassTree=function(e){var t=this.props.editor.model,n=new Set,reduceNonCycle=function(e,t){if(!n.has(t.id)){n.add(t.id);var i=t.children.reduce(reduceNonCycle,[]);e.push(r.__assign(r.__assign({},t),{children:i})),n.delete(t.id)}return e};this.classTree=e.reduce(reduceNonCycle,[]);var addClass=function(e){if(!t.getClass(e.id)){var n=e.id,r=e.label,i=e.count,a=e.children,s=new o.FatClassModel({id:n,label:r.values,count:i});t.addClass(s),a.forEach(addClass)}};this.classTree.forEach(addClass),this.refreshClassTree()},ClassTree.prototype.queryCreatableTypes=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,a.CancellationToken.mapCancelledToNull(t,this.props.editor.metadataApi.filterConstructibleTypes(e,t))];case 1:return null===(n=o.sent())?[2]:(this.setState((function(t){var i=s.cloneMap(t.constructibleClasses);return e.forEach((function(e){i.set(e,n.has(e))})),applyFilters(r.__assign(r.__assign({},t),{constructibleClasses:i,refreshingState:u.ProgressState.completed}))})),[3,3]);case 2:return i=o.sent(),console.error(i),t.aborted?[2]:(this.setState((function(e){return applyFilters(r.__assign(r.__assign({},e),{refreshingState:u.ProgressState.error}))})),[3,3]);case 3:return[2]}}))}))},ClassTree}(i.Component);function normalizeSearchText(e){return e.trim().toLowerCase()}function sortTree(e){function mapNodes(e){if(0===e.length)return e;var t=e.map(mapNode);return t.sort(compareByLabel),t}function mapNode(e){return d.TreeNode.setDerived(e,mapNodes(e.derived))}function compareByLabel(e,t){return e.label.localeCompare(t.label)}return mapNodes(e)}function applyFilters(e){var t=e.roots;return e.appliedSearchText&&(t=function filterByKeyword(e,t){if(0===e.length)return e;return e.reduce((function collectByKeyword(e,n){var r=n.derived.reduce(collectByKeyword,[]);return(r.length>0||n.label.toLowerCase().indexOf(t)>=0)&&e.push(d.TreeNode.setDerived(n,r)),e}),[])}(t,e.appliedSearchText)),e.showOnlyConstructible&&(t=function filterOnlyCreatable(e,t){return e.reduce((function collectOnlyCreatable(e,n){var r=n.derived.reduce(collectOnlyCreatable,[]);return(r.length>0||t.get(n.model.id))&&e.push(d.TreeNode.setDerived(n,r)),e}),[])}(t,e.constructibleClasses)),r.__assign(r.__assign({},e),{filteredRoots:t})}t.ClassTree=f},3297:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11);t.TreeNode={setDerived:function(e,t){return r.__assign(r.__assign({},e),{derived:t})}}},3298:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1698),a=n(3299).default,s=n(3300).default,l=n(3301).default,c=n(3302).default,u="ontodia-class-leaf",d=function(e){function Leaf(t){var n=e.call(this,t)||this;return n.onClick=function(e){e.preventDefault();var t=n.props,r=t.node;(0,t.onSelect)(r)},n.toggle=function(){n.setState((function(e){return{expanded:!e.expanded}}))},n.onClickCreate=function(){n.props.onClickCreate(n.props.node)},n.onDragCreate=function(e){e.dataTransfer.setData("text",""),n.props.onDragCreate(n.props.node)},n.state={expanded:Boolean(n.props.searchText)},n}return r.__extends(Leaf,e),Leaf.prototype.componentWillReceiveProps=function(e){this.props.searchText!==e.searchText&&this.setState({expanded:Boolean(e.searchText)})},Leaf.prototype.render=function(){var e,t=this.props,n=t.node,d=r.__rest(t,["node"]),h=d.view,f=d.selectedNode,m=d.searchText,g=d.creatableClasses,v=this.state.expanded;n.derived.length>0&&(e=v?s:a);var y=h.getTypeStyle([n.model.id]).icon;y||(y=0===n.derived.length?l:c);var k=u+"__body";f&&f.model===n.model&&(k+=" "+u+"__body--selected");var E=o.highlightSubstring(n.label,m,{className:u+"__highlighted-term"});return i.createElement("div",{className:u,role:"tree-item"},i.createElement("div",{className:u+"__row"},i.createElement("div",{className:u+"__toggle",onClick:this.toggle,role:"button"},e?i.createElement("img",{className:u+"__toggle-icon",src:e}):null),i.createElement("a",{className:k,href:n.model.id,onClick:this.onClick},i.createElement("div",{className:u+"__icon-container"},i.createElement("img",{className:u+"__icon",src:y})),i.createElement("span",{className:u+"__label"},E),n.model.count?i.createElement("span",{className:u+"__count ontodia-badge"},n.model.count):null),g.get(n.model.id)?i.createElement("div",{className:u+"__create ontodia-btn-group ontodia-btn-group-xs"},i.createElement("button",{className:"ontodia-btn ontodia-btn-default",title:"Click or drag to create new entity of this type",draggable:!0,onClick:this.onClickCreate,onDragStart:this.onDragCreate},"+")):null),v&&n.derived.length>0?i.createElement(p,r.__assign({className:u+"__children",nodes:n.derived},d)):null)},Leaf}(i.Component);t.Leaf=d;var p=function(e){function Forest(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(Forest,e),Forest.prototype.render=function(){var e=this.props,t=e.nodes,n=e.className,o=r.__rest(e,["nodes","className"]);return i.createElement("div",{className:n,role:"tree"},t.map((function(e){return i.createElement(d,r.__assign({key:"node-"+e.model.id,node:e},o))})))},Forest}(i.Component);t.Forest=p},3299:function(e,t,n){"use strict";n.r(t),t.default=n.p+"99c80b666605548c69d369d82b52aa5f.svg"},3300:function(e,t,n){"use strict";n.r(t),t.default=n.p+"b433bf51d8ebd994a3541bfb50d80f40.svg"},3301:function(e,t,n){"use strict";n.r(t),t.default=n.p+"50c3223c98643b7a0c36f492103b55ea.svg"},3302:function(e,t,n){"use strict";n.r(t),t.default=n.p+"c7b15270f3d3c03a05a17a173732c951.svg"},3303:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o=n(1655),a=n(1573),s=n(1560),l=n(1554),c=n(1698),u=n(1697),d=function(e){function LinkInToolBox(){var t=null!==e&&e.apply(this,arguments)||this;return t.onPressFilter=function(){t.props.onPressFilter&&t.props.onPressFilter(t.props.link)},t.changeState=function(e){changeLinkTypeState(t.props.view.model.history,e,[t.props.link])},t.isChecked=function(e){return e===(t.props.link.visible?t.props.link.showLabel?"allVisible":"withoutLabels":"invisible")},t.getText=function(){var e=t.props,n=e.link,r=e.view,i=e.filterKey,o=r.formatLabel(n.label,n.id);return c.highlightSubstring(o,i)},t}return r.__extends(LinkInToolBox,e),LinkInToolBox.prototype.render=function(){var e=this,t=this.props.link.isNew?i.createElement("span",{className:"linkInToolBox__new-tag"},"new"):"",n=this.props.count>0?i.createElement("span",{className:"ontodia-badge"},this.props.count):"",r=t||n?i.createElement("div",null,t,n):"";return i.createElement("li",{"data-linktypeid":this.props.link.id,className:"ontodia-list-group-item linkInToolBox clearfix"},i.createElement("span",{className:"ontodia-btn-group ontodia-btn-group-xs","data-toggle":"buttons"},i.createElement("label",{className:"ontodia-btn ontodia-btn-default"+(this.isChecked("invisible")?" active":""),id:"invisible",title:"Hide links and labels",onClick:function(){return e.changeState("invisible")}},i.createElement("span",{className:"fa fa-times","aria-hidden":"true"})),i.createElement("label",{className:"ontodia-btn ontodia-btn-default"+(this.isChecked("withoutLabels")?" active":""),id:"withoutLabels",title:"Show links without labels",onClick:function(){return e.changeState("withoutLabels")}},i.createElement("span",{className:"fa fa-arrows-h","aria-hidden":"true"})),i.createElement("label",{className:"ontodia-btn ontodia-btn-default"+(this.isChecked("allVisible")?" active":""),id:"allVisible",title:"Show links with labels",onClick:function(){return e.changeState("allVisible")}},i.createElement("span",{className:"fa fa-text-width","aria-hidden":"true"}))),i.createElement("div",{className:"link-title"},this.getText()),r,i.createElement("div",{className:"linkInToolBox__filter-button",onClick:this.onPressFilter}))},LinkInToolBox}(i.Component),p=function(e){function LinkTypesToolboxView(t){var n=e.call(this,t)||this;return n.compareLinks=function(e,t){var r=n.props.view,i=r.formatLabel(e.label,e.id),o=r.formatLabel(t.label,t.id);return i.localeCompare(o)},n.onChangeInput=function(e){n.setState({filterKey:e.currentTarget.value})},n.onDropFilter=function(){n.setState({filterKey:""})},n.getLinks=function(){var e=n.props,t=e.view,r=e.links;return(void 0===r?[]:r).filter((function(e){var r=t.formatLabel(e.label,e.id).toLowerCase();return!n.state.filterKey||r.indexOf(n.state.filterKey.toLowerCase())>=0})).sort(n.compareLinks)},n.getViews=function(e){for(var t=n.props.countMap||{},r=[],o=0,a=e;o<a.length;o++){var s=a[o];r.push(i.createElement(d,{key:s.id,view:n.props.view,link:s,onPressFilter:n.props.filterCallback,count:t[s.id]||0,filterKey:n.state.filterKey}))}return r},n.state={filterKey:""},n}return r.__extends(LinkTypesToolboxView,e),LinkTypesToolboxView.prototype.render=function(){var e="link-types-toolbox",t=this.props,n=t.view,r=t.dataState,o=t.selectedElement,a=n.model.history,s=this.getLinks(),l=this.getViews(s),c=null;if(o){var d=n.formatLabel(o.data.label.values,o.iri);c=i.createElement("h4",{className:"links-heading",style:{display:"block"}},"Connected to","",i.createElement("span",null,d))}var p=null;return this.state.filterKey&&(p=i.createElement("button",{type:"button",className:e+"__clearSearch",onClick:this.onDropFilter},i.createElement("span",{className:"fa fa-times","aria-hidden":"true"}))),i.createElement("div",{className:e},i.createElement("div",{className:e+"__heading"},i.createElement("div",{className:e+"__searching-box"},i.createElement("input",{className:"search-input ontodia-form-control",type:"text",value:this.state.filterKey,onChange:this.onChangeInput,placeholder:"Search for..."}),p),i.createElement("div",{className:e+"__switch-all"},i.createElement("div",{className:"ontodia-btn-group ontodia-btn-group-xs"},i.createElement("label",{className:"ontodia-btn ontodia-btn-default",title:"Hide links and labels",onClick:function(){return changeLinkTypeState(a,"invisible",s)}},i.createElement("span",{className:"fa fa-times","aria-hidden":"true"})),i.createElement("label",{className:"ontodia-btn ontodia-btn-default",title:"Show links without labels",onClick:function(){return changeLinkTypeState(a,"withoutLabels",s)}},i.createElement("span",{className:"fa fa-arrows-h","aria-hidden":"true"})),i.createElement("label",{className:"ontodia-btn ontodia-btn-default",title:"Show links with labels",onClick:function(){return changeLinkTypeState(a,"allVisible",s)}},i.createElement("span",{className:"fa fa-text-width","aria-hidden":"true"}))),i.createElement("span",null,"Switch all"))),i.createElement(u.ProgressBar,{state:r}),i.createElement("div",{className:e+"__rest"},c,i.createElement("div",{className:"ontodia-scrollable"},i.createElement("ul",{className:"ontodia-list-group connected-links"},l))))},LinkTypesToolboxView}(i.Component),h=function(e){function LinkTypesToolbox(t,n){var r=e.call(this,t,n)||this;r.listener=new l.EventObserver,r.linkListener=new l.EventObserver,r.debounceSelection=new s.Debouncer(50),r.updateOnCurrentSelection=function(){var e=r.props.editor,t=1===e.selection.length?e.selection[0]:null;t!==r.state.selectedElement&&t instanceof a.Element&&r.requestLinksOf(t)},r.onLinkChanged=function(){r.forceUpdate()},r.onAddToFilter=function(e){r.state.selectedElement.addToFilter(e)};var i=r.props,o=i.view,c=i.editor;return r.listener.listen(o.events,"changeLanguage",(function(){return r.updateOnCurrentSelection()})),r.listener.listen(c.model.events,"loadingSuccess",(function(){return r.updateOnCurrentSelection()})),r.listener.listen(c.events,"changeSelection",(function(){r.debounceSelection.call(r.updateOnCurrentSelection)})),r.state={dataState:u.ProgressState.none},r}return r.__extends(LinkTypesToolbox,e),LinkTypesToolbox.prototype.componentDidMount=function(){this.updateOnCurrentSelection()},LinkTypesToolbox.prototype.componentWillUnmount=function(){this.listener.stopListening(),this.linkListener.stopListening(),this.debounceSelection.dispose()},LinkTypesToolbox.prototype.requestLinksOf=function(e){var t=this;if(e){var n={elementId:e.iri};this.currentRequest=n,this.setState({dataState:u.ProgressState.loading,selectedElement:e}),this.props.editor.model.dataProvider.linkTypesOf(n).then((function(e){if(t.currentRequest===n){var r=t.computeStateFromRequestResult(e),i=r.linksOfElement,o=r.countMap;t.subscribeOnLinksEvents(i),t.setState({dataState:u.ProgressState.completed,linksOfElement:i,countMap:o})}})).catch((function(e){t.currentRequest===n&&(console.error(e),t.setState({dataState:u.ProgressState.error,linksOfElement:void 0,countMap:{}}))}))}else this.currentRequest=null,this.setState({dataState:u.ProgressState.completed,selectedElement:e,linksOfElement:void 0,countMap:{}})},LinkTypesToolbox.prototype.computeStateFromRequestResult=function(e){for(var t=[],n={},r=this.props.editor.model,i=0,o=e;i<o.length;i++){var a=o[i],s=r.createLinkType(a.id);t.push(s),n[a.id]=a.inCount+a.outCount}return{linksOfElement:t,countMap:n}},LinkTypesToolbox.prototype.subscribeOnLinksEvents=function(e){this.linkListener.stopListening();for(var t=this.linkListener,n=0,r=e;n<r.length;n++){var i=r[n];t.listen(i.events,"changeLabel",this.onLinkChanged),t.listen(i.events,"changeVisibility",this.onLinkChanged)}},LinkTypesToolbox.prototype.render=function(){var e=this.props.view,t=this.state,n=t.selectedElement,r=t.dataState,o=t.linksOfElement,a=t.countMap;return i.createElement(p,{view:e,dataState:r,links:o,countMap:a,filterCallback:this.onAddToFilter,selectedElement:n})},LinkTypesToolbox}(i.Component);function changeLinkTypeState(e,t,n){for(var r=e.startBatch(),i="invisible"===t?{visible:!1,showLabel:!1}:"withoutLabels"===t?{visible:!0,showLabel:!1}:"allVisible"===t?{visible:!0,showLabel:!0}:void 0,a=i.visible,s=i.showLabel,l=0,c=n;l<c.length;l++){var u=c[l];e.execute(o.changeLinkTypeVisibility({linkType:u,visible:a,showLabel:s}))}r.store()}t.LinkTypesToolbox=h},3304:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(1),o="ontodia-accordion",a=function(e){function Accordion(t){var n=e.call(this,t)||this;n.items=[],n.isScrollable=!1,n.updateSizes=function(){var e=n.props.children,t=new Map;i.Children.forEach(e,(function(e,r){if("object"==typeof e){var i=e.props,o=i.defaultSize,a=i.defaultCollapsed,s=i.collapsedSize,l=i.minSize;void 0!==l&&(n.isScrollable=!0),t.set(r,{defaultSize:o,defaultCollapsed:a,collapsedSize:s,minSize:l})}})),n.defaultProps=t,n.setState((function(t){var r=t.collapsed,o=n.clientSize(n.element.parentElement),a=o,s=i.Children.count(e),l=[];n.defaultProps.forEach((function(e,t){var i=e.defaultSize,o=e.defaultCollapsed,c=void 0!==o&&o,u=void 0===r[t]?c:r[t],d=t===n.defaultProps.size-1,p=l.findIndex((function(e){return!e}))<0;d&&p&&(u=!1);var h=u?n.sizeWhenCollapsed(t):i;h&&(a-=h,s-=1),l.push(u)}));var c=[],u=[];return n.defaultProps.forEach((function(e,t){var r=e.defaultSize,i=e.minSize,d=a/s,p=n.sizeWhenCollapsed(t);l[t]?d=p:void 0!==r?d=r:d<i&&(d=p+i),d<p&&(d=p,l[t]=!0);var h=100*d/o+"%";c.push(d),u.push(h)})),{sizes:c,percents:u,collapsed:l}}))},n.onBeginDragHandle=function(e){n.originTotalSize=n.clientSize(n.element),n.originSizes=n.computeEffectiveItemSizes(),n.originCollapsed=r.__spreadArrays(n.state.collapsed),n.setState({resizing:!0},(function(){var e=n.props,t=e.direction,r=e.onStartResize;r&&r(t)}))},n.onEndDragHandle=function(){n.setState({resizing:!1})},n.sizeWhenCollapsed=function(e){var t=n.items[e],r=n.defaultProps.get(e).collapsedSize;return void 0!==r?r:(t.header?n.clientSize(t.header):0)+(n.offsetSize(t.element)-n.clientSize(t.element))},n.onDragHandle=function(e,t,i){var o=r.__spreadArrays(n.originSizes),a=r.__spreadArrays(n.originCollapsed);new s(o,a,n.originTotalSize,n.sizeWhenCollapsed).distribute(e+1,n.isVertical?i:t);var l=o.map((function(e){return 100*e/n.originTotalSize+"%"}));n.setState({sizes:o,percents:l,collapsed:a})};var o=i.Children.count(n.props.children);return n.state={collapsed:[],resizing:!1,percents:i.Children.map(n.props.children,(function(){return 100/o+"%"}))},n}return r.__extends(Accordion,e),Accordion.prototype.componentDidMount=function(){this.updateSizes()},Accordion.prototype.componentDidUpdate=function(e,t){var n=this.props,r=n.direction,o=n.children,a=n.onResize,s=n.animationDuration;i.Children.count(o)!==i.Children.count(e.children)&&this.updateSizes();var l=this.state,c=l.sizes,u=l.resizing;c!==t.sizes&&a&&(u?a(r):setTimeout((function(){return a(r)}),s))},Object.defineProperty(Accordion.prototype,"isVertical",{get:function(){return"vertical"===this.props.direction},enumerable:!0,configurable:!0}),Accordion.prototype.clientSize=function(e){var t=e.clientWidth,n=e.clientHeight;return this.isVertical?n:t},Accordion.prototype.offsetSize=function(e){var t=e.offsetWidth,n=e.offsetHeight;return this.isVertical?n:t},Accordion.prototype.render=function(){var e=this,t=this.props.direction,n=this.state.resizing?o+"--resizing":"",r=this.isScrollable?o+"--scrollable":"";return i.createElement("div",{className:o+" "+o+"--"+t+" "+n+" "+r,ref:function(t){return e.element=t}},this.renderItems())},Accordion.prototype.renderItems=function(){var e=this,t=this.state,n=t.sizes,r=t.percents,o=t.collapsed,a=this.props,s=a.children,l=a.direction;return i.Children.map(s,(function(t,a){if("object"!=typeof t)throw new Error("Accordion should have only AccordionItem elements as children");var c=a===i.Children.count(s)-1,u=o[a]?n[a]:r[a],d={ref:function(t){return e.items[a]=t},collapsed:o[a],size:u,direction:l,onChangeCollapsed:function(t){return e.onItemChangeCollapsed({itemIndex:a,itemCollapsed:t})},onBeginDragHandle:c?void 0:function(){return e.onBeginDragHandle(a)},onDragHandle:c?void 0:function(t,n){return e.onDragHandle(a,t,n)},onEndDragHandle:e.onEndDragHandle};return i.cloneElement(t,d)}))},Accordion.prototype.computeEffectiveItemSizes=function(){var e=this,t=[];return this.items.forEach((function(n,r){if(n)if(e.state.collapsed[r]){var i=e.sizeWhenCollapsed(r);t.push(i)}else t.push(e.offsetSize(n.element))})),t},Accordion.prototype.onItemChangeCollapsed=function(e){var t=e.itemIndex,n=e.itemCollapsed,i=this.clientSize(this.element),o=this.computeEffectiveItemSizes();if(1!==o.length){var a=r.__spreadArrays(this.state.collapsed),l=o[t],c=this.sizeWhenCollapsed(t),u=new s(o,a,i,this.sizeWhenCollapsed);if(n){var d=Math.max(l-c,0);o[t]=c,t===o.length-1?u.expand(d,t-1):u.expand(d,t+1)}else{var p=this.defaultProps.get(t),h=p.defaultSize,f=p.minSize,m=(h||i/o.length)-c,g=0;g=t===o.length-1?u.collapseForward({shift:m,from:t-1,to:t}):u.collapseForward({shift:m,from:t+1,to:o.length}),(g=Math.max(g,u.leftoverSize()))<m&&(g+=u.collapseForward({shift:m-g,from:0,to:t})),g<f&&(g=f),o[t]=Math.round(c+g)}a[t]=n;var v=o.map((function(e){return 100*e/i+"%"}));this.setState({sizes:o,percents:v,collapsed:a})}},Accordion.defaultProps={direction:"vertical",animationDuration:300},Accordion}(i.Component);t.Accordion=a;var s=function(){function SizeDistributor(e,t,n,r){this.sizes=e,this.collapsed=t,this.totalSize=n,this.sizeWhenCollapsed=r}return SizeDistributor.prototype.distribute=function(e,t){if(t>0){var n=this.collapseForward({shift:t,from:e,to:this.sizes.length});n=Math.max(n,this.leftoverSize()),this.expand(n,e-1)}else{n=this.collapseBackward({shift:-t,from:0,to:e});n=Math.max(n,this.leftoverSize()),this.expand(n,e)}},SizeDistributor.prototype.collapseForward=function(e){var t=e.shift,n=e.from,r=e.to;if(t<=0)return 0;for(var i=t,o=n;o<r;o++)i=this.collapse(i,o);return t-i},SizeDistributor.prototype.collapseBackward=function(e){var t=e.shift,n=e.from,r=e.to;if(t<=0)return 0;for(var i=t,o=r-1;o>=n;o--)i=this.collapse(i,o);return t-i},SizeDistributor.prototype.collapse=function(e,t){if(this.collapsed[t])return e;var n=this.sizes[t],r=this.sizeWhenCollapsed(t),i=Math.round(Math.max(n-e,r));return this.sizes[t]=i,this.collapsed[t]=i<=r,e-(n-i)},SizeDistributor.prototype.expand=function(e,t){if(e<=0)return 0;var n=this.sizes[t],r=Math.round(n+e);return this.sizes[t]=r,this.collapsed[t]=r<=this.sizeWhenCollapsed(t),r-n},SizeDistributor.prototype.leftoverSize=function(){var e=this.sizes.reduce((function(e,t){return e+t}),0);return Math.max(this.totalSize-e,0)},SizeDistributor}()},3305:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(11),o=n(1),a=n(1985);!function(e){e[e.Left=1]="Left",e[e.Right=2]="Right"}(r=t.DockSide||(t.DockSide={}));var s="ontodia-accordion-item",l=function(e){function AccordionItem(t){var n=e.call(this,t)||this;return n.state={resizing:!1},n}return i.__extends(AccordionItem,e),Object.defineProperty(AccordionItem.prototype,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(AccordionItem.prototype,"header",{get:function(){return this._header},enumerable:!0,configurable:!0}),Object.defineProperty(AccordionItem.prototype,"isVertical",{get:function(){return"vertical"===this.props.direction},enumerable:!0,configurable:!0}),AccordionItem.prototype.renderToggleButton=function(){var e=this.props,t=e.collapsed,n=e.dockSide,i=e.onChangeCollapsed;if(!n)return null;var a=n===r.Left?"left":"right";return o.createElement("div",{className:s+"__handle-btn "+s+"__handle-btn-"+a,onClick:function(){return i(!t)}})},AccordionItem.prototype.render=function(){var e=this,t=this.props,n=t.heading,r=t.bodyClassName,i=t.children,l=t.bodyRef,c=t.collapsed,u=t.size,d=t.direction,p=t.onBeginDragHandle,h=t.onDragHandle,f=t.onEndDragHandle,m=t.dockSide,g=t.className,v=void 0===g?"":g,y=this.state.resizing,k=p&&h&&f,E=this.isVertical?{height:u}:{width:u},b=!(c&&m);return o.createElement("div",{className:s+" "+s+"--"+(c?"collapsed":"expanded")+" "+s+"--"+d+"\n                "+(y?s+"--resizing":""),ref:function(t){return e._element=t},style:E},o.createElement("div",{className:s+"__inner "+v},n?o.createElement("div",{className:s+"__header",ref:function(t){return e._header=t},onClick:function(){return e.props.onChangeCollapsed(!c)}},n):null,o.createElement("div",{className:s+"__body"},i&&b?i:o.createElement("div",{ref:l,className:""+(r||"")}))),k?o.createElement(a.DraggableHandle,{className:s+"__handle "+s+"__handle-"+d,onBeginDragHandle:function(t){e.setState({resizing:!0}),p()},onDragHandle:function(e,t,n){return h(t,n)},onEndDragHandle:function(t){e.setState({resizing:!1}),f()}}):null,this.renderToggleButton())},AccordionItem.defaultProps={direction:"vertical"},AccordionItem}(o.Component);t.AccordionItem=l},3306:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(2273);t.LINK_SHOW_IRI=i.LINK_SHOW_IRI;var o=n(1580);t.TemplateProperties=o.TemplateProperties,r.__exportStar(n(1692),t),r.__exportStar(n(1656),t),r.__exportStar(n(1560),t),r.__exportStar(n(1623),t),r.__exportStar(n(2272),t),r.__exportStar(n(1585),t),r.__exportStar(n(1698),t),r.__exportStar(n(1986),t);var a=n(1657);t.WorkspaceContext=a.WorkspaceContext,t.WorkspaceContextWrapper=a.WorkspaceContextWrapper,t.WorkspaceContextTypes=a.WorkspaceContextTypes;var s=n(1748);t.groupForceLayout=s.groupForceLayout,t.groupRemoveOverlaps=s.groupRemoveOverlaps,t.padded=s.padded,t.biasFreePadded=s.biasFreePadded,t.getContentFittingBoxForLayout=s.getContentFittingBoxForLayout}}]);
//# sourceMappingURL=default~diagram-search-result~ontodia~ontodia-nested-nodes~rs-dashboard~rs-image-graph-authoring~rs-~75ac7c5b-586a56ef93c367d751b1.js.map