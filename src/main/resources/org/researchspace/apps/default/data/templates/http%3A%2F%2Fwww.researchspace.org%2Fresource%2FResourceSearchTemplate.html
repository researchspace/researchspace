<mp-event-target-template-render id="[[urlParam 'resourceconfig' escape=false]]-resourceSearch-frame" template='{{> template}}'>
  <template id='template'>
    [[!-- WARNING: any KPs used for search has to have a domain matching the resource ontology class --]]
    [[#if (urlParam "searchkpcategory")]]
      <semantic-search config='[[searchConfigForFieldsFromQuery (setQueryBindings "SELECT DISTINCT ?field WHERE { ?field a <http://www.researchspace.org/resource/system/fields/Field> . ?field <http://www.researchspace.org/resource/system/fields/category> ?category . }" category=(urlParam "searchkpcategory" escape=false))]]'>
    [[else]]    
      <semantic-search config='[[searchConfigForFieldsFromQuery (setQueryBindings "SELECT DISTINCT ?field WHERE { ?field a <http://www.researchspace.org/resource/system/fields/Field> .  ?field <http://www.researchspace.org/resource/system/fields/domain> ?domain . ?field <http://www.researchspace.org/resource/system/fields/range> ?range . }" domain=(urlParam "resourceontologyclass" escape=false))]]'>      
    [[/if]]

    [[!-- Uncomment line below if you want to see all available facets --]]
[[!--     <semantic-search domain='(urlParam "resourceontologyclass" escape=false)' config='[[searchConfigForFieldsFromQuery "SELECT DISTINCT ?field WHERE { ?field a <http://www.researchspace.org/resource/system/fields/Field> . ?field <http://www.researchspace.org/resource/system/fields/domain> <http://www.researchspace.org/ontology/EX_Digital_Image> . ?field <http://www.researchspace.org/resource/system/fields/range> ?range . ?field  <http://www.researchspace.org/resource/system/fields/category> <http://www.researchspace.org/resource/system/category/image> . OPTIONAL {?field <http://www.researchspace.org/resource/system/fields/order> ?fieldsOrder } } ORDER BY ASC(xsd:integer(?fieldsOrder))"]]'>
--]]
      <div class="semantic-search-content">
        <div class="semantic-search-header-content">
          {{#if [[urlParam "searchall" escape=false]]}}
            <div class="semantic-search-header-title text-truncate-line1" style="min-height: 31px; min-width: 340px;flex: 0;"></div>
          {{else}}
            <h3 class="semantic-search-header-title text-truncate-line1" title="[[urlParam 'resourcelabel' escape=false]]">[[urlParam "resourcelabel" escape=false]]</h3>
          {{/if}}
      
          <div class="semantic-search-header-actions">

            [[!-- New button --]]
            <semantic-switch query='SELECT ?resourceConfig {
                                      BIND(<[[urlParam "resourceconfig" escape=false]]> as ?resourceConfig)
                                    }'>

              <template id='http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_narrative'>
                <div class="btn-newDraggableTab-container" style="margin-right: 20px;">
                  <semantic-link-container uri="http://www.researchspace.org/resource/ThinkingFrames" 
                                          urlqueryparam-view='semantic-narrative'>
                    <button id="create-new-btn" class="btn btn-action btn-textAndIcon">
                      <rs-icon icon-type="round" icon-name="add_box"></rs-icon>
                      <span>New [[urlParam "resourcelabel" escape=false]]</span>
                    </button>                 
                  </semantic-link-container>
                  <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                            urlqueryparam-view="semantic-narrative"
                                            urlqueryparam-open-as-drag-and-drop='true'>
                    <button class="btn btn-action btn-textAndIcon btn-newDraggableTab" title='Open in new draggable tab'>
                      <rs-icon icon-type="rounded" icon-name="tab_move" symbol="true"></rs-icon>
                    </button>
                  </semantic-link-container>
                </div>  
              </template>

              <template id='http://www.researchspace.org/resource/system/resource_configurations_container/data/Knowledge_map'>
                <div class="btn-newDraggableTab-container" style="margin-right: 20px;">
                  <semantic-link-container uri="http://www.researchspace.org/resource/ThinkingFrames" 
                                          urlqueryparam-view='knowledge-map'>
                    <button id="create-new-btn" class="btn btn-action btn-textAndIcon">
                      <rs-icon icon-type="round" icon-name="add_box"></rs-icon>
                      <span>New [[urlParam "resourcelabel" escape=false]]</span>
                    </button>                 
                  </semantic-link-container>
                  <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                            urlqueryparam-view="knowledge-map"
                                            urlqueryparam-open-as-drag-and-drop='true'>
                    <button class="btn btn-action btn-textAndIcon btn-newDraggableTab" title='Open in new draggable tab'>
                      <rs-icon icon-type="rounded" icon-name="tab_move" symbol="true"></rs-icon>
                    </button>
                  </semantic-link-container>
                </div>  
              </template>

              <template id='http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_chart'>
              </template>

              <template id='http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_timeline'>
              </template>

              <template id='http://www.researchspace.org/resource/system/resource_configurations_container/data/Set'>
              </template>

              <template id='http://www.researchspace.org/resource/system/resource_configurations_container/data/Set_item'>
              </template>

              <template id='http://www.researchspace.org/resource/system/resource_configurations_container/data/User'>
              </template>

              <template id='http://www.researchspace.org/resource/system/resource_configurations_container/data/Image_annotation'>
              </template>

              <template id='default'>
                [[#if (urlParam "resourceform")]]
                  <div class="btn-newDraggableTab-container" style="margin-right: 20px;">
                    <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                              urlqueryparam-view="resource-editor"
                                              urlqueryparam-entity-type-config='[[urlParam "resourceconfig" escape=false]]'
                                              urlqueryparam-mode='new'
                                              urlqueryparam-custom-label='New [[urlParam "resourcelabel" escape=false]]'>
                      <button id="create-new-btn" class="btn btn-action btn-textAndIcon">
                        <rs-icon icon-type="round" icon-name="add_box"></rs-icon>
                        <span>New [[urlParam "resourcelabel" escape=false]]</span>
                      </button>
                    </semantic-link-container>
                    <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                              urlqueryparam-view="resource-editor"
                                              urlqueryparam-entity-type-config='[[urlParam "resourceconfig" escape=false]]'
                                              urlqueryparam-mode='new'
                                              urlqueryparam-open-as-drag-and-drop='true'
                                              urlqueryparam-custom-label='New [[urlParam "resourcelabel" escape=false]]'>
                      <button class="btn btn-action btn-textAndIcon btn-newDraggableTab" title='Open in new draggable tab'>
                        <rs-icon icon-type="rounded" icon-name="tab_move" symbol="true"></rs-icon>
                      </button>
                    </semantic-link-container>
                  </div>

                  [[!--  <mp-overlay-dialog id="[[urlParam 'viewid' escape=false]]-newResource-modal" title="New [[urlParam 'resourcelabel' escape=false]]" type="lightbox">
                          <mp-overlay-dialog-trigger>
                          </mp-overlay-dialog-trigger>
                          <mp-overlay-dialog-content>
                            <div>
                              <inline-template  template-iri="[[urlParam 'resourceform' escape=false]]"
                                                options='{
                                                          "mode": "new",
                                                          "editable": true,
                                                          "viewId": "[[urlParam "viewid" escape=false]]"
                                                        }'>
                              </inline-template>
                            </div>
                          </mp-overlay-dialog-content>
                        </mp-overlay-dialog>
                  --]]
                [[else]]
                [[/if]]
              </template>

            </semantic-switch>

            {{#ifCond "[[urlParam "resourceconfig" escape=false]]" "==" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Authority_document"}}
              <mp-overlay-dialog  id='[[urlParam "viewid" escape=false]]-import-authorityDocument-dialog'
                                  title="Import authority document" 
                                  type="modal" 
                                  bs-size="large"
                                  class="importVocabulary-modal">
                <mp-overlay-dialog-trigger>
                  <button class="btn btn-default btn-textAndIcon">
                    <rs-icon icon-type='rounded' icon-name='upload' symbol='true'></rs-icon>
                    <span>Import</span>
                  </button>
                </mp-overlay-dialog-trigger>
                <mp-overlay-dialog-content>
                  <mp-rdf-upload accept='[".trig", ".nq"]' 
                                  keep-source-graphs='true' 
                                  allow-load-by-url='false' 
                                  show-advanced-options='false' 
                                  drop-area-template='{{> template}}'>
                    <template id='template'>
                      <div class='RdfUpload__rdf-dropzone-content' style='text-align: center;'>
                        {{#if isDragAccept}}
                          <div>
                            <bs-progress-bar active="true" min="0" now="100" max="100" label="Uploading files" striped="true"></bs-progress-bar>
                          </div>
                        {{else}}
                          {{#if isDragReject}}
                            Only *.trig or *.nq files are accepted.
                          {{else}}
                            <div class='placeholder-item'>
                              <rs-icon icon-type='rounded' icon-name='upload' class='upload_icon' symbol='true'></rs-icon>
                              <div> 
                                <p>Drag authority document as *.trig or *.nq RDF file(s) or click to upload</p>
                                <div class="documentation-section documentation-section-withIcon" style="margin: 20px 0;">
                                  <div class="documentation-section-icon-container">
                                    <i class="fa fa-info"></i>
                                  </div>
                      
                                  <div style="flex: 1;"> 
                                    <div class="documentation-section-title">Authority document must be of ontology class crm:E32_Authority_Document.</div>
                                    <div class="documentation-section-content"> 
                                      The authority document and all associated data must be defined in one named graph that equals to the authority document IRI.
                                    </div>
                                  </div>
                                </div> 
                              </div>
                            </div>  
                          {{/if}}
                        {{/if}}
                      </div>
                    </template>
                  </mp-rdf-upload>
                </mp-overlay-dialog-content>
              </mp-overlay-dialog>

              <mp-event-proxy id='[[urlParam "viewid" escape=false]]-authorityDocument-import-closeModal-proxy' 
                              on-event-type='RdfUpload.Success'
                              proxy-event-type='OverlayDialog.Close' 
                              proxy-targets='["[[urlParam "viewid" escape=false]]-import-authorityDocument-dialog"]'
              ></mp-event-proxy>

              <mp-event-proxy id='[[urlParam "viewid" escape=false]]-authorityDocument-importSuccess-refreshSearch-proxy' 
                              on-event-type='RdfUpload.Success'
                              proxy-event-type='Component.TemplateUpdate' 
                              proxy-targets='["http://www.researchspace.org/resource/system/resource_configurations_container/data/Authority_document-resourceSearch-frame"]'>
              ></mp-event-proxy>
            {{/ifCond}}

            <div class="search-results-header-keyword">
              <semantic-search-query-keyword  domain='[[urlParam "resourceontologyclass" escape=false]]'
                                              query='SELECT ?subject WHERE { 
                                                      ?subject a [[urlParam "resourceontologyclass" escape=false]] .
                                                      
                                                      [[#if (urlParam "resourcetype")]] 
                                                        ?subject crm:P2_has_type [[urlParam "resourcetype" escape=false]] .
                                                      [[/if]]
                                                    
                                                      BIND(?subject as ?item) .
    
                                                      [[#if (urlParam "resourcerestrictionpattern")]] 
                                                        [[urlParam "resourcerestrictionpattern" escape=false]] 
                                                      [[/if]]     
    
                                                      [[#if (urlParam "resourcelabelpattern")]]
                                                        [[urlParam "resourcelabelpattern" escape=false]]
                                                      [[else]]
                                                        ?subject rdfs:label ?label .
                                                      [[/if]]

                                                      {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Appellation")}}
                                                        MINUS { ?systemAuthorityItem crm:P1_is_identified_by|crm:P170i_time_is_defined_by ?subject .
                                                                ?systemAuthorityItem crm:P71i_is_listed_in ?systemAuthority .
                                                                ?systemAuthority crm:P2_has_type Platform:System_Resource . }
                                                      {{/if}}

                                                      {{#if (or 
                                                        (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Actor")
                                                        (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Group")
                                                        (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Person")
                                                      )}}
                                                        MINUS {?subject crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/user> .}
                                                      {{/if}}

                                                      {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Authority_document")}}
                                                        MINUS { ?subject crm:P2_has_type Platform:System_Resource .}
                                                      {{/if}}


                                                      {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Entity")}}
                                                        MINUS { ?configuration <http://www.researchspace.org/pattern/system/resource_configuration/resource_search_listView_column> ?subject .}
                                                      {{/if}}

                                                      {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Information_object")}}
                                                        MINUS { ?subject a Platform:resource_configuration .}
                                                      {{/if}}

                                                      {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Term")}}
                                                        MINUS { ?subject crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/KP_category> .}
                                                      {{/if}}

                                                      {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Timespan")}}
                                                        MINUS { 
                                                          ?entityFormRecordCreation crm:P4_has_time-span ?subject .
                                                          ?entityFormRecordCreation crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/entity_form_record_creation> .
                                                        }
                                                      {{/if}}

                                                      {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Set")}}
                                                        MINUS {?subject prov:wasAttributedTo ?__useruri__ ; rdfs:label "Uncategorized" .}
                                                      {{/if}}

                                                      MINUS {
                                                        ?subject crm:P71i_is_listed_in|skos:inScheme ?systemAuthorityDoc .
                                                        ?systemAuthorityDoc crm:P2_has_type Platform:System_Resource .
                                                      }

                                                      SERVICE <http://www.bigdata.com/rdf/search#search> {
                                                        ?label bds:search ?__token__ ;
                                                        bds:minRelevance "0.3" ;
                                                        bds:matchAllTerms "true"  .
                                                      }
                                                    }'
    
                                                default-query='SELECT ?subject WHERE { 
                                                                ?subject a [[urlParam "resourceontologyclass" escape=false]] .
                                                                
                                                                [[#if (urlParam "resourcetype")]] 
                                                                  ?subject crm:P2_has_type [[urlParam "resourcetype" escape=false]] .
                                                                [[/if]]
    
                                                                BIND(?subject as ?item) .
    
                                                                [[#if (urlParam "resourcerestrictionpattern")]] 
                                                                  [[urlParam "resourcerestrictionpattern" escape=false]] 
                                                                [[/if]]

                                                                {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Appellation")}}
                                                                  MINUS { ?systemAuthorityItem crm:P1_is_identified_by|crm:P170i_time_is_defined_by ?subject .
                                                                    ?systemAuthorityItem crm:P71i_is_listed_in ?systemAuthority .
                                                                    ?systemAuthority crm:P2_has_type Platform:System_Resource . }
                                                                {{/if}}
                                                                {{#if (or 
                                                                  (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Actor")
                                                                  (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Group")
                                                                  (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Person")
                                                                )}}
                                                                  MINUS {?subject crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/user> .}
                                                                {{/if}}
                                                                {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Authority_document")}}
                                                                  MINUS { ?subject crm:P2_has_type Platform:System_Resource .}
                                                                {{/if}}
                                                                {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Entity")}}
                                                                  MINUS { ?configuration <http://www.researchspace.org/pattern/system/resource_configuration/resource_search_listView_column> ?subject .}
                                                                {{/if}}
                                                                {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Information_object")}}
                                                                  MINUS { ?subject a Platform:resource_configuration .}
                                                                {{/if}}
                                                                {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Term")}}
                                                                  MINUS { ?subject crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/KP_category> .}
                                                                {{/if}}
                                                                {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Timespan")}}
                                                                  MINUS { 
                                                                    ?entityFormRecordCreation crm:P4_has_time-span ?subject .
                                                                    ?entityFormRecordCreation crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/entity_form_record_creation> .
                                                                  }
                                                                {{/if}}
                                                                {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Set")}}
                                                                  MINUS {?subject prov:wasAttributedTo ?__useruri__ ; rdfs:label "Uncategorized" .}
                                                                {{/if}}

                                                                MINUS {
                                                                  ?subject crm:P71i_is_listed_in|skos:inScheme ?systemAuthorityDoc .
                                                                  ?systemAuthorityDoc crm:P2_has_type Platform:System_Resource .
                                                                }
                                                              }'
                                                debounce=300
                                                placeholder="Search [[urlParam 'resourcelabel' escape=false]]"
              ></semantic-search-query-keyword>
            </div>

            [[!-- View as dropdown/button --]]
            <semantic-query query='SELECT ?resourceConfig ?viewid ?searchViewType ?searchViewLabel WHERE {
                                    BIND(<[[urlParam "resourceconfig" escape=false]]> as ?resourceConfig)
                                    BIND("[[urlParam "viewid" escape=false]]" as ?viewid)
                                    ?resourceConfig <http://www.researchspace.org/pattern/system/resource_configuration/resource_search_view_type> ?searchViewType.
                                    ?searchViewType crm:P71i_is_listed_in <http://www.researchspace.org/resource/system/vocab/search_view_type> .
                                    ?searchViewType skos:prefLabel ?searchViewLabel .
                                  } '

                            template='{{> search-views}}'
            >
              <template id='search-views'>
                
                  {{#if bindings.1.searchViewType.value}}
                    <mp-event-target-template-render id="{{bindings.0.viewid.value}}-search-view-dropdown-area" template="{{> viewDropdown}}">
                      <template id='viewDropdown'>
                        <bs-dropdown id="{{bindings.0.viewid.value}}-view-type-selection"
                                      bs-style="default"
                                      class="btn-textAndIcon search-view-dropdown"
                                      pull-right=true
                                      title="{{#if viewTypeIndex}}{{#with (lookup bindings viewTypeIndex)}}{{searchViewLabel.value}}{{/with}}{{else}}List{{/if}}"
                        > 
                          <bs-dropdown-toggle>
                            <div>
                              <span class="color-secondary-light" style="font-weight: 400;">View as: </span>
                              <span style="font-weight: 600;">{{#if viewTypeIndex}}{{#with (lookup bindings viewTypeIndex)}}{{searchViewLabel.value}}{{/with}}{{else}}List{{/if}}</span>
                            </div>
                          </bs-dropdown-toggle>

                          <bs-dropdown-menu>
                            {{#each bindings}}
                              <mp-event-trigger id='{{../bindings.0.viewid.value}}-view-type-trigger' 
                                                type='Component.TemplateUpdate' 
                                                data='{"viewTypeIndex": "{{@index}}",
                                                      "searchViewType": "{{searchViewType.value}}"}' 
                                                targets='["{{../bindings.0.viewid.value}}-search-view-dropdown-area",
                                                          "{{../bindings.0.viewid.value}}-search-result-views"
                                                        ]'>
                                <bs-menu-item event-key="{{searchViewLabel.value}}" 
                                              draggable="false"
                                              active='{{#if ../viewTypeIndex}}{{#ifCond ../viewTypeIndex "==" @index}}true{{else}}false{{/ifCond}}{{else}}{{#ifCond searchViewType.value "==" "http://www.researchspace.org/resource/system/vocab/search_view_type/list"}}true{{else}}false{{/ifCond}}{{/if}}'>
                                  {{searchViewLabel.value}}
                                </bs-menu-item>
                              </mp-event-trigger> 
                            {{/each}}
                          </bs-dropdown-menu>

                        </bs-dropdown>
                      </template>
                    </mp-event-target-template-render>
                  {{else}}
                    <div></div>
                  {{/if}}
                
              </template>
            </semantic-query>

            [[!-- Refresh button --]]
            <mp-event-trigger id="[[urlParam 'viewid' escape=false]]-search-refresh-trigger" 
                                  type='Component.TemplateUpdate' 
                                  targets='["[[urlParam "resourceconfig" escape=false]]-resourceSearch-frame"]'
                                  >
              <button class="btn btn-default btn-textAndIcon">
                <rs-icon icon-type="rounded" icon-name="refresh" title="Refresh results" symbol="true"></rs-icon>
              </button>
            </mp-event-trigger>

            [[!-- More actions button --]]
            <bs-dropdown id="[[urlParam 'viewid' escape=false]]-search-actions-dropdown" pull-right=true class="dropdown-no-caret">
              <bs-dropdown-toggle>
                <rs-icon icon-type="rounded" icon-name="more_vert" symbol="true"></rs-icon>
              </bs-dropdown-toggle>
              <bs-dropdown-menu>
             
                <mp-selection-action-choice id='[[urlParam "viewid" escape=false]]-image-side-by-side-action' selection='item-selection-aggregator'>
                  <div>
                    {{#each selection}}
                      <div>{{tag}}</div>
                    {{/each}}
                  </div>
                </mp-selection-action-choice>

                {{#ifCond "[[urlParam "resourceconfig" escape=false]]" "==" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Image"}}
                  [[!-- 
                    <mp-selection-action-choice id='[[urlParam "viewid" escape=false]]-side-by-side-action' selection='item-selection-aggregator'>
                      <rs-iiif-side-by-side-action icon="splitscreen_vertical_add" [[> rsp:IIIFConfig]] ></rs-iiif-side-by-side-action>
                    </mp-selection-action-choice>
                  --]]
                  
                  <mp-selection-action-choice id='[[urlParam "viewid" escape=false]]-overlay-action' selection='item-selection-aggregator'>
                    <rs-iiif-overlay-action icon="layers" [[> rsp:IIIFConfig]]></rs-iiif-overlay-action>
                  </mp-selection-action-choice>
                  
                  <hr>
                {{/ifCond}}

                {{#ifCond "[[urlParam "resourceconfig" escape=false]]" "==" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Set"}}
                {{else ifCond "[[urlParam "resourceconfig" escape=false]]" "==" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Knowledge_map"}}
                {{else ifCond "[[urlParam "resourceconfig" escape=false]]" "==" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_chart"}}
                {{else ifCond "[[urlParam "resourceconfig" escape=false]]" "==" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_timeline"}}
                {{else}}
                  [[#if (hasPermission "forms:ldp:*")]]
                    <mp-selection-action-choice id='[[urlParam "viewid" escape=false]]-create-set-action' selection='item-selection-aggregator'>
                      <mp-create-set-action id="[[urlParam 'viewid' escape=false]]-new-set-with-selection" icon="create_new_folder"></mp-create-set-action>
                    </mp-selection-action-choice>
                  [[/if]]

                  <mp-anonymous-hidden>
                    <semantic-search-action-save-set-result id='[[urlParam "viewid" escape=false]]-new-set-with-results'>
                      <bs-menu-item draggable="false">
                        <rs-icon icon-type="rounded" icon-name="create_new_folder" class="icon-left" symbol="true"></rs-icon>
                        <span>New set with results</span>
                      </bs-menu-item>  
                    </semantic-search-action-save-set-result>
                  </mp-anonymous-hidden>

                  [[#if (hasPermission "forms:ldp:*")]]
                    <hr>
                  [[/if]]
                {{/ifCond}}

        [[!--    <mp-anonymous-hidden>
                  <semantic-search-action-save-search-result id='save-search-result-action' add-to-default-set=true>
                    <bs-menu-item draggable="false">
                      <rs-icon icon-type="rounded" icon-name="save" class="icon-left" symbol="true"></rs-icon>
                      <span>Save search in clipboard</span>
                    </bs-menu-item>
                  </semantic-search-action-save-search-result>
                </mp-anonymous-hidden>

                <mp-anonymous-hidden><hr></mp-anonymous-hidden>
         --]]       
                <semantic-search-result> 
                  <mp-sparql-download id='csv-result' 
                                      query='SELECT ?resourceName ?resourceType ?resourceDescription WHERE { 
                                              BIND("[[urlParam "resourcelabel" escape=false]]" as ?resourceType)

                                              { 
                                                ?subject crm:P1_is_identified_by ?appellation .
                                                ?appellation a crm:E41_Appellation .
                                                ?appellation crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/primary_appellation> . 
                                                ?appellation crm:P190_has_symbolic_content ?resourceName .
                                              } UNION {
                                                  ?subject crm:P170i_time_is_defined_by ?resourceName .
                                              } UNION {
                                                  ?subject skos:prefLabel ?resourceName .
                                              } UNION {
                                                  ?subject crm:P190_has_symbolic_content ?resourceName .
                                              }

                                              OPTIONAL {
                                                  ?subject crm:P67i_is_referred_to_by ?information_object  .
                                                  ?information_object a crm:E73_Information_Object .
                                                  ?information_object crm:P2_has_type <http://www.researchspace.org/resource/vocab/text_type/description> .
                                                  ?information_object crm:P1_is_identified_by ?descriptionAppellation . 
                                                  ?descriptionAppellation a crm:E41_Appellation . 
                                                  ?descriptionAppellation crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/primary_appellation> . 
                                                  ?descriptionAppellation crm:P190_has_symbolic_content ?resourceDescription .
                                              }

                                              {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Appellation")}}
                                                MINUS { ?systemAuthorityItem crm:P1_is_identified_by|crm:P170i_time_is_defined_by ?subject .
                                                  ?systemAuthorityItem crm:P71i_is_listed_in ?systemAuthority .
                                                  ?systemAuthority crm:P2_has_type Platform:System_Resource . }
                                              {{/if}}

                                              {{#if (or 
                                                (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Actor")
                                                (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Group")
                                                (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Person")
                                              )}}
                                                MINUS {?subject crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/user> .}
                                              {{/if}}

                                              {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Authority_document")}}
                                                MINUS { ?subject crm:P2_has_type Platform:System_Resource .}
                                              {{/if}}


                                              {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Entity")}}
                                                MINUS { ?configuration <http://www.researchspace.org/pattern/system/resource_configuration/resource_search_listView_column> ?subject .}
                                              {{/if}}

                                              {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Information_object")}}
                                                MINUS { ?subject a Platform:resource_configuration .}
                                              {{/if}}

                                              {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Term")}}
                                                MINUS { ?subject crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/KP_category> .}
                                              {{/if}}

                                              {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Timespan")}}
                                                MINUS { 
                                                  ?entityFormRecordCreation crm:P4_has_time-span ?subject .
                                                  ?entityFormRecordCreation crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/entity_form_record_creation> .
                                                }
                                              {{/if}}

                                              {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Set")}}
                                                MINUS {?subject prov:wasAttributedTo ?__useruri__ ; rdfs:label "Uncategorized" .}
                                              {{/if}}

                                              MINUS {
                                                ?subject crm:P71i_is_listed_in|skos:inScheme ?systemAuthorityDoc .
                                                ?systemAuthorityDoc crm:P2_has_type Platform:System_Resource .
                                              }
                                            }'
                                      header='text/csv'
                                      filename='[[urlParam "resourcelabel" escape=false]]-csv-result.csv'>
                    <bs-menu-item draggable="false">
                      <rs-icon icon-type="rounded" icon-name="file_download" class="icon-left" symbol="true"></rs-icon>
                      <span>Export as CSV</span>
                    </bs-menu-item>
                  </mp-sparql-download>
                </semantic-search-result>
                  
                <semantic-search-result>
                  <mp-sparql-download id='json-result' 
                                      query='SELECT ?resourceName ?resourceType ?resourceDescription WHERE { 
                                              BIND("[[urlParam "resourcelabel" escape=false]]" as ?resourceType)

                                              { 
                                                ?subject crm:P1_is_identified_by ?appellation .
                                                ?appellation a crm:E41_Appellation .
                                                ?appellation crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/primary_appellation> . 
                                                ?appellation crm:P190_has_symbolic_content ?resourceName .
                                              } UNION {
                                                  ?subject crm:P170i_time_is_defined_by ?resourceName .
                                              } UNION {
                                                  ?subject skos:prefLabel ?resourceName .
                                              } UNION {
                                                  ?subject crm:P190_has_symbolic_content ?resourceName .
                                              }

                                              OPTIONAL {
                                                  ?subject crm:P67i_is_referred_to_by ?information_object  .
                                                  ?information_object a crm:E73_Information_Object .
                                                  ?information_object crm:P2_has_type <http://www.researchspace.org/resource/vocab/text_type/description> .
                                                  ?information_object crm:P1_is_identified_by ?descriptionAppellation . 
                                                  ?descriptionAppellation a crm:E41_Appellation . 
                                                  ?descriptionAppellation crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/primary_appellation> . 
                                                  ?descriptionAppellation crm:P190_has_symbolic_content ?resourceDescription .
                                              }

                                              {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Appellation")}}
                                                MINUS { ?systemAuthorityItem crm:P1_is_identified_by|crm:P170i_time_is_defined_by ?subject .
                                                  ?systemAuthorityItem crm:P71i_is_listed_in ?systemAuthority .
                                                  ?systemAuthority crm:P2_has_type Platform:System_Resource . }
                                              {{/if}}

                                              {{#if (or 
                                                (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Actor")
                                                (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Group")
                                                (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Person")
                                              )}}
                                                MINUS {?subject crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/user> .}
                                              {{/if}}

                                              {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Authority_document")}}
                                                MINUS { ?subject crm:P2_has_type Platform:System_Resource .}
                                              {{/if}}


                                              {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Entity")}}
                                                MINUS { ?configuration <http://www.researchspace.org/pattern/system/resource_configuration/resource_search_listView_column> ?subject .}
                                              {{/if}}

                                              {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Information_object")}}
                                                MINUS { ?subject a Platform:resource_configuration .}
                                              {{/if}}

                                              {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Term")}}
                                                MINUS { ?subject crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/KP_category> .}
                                              {{/if}}

                                              {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Timespan")}}
                                                MINUS { 
                                                  ?entityFormRecordCreation crm:P4_has_time-span ?subject .
                                                  ?entityFormRecordCreation crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/entity_form_record_creation> .
                                                }
                                              {{/if}}

                                              {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Set")}}
                                                MINUS {?subject prov:wasAttributedTo ?__useruri__ ; rdfs:label "Uncategorized" .}
                                              {{/if}}

                                              MINUS {
                                                ?subject crm:P71i_is_listed_in|skos:inScheme ?systemAuthorityDoc .
                                                ?systemAuthorityDoc crm:P2_has_type Platform:System_Resource .
                                              }
                                            }'
                                      header='application/sparql-results+json'
                                      filename='[[urlParam "resourcelabel" escape=false]]-json-result.json'>
                    <bs-menu-item draggable="false">
                      <rs-icon icon-type="rounded" icon-name="file_download" class="icon-left" symbol="true"></rs-icon>
                      <span>Export as JSON</span>
                    </bs-menu-item>
                  </mp-sparql-download>
                </semantic-search-result>
                
              </bs-dropdown-menu>
            </bs-dropdown>

          </div>
        </div>

        {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Authority_document")}}
          <semantic-query query='SELECT ?vocabulary ?vocabularyGraph WHERE { 
                                  
                                  GRAPH ?vocabularyGraph {
                                    ?vocabulary a crm:E32_Authority_Document .
                                  }
                                  
                                  MINUS {
                                    ?vocabulary crm:P2_has_type <http://www.researchspace.org/resource/system/System_Resource> .
                                  }
                                  FILTER(?vocabularyGraph != ?vocabulary) .
                                }' 
                          template='{{> template}}'
                          >

            <template id='template'>
              <div>
                <div class="warning-documentation-section warning-documentation-section-withIcon" style="margin: 5px 0 10px;">
                  <div class="warning-documentation-section-icon-container">
                    <rs-icon icon-type="rounded" icon-name="priority_high" symbol="true"></rs-icon>
                  </div>
          
                  <div> 
                    <div class="warning-documentation-section-title">Warning! &nbsp; The following authority documents can't be edited.</div>
                    <div class="warning-documentation-section-content">
                      <div>Authority documents of ontology class crm:E32_Authority_Document and all associated data should be defined in one named graph that equals to the authority IRI.</div>
                        <ul>
                          {{#each bindings}}
                            <li>
                              Authority document IRI '{{vocabulary.value}}' in graph '{{vocabularyGraph.value}}'
                            </li>
                          {{/each}}
                        </ul>
                    </div>
                  </div>
                </div>
              </div>  
            </template>
          </semantic-query>
        {{/if}}

  [[!-- With persist-resize=false when the sidebar re-rendered it doesn't 
        look at the local storage for size and it's always close (as default-open=false). 
        If persist-resize=true don't use id including 'viewId' as the same sidebar 
        will have different keys in local storage, creating problems  
  --]]
        <mp-splitpane id='[[urlParam "resourcelabel" escape=false]]-search-filters-sidebar' 
                      min-size=43 
                      default-size=297 
                      snap-threshold=150 
                      default-open=false
                      persist-resize=false 
                      always-render=true 
                      primary='second' 
                      class="search-filters-sidebar">

          <div class="search-results-area page__section-container">
            <semantic-search-facet-breadcrumbs></semantic-search-facet-breadcrumbs>

            <mp-event-target-template-render id="[[urlParam 'viewid' escape=false]]-search-result-views" template="{{> resultViews}}">
              <template id='resultViews'>
                  <semantic-search-result-holder>
                    {{#if (eq searchViewType "http://www.researchspace.org/resource/system/vocab/search_view_type/grid")}}
                      
                    [[!-- grid view --]]
                      <semantic-search-result>
                        <semantic-table id='semantic-search-result-grid'
                                        class-name="semantic-search-result-grid"
                                        query='SELECT DISTINCT ?subject ?iri ?resourceOntologyClass WHERE {
                                                    BIND(?subject as ?iri) .
                                                    BIND(IRI([[urlParam "resourceontologyclass" escape=false]]) AS ?resourceOntologyClass ).
                                                } ORDER BY ?subject'
                                        tuple-template='{{> gridItem }}'
                                        options='{"showFilter":false,
                                                  "resultsPerPage":50
                                                }'
                        >
                          <template id='gridItem'>
                            <div>
                              <mp-draggable iri='{{iri.value}}'>
                                {{#bind iri=iri.value}}
                                  {{> rsp:ResourceCard  selectionToggle=true 
                                                        resourceConfig="[[urlParam 'resourceconfig' escape=false]]" 
                                                        resourceLabel="[[urlParam 'resourcelabel' escape=true]]"
                                                        resourceOntologyClass=resourceOntologyClass.value
                                                        resourceIcon="[[urlParam 'resourceicon' escape=true]]"  
                                                        resourceFormIRI="[[urlParam "resourceform" escape=false]]"
                                                        viewId=__semanticTableIndex.value
                                                        allowResourceDelete=true
                                  }}
                                {{/bind}}
                              </mp-draggable>
                            </div>
                          </template>
                        </semantic-table>

                        [[> numberOfResults]]
                      </semantic-search-result>
                    {{else if (eq searchViewType "http://www.researchspace.org/resource/system/vocab/search_view_type/map")}}
                      <div>no map results</div>
                    {{else if (eq searchViewType "http://www.researchspace.org/resource/system/vocab/search_view_type/timeline")}}
                    
                    [[!-- timeline view: currently enabled only for crm:E21_Person and rdfs:subClassOf* crm:E2_Temporal_Entity  --]]
                      <div>
                        <semantic-search-result>
                          <mp-sparql-result-counts id='timeline-search-result-count' query="SELECT DISTINCT ?subject {} LIMIT 100"
                                                      template='{{> template}}'
                          >
                              <template id='template'>
                                {{#if hasLimit}}
                                  <bs-alert bs-style="warning" class="search-results__alert">
                                    <rs-icon icon-type="rounded" icon-name="report_problem" symbol="true"></rs-icon>
                                    <span class="num-results">There were {{totalNumberOfResults}} results. Only 100 can be visualised on the timeline at once!</span>
                                  </bs-alert>
                                {{/if}}
                              </template>
                          </mp-sparql-result-counts>
                        </semantic-search-result>

                        <semantic-search-result-context ranges='["http://www.cidoc-crm.org/cidoc-crm/E52_Time-Span"]'>
                          <semantic-search-result id='semantic-search-result-timeline'>
                              <mp-component-toolbar>
                                <mp-component-toolbar-actions>
                                    <mp-component-toolbar-action-save id='[[urlParam "viewid" escape=false]]-persist-component-action' add-to-default-set=false></mp-component-toolbar-action-save>
                                </mp-component-toolbar-actions>
                                <mp-component-toolbar-component>
                                    <semantic-timeline  id='search-result-timeline'
                                                        query='PREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>
                                                                SELECT DISTINCT ?item ?timespan ?start ?end ?birthTimespan ?deathTimespan WHERE {
                                                                  {
                                                                    ?item a ?ontologyClass .
                                                                    ?ontologyClass rdfs:subClassOf* crm:E2_Temporal_Entity .
                                                                    ?item crm:P4_has_time-span ?__value__ .
                                                                    ?__value__ crm:P82a_begin_of_the_begin|crm:P82b_end_of_the_end|crm:P82_at_some_time_within ?timespanDate .
                                                                    OPTIONAL { ?__value__ crm:P82a_begin_of_the_begin ?timespanStart . }
                                                                    OPTIONAL { ?__value__ crm:P82b_end_of_the_end ?timespanEnd . }
                                                                    OPTIONAL { ?__value__ crm:P82_at_some_time_within ?date . }
                                                                  

                                                                    BIND(IF(BOUND(?timespanEnd), ?timespanEnd, ?date) AS ?end)
                                                                    BIND(COALESCE(?timespanStart, ?date, ?end) AS ?start)
                                                                    BIND(?__value__ as ?timespan)
                                                               
                                                                    OPTIONAL { FILTER(?__contextRelationPattern__) }
                                                                  } UNION
                                                                  {
                                                                    ?item rdf:type crm:E21_Person.
                                                                    ?item crm:P98i_was_born|crm:P100i_died_in ?activity .
                                                                    ?activity crm:P4_has_time-span ?activityTimespan .
                                                                    ?activityTimespan crm:P82_at_some_time_within|crm:P82a_begin_of_the_begin|crm:P82b_end_of_the_end ?activityTimespanDate .
                                                                    OPTIONAL {
                                                                      ?item crm:P98i_was_born ?birth .
                                                                      ?birth crm:P4_has_time-span ?birthTimespan .
                                                                      ?birthTimespan crm:P82_at_some_time_within|crm:P82a_begin_of_the_begin|crm:P82b_end_of_the_end ?birthTimespanDate .
                                                                      OPTIONAL { ?birthTimespan crm:P82a_begin_of_the_begin ?birthStart . }
                                                                      OPTIONAL { ?birthTimespan crm:P82b_end_of_the_end ?birthEnd . }
                                                                      OPTIONAL { ?birthTimespan crm:P82_at_some_time_within ?birthDate . }
                                                                      BIND(COALESCE(?birthDate, ?birthStart, ?birthEnd) AS ?existingStart)
                                                                    }
                                                                    OPTIONAL {
                                                                      ?item crm:P100i_died_in ?death .
                                                                      ?death crm:P4_has_time-span ?deathTimespan .
                                                                      ?deathTimespan crm:P82_at_some_time_within|crm:P82a_begin_of_the_begin|crm:P82b_end_of_the_end ?deathTimespanDate .
                                                                      OPTIONAL { ?deathTimespan crm:P82a_begin_of_the_begin ?deathStart . }
                                                                      OPTIONAL { ?deathTimespan crm:crm:P82b_end_of_the_end ?deathEnd .}
                                                                      OPTIONAL { ?deathTimespan crm:P82_at_some_time_within ?deathDate . }
                                                                      BIND(COALESCE(?deathDate, ?deathStart, ?deathEnd) AS ?end)
                                                                    }
                                                                    BIND(COALESCE(?existingStart, ?end) AS ?start)
                                                                    OPTIONAL { FILTER(?__contextRelationPattern__) }
                                                                  } 
                                                                }
                                                                ORDER BY ?start ?end
                                                                LIMIT 100'
                                                                
                                                            
                                                        options='{"showCurrentTime": "true", "height": "500px"}'
                                                        tuple-template='{{> timelineItem}}'
                                                        no-result-template='{{> noResults}}'
                                                        tuple-template-height=auto>

                                      <template id='timelineItem'>
                                        <div style='display:flex;'>
                                          <div style='display:flex; gap: 12px; flex: 1;'>
                                            <div>
                                              <mp-resource-thumbnail iri='{{item.value}}'
                                                                    style="width: 55px; height: 55px; object-fit:cover; margin-top: 5px;">
                                                <mp-resource-thumbnail-fallback>
                                                  <span></span>
                                                </mp-resource-thumbnail-fallback>
                                              </mp-resource-thumbnail>
                                            </div>
                                            <div style='display:flex; flex-direction:column;align-items: flex-start; gap: 2px;'>
                                              <semantic-link iri="http://www.researchspace.org/resource/ThinkingFrames"
                                                              urlqueryparam-view='resource-editor' 
                                                              urlqueryparam-resource-iri='{{item.value}}'>
                                                <mp-label iri='{{item.value}}' class="text-link-action text-truncate-line1"></mp-label>
                                              </semantic-link>
                                              {{#if timespan}}
                                                {{#if start.value}}<div>Start date: {{start.value}}</div>{{/if}}
                                                {{#if end.value}}<div>End date: {{end.value}}</div>{{/if}}
                                                <div style="display: flex; gap: 3px;">
                                                  <span>View date:</span>
                                                  <semantic-link iri="http://www.researchspace.org/resource/ThinkingFrames"
                                                                  urlqueryparam-view='resource-editor' 
                                                                  urlqueryparam-resource-iri='{{timespan.value}}'>
                                                      <span><mp-label iri='{{timespan.value}}' class="text-link text-truncate-line1"></mp-label></span>
                                                  </semantic-link>
                                                </div> 
                                              {{/if}}
                                              {{#if birthTimespan}}
                                                <div style="display: flex; gap: 3px;">
                                                  <div>Birth date: </div>
                                                  {{#if start}}
                                                    <semantic-link iri="http://www.researchspace.org/resource/ThinkingFrames"
                                                                    urlqueryparam-view='resource-editor' 
                                                                    urlqueryparam-resource-iri='{{birthTimespan.value}}'
                                                                    class="text-link-action text-truncate-line1">
                                                        {{start.value}}
                                                    </semantic-link>
                                                  {{else}}
                                                    <div>missing birth timespan - date value</div>
                                                  {{/if}}
                                                </div> 
                                              {{/if}}
                                              {{#if deathTimespan}}
                                                <div style="display: flex; gap: 3px;">
                                                  <div>Death date: </div>
                                                  {{#if end}}
                                                    <semantic-link iri="http://www.researchspace.org/resource/ThinkingFrames"
                                                                    urlqueryparam-view='resource-editor' 
                                                                    urlqueryparam-resource-iri='{{deathTimespan.value}}'
                                                                    class="text-link-action text-truncate-line1">
                                                        {{end.value}}
                                                    </semantic-link>
                                                  {{else}}
                                                    <div>missing death timespan - date value</div>
                                                  {{/if}}
                                                </div> 
                                              {{/if}}
                                            </div>
                                          </div>
                                          <div style="display:flex; gap: 3px;">
                                            <mp-copy-to-default-set id="[[urlParam 'viewid' escape=false]]-copy-to-clipboard" resource="{{item.value}}">
                                              <button class="btn btn-default" style="height: 35px;">
                                                <rs-icon icon-type="rounded" icon-name="inventory" symbol="true" title="Copy to clipboard"></rs-icon>
                                              </button>
                                            </mp-copy-to-default-set>
                                            
                                            <mp-overlay-dialog  id="{{item.value}}-resource-preview-dialog"  
                                                                type="modal" 
                                                                class="modal-xlSize preview_modal"
                                                                title="Preview">
                                              <mp-overlay-dialog-trigger>
                                                <button class="btn btn-default" style="height: 35px;">
                                                  <rs-icon icon-type="rounded" icon-name="fullscreen" symbol="true" title="Preview"></rs-icon>
                                                </button>
                                              </mp-overlay-dialog-trigger>

                                              <mp-overlay-dialog-content>
                                                <inline-template template-iri='[[resolvePrefix "rsp:ResourcePreview"]]' 
                                                                  options='{  "resource": "{{item.value}}", 
                                                                              "resourceConfig": "[[urlParam "resourceconfig" escape=false]]", 
                                                                              "resourceConfigLabel": "[[urlParam "resourcelabel" escape=false]]",
                                                                              "resourceOntologyClass": "[[urlParam "resourceontologyclass" escape=false]]",
                                                                              "resourceDetailSection": true
                                                                            }' >
                                                </inline-template> 
                                              </mp-overlay-dialog-content>
                                            </mp-overlay-dialog>
                                          </div>
                                        </div>
                                      </template>

                                      <template id='noResults'>
                                        <div style="margin-bottom: 20px;">
                                          <div class="documentation-section documentation-section-withIcon">
                                            <div class="documentation-section-icon-container">
                                              <i class="fa fa-info"></i>
                                            </div>
                          
                                            <div style="flex: 1;"> 
                                              <div class="documentation-section-title">No results available</div>
                                              <div class="documentation-section-content">
                                                To display a resource in the timeline it must have associated a Timespan with date, start date or end date.
                                              </div>
                                            </div>
                                          </div> 
                                        </div>
                                      </template>
                                    </semantic-timeline>
                                </mp-component-toolbar-component>
                              </mp-component-toolbar>
                          </semantic-search-result>
                        </semantic-search-result-context>
                      </div>
                    {{else if (eq searchViewType "http://www.researchspace.org/resource/system/vocab/search_view_type/chart")}}

                      [[!-- chart view --]]
                      <semantic-search-result-context ranges='["http://www.w3.org/2004/02/skos/core#Concept","http://www.cidoc-crm.org/cidoc-crm/E55_Type","http://www.cidoc-crm.org/cidoc-crm/E53_Place"]'>
                        <semantic-search-result id='[[urlParam "viewid" escape=false]]-semantic-search-result-chart'>

                          <mp-component-toolbar>
                            <mp-component-toolbar-actions>
                              <semantic-chart-type-selector id='[[urlParam "viewid" escape=false]]-search-result-chart-type-selector' default="bar" types='["line", "bar", "radar", "pie", "donut"]'></semantic-chart-type-selector>
                                <mp-component-toolbar-action-download></mp-component-toolbar-action-download>
                                <mp-component-toolbar-action-save id='[[urlParam "viewid" escape=false]]-persist-component-action' add-to-default-set=false></mp-component-toolbar-action-save>
                            </mp-component-toolbar-actions>
                            <mp-component-toolbar-component>
                              <semantic-chart id='[[urlParam "viewid" escape=false]]-search-result-chart'
                                              query='SELECT ?__value__ (COUNT(DISTINCT ?subject) as ?count) WHERE {
                                                      OPTIONAL { FILTER(?__contextRelationPattern__) }
                                                      BIND(IF(BOUND(?__value__), ?__value__, "Unknown") as ?__value__)
                                                    } GROUP BY ?__value__ 
                                                      ORDER BY DESC(?count)'
                                              sets='[{
                                                      "dataSetName": "Number of values",
                                                      "category": "__value__",
                                                      "value": "count"
                                                    }]'>
                              </semantic-chart>
                            </mp-component-toolbar-component>
                          </mp-component-toolbar>
                        </semantic-search-result>
                      </semantic-search-result-context>
                    
                    {{else}}
                      [[!-- list view --]]
                      <semantic-query query=' SELECT DISTINCT ?resourceConfig 
                                                              ?columnTitle1 ?columnTitle2 ?columnTitle3 ?columnTitle4
                                                              ?columnContentType2 ?columnContentType3 ?columnContentType4
                                                              ?columnContentSparqlPattern2 ?columnContentSparqlPattern3 ?columnContentSparqlPattern4 
                                              WHERE {
                                                BIND(<[[urlParam "resourceconfig" escape=false]]> as ?resourceConfig)
                                                ?resourceConfig <http://www.researchspace.org/pattern/system/resource_configuration/resource_search_listView_column> ?customListViewColumn .

                                                OPTIONAL {
                                                  ?resourceConfig <http://www.researchspace.org/pattern/system/resource_configuration/resource_search_listView_column> ?customListViewColumn1 .
                                                  ?customListViewColumn1 <http://www.researchspace.org/pattern/system/resource_search_listView_column/order> "1" ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/title> ?columnTitle1 .
                                                }
                                                OPTIONAL {
                                                  ?resourceConfig <http://www.researchspace.org/pattern/system/resource_configuration/resource_search_listView_column> ?customListViewColumn2 .
                                                  ?customListViewColumn2 <http://www.researchspace.org/pattern/system/resource_search_listView_column/order> "2" ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/title> ?columnTitle2 ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/content_type> ?columnContentType2 ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/content_sparql_pattern> ?columnContentSparqlPattern2 .
                                                }
                                                OPTIONAL {
                                                  ?resourceConfig <http://www.researchspace.org/pattern/system/resource_configuration/resource_search_listView_column> ?customListViewColumn3 .
                                                  ?customListViewColumn3 <http://www.researchspace.org/pattern/system/resource_search_listView_column/order> "3" ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/title> ?columnTitle3 ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/content_type> ?columnContentType3 ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/content_sparql_pattern> ?columnContentSparqlPattern3 .
                                                }
                                                OPTIONAL {
                                                  ?resourceConfig <http://www.researchspace.org/pattern/system/resource_configuration/resource_search_listView_column> ?customListViewColumn4 .
                                                  ?customListViewColumn4 <http://www.researchspace.org/pattern/system/resource_search_listView_column/order> "4" ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/title> ?columnTitle4 ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/content_type> ?columnContentType4 ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/content_sparql_pattern> ?columnContentSparqlPattern4 .
                                                }
                                              } LIMIT 1'

                                      template='{{> custom-list-view}}'
                                      no-result-template='{{> default-list-view}}'>
                      
                        <template id='custom-list-view'>
                          <semantic-search-result>
                            <semantic-table id='semantic-search-result-list'
                                            class-name="table-fixed-header table-scrollable-content table-expanded search-table-container 
                                            {{#if (or (eq '[[urlParam 'resourceconfig' escape=false]]' 'http://www.researchspace.org/resource/system/resource_configurations_container/data/Set')
                                                      (eq '[[urlParam 'resourceconfig' escape=false]]' 'http://www.researchspace.org/resource/system/resource_configurations_container/data/Knowledge_map')
                                                      (eq '[[urlParam 'resourceconfig' escape=false]]' 'http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_chart')
                                                      (eq '[[urlParam 'resourceconfig' escape=false]]' 'http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_timeline'))}}table-without-checkbox{{else}}table-with-checkbox{{/if}}"
                                            query='SELECT DISTINCT ?subject ?iri ?description WHERE {
                                                    BIND(?subject as ?iri) .
                                                    #?subject a ?type .
                                                    #?type rdfs:label ?typeLabel .
                                                    #FILTER (lang(?typeLabel) = "en")

                                                    OPTIONAL {
                                                      ?subject crm:P67i_is_referred_to_by ?information_object  .
                                                      ?information_object crm:P2_has_type <http://www.researchspace.org/resource/vocab/text_type/description> .
                                                      ?information_object crm:P1_is_identified_by ?descriptionAppellation . 
                                                      ?descriptionAppellation crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/primary_appellation> . 
                                                      ?descriptionAppellation crm:P190_has_symbolic_content ?description .
                                                    }
                                                  } ORDER BY ?subject'
    
                                            options='{"showFilter":false, 
                                                      "resultsPerPage":30,
                                                      "useFixedHeader":true
                                                     }' 

                                            column-configuration='[
                                                                    {"variableName": "subject", "displayName": "", "cellTemplate": "{{> selectionCheckbox}}" },
                                                                    {"variableName": "subject", "displayName": "{{#if bindings.0.columnTitle1.value}}{{bindings.0.columnTitle1.value}}{{else}}[[urlParam "resourcelabel" escape=false]] name{{/if}}", "cellTemplate": "{{> column1}}" },
                                                                    {{#if bindings.0.columnTitle2.value}} {"variableName": "", "displayName": "{{bindings.0.columnTitle2.value}}", "cellTemplate": "{{> column2}}" },{{/if}}
                                                                    {{#if bindings.0.columnTitle3.value}} {"variableName": "", "displayName": "{{bindings.0.columnTitle3.value}}", "cellTemplate": "{{> column3}}" },{{/if}}
                                                                    {{#if bindings.0.columnTitle4.value}} {"variableName": "", "displayName": "{{bindings.0.columnTitle4.value}}", "cellTemplate": "{{> column4}}" },{{/if}}
                                                                    {"variableName": "", "displayName": "", "cellTemplate": "{{> actions}}" }
                                                                  ]'   
                            >
    
                              <template id='selectionCheckbox'>
                                [[#if (hasPermission "forms:ldp:*")]]
                                  {{#if (or (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Set") 
                                            (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Knowledge_map")
                                            (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_chart")
                                            (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_timeline")
                                        )}}
                                  {{else}}
                                    <div>
                                      <mp-selection-toggle selection="item-selection-aggregator" tag="{{iri.value}}"></mp-selection-toggle>
                                    </div>
                                  {{/if}}
                                [[/if]]
                              </template>
    
                              <template id='column1'>
                                <div>
                                  <div style="display: flex; align-items: center; gap: 15px;"> 
                                    <mp-overlay-dialog  id="{{iri.value}}-resource-preview-dialog"  
                                                        type="modal" 
                                                        class="modal-xlSize preview_modal"
                                                        title="Preview">
                                      <mp-overlay-dialog-trigger>
                                        <div class="resource-thumbnail-small-container">
                                          <mp-draggable iri='{{iri.value}}'>
                                            {{#if (eq bindings.0.resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Image_annotation")}}
                                              <div>
                                                <rs-iiif-image-thumbnail  height='40' width='45' style='height: 100%; width: 100%; max-height: 40px;'
                                                                          image-or-region='{{iri.value}}'      
                                                                          [[> rsp:IIIFConfig]]
                                                                        >
                                                </rs-iiif-image-thumbnail>
                                              </div>
                                            {{else}}
                                              <div>
                                                <mp-resource-thumbnail iri='{{iri.value}}' class='resource-thumbnail-small'>
                                                    <mp-resource-thumbnail-fallback>
                                                      [[#if (urlParam 'resourceicon') ]]
                                                        <rs-icon icon-type="rounded" icon-name="[[urlParam 'resourceicon']]" symbol="true" class='resource-thumbnail-small-fallback-icon'></rs-icon>
                                                      [[else]]
                                                        <rs-icon icon-type="rounded" icon-name="image" symbol="true" class='resource-thumbnail-small-fallback-icon'></rs-icon>
                                                      [[/if]]
                                                    </mp-resource-thumbnail-fallback>
                                                </mp-resource-thumbnail>
                                              </div>
                                            {{/if}}    
                                          </mp-draggable>     
                                        </div>
                                      </mp-overlay-dialog-trigger>
                                      <mp-overlay-dialog-content>
                                        <inline-template template-iri='[[resolvePrefix "rsp:ResourcePreview"]]' 
                                                        options='{"resource": "{{iri.value}}", 
                                                                    "resourceConfig": "{{bindings.0.resourceConfig.value}}", 
                                                                    "resourceConfigLabel": "[[urlParam "resourcelabel" escape=false]]",
                                                                    "resourceDescription": "{{description.value}}",
                                                                    "resourceDetailSection": true
                                                                    }' >
                                        </inline-template> 
                                      </mp-overlay-dialog-content>
                                    </mp-overlay-dialog>
                                    <div>
                                      <mp-draggable iri='{{iri.value}}'>
                                        <div>
                                          {{#if (eq bindings.0.resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Knowledge_map")}}
                                            <mp-event-trigger id='{{iri.value}}-open-km-title-trigger' 
                                                              type='Dashboard.AddFrame'
                                                              data='{"viewId":"knowledge-map", 
                                                                      "resourceIri": "{{iri.value}}"}' 
                                                              targets='["thinking-frames"]'>
                                              <div><mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label></div>
                                            </mp-event-trigger>
                                          {{else if (eq bindings.0.resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_chart")}}
                                            <mp-event-trigger id='{{iri.value}}-open-chart-title-trigger' 
                                                              type='Dashboard.AddFrame'
                                                              data='{"viewId":"chart", 
                                                                      "resourceIri": "{{iri.value}}"}' 
                                                              targets='["thinking-frames"]'>
                                              <div><mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label></div>
                                            </mp-event-trigger>
                                          {{else if (eq bindings.0.resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_timeline")}}
                                            <mp-event-trigger id='{{iri.value}}-open-timeline-title-trigger' 
                                                              type='Dashboard.AddFrame'
                                                              data='{"viewId":"timeline", 
                                                                      "resourceIri": "{{iri.value}}"}' 
                                                              targets='["thinking-frames"]'>
                                              <div><mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label></div>
                                            </mp-event-trigger>
                                          {{else if (eq bindings.0.resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Authority_document")}}
                                            <semantic-link  iri='http://www.researchspace.org/resource/ThinkingFrames'
                                                            urlqueryparam-view='authority-list'
                                                            urlqueryparam-resource='{{iri.value}}'>
                                              <mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label>
                                            </semantic-link>
                                          {{else if (eq bindings.0.resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Set")}}
                                            <semantic-link  iri='http://www.researchspace.org/resource/ThinkingFrames'
                                                            urlqueryparam-view='single-set-management'
                                                            urlqueryparam-resource='{{iri.value}}'>
                                              <mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label>
                                            </semantic-link>
                                          {{else}}
                                            <semantic-link  iri='http://www.researchspace.org/resource/ThinkingFrames'
                                                            urlqueryparam-view='{{#if (eq bindings.0.resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_narrative")}}semantic-narrative{{else}}resource-editor{{/if}}'
                                                            urlqueryparam-resource='{{iri.value}}'>
                                              <mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label>
                                            </semantic-link>
                                          {{/if}}
                                        </div>
                                      </mp-draggable>

                                      {{#if (eq bindings.0.resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/User")}}
                                        <semantic-query query='SELECT DISTINCT ?systemUser WHERE { 
                                                                BIND(IRI(REPLACE(STR(?__useruri__), "%40", "_")) as ?systemUser)
                                                              } LIMIT 1'>
                                          <template id='template'>
                                            {{#ifCond bindings.0.systemUser.value "===" iri.value}}
                                              <div class="color-action text-bold600 text-font-size__xsmall text-truncate-line1">My profile</div>
                                            {{else}}
                                              <div class="color-secondary-light text-font-size__xsmall text-truncate-line1">[[urlParam "resourcelabel" escape=false]]</div>
                                            {{/ifCond}}
                                          </template>
                                        </semantic-query>
                                      {{else}}
                                        <div class="color-secondary-light text-font-size__xsmall text-truncate-line1">[[urlParam "resourcelabel" escape=false]]</div>
                                      {{/if}}
                                    </div>
                                  </div>
                                </div>
                              </template>

                              <template id='column2'>
                                {{#if bindings.0.columnContentSparqlPattern2.value}}
                                  <semantic-query query='SELECT ?item ?value ?label ?columnContentType2 ?itemIri WHERE {
                                                            BIND(<{{iri.value}}> AS ?item)
                                                            BIND("{{bindings.0.columnContentType2.value}}" AS ?columnContentType2)
                                                            {{bindings.0.columnContentSparqlPattern2.value}}
                                                          }'
                                                  template='{{> customColumnContent}}'
                                    >

                                      <template id='customColumnContent'>
                                        <div>
                                          {{#if (eq bindings.0.columnContentType2.value "icon actor")}}
                                            <mp-popover>
                                              <mp-popover-trigger placement="bottom" trigger='["click", "focus"]'> 
                                                <rs-icon icon-type="rounded" icon-name="people_alt" symbol="true" class="people-icon"></rs-icon>
                                              </mp-popover-trigger>
                                              <mp-popover-content>
                                                <div style="display: flex; flex-direction: column; gap: 5px;">
                                                  {{#each bindings}}
                                                    <mp-draggable iri='{{value.value}}'>
                                                      <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                                                                urlqueryparam-view="resource-editor"
                                                                                urlqueryparam-resource-iri='{{value.value}}'>
                                                        <div class="text-link">{{label.value}}</div>
                                                      </semantic-link-container>
                                                    </mp-draggable>
                                                  {{/each}}
                                                </div>
                                              </mp-popover-content>
                                            </mp-popover>
                                          {{else}}
                                            {{#if (eq bindings.0.columnContentType2.value "tag")}}<div style="display: flex; gap: 5px; flex-wrap: wrap;">{{/if}}
                                              {{#each bindings}}
                                                {{#if (eq columnContentType2.value "date")}}
                                                  <mp-draggable iri='{{value.value}}'><span>{{dateTimeFormat label.value "DD/MM/YYYY"}}</span></mp-draggable>
                                                  <span>{{#if @last}}{{else}}, {{/if}}</span>
                                                {{else if (eq columnContentType2.value "link")}}
                                                  <mp-draggable iri='{{value.value}}'>
                                                    <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                                                              urlqueryparam-view="resource-editor"
                                                                              urlqueryparam-resource-iri='{{value.value}}'>
                                                      <span class="text-link">{{label.value}}</span>
                                                    </semantic-link-container>
                                                  </mp-draggable>
                                                  <span>{{#if @last}}{{else}}, {{/if}}</span>
                                                {{else if (eq columnContentType2.value "tag")}}
                                                  <span class="badge badge--secondary">{{label.value}}</span>
                                                {{else}}
                                                  <span style="{{#if (eq columnContentType2.value 'bold text')}}font-weight: 600;{{/if}}">{{label.value}}</span>
                                                  <span>{{#if @last}}{{else}}, {{/if}}</span>
                                                {{/if}}
                                              {{/each}}
                                              {{#if (eq bindings.0.columnContentType2.value "tag")}}</div>{{/if}}
                                          {{/if}}
                                        </div>
                                      </template>
                                  </semantic-query>
                                {{/if}}
                              </template>

                              <template id='column3'>
                                {{#if bindings.0.columnContentSparqlPattern3.value}}
                                  <semantic-query query='SELECT ?item ?value ?label ?itemIri ?columnContentType3 WHERE {
                                                            BIND(<{{iri.value}}> AS ?item)
                                                            BIND("{{bindings.0.columnContentType3.value}}" AS ?columnContentType3)
                                                            {{bindings.0.columnContentSparqlPattern3.value}}
                                                          }'
                                                    template='{{> customColumnContent}}'
                                    >

                                      <template id='customColumnContent'>
                                        <div>
                                          {{#if (eq bindings.0.columnContentType3.value "icon actor")}}
                                            <mp-popover>
                                              <mp-popover-trigger placement="bottom" trigger='["click", "focus"]'> 
                                                <rs-icon icon-type="rounded" icon-name="people_alt" symbol="true" class="people-icon"></rs-icon>
                                              </mp-popover-trigger>
                                              <mp-popover-content>
                                                <div style="display: flex; flex-direction: column; gap: 5px;">
                                                  {{#each bindings}}
                                                    <mp-draggable iri='{{value.value}}'>
                                                      <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                                                                urlqueryparam-view="resource-editor"
                                                                                urlqueryparam-resource-iri='{{value.value}}'>
                                                        <div class="text-link">{{label.value}}</div>
                                                      </semantic-link-container>
                                                    </mp-draggable>
                                                  {{/each}}
                                                </div>
                                              </mp-popover-content>
                                            </mp-popover>
                                          {{else}}
                                            {{#if (eq bindings.0.columnContentType3.value "tag")}}<div style="display: flex; gap: 5px; flex-wrap: wrap;">{{/if}}
                                            {{#each bindings}}
                                              {{#if (eq columnContentType3.value "date")}}
                                                <mp-draggable iri='{{value.value}}'><span>{{dateTimeFormat label.value "DD/MM/YYYY"}}</span></mp-draggable>
                                                <span>{{#if @last}}{{else}}, {{/if}}</span>
                                              {{else if (eq columnContentType3.value "link")}}
                                                <mp-draggable iri='{{value.value}}'>
                                                  <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                                                            urlqueryparam-view="resource-editor"
                                                                            urlqueryparam-resource-iri='{{value.value}}'>
                                                    <span class="text-link">{{label.value}}</span>
                                                  </semantic-link-container>
                                                </mp-draggable>
                                                <span>{{#if @last}}{{else}}, {{/if}}</span>
                                              {{else if (eq columnContentType3.value "tag")}}
                                                <span class="badge badge--secondary">{{label.value}}</span>
                                              {{else}}
                                                <span style="{{#if (eq columnContentType3.value 'bold text')}}font-weight: 600;{{/if}}">{{label.value}}</span>
                                                <span>{{#if @last}}{{else}}, {{/if}}</span>
                                              {{/if}}
                                            {{/each}}
                                            {{#if (eq bindings.0.columnContentType3.value "tag")}}</div>{{/if}}
                                          {{/if}}
                                        </div>
                                      </template>
                                  </semantic-query>
                                {{/if}}
                              </template>    

                              <template id='column4'>
                                {{#if bindings.0.columnContentSparqlPattern4.value}}
                                  <semantic-query query='SELECT ?item ?value ?label ?itemIri ?columnContentType4 WHERE {
                                                            BIND(<{{iri.value}}> AS ?item)
                                                            BIND("{{bindings.0.columnContentType4.value}}" AS ?columnContentType4)
                                                            {{bindings.0.columnContentSparqlPattern4.value}}
                                                          }'
                                                    template='{{> customColumnContent}}'
                                    >

                                      <template id='customColumnContent'>
                                        <div>
                                          {{#if (eq bindings.0.columnContentType4.value "icon actor")}}
                                            <mp-popover>
                                              <mp-popover-trigger placement="bottom" trigger='["click", "focus"]'> 
                                                <rs-icon icon-type="rounded" icon-name="people_alt" symbol="true" class="people-icon"></rs-icon>
                                              </mp-popover-trigger>
                                              <mp-popover-content>
                                                <div style="display: flex; flex-direction: column; gap: 5px;">
                                                  {{#each bindings}}
                                                    <mp-draggable iri='{{value.value}}'>
                                                      <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                                                                urlqueryparam-view="resource-editor"
                                                                                urlqueryparam-resource-iri='{{value.value}}'>
                                                        <div class="text-link">{{label.value}}</div>
                                                      </semantic-link-container>
                                                    </mp-draggable>
                                                  {{/each}}
                                                </div>
                                              </mp-popover-content>
                                            </mp-popover>
                                          {{else}}
                                            {{#if (eq bindings.0.columnContentType4.value "tag")}}<div style="display: flex; gap: 5px; flex-wrap: wrap;">{{/if}}
                                            {{#each bindings}}
                                              {{#if (eq columnContentType4.value "date")}}
                                                <mp-draggable iri='{{value.value}}'>
                                                  <span>{{dateTimeFormat label.value "DD/MM/YYYY"}}</span>
                                                </mp-draggable>
                                                <span>{{#if @last}}{{else}}, {{/if}}</span>
                                              {{else if (eq columnContentType4.value "link")}}
                                                <mp-draggable iri='{{value.value}}'>
                                                  <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                                                            urlqueryparam-view="resource-editor"
                                                                            urlqueryparam-resource-iri='{{value.value}}'>
                                                    <span class="text-link">{{label.value}}</span>
                                                  </semantic-link-container>
                                                </mp-draggable>
                                                <span>{{#if @last}}{{else}}, {{/if}}</span>
                                              {{else if (eq columnContentType4.value "tag")}}
                                                <span class="badge badge--secondary">{{label.value}}</span>
                                              {{else}}
                                                <span style="{{#if (eq columnContentType4.value 'bold text')}}font-weight: 600;{{/if}}">{{label.value}}</span>
                                                <span>{{#if @last}}{{else}}, {{/if}}</span>
                                              {{/if}}
                                            {{/each}}
                                            {{#if (eq bindings.0.columnContentType4.value "tag")}}</div>{{/if}}
                                          {{/if}}
                                        </div>
                                      </template>
                                  </semantic-query>
                                {{/if}}
                              </template>

                              <template id='actions'>
                                [[> resultCardActions resourceConfig="bindings.0.resourceConfig.value" ]]
                              </template>  

                            </semantic-table>
                            [[> numberOfResults]]
                          </semantic-search-result>
                        </template>

                        <template id='default-list-view'>
                          <semantic-search-result>
                            <semantic-table id='semantic-search-result-list'
                                            class-name="table-fixed-header table-scrollable-content table-expanded search-table-container 
                                            {{#if (or (eq '[[urlParam 'resourceconfig' escape=false]]' 'http://www.researchspace.org/resource/system/resource_configurations_container/data/Set')
                                                      (eq '[[urlParam 'resourceconfig' escape=false]]' 'http://www.researchspace.org/resource/system/resource_configurations_container/data/Knowledge_map')
                                                      (eq '[[urlParam 'resourceconfig' escape=false]]' 'http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_chart')
                                                      (eq '[[urlParam 'resourceconfig' escape=false]]' 'http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_timeline')
                                            )}}table-without-checkbox{{else}}table-with-checkbox{{/if}}"
                                            query='SELECT DISTINCT ?subject ?iri ?description ?resourceConfig WHERE {
                                                    BIND(?subject as ?iri) .
                                                    BIND(<[[urlParam "resourceconfig" escape=false]]> as ?resourceConfig) .
                                                    
                                                    OPTIONAL {
                                                      ?subject crm:P67i_is_referred_to_by ?information_object  .
                                                      ?information_object crm:P2_has_type <http://www.researchspace.org/resource/vocab/text_type/description> .
                                                      ?information_object crm:P1_is_identified_by ?descriptionAppellation . 
                                                      ?descriptionAppellation crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/primary_appellation> . 
                                                      ?descriptionAppellation crm:P190_has_symbolic_content ?description .
                                                    }
                                                  } ORDER BY ?subject'
    
                                            options='{"showFilter":false, 
                                                      "resultsPerPage":30,
                                                      "useFixedHeader":true
                                                    }' 
                                            column-configuration='[
                                                                    {"variableName": "subject", "displayName": "", "cellTemplate": "{{> selectionCheckbox}}" },
                                                                    {"variableName": "subject", "displayName": "[[urlParam "resourcelabel" escape=false]] name", "cellTemplate": "{{> column1}}" },
                                                                    {"variableName": "description", "displayName": "Description", "cellTemplate": "{{> column2}}" },
                                                                    {"variableName": "", "displayName": "", "cellTemplate": "{{> actions}}" }
                                                                  ]'   
                            >
    
                              <template id='selectionCheckbox'>
                                [[#if (hasPermission "forms:ldp:*")]]
                                  {{#if (or (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Set") 
                                            (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Knowledge_map")
                                            (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_chart")
                                            (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_timeline")
                                  )}}
                                  {{else}}
                                    <div>
                                      <mp-selection-toggle selection="item-selection-aggregator" tag="{{iri.value}}"></mp-selection-toggle>
                                    </div>
                                  {{/if}}
                                [[/if]]
                              </template>
    
                              <template id='column1'>
                                <div>
                                  <div style="display: flex; align-items: center; gap: 15px;">                                 
                                    
                                    <mp-overlay-dialog  id="{{iri.value}}-resource-preview-dialog"  
                                                        type="modal" 
                                                        class="modal-xlSize preview_modal"
                                                        title="Preview">
                                      <mp-overlay-dialog-trigger>
                                        <div class="resource-thumbnail-small-container">
                                          <mp-draggable iri='{{iri.value}}'>
                                            {{#if (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Image_annotation")}}
                                              <div>
                                                <rs-iiif-image-thumbnail  height='40' width='45' style='height: 100%; width: 100%; max-height: 40px;'
                                                                          image-or-region='{{iri.value}}'      
                                                                          [[> rsp:IIIFConfig]]
                                                                        >
                                                </rs-iiif-image-thumbnail>
                                              </div>
                                            {{else}}
                                              <div>
                                                <mp-resource-thumbnail iri='{{iri.value}}' class='resource-thumbnail-small'>
                                                    <mp-resource-thumbnail-fallback>
                                                      [[#if (urlParam 'resourceicon') ]]
                                                        <rs-icon icon-type="rounded" icon-name="[[urlParam 'resourceicon']]" symbol="true" class='resource-thumbnail-small-fallback-icon'></rs-icon>
                                                      [[else]]
                                                        <rs-icon icon-type="rounded" icon-name="image" symbol="true" class='resource-thumbnail-small-fallback-icon'></rs-icon>
                                                      [[/if]]
                                                    </mp-resource-thumbnail-fallback>
                                                </mp-resource-thumbnail>
                                              </div>
                                            {{/if}}         
                                          </mp-draggable>
                                        </div>
                                      </mp-overlay-dialog-trigger>
                                      <mp-overlay-dialog-content>
                                        <inline-template template-iri='[[resolvePrefix "rsp:ResourcePreview"]]' 
                                                        options='{"resource": "{{iri.value}}", 
                                                                    "resourceConfig": "{{resourceConfig.value}}", 
                                                                    "resourceConfigLabel": "[[urlParam "resourcelabel" escape=false]]",
                                                                    "resourceDescription": "{{description.value}}",
                                                                    "resourceDetailSection": true
                                                                    }' >
                                        </inline-template> 
                                      </mp-overlay-dialog-content>
                                    </mp-overlay-dialog>
                                    <div>
                                      <mp-draggable iri='{{iri.value}}'>
                                        <div>
                                          {{#if (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Knowledge_map")}}
                                            <mp-event-trigger id='{{iri.value}}-open-km-title-trigger' 
                                                              type='Dashboard.AddFrame'
                                                              data='{"viewId":"knowledge-map", 
                                                                      "resourceIri": "{{iri.value}}"}' 
                                                              targets='["thinking-frames"]'>
                                              <div><mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label></div>
                                            </mp-event-trigger>
                                          {{else if (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_chart")}}
                                            <mp-event-trigger id='{{iri.value}}-open-chart-title-trigger' 
                                                              type='Dashboard.AddFrame'
                                                              data='{"viewId":"chart", 
                                                                      "resourceIri": "{{iri.value}}"}' 
                                                              targets='["thinking-frames"]'>
                                              <div><mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label></div>
                                            </mp-event-trigger>
                                          {{else if (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_timeline")}}
                                            <mp-event-trigger id='{{iri.value}}-open-timeline-title-trigger' 
                                                              type='Dashboard.AddFrame'
                                                              data='{"viewId":"timeline", 
                                                                      "resourceIri": "{{iri.value}}"}' 
                                                              targets='["thinking-frames"]'>
                                              <div><mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label></div>
                                            </mp-event-trigger>
                                          {{else if (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Authority_document")}}
                                            <semantic-link  iri='http://www.researchspace.org/resource/ThinkingFrames'
                                                            urlqueryparam-view='authority-list'
                                                            urlqueryparam-resource='{{iri.value}}'>
                                              <mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label>
                                            </semantic-link>
                                          {{else if (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Set")}}
                                            <semantic-link  iri='http://www.researchspace.org/resource/ThinkingFrames'
                                                            urlqueryparam-view='single-set-management'
                                                            urlqueryparam-resource='{{iri.value}}'>
                                              <mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label>
                                            </semantic-link>
                                          {{else}}
                                            <semantic-link  iri='http://www.researchspace.org/resource/ThinkingFrames'
                                                            urlqueryparam-view='{{#if (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_narrative")}}semantic-narrative{{else}}resource-editor{{/if}}'
                                                            urlqueryparam-resource='{{iri.value}}'>
                                              <mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label>
                                            </semantic-link>
                                          {{/if}}
                                        </div>
                                      </mp-draggable>

                                      {{#if (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/User")}}
                                        <semantic-query query='SELECT DISTINCT ?systemUser WHERE { 
                                                                BIND(IRI(REPLACE(STR(?__useruri__), "%40", "_")) as ?systemUser)
                                                              } LIMIT 1'>
                                          <template id='template'>
                                            {{#ifCond bindings.0.systemUser.value "===" iri.value}}
                                              <div class="color-action text-bold600 text-font-size__xsmall text-truncate-line1">My profile</div>
                                            {{else}}
                                              <div class="color-secondary-light text-font-size__xsmall text-truncate-line1">[[urlParam "resourcelabel" escape=false]]</div>
                                            {{/ifCond}}
                                          </template>
                                        </semantic-query>
                                      {{else}}
                                        <div class="color-secondary-light text-font-size__xsmall text-truncate-line1">[[urlParam "resourcelabel" escape=false]]</div>
                                      {{/if}}
                                    </div>
                                  </div>
                                </div>
                              </template>

                              <template id='column2'>
                                {{#if description.value}}
                                  <mp-text-truncate lines=1 expand='<div class="text-link">Expand</div>' collapse='<div class="text-link">Collapse</div>'>
                                    {{description.value}}
                                  </mp-text-truncate>
                                {{/if}}
                              </template>

                              <template id='actions'>
                                <div>
                                  [[> resultCardActions resourceConfig="resourceConfig.value" ]]
                                </div>
                              </template>
    
                            </semantic-table>
                            [[> numberOfResults]]
                          </semantic-search-result>
                        </template>

                      </semantic-query>
                    {{/if}}
                  </semantic-search-result-holder>
              </template>
            </mp-event-target-template-render>
          </div>

          <div class="split-pane__sidebar split-pane__rightsidebar">

            <mp-splitpane-toggle-on>
              <button class="btn-toggle-on" title="Filter by">
                  <div class="btn-toggle-on-content content-center">
                    <rs-icon icon-type="outlined" icon-name="filter_alt"></rs-icon>
                  </div>
              </button>
            </mp-splitpane-toggle-on>

            <mp-splitpane-toggle-off>
              <div class="split-pane__sidebar-header" style="position: relative;">
                  <button class="btn-toggle-off">
                      <div style="display: flex; align-items: center; gap: 10px;">
                          <div class="customFormHeader" style="padding-top: 0;">Filter by</div>
                      </div> 
                      <rs-icon icon-type="rounded" icon-name="keyboard_double_arrow_right" symbol="true"
                              style="font-size: 20px;">
                      </rs-icon>
                  </button>
              </div>
            </mp-splitpane-toggle-off>

            <mp-splitpane-sidebar-open style="flex: 1; overflow: hidden;">
              <div class="split-pane__sidebar-open">
                <semantic-search-facet  id='[[urlParam "viewid" escape=false]]-semantic-search-facet'
                                        big-result-set=true
                                        open-by-default=true
                                        hide-toggle-button=true>
                </semantic-search-facet>
              </div>
            </mp-splitpane-sidebar-open>

          </div>

        </mp-splitpane>
      </div>
    </semantic-search> 
  </template>
</mp-event-target-template-render>

[[#*inline "numberOfResults"]]
  <div class="semantic-search-num-results">
    <mp-sparql-result-counts  id='semantic-search-result-count' 
                              query="SELECT DISTINCT ?subject {}"
                              template='{{> template}}'
    >
      <template id='template'>
        <div class="num-results">
            Found 
            <span class="num-results-color">{{#if hasLimit}}{{totalNumberOfResults}}{{else}}{{numberOfResults}}{{/if}}</span> 
            results
        </div>
      </template>
    </mp-sparql-result-counts>
  </div>
[[/inline ]]


[[#*inline "resultCardActions"]]
  <div style="display: flex; align-items: stretch; gap: 1px;">
    <mp-draggable iri='{{iri.value}}' drag-style="cursor: grab;">
      <button class="btn btn-default border-none" title="drag [[urlParam 'resourcelabel' escape=false]]" style="cursor: grab;">
        <rs-icon icon-type="rounded" icon-name="drag_pan" symbol="true"></rs-icon>
      </button>
    </mp-draggable>

    <rs-resource-dropdown id="[[resourceConfig]]-{{iri.value}}-item-actions-dropdown" class-name="dropdown-no-caret" toggle-class-name="border-none">
      {{> rsp:ResourceDropdownActions viewId=[[resourceConfig]]
                                      iri=iri.value
                                      resourceConfig=[[resourceConfig]]
                                      resourceLabel="[[urlParam "resourcelabel" escape=false]]"
                                      resourceOntologyClass="[[urlParam "resourceontologyclass" escape=false]]"
                                      resourceDescription=description.value
                                      resourceFormIRI="[[urlParam "resourceform" escape=false]]"
                                      allowResourceDelete=true
      }}
    </rs-resource-dropdown>
  </div>
[[/inline ]]
