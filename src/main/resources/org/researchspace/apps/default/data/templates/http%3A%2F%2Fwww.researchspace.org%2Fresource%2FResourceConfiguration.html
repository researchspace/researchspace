{{#bind viewId=dashboardId}}
  <div class="resource-editView-container">
      <mp-splitpane min-size=250 default-size=450 default-open=true always-render=true persist-resize=false snap-threshold=70>
        <div class="split-pane__sidebar split-pane__leftsidebar">
          <mp-splitpane-toggle-on>
            <button class="btn-toggle-on">
              <div class="btn-toggle-on-content">
                <h4 style="width: 100%; text-align: left;">
                  Resource configuration
                </h4>
                <rs-icon icon-type="round" icon-name="chevron_right"></rs-icon>
              </div>
            </button>
          </mp-splitpane-toggle-on>
          <mp-splitpane-toggle-off>
            <div class="split-pane__sidebar-header">
              <button class="btn-toggle-off">
                <h4 style="width: 100%; text-align: left;">
                  Resource configuration
                </h4>
                <rs-icon icon-type="round" icon-name="chevron_left"></rs-icon>
              </button>
            </div>
          </mp-splitpane-toggle-off>
          <mp-splitpane-sidebar-open style="flex: 1;">
            <div class="split-pane__sidebar-open">
              <div class="collection-terms-area">
              
                <mp-event-trigger id='{{viewId}}-resource-config-form-new-trigger' 
                                  type='Component.TemplateUpdate' 
                                  data='{"mode": "new" }' 
                                  targets='["{{viewId}}-resource-config-term-forms"]'>
                  <button class="btn btn-action btn-textAndIcon" style="margin-bottom: 10px; justify-content: center;">
                    <rs-icon icon-type="round" icon-name="add_box"></rs-icon>
                    <span>New configuration</span>
                  </button>
                </mp-event-trigger>
            
                <mp-event-target-template-render id='{{viewId}}-resource-config-mytree'  template='{{> treeTemplate}}'>
                  <template id='treeTemplate'>
                    <semantic-lazy-tree id='{{viewId}}-resource-config-scheme-tree' 
                                        info-template='{{> template}}'  
                                        input-placeholder='Select configuration' 
                                        type='simple'  
                                        focused='{{#if (not (eq mode "deleted"))}}{{iri}}{{/if}}' 
                                        page-size='10000'
                                        config='{"scheme": "http://www.researchspace.org/resource/system/resource_configurations_container", 
                                                {{#if resourceLabelPattern}}
                                                  "labelPattern": "{{resourceLabelPattern}}",
                                                {{else}}
                                                  "labelPattern": "?item <http://www.researchspace.org/pattern/system/resource_configuration/resource_name> ?label . ",
                                                {{/if}}
                                                
                                                "orderByPattern": "BIND(?label as ?order)",
                                                
                                                "schemePattern": " ?item <http://www.cidoc-crm.org/cidoc-crm/P71i_is_listed_in> ?__scheme__ . 
                                                                      FILTER(?label != \"Finder\" )
                                                                      {{#if resourceOntologyClass }} ?item a/rdfs:subClassOf* <{{resourceOntologyClass }}> . {{/if}} 
                                                                      {{#if resourceP2Type}} ?item <http://www.researchspace.org/pattern/system/resource_configuration/resource_type> <{{resourceP2Type}}> . {{/if}}
                                                                      {{#if resourceRestrictionPattern}}{{resourceRestrictionPattern}}{{/if}}"
                                                 
                                                }'>
                      <template id='template'>
                        <span class="tree-item-actions-container">
                          <div style="display: flex; align-items: center; gap: 7px;">

                            <semantic-if query='ASK { <{{iri}}> <http://www.researchspace.org/pattern/system/resource_configuration/resource_use_as_vocabulary_type> ?value . }'
                              then='{{> useAsVocabularyType}}'
                            >
                              <template id='useAsVocabularyType'>
                                <span class="badge badge--secondary" style="height: 28px;">Voc. / Auth.</span>
                              </template>
                            </semantic-if>

                            <semantic-if query='ASK { <{{iri}}> <http://www.researchspace.org/pattern/system/resource_configuration/resource_in_finder> ?value . }'
                                        then='{{> inFinder}}'
                                        else="{{> else}}"
                            >
                              <template id='inFinder'>
                                <span class="badge badge--secondary" style="height: 28px; width: 54px;">Finder</span>
                              </template>

                              <template id='else'>
                                <span style="width: 54px;"></span>
                              </template>
                            </semantic-if>

                           <semantic-if query='ASK { <{{iri}}> crm:P2_has_type <http://www.researchspace.org/pattern/system/resource_configuration/configuration_type/system> . }'
                                          then='{{> system}}'
                            >
                                <template id='system'>
                                  <span class="badge badge--secondary" style="height: 28px; width: 54px;">System</span>
                                </template>
                            </semantic-if> 

                            <mp-event-trigger id='{{viewId}}-resource-config-form-edit-trigger--{{iri}}' 
                                              type='Component.TemplateUpdate'
                                              data='{"iri":"{{iri}}", "label": "{{label}}", "mode": "edit" }' 
                                              targets='["{{viewId}}-resource-config-term-forms"]'>
                              <span class='tree-item-action'>
                                <rs-icon icon-type="round" icon-name="edit" title="Edit configuration"></rs-icon>
                              </span>
                            </mp-event-trigger>

                          </div>
                          
                          <mp-event-proxy id='{{viewId}}-resource-config-focus-tree-element' 
                                          on-event-source='{{viewId}}-resource-config-form-edit-trigger--{{iri}}' 
                                          proxy-event-type='LazyTree.Focus' 
                                          proxy-targets='["{{viewId}}-resource-config-scheme-tree"]' 
                                          data='{"iri":"{{iri}}"}'>
                          </mp-event-proxy>
                        </span>
                      </template>
                    </semantic-lazy-tree> 
                  </template>
                </mp-event-target-template-render>
              </div>
            </div>
          </mp-splitpane-sidebar-open>
        </div>

          <div class="page__grid-container">
    
            <div class="page__content-container resource-editView-form-container">
              <mp-event-target-template-render id='{{viewId}}-resource-config-term-forms' template='{{> template}}'>
                <template id='template'>
        
                  {{#ifCond mode "==" "deleted"}}
                    <mp-event-target-template-render id='{{viewId}}-deleted-state' template='{{> template}}'>
                      <template id='template'>
                        {{#if hideMessage}}
                        {{else}}
                            <div class='success-documentation-section success-documentation-section-withIcon' style="width: 100%;">
                              <div class="success-documentation-section-icon-container">
                                <rs-icon icon-type="round" icon-name="done"></rs-icon>
                              </div>
            
                              <div style="flex: 1;"> 
                                <div class="success-documentation-section-title">Success!</div>
                                <div class="success-documentation-section-content">
                                  <span style="text-transform: capitalize;">{{label}}</span>
                                  <span> has been deleted.</span>
                                </div>
                              </div>
                              
                              <mp-event-trigger id='{{viewId}}-cancel-deleted-state-message-{{iri}}'
                                                type='Component.TemplateUpdate'
                                                data='{ "hideMessage": "true" }'
                                                targets='["{{viewId}}-deleted-state"]'
                              >
                                <button class="btn btn-documentation">
                                  <rs-icon icon-type="round" icon-name="close"></rs-icon>
                                </button>
                              </mp-event-trigger>
                            </div>
                        {{/if}}
                      </template>
                    </mp-event-target-template-render>
                  {{/ifCond}}

                  {{#if (not (eq mode "deleted"))}}
                    <mp-event-proxy id='{{viewId}}-resource-config-tree-refresh-on-created' 
                                    on-event-source='{{viewId}}-resource-form' 
                                    on-event-types='["Form.ResourceCreated", "Form.ResourceUpdated"]'
                                    proxy-event-type='Component.TemplateUpdate' 
                                    proxy-targets='["{{viewId}}-resource-config-mytree", "{{viewId}}-resource-config-term-forms"]'
                                    additional-data='{"mode": "edit"}'
                    ></mp-event-proxy>
          
                    <mp-event-proxy id='{{viewId}}-resource-config-tree-refresh-on-delete' 
                                    on-event-source='{{viewId}}-resource-form' 
                                    on-event-types='["Form.ResourceRemoved"]'
                                    proxy-event-type='Component.TemplateUpdate' 
                                    proxy-targets='["{{viewId}}-resource-config-mytree", "{{viewId}}-resource-config-term-forms"]'
                                    additional-data='{"mode": "deleted", "label": "{{label}}"}'
                    ></mp-event-proxy>
      
                    {{#if mode}}
                      <inline-template template-iri='[[resolvePrefix "rsp:ResourceConfigForm"]]' 
                                      options='{
                                                "scheme": "http://www.researchspace.org/resource/custom/resource_configurations_container", 
                                                {{#ifCond mode "!==" "new"}}"node": "{{iri}}",{{/ifCond}}
                                                {{#if broader}}"broader": "{{broader}}",{{/if}}
                                                "editable": true,
                                                "mode": "{{mode}}",
                                                "viewId": "{{viewId}}",
                                                "resourceBroaderProperty": {{#if resourceBroaderProperty}}"{{resourceBroaderProperty}}"{{else}}null{{/if}}
                                      }'>
                      </inline-template>
                    {{/if}}
                  
                  {{else}}
                    <div></div>
                  {{/if}}
                </template>
              </mp-event-target-template-render>
            </div>
          </div>

      </mp-splitpane>
  </div>
{{/bind}}
